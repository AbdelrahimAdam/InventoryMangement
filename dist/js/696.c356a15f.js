"use strict";(self["webpackChunkmonofia_perfume_inventory"]=self["webpackChunkmonofia_perfume_inventory"]||[]).push([[696],{696:function(e,a,o){o.d(a,{A:function(){return G}});var l=o(641),t=o(751),s=o(33);const r={key:0,class:"modal-overlay"},n={class:"modal-content"},u={class:"modal-header"},i={class:"modal-body"},c={class:"form-group"},d={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},m={class:"form-group"},v={class:"form-group"},p={class:"form-group"},_=["value"],g={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},k={class:"form-group"},b={class:"form-group"},f={class:"form-group"},h={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 sm:space-x-reverse mb-4"},L={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},y={class:"form-group"},w={class:"form-group"},E={key:1,class:"form-group"},M={class:"form-group"},C={key:2,class:"alert alert-info"},x={class:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},D={key:0},W={key:1},q={class:"col-span-full border-t pt-1 font-medium mt-1"},I={key:3,class:"alert alert-warning"},V={class:"mt-2 text-sm"},X={key:4,class:"alert alert-danger"},O={class:"alert-message"},Q={key:5,class:"alert alert-success"},U={class:"alert-message"},J={key:6,class:"alert alert-danger"},B={class:"alert-message"},S={class:"modal-footer"},K={class:"flex gap-2"},A=["disabled"],R={key:0,class:"spinner spinner-sm",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},z={key:1,class:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function F(e,a,o,F,j,H){return o.isOpen?((0,l.uX)(),(0,l.CE)("div",r,[(0,l.Lk)("div",n,[(0,l.Lk)("div",u,[a[17]||(a[17]=(0,l.Lk)("h2",{class:"modal-title"},"إضافة صنف جديد",-1)),(0,l.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>F.closeModal&&F.closeModal(...e)),class:"modal-close-btn"},[...a[16]||(a[16]=[(0,l.Lk)("svg",{class:"modal-close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,l.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,l.Lk)("div",i,[(0,l.Lk)("form",{onSubmit:a[15]||(a[15]=(0,t.D$)((...e)=>F.handleSubmit&&F.handleSubmit(...e),["prevent"])),class:"space-y-4"},[(0,l.Lk)("div",c,[a[18]||(a[18]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)(" الاسم "),(0,l.Lk)("span",{class:"required-star"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",required:"","onUpdate:modelValue":a[1]||(a[1]=e=>F.formData.name=e),class:"form-input",placeholder:"أدخل اسم الصنف"},null,512),[[t.Jo,F.formData.name]])]),(0,l.Lk)("div",d,[(0,l.Lk)("div",m,[a[19]||(a[19]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)(" الكود "),(0,l.Lk)("span",{class:"required-star"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",required:"","onUpdate:modelValue":a[2]||(a[2]=e=>F.formData.code=e),class:"form-input",placeholder:"كود الصنف"},null,512),[[t.Jo,F.formData.code]])]),(0,l.Lk)("div",v,[a[20]||(a[20]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)(" اللون "),(0,l.Lk)("span",{class:"required-star"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",required:"","onUpdate:modelValue":a[3]||(a[3]=e=>F.formData.color=e),class:"form-input",placeholder:"لون الصنف"},null,512),[[t.Jo,F.formData.color]])])]),(0,l.Lk)("div",p,[a[22]||(a[22]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)(" المخزن "),(0,l.Lk)("span",{class:"required-star"},"*")],-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>F.formData.warehouse_id=e),class:"form-select",required:""},[a[21]||(a[21]=(0,l.Lk)("option",{value:""},"اختر المخزن",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(F.accessibleWarehouses,e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,s.v_)(e.name_ar),9,_))),128))],512),[[t.u1,F.formData.warehouse_id]])]),(0,l.Lk)("div",g,[(0,l.Lk)("div",k,[a[23]||(a[23]=(0,l.Lk)("label",{class:"form-label"}," المورد ",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>F.formData.supplier=e),class:"form-input",placeholder:"اسم المورد"},null,512),[[t.Jo,F.formData.supplier]])]),(0,l.Lk)("div",b,[a[24]||(a[24]=(0,l.Lk)("label",{class:"form-label"}," مكان الصنف ",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=e=>F.formData.item_location=e),class:"form-input",placeholder:"مكان الصنف داخل المخزن"},null,512),[[t.Jo,F.formData.item_location]])])]),(0,l.Lk)("div",f,[a[25]||(a[25]=(0,l.Lk)("label",{class:"form-label"}," طريقة الإضافة ",-1)),(0,l.Lk)("div",h,[(0,l.Lk)("button",{type:"button",onClick:a[7]||(a[7]=e=>F.addMode="cartons"),class:(0,s.C4)(["mode-btn","cartons"===F.addMode?"mode-btn-active":"mode-btn-inactive"])}," كراتين ",2),(0,l.Lk)("button",{type:"button",onClick:a[8]||(a[8]=e=>F.addMode="single"),class:(0,s.C4)(["mode-btn","single"===F.addMode?"mode-btn-active":"mode-btn-inactive"])}," فردي ",2),(0,l.Lk)("button",{type:"button",onClick:a[9]||(a[9]=e=>F.addMode="both"),class:(0,s.C4)(["mode-btn","both"===F.addMode?"mode-btn-active":"mode-btn-inactive"])}," الاثنين معاً ",2)])]),"cartons"===F.addMode||"both"===F.addMode?((0,l.uX)(),(0,l.CE)("div",L,[(0,l.Lk)("div",y,[a[26]||(a[26]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)(" عدد الكراتين "),(0,l.Lk)("span",{class:"required-star"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",min:"0",required:"","onUpdate:modelValue":a[10]||(a[10]=e=>F.formData.cartons_count=e),class:"form-input"},null,512),[[t.Jo,F.formData.cartons_count,void 0,{number:!0}]])]),(0,l.Lk)("div",w,[a[27]||(a[27]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)(" عدد في الكرتونة "),(0,l.Lk)("span",{class:"required-star"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",min:"1",required:"","onUpdate:modelValue":a[11]||(a[11]=e=>F.formData.per_carton_count=e),class:"form-input"},null,512),[[t.Jo,F.formData.per_carton_count,void 0,{number:!0}]])])])):(0,l.Q3)("",!0),"single"===F.addMode||"both"===F.addMode?((0,l.uX)(),(0,l.CE)("div",E,[a[28]||(a[28]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)(" عدد القزاز الفردي "),(0,l.Lk)("span",{class:"required-star"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",min:"0",required:"","onUpdate:modelValue":a[12]||(a[12]=e=>F.formData.single_bottles_count=e),class:"form-input"},null,512),[[t.Jo,F.formData.single_bottles_count,void 0,{number:!0}]])])):(0,l.Q3)("",!0),(0,l.Lk)("div",M,[a[29]||(a[29]=(0,l.Lk)("label",{class:"form-label"}," ملاحظات ",-1)),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":a[13]||(a[13]=e=>F.formData.notes=e),rows:"2",class:"form-textarea",placeholder:"ملاحظات إضافية (اختياري)"},null,512),[[t.Jo,F.formData.notes]])]),F.showSummary?((0,l.uX)(),(0,l.CE)("div",C,[a[30]||(a[30]=(0,l.Lk)("h4",{class:"alert-title"},"ملخص الكمية:",-1)),(0,l.Lk)("div",x,["cartons"===F.addMode||"both"===F.addMode?((0,l.uX)(),(0,l.CE)("div",D," الكراتين: "+(0,s.v_)(F.formData.cartons_count)+" × "+(0,s.v_)(F.formData.per_carton_count)+" = "+(0,s.v_)(F.cartonsTotal),1)):(0,l.Q3)("",!0),"single"===F.addMode||"both"===F.addMode?((0,l.uX)(),(0,l.CE)("div",W," الفردي: "+(0,s.v_)(F.formData.single_bottles_count),1)):(0,l.Q3)("",!0),(0,l.Lk)("div",q," الإجمالي: "+(0,s.v_)(F.totalQuantity),1)])])):(0,l.Q3)("",!0),F.existingItem&&!F.storeOperationError?((0,l.uX)(),(0,l.CE)("div",I,[a[31]||(a[31]=(0,l.Fv)('<div class="flex items-center" data-v-42481776><svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20" data-v-42481776><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" data-v-42481776></path></svg><h4 class="alert-title" data-v-42481776>تم العثور على صنف موجود</h4></div><p class="alert-message" data-v-42481776> يوجد بالفعل صنف بنفس الاسم واللون والكود في هذا المخزن. سيتم تحديث الكميات بدلاً من إنشاء صنف جديد. </p>',2)),(0,l.Lk)("div",V,[(0,l.Lk)("p",null,"الكمية الحالية: "+(0,s.v_)(F.existingItem.remaining_quantity),1),(0,l.Lk)("p",null,"الكمية المضافة سابقاً: "+(0,s.v_)(F.existingItem.total_added),1)])])):(0,l.Q3)("",!0),F.storeOperationError?((0,l.uX)(),(0,l.CE)("div",X,[(0,l.Lk)("p",O,(0,s.v_)(F.storeOperationError),1)])):(0,l.Q3)("",!0),F.successMessage?((0,l.uX)(),(0,l.CE)("div",Q,[(0,l.Lk)("p",U,(0,s.v_)(F.successMessage),1)])):(0,l.Q3)("",!0),F.errorMessage?((0,l.uX)(),(0,l.CE)("div",J,[(0,l.Lk)("p",B,(0,s.v_)(F.errorMessage),1)])):(0,l.Q3)("",!0),(0,l.Lk)("div",S,[(0,l.Lk)("div",K,[(0,l.Lk)("button",{type:"button",onClick:a[14]||(a[14]=(...e)=>F.closeModal&&F.closeModal(...e)),class:"btn-secondary"}," إلغاء "),(0,l.Lk)("button",{type:"submit",disabled:F.loading||F.storeOperationLoading||!F.isFormValid,class:"btn-primary"},[F.loading||F.storeOperationLoading?((0,l.uX)(),(0,l.CE)("svg",R,[...a[32]||(a[32]=[(0,l.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,l.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,l.uX)(),(0,l.CE)("svg",z,[...a[33]||(a[33]=[(0,l.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"},null,-1)])])),(0,l.eW)(" "+(0,s.v_)(F.loading||F.storeOperationLoading?"جاري الحفظ...":F.existingItem?"تحديث الكميات":"إضافة الصنف"),1)],8,A)])])],32)])])])):(0,l.Q3)("",!0)}var j=o(953),H=o(278),T={name:"AddItemModal",props:{isOpen:{type:Boolean,required:!0}},emits:["close","success"],setup(e,{emit:a}){const o=(0,H.Pj)(),t=(0,j.KR)(!1),s=(0,j.KR)(""),r=(0,j.KR)(""),n=(0,j.KR)("both"),u=(0,j.KR)(null),i=(0,j.KR)({name:"",code:"",color:"",warehouse_id:"",supplier:"",item_location:"",cartons_count:0,per_carton_count:12,single_bottles_count:0,notes:""}),c=(0,l.EW)(()=>o.getters.accessibleWarehouses),d=(0,l.EW)(()=>o.state.operationLoading),m=(0,l.EW)(()=>o.state.operationError),v=((0,l.EW)(()=>o.state.user),(0,l.EW)(()=>o.state.user?.uid)),p=((0,l.EW)(()=>o.state.userProfile),(0,l.EW)(()=>i.value.cartons_count*i.value.per_carton_count)),_=(0,l.EW)(()=>{const e=p.value,a=i.value.single_bottles_count||0;return e+a}),g=(0,l.EW)(()=>_.value>0),k=(0,l.EW)(()=>!!i.value.name.trim()&&(!!i.value.code.trim()&&(!!i.value.color.trim()&&(!!i.value.warehouse_id&&("cartons"===n.value?i.value.cartons_count>0&&i.value.per_carton_count>0:"single"===n.value?i.value.single_bottles_count>0:"both"===n.value&&_.value>0))))),b=(0,l.EW)(()=>("cartons"===n.value||"both"===n.value)&&i.value.cartons_count>0);(0,l.wB)(()=>e.isOpen,e=>{if(e&&(h(),c.value.length>0)){const e=o.getters.mainWarehouse;i.value.warehouse_id=e?.id||c.value[0].id}}),(0,l.wB)(c,e=>{if(e.length>0&&!i.value.warehouse_id){const a=o.getters.mainWarehouse;i.value.warehouse_id=a?.id||e[0].id}}),(0,l.wB)([()=>i.value.name,()=>i.value.code,()=>i.value.color,()=>i.value.warehouse_id],async([e,a,o,l])=>{e&&a&&o&&l?await L():u.value=null},{immediate:!0});const f=()=>{a("close"),h()},h=()=>{i.value={name:"",code:"",color:"",warehouse_id:c.value.length>0?o.getters.mainWarehouse?.id||c.value[0].id:"",supplier:"",item_location:"",cartons_count:0,per_carton_count:12,single_bottles_count:0,notes:""},n.value="both",s.value="",r.value="",u.value=null,o.dispatch("clearOperationError")},L=async()=>{if(i.value.name&&i.value.code&&i.value.color&&i.value.warehouse_id)try{const e=await o.dispatch("checkExistingItem",{name:i.value.name.trim(),code:i.value.code.trim(),color:i.value.color.trim(),warehouse_id:i.value.warehouse_id});e&&e.exists&&e.item?u.value=e.item:u.value=null}catch(e){console.error("Error checking existing item:",e),u.value=null}else u.value=null},y=()=>{if(s.value="",o.dispatch("clearOperationError"),!i.value.name.trim())return s.value="يرجى إدخال اسم الصنف",!1;if(!i.value.code.trim())return s.value="يرجى إدخال كود الصنف",!1;if(!i.value.color.trim())return s.value="يرجى إدخال لون الصنف",!1;if(!i.value.warehouse_id)return s.value="يرجى اختيار المخزن",!1;if(!v.value)return s.value="يجب تسجيل الدخول أولاً",!1;if(!o.getters.canEdit)return s.value="ليس لديك صلاحية لإضافة أصناف",!1;if("cartons"===n.value){if(!i.value.cartons_count||i.value.cartons_count<=0)return s.value="يرجى إدخال عدد كراتين صحيح",!1;if(!i.value.per_carton_count||i.value.per_carton_count<=0)return s.value="يرجى إدخال عدد صحيح في الكرتونة",!1}else if("single"===n.value){if(!i.value.single_bottles_count||i.value.single_bottles_count<=0)return s.value="يرجى إدخال عدد فردي صحيح",!1}else if("both"===n.value){const e=i.value.cartons_count&&i.value.cartons_count>0&&i.value.per_carton_count&&i.value.per_carton_count>0,a=i.value.single_bottles_count&&i.value.single_bottles_count>0;if(!e&&!a)return s.value="يرجى إدخال كميات صحيحة إما في الكراتين أو الفردي",!1}return!(_.value<=0)||(s.value="يرجى إدخال كمية صحيحة",!1)},w=async()=>{if(y()){t.value=!0,s.value="",r.value="";try{const e=v.value;if(!e)throw new Error("يجب تسجيل الدخول أولاً");const l=b.value,t={name:i.value.name.trim(),code:i.value.code.trim(),color:i.value.color.trim(),warehouse_id:i.value.warehouse_id,cartons_count:i.value.cartons_count||0,per_carton_count:i.value.per_carton_count||(l?12:1),single_bottles_count:i.value.single_bottles_count||0,supplier:i.value.supplier?.trim()||"",item_location:i.value.item_location?.trim()||"",notes:i.value.notes?.trim()||""};console.log("Submitting item with data:",{itemData:t,userId:e,addingCartons:l,existingItem:u.value});const s=await o.dispatch("addInventoryItemAtomic",{itemData:t,userId:e,isAddingCartons:l});console.log("Item operation completed:",s),r.value="created"===s?.type?"تم إضافة الصنف الجديد بنجاح!":"updated"===s?.type?"تم تحديث الكميات بنجاح!":"تم حفظ التغييرات بنجاح!",setTimeout(()=>{a("success",s||{type:u.value?"updated":"created"}),f()},1500)}catch(e){console.error("Error in handleSubmit:",e),e.message?.includes("يجب تسجيل الدخول")?s.value="يجب تسجيل الدخول أولاً":e.message?.includes("صلاحية")?s.value="ليس لديك صلاحية لإضافة أصناف. يرجى التواصل مع المشرف.":e.message?.includes("مطلوب")||e.message?.includes("الحقل")?s.value=e.message:e.message?.includes("الشبكة")||e.message?.includes("الاتصال")?s.value="خطأ في الاتصال بالشبكة. يرجى التحقق من اتصال الإنترنت والمحاولة مرة أخرى.":m.value?s.value=m.value:s.value=`حدث خطأ أثناء حفظ الصنف: ${e.message||"خطأ غير معروف"}`}finally{t.value=!1}}};return{loading:t,errorMessage:s,successMessage:r,addMode:n,existingItem:u,formData:i,accessibleWarehouses:c,storeOperationLoading:d,storeOperationError:m,cartonsTotal:p,totalQuantity:_,showSummary:g,isFormValid:k,closeModal:f,handleSubmit:w}}},P=o(262);const $=(0,P.A)(T,[["render",F],["__scopeId","data-v-42481776"]]);var G=$}}]);