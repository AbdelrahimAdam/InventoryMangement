"use strict";(self["webpackChunkmonofia_perfume_inventory"]=self["webpackChunkmonofia_perfume_inventory"]||[]).push([[808],{155:function(e,r,a){a.d(r,{A:function(){return se}});var t=a(641),s=a(33),o=a(751);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},d={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl rtl max-h-[90vh] overflow-y-auto"},n={class:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700"},i={class:"text-xl font-semibold text-gray-800 dark:text-white"},u={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},c=["readonly"],g={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},m={class:"relative inline-flex items-center cursor-pointer"},k={class:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300"},p={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},x=["value","onUpdate:modelValue","disabled"],h={class:"flex w-full items-center justify-between"},b={class:"flex items-center"},v={class:"text-sm"},y={class:"font-medium text-gray-900 dark:text-white"},w={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},f={key:0,class:"h-5 w-5 text-blue-600 dark:text-blue-400",viewBox:"0 0 20 20",fill:"currentColor"},L={key:0,class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},_={key:0},C={class:"flex gap-3"},E={key:1},M={key:0,class:"text-center py-4"},W={key:1,class:"space-y-3"},X={class:"flex items-center justify-between mb-2"},D={class:"text-sm text-gray-600 dark:text-gray-400"},j={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},U={class:"flex items-center h-5"},P=["value"],S={class:"mr-3 text-sm"},A={class:"font-medium text-gray-900 dark:text-white"},R={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},B={key:2,class:"text-center py-4 border border-gray-200 dark:border-gray-600 rounded-lg"},K={key:3,class:"text-red-500 text-sm mt-2"},V={key:2,class:"bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4"},z={class:"text-sm text-gray-600 dark:text-gray-300 space-y-1"},Q={key:3,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},I={class:"text-sm text-red-700 dark:text-red-300 list-disc pr-5 space-y-1"},F={key:4,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},H={class:"text-sm text-red-700 dark:text-red-300"},N={class:"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700"},$=["disabled"],T={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},O={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function J(e,r,a,J,q,G){return a.isOpen?((0,t.uX)(),(0,t.CE)("div",l,[(0,t.Lk)("div",d,[(0,t.Lk)("div",n,[(0,t.Lk)("h2",i,(0,s.v_)(a.user?"تعديل المستخدم":"إضافة مستخدم جديد"),1),(0,t.Lk)("button",{onClick:r[0]||(r[0]=r=>e.$emit("close")),class:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors duration-200"},[...r[11]||(r[11]=[(0,t.Lk)("svg",{class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,t.Lk)("form",{onSubmit:r[10]||(r[10]=(0,o.D$)((...e)=>J.handleSubmit&&J.handleSubmit(...e),["prevent"])),class:"p-6 space-y-6"},[(0,t.Lk)("div",u,[(0,t.Lk)("div",null,[r[12]||(r[12]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,t.eW)(" الاسم الكامل "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",required:"","onUpdate:modelValue":r[1]||(r[1]=e=>J.formData.name=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"أدخل الاسم الكامل"},null,512),[[o.Jo,J.formData.name]])]),(0,t.Lk)("div",null,[r[13]||(r[13]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,t.eW)(" البريد الإلكتروني "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.bo)((0,t.Lk)("input",{type:"email",required:"","onUpdate:modelValue":r[2]||(r[2]=e=>J.formData.email=e),readonly:!!a.user,class:(0,s.C4)(["w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",{"bg-gray-100 dark:bg-gray-800":!!a.user}]),placeholder:"example@company.com"},null,10,c),[[o.Jo,J.formData.email]])])]),(0,t.Lk)("div",g,[(0,t.Lk)("div",null,[r[14]||(r[14]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," رقم الهاتف ",-1)),(0,t.bo)((0,t.Lk)("input",{type:"tel","onUpdate:modelValue":r[3]||(r[3]=e=>J.formData.phone=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"01XXXXXXXXX"},null,512),[[o.Jo,J.formData.phone]])]),(0,t.Lk)("div",null,[r[16]||(r[16]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"حالة الحساب",-1)),(0,t.Lk)("label",m,[(0,t.bo)((0,t.Lk)("input",{type:"checkbox","onUpdate:modelValue":r[4]||(r[4]=e=>J.formData.is_active=e),class:"sr-only peer"},null,512),[[o.lH,J.formData.is_active]]),r[15]||(r[15]=(0,t.Lk)("div",{class:"w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"},null,-1)),(0,t.Lk)("span",k,(0,s.v_)(J.formData.is_active?"نشط":"غير نشط"),1)])])]),(0,t.Lk)("div",null,[r[18]||(r[18]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},[(0,t.eW)(" الدور "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.Lk)("div",p,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(J.availableRoles,e=>((0,t.uX)(),(0,t.CE)("label",{key:e.value,class:(0,s.C4)(["relative flex cursor-pointer rounded-lg border p-4 focus:outline-none transition-colors duration-200",{"border-blue-600 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/20":J.formData.role===e.value,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700":J.formData.role!==e.value}])},[(0,t.bo)((0,t.Lk)("input",{type:"radio",value:e.value,"onUpdate:modelValue":e=>J.formData.role=e,disabled:"superadmin"===a.user?.role,class:"sr-only"},null,8,x),[[o.XL,J.formData.role]]),(0,t.Lk)("div",h,[(0,t.Lk)("div",b,[(0,t.Lk)("div",v,[(0,t.Lk)("div",y,(0,s.v_)(e.name),1),(0,t.Lk)("div",w,(0,s.v_)(e.description),1)])]),J.formData.role===e.value?((0,t.uX)(),(0,t.CE)("svg",f,[...r[17]||(r[17]=[(0,t.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])])):(0,t.Q3)("",!0)])],2))),128))]),"superadmin"===a.user?.role?((0,t.uX)(),(0,t.CE)("p",L," لا يمكن تغيير دور المشرف العام ")):(0,t.Q3)("",!0)]),a.user?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",_,[r[19]||(r[19]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,t.eW)(" كلمة المرور "),(0,t.Lk)("span",{class:"text-red-500"},"*"),(0,t.Lk)("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"(سيستخدمها المستخدم للدخول)")],-1)),(0,t.Lk)("div",C,[(0,t.bo)((0,t.Lk)("input",{type:"text",required:"","onUpdate:modelValue":r[5]||(r[5]=e=>J.formData.password=e),class:"flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"كلمة المرور المؤقتة"},null,512),[[o.Jo,J.formData.password]]),(0,t.Lk)("button",{type:"button",onClick:r[6]||(r[6]=(...e)=>J.generatePassword&&J.generatePassword(...e)),class:"px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200 text-sm font-medium"}," توليد عشوائي ")]),r[20]||(r[20]=(0,t.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"}," يجب أن تكون كلمة المرور 6 أحرف على الأقل ",-1))])),"warehouse_manager"===J.formData.role?((0,t.uX)(),(0,t.CE)("div",E,[r[23]||(r[23]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},[(0,t.eW)(" المخازن المسموحة "),(0,t.Lk)("span",{class:"text-red-500"},"*"),(0,t.Lk)("span",{class:"text-xs text-gray-500 dark:text-gray-400 block mt-1"},"اختر المخازن التي يمكن للمستخدم الوصول إليها")],-1)),J.loadingWarehouses?((0,t.uX)(),(0,t.CE)("div",M,[...r[21]||(r[21]=[(0,t.Lk)("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 dark:border-blue-400 mx-auto"},null,-1),(0,t.Lk)("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},"جاري تحميل المخازن...",-1)])])):((0,t.uX)(),(0,t.CE)("div",W,[(0,t.Lk)("div",X,[(0,t.Lk)("div",D,(0,s.v_)(J.primaryWarehouses.length)+" مخزن متاح ",1),(0,t.Lk)("button",{type:"button",onClick:r[7]||(r[7]=(...e)=>J.toggleAllWarehouses&&J.toggleAllWarehouses(...e)),class:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"},(0,s.v_)(J.formData.allowed_warehouses.length===J.primaryWarehouses.length?"إلغاء الكل":"اختيار الكل"),1)]),(0,t.Lk)("div",j,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(J.primaryWarehouses,e=>((0,t.uX)(),(0,t.CE)("label",{key:e.id,class:(0,s.C4)(["relative flex items-start p-3 border rounded-lg transition-colors duration-200",{"border-blue-300 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/20":J.formData.allowed_warehouses.includes(e.id),"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600":!J.formData.allowed_warehouses.includes(e.id)}])},[(0,t.Lk)("div",U,[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":r[8]||(r[8]=e=>J.formData.allowed_warehouses=e),class:"h-4 w-4 text-blue-600 dark:text-blue-400 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400"},null,8,P),[[o.lH,J.formData.allowed_warehouses]])]),(0,t.Lk)("div",S,[(0,t.Lk)("div",A,(0,s.v_)(e.name_ar),1),(0,t.Lk)("div",R,(0,s.v_)(e.name_en),1)])],2))),128))])])),J.loadingWarehouses||0!==J.primaryWarehouses.length?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",B,[...r[22]||(r[22]=[(0,t.Lk)("svg",{class:"mx-auto h-8 w-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),(0,t.Lk)("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},"لا توجد مخازن متاحة",-1)])])),0===J.formData.allowed_warehouses.length&&J.primaryWarehouses.length>0?((0,t.uX)(),(0,t.CE)("p",K," يجب اختيار مخزن واحد على الأقل لمدير المخازن ")):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),J.formData.role?((0,t.uX)(),(0,t.CE)("div",V,[r[25]||(r[25]=(0,t.Lk)("h4",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"},"ملخص الصلاحيات:",-1)),(0,t.Lk)("ul",z,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(J.getRolePermissions(J.formData.role),e=>((0,t.uX)(),(0,t.CE)("li",{key:e,class:"flex items-center"},[r[24]||(r[24]=(0,t.Lk)("svg",{class:"h-4 w-4 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),(0,t.eW)(" "+(0,s.v_)(e),1)]))),128))])])):(0,t.Q3)("",!0),J.validationErrors.length>0?((0,t.uX)(),(0,t.CE)("div",Q,[r[26]||(r[26]=(0,t.Lk)("h4",{class:"text-sm font-medium text-red-800 dark:text-red-300 mb-2"},"خطأ في التحقق:",-1)),(0,t.Lk)("ul",I,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(J.validationErrors,e=>((0,t.uX)(),(0,t.CE)("li",{key:e},(0,s.v_)(e),1))),128))])])):(0,t.Q3)("",!0),J.errorMessage?((0,t.uX)(),(0,t.CE)("div",F,[(0,t.Lk)("p",H,(0,s.v_)(J.errorMessage),1)])):(0,t.Q3)("",!0),(0,t.Lk)("div",N,[(0,t.Lk)("button",{type:"button",onClick:r[9]||(r[9]=r=>e.$emit("close")),class:"flex-1 py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 font-medium"}," إلغاء "),(0,t.Lk)("button",{type:"submit",disabled:J.loading||!J.isFormValid,class:"flex-1 py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-md hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 font-medium flex items-center justify-center gap-2"},[J.loading?((0,t.uX)(),(0,t.CE)("svg",T,[...r[27]||(r[27]=[(0,t.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,t.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,t.uX)(),(0,t.CE)("svg",O,[...r[28]||(r[28]=[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),(0,t.eW)(" "+(0,s.v_)(J.loading?"جاري الحفظ...":a.user?"تحديث":"إضافة"),1)],8,$)])],32)])])):(0,t.Q3)("",!0)}var q=a(953),G=a(278),Z=a(556),Y=a(496),ee=a(884),re={name:"UserModal",props:{isOpen:{type:Boolean,required:!0},user:{type:Object,default:null}},emits:["close","save"],setup(e,{emit:r}){const a=(0,G.Pj)(),s=(0,q.KR)(!1),o=(0,q.KR)(!1),l=(0,q.KR)(""),d=(0,q.KR)([]),n=(0,q.KR)({name:"",email:"",role:"company_manager",is_active:!0,phone:"",allowed_warehouses:[],password:""}),i=(0,q.KR)([{value:"superadmin",name:"المشرف العام",description:"صلاحيات كاملة على النظام"},{value:"warehouse_manager",name:"مدير المخازن",description:"إدارة المخزون والحركات في المخازن المحددة"},{value:"company_manager",name:"مدير الشركة",description:"عرض التقارير والبيانات (قراءة فقط)"}]),u=(0,t.EW)(()=>{const e=a.state.warehouses||[];return e.filter(e=>"primary"===e.type)}),c=(0,t.EW)(()=>(d.value=[],n.value.name.trim()||d.value.push("الاسم الكامل مطلوب"),n.value.email.trim()?g(n.value.email)||d.value.push("صيغة البريد الإلكتروني غير صحيحة"):d.value.push("البريد الإلكتروني مطلوب"),n.value.role||d.value.push("الدور مطلوب"),e.user||n.value.password?!e.user&&n.value.password.length<6&&d.value.push("كلمة المرور يجب أن تكون 6 أحرف على الأقل"):d.value.push("كلمة المرور مطلوبة"),"warehouse_manager"===n.value.role&&0===n.value.allowed_warehouses.length&&d.value.push("يجب اختيار مخزن واحد على الأقل لمدير المخازن"),n.value.phone&&!m(n.value.phone)&&d.value.push("رقم الهاتف غير صحيح"),0===d.value.length)),g=e=>{const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return r.test(e)},m=e=>{const r=/^01[0-9]{9}$/;return r.test(e)},k=e=>{const r={superadmin:["الوصول الكامل إلى جميع المخازن","إدارة المستخدمين والأدوار","إنشاء وتعديل وحذف الأصناف","إدارة الحركات والنقل","تصدير التقارير والبيانات","إعدادات النظام"],warehouse_manager:["الوصول إلى المخازن المحددة فقط","إنشاء وتعديل الأصناف في المخازن المسموحة","إدارة الحركات والنقل بين المخازن المسموحة","عرض التقارير للمخازن المسموحة","تصدير بيانات المخازن المسموحة"],company_manager:["عرض جميع البيانات للقراءة فقط","تصفية البيانات والتقارير","تصدير التقارير والبيانات","لا يمكن التعديل أو الحذف"]};return r[e]||[]},p=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let r="";for(let a=0;a<12;a++)r+=e.charAt(Math.floor(Math.random()*e.length));n.value.password=r},x=()=>{n.value.allowed_warehouses.length===u.value.length?n.value.allowed_warehouses=[]:n.value.allowed_warehouses=u.value.map(e=>e.id)},h=()=>{n.value={name:"",email:"",role:"company_manager",is_active:!0,phone:"",allowed_warehouses:[],password:""},l.value="",d.value=[]},b=async e=>{try{const r=(0,ee.rJ)(Z.db,"users"),a=(0,ee.P)(r,(0,ee._M)("email","==",e)),t=await(0,ee.GG)(a);return!t.empty}catch(r){return console.error("Error checking email existence:",r),!1}},v=async(e,r,a)=>{try{const a=await(0,Y.eJ)(Z.j2,e,r);return a.user}catch(t){console.error("Error creating Firebase user:",t);let e="خطأ في إنشاء حساب المستخدم";switch(t.code){case"auth/email-already-in-use":e="البريد الإلكتروني مستخدم بالفعل";break;case"auth/invalid-email":e="صيغة البريد الإلكتروني غير صحيحة";break;case"auth/weak-password":e="كلمة المرور ضعيفة";break}throw new Error(e)}},y=async()=>{if(0===u.value.length){o.value=!0;try{await a.dispatch("loadWarehouses")}catch(e){console.error("Error loading warehouses:",e),l.value="خطأ في تحميل المخازن"}finally{o.value=!1}}},w=async()=>{if(c.value){s.value=!0,l.value="";try{const s={name:n.value.name.trim(),email:n.value.email.trim(),role:n.value.role,is_active:n.value.is_active,phone:n.value.phone.trim(),allowed_warehouses:"warehouse_manager"===n.value.role?n.value.allowed_warehouses:[],created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};if(!a.getters.canManageUsers)throw new Error("ليس لديك صلاحية لإدارة المستخدمين");let o;if(e.user){if(s.created_at=e.user.created_at,s.id=e.user.id,o=await a.dispatch("updateUser",{userId:e.user.id,userData:s}),!o.success)throw new Error(o.error||"فشل في تحديث المستخدم");a.dispatch("showNotification",{type:"success",message:"تم تحديث المستخدم بنجاح"})}else{const e=await b(s.email);if(e)throw new Error("البريد الإلكتروني مستخدم بالفعل");try{const e=await v(s.email,n.value.password,s.name);s.id=e.uid,s.created_by=a.state.user?.uid,await(0,ee.BN)((0,ee.H9)(Z.db,"users",e.uid),s);const r={...s,temporary_password:n.value.password};a.dispatch("showNotification",{type:"success",message:`تم إضافة المستخدم بنجاح. كلمة المرور المؤقتة: ${n.value.password}`}),o={success:!0,data:r}}catch(t){throw t}}r("save",o.data||s),r("close")}catch(o){console.error("Error in form submission:",o),l.value=o.message||"حدث خطأ أثناء حفظ المستخدم",a.dispatch("showNotification",{type:"error",message:l.value})}finally{s.value=!1}}};return(0,t.wB)(()=>e.isOpen,async r=>{r&&(h(),e.user||p(),await y(),e.user&&(n.value={name:e.user.name||"",email:e.user.email||"",role:e.user.role||"company_manager",is_active:!1!==e.user.is_active,phone:e.user.phone||"",allowed_warehouses:e.user.allowed_warehouses||[]}))}),(0,t.wB)(()=>n.value.role,e=>{"warehouse_manager"!==e&&(n.value.allowed_warehouses=[])}),(0,t.sV)(async()=>{await y()}),{loading:s,loadingWarehouses:o,errorMessage:l,validationErrors:d,formData:n,availableRoles:i,primaryWarehouses:u,isFormValid:c,getRolePermissions:k,generatePassword:p,toggleAllWarehouses:x,handleSubmit:w}}},ae=a(262);const te=(0,ae.A)(re,[["render",J]]);var se=te},188:function(e,r,a){a.d(r,{A:function(){return Te}});var t=a(641),s=a(33),o=a(751);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},d={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl rtl max-h-[90vh] overflow-y-auto"},n={class:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700"},i={class:"text-xl font-semibold text-gray-800 dark:text-white"},u={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},c=["readonly"],g={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},m={class:"relative inline-flex items-center cursor-pointer"},k={class:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300"},p={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},x=["value","onUpdate:modelValue","disabled"],h={class:"flex w-full items-center justify-between"},b={class:"flex items-center"},v={class:"text-sm"},y={class:"font-medium text-gray-900 dark:text-white"},w={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},f={key:0,class:"h-5 w-5 text-blue-600 dark:text-blue-400",viewBox:"0 0 20 20",fill:"currentColor"},L={key:0,class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},_={key:0},C={class:"flex justify-between items-center mb-3"},E={class:"flex gap-2"},M={key:0,class:"text-center py-4"},W={key:1,class:"space-y-3"},X={key:0},D={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},j={class:"flex items-center h-5"},U=["value"],P={class:"mr-3 text-sm flex-1"},S={class:"flex justify-between items-start"},A={class:"font-medium text-gray-900 dark:text-white"},R={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},B={class:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},K=["onClick"],V={class:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-2"},z={key:1},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},I={class:"flex items-center h-5"},F=["value"],H={class:"mr-3 text-sm"},N={class:"font-medium text-gray-900 dark:text-white"},$={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},T={key:2,class:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},O={class:"flex items-center gap-2"},J={class:"text-sm text-green-700 dark:text-green-300"},q={class:"mt-2 text-xs text-green-600 dark:text-green-400"},G={class:"mr-2 font-medium"},Z={key:2,class:"text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-600 rounded-lg"},Y={class:"mt-4"},ee={key:1},re={class:"flex justify-between items-center mb-3"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},se={class:"space-y-2"},oe=["value"],le={class:"mr-3 text-sm"},de={class:"font-medium text-gray-700 dark:text-gray-300"},ne={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},ie={class:"mt-4 flex gap-2 flex-wrap"},ue={key:2,class:"bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg"},ce={class:"flex justify-between items-center mb-2"},ge={class:"flex gap-2"},me={class:"flex gap-3"},ke=["type"],pe={class:"mt-2"},xe={class:"flex items-center justify-between mb-1"},he={class:"h-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},be={key:0,class:"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md"},ve={class:"flex items-center gap-2"},ye={class:"flex-1 font-mono text-sm bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700"},we={key:3,class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Le={class:"text-sm text-blue-700 dark:text-blue-300"},_e={class:"mt-1 text-xs text-blue-600 dark:text-blue-400"},Ce={class:"text-sm text-blue-700 dark:text-blue-300"},Ee={key:0,class:"mt-1 text-xs text-blue-600 dark:text-blue-400 truncate"},Me={key:0},We={key:4,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},Xe={class:"text-sm text-red-700 dark:text-red-300 list-disc pr-5 space-y-1"},De={key:5,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},je={class:"flex items-center gap-2"},Ue={class:"text-sm text-red-700 dark:text-red-300"},Pe={class:"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700"},Se=["disabled"],Ae={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Re={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function Be(e,r,a,Be,Ke,Ve){const ze=(0,t.g2)("WarehouseModal");return(0,t.uX)(),(0,t.CE)(t.FK,null,[a.isOpen?((0,t.uX)(),(0,t.CE)("div",l,[(0,t.Lk)("div",d,[(0,t.Lk)("div",n,[(0,t.Lk)("h2",i,(0,s.v_)(a.user?"تعديل المستخدم":"إضافة مستخدم جديد"),1),(0,t.Lk)("button",{onClick:r[0]||(r[0]=r=>e.$emit("close")),class:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors duration-200"},[...r[23]||(r[23]=[(0,t.Lk)("svg",{class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,t.Lk)("form",{onSubmit:r[22]||(r[22]=(0,o.D$)((...e)=>Be.handleSubmit&&Be.handleSubmit(...e),["prevent"])),class:"p-6 space-y-6"},[(0,t.Lk)("div",u,[(0,t.Lk)("div",null,[r[24]||(r[24]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,t.eW)(" الاسم الكامل "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",required:"","onUpdate:modelValue":r[1]||(r[1]=e=>Be.formData.name=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"أدخل الاسم الكامل"},null,512),[[o.Jo,Be.formData.name]])]),(0,t.Lk)("div",null,[r[25]||(r[25]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,t.eW)(" البريد الإلكتروني "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.bo)((0,t.Lk)("input",{type:"email",required:"","onUpdate:modelValue":r[2]||(r[2]=e=>Be.formData.email=e),readonly:!!a.user,class:(0,s.C4)(["w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",{"bg-gray-100 dark:bg-gray-800":!!a.user}]),placeholder:"example@company.com"},null,10,c),[[o.Jo,Be.formData.email]])])]),(0,t.Lk)("div",g,[(0,t.Lk)("div",null,[r[26]||(r[26]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," رقم الهاتف ",-1)),(0,t.bo)((0,t.Lk)("input",{type:"tel","onUpdate:modelValue":r[3]||(r[3]=e=>Be.formData.phone=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"01XXXXXXXXX"},null,512),[[o.Jo,Be.formData.phone]])]),(0,t.Lk)("div",null,[r[28]||(r[28]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"حالة الحساب",-1)),(0,t.Lk)("label",m,[(0,t.bo)((0,t.Lk)("input",{type:"checkbox","onUpdate:modelValue":r[4]||(r[4]=e=>Be.formData.is_active=e),class:"sr-only peer"},null,512),[[o.lH,Be.formData.is_active]]),r[27]||(r[27]=(0,t.Lk)("div",{class:"w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"},null,-1)),(0,t.Lk)("span",k,(0,s.v_)(Be.formData.is_active?"نشط":"غير نشط"),1)])])]),(0,t.Lk)("div",null,[r[30]||(r[30]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},[(0,t.eW)(" الدور "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.Lk)("div",p,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Be.availableRoles,e=>((0,t.uX)(),(0,t.CE)("label",{key:e.value,class:(0,s.C4)(["relative flex cursor-pointer rounded-lg border p-4 focus:outline-none transition-colors duration-200",{"border-blue-600 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/20":Be.formData.role===e.value,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700":Be.formData.role!==e.value}])},[(0,t.bo)((0,t.Lk)("input",{type:"radio",value:e.value,"onUpdate:modelValue":e=>Be.formData.role=e,disabled:"superadmin"===a.user?.role,class:"sr-only"},null,8,x),[[o.XL,Be.formData.role]]),(0,t.Lk)("div",h,[(0,t.Lk)("div",b,[(0,t.Lk)("div",v,[(0,t.Lk)("div",y,(0,s.v_)(e.name),1),(0,t.Lk)("div",w,(0,s.v_)(e.description),1)])]),Be.formData.role===e.value?((0,t.uX)(),(0,t.CE)("svg",f,[...r[29]||(r[29]=[(0,t.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])])):(0,t.Q3)("",!0)])],2))),128))]),"superadmin"===a.user?.role?((0,t.uX)(),(0,t.CE)("p",L," لا يمكن تغيير دور المشرف العام ")):(0,t.Q3)("",!0)]),"warehouse_manager"===Be.formData.role?((0,t.uX)(),(0,t.CE)("div",_,[(0,t.Lk)("div",C,[r[32]||(r[32]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[(0,t.eW)(" المخازن المسموحة "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.Lk)("div",E,[(0,t.Lk)("button",{type:"button",onClick:r[5]||(r[5]=(...e)=>Be.toggleAllWarehouses&&Be.toggleAllWarehouses(...e)),class:"text-sm px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200"},(0,s.v_)(Be.formData.allowed_warehouses.length===Be.allWarehouses.length?"إلغاء الكل":"اختيار الكل"),1),(0,t.Lk)("button",{type:"button",onClick:r[6]||(r[6]=(...e)=>Be.manageWarehouses&&Be.manageWarehouses(...e)),class:"text-sm px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-md hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors duration-200 flex items-center gap-1"},[...r[31]||(r[31]=[(0,t.Lk)("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),(0,t.eW)(" إدارة المخازن ",-1)])])])]),r[44]||(r[44]=(0,t.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-3"}," اختر المخازن التي يمكن للمستخدم الوصول إليها. سيتمكن المستخدم من إجراء جميع العمليات في المخازن المختارة. ",-1)),Be.loadingWarehouses?((0,t.uX)(),(0,t.CE)("div",M,[...r[33]||(r[33]=[(0,t.Lk)("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 dark:border-blue-400 mx-auto"},null,-1),(0,t.Lk)("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},"جاري تحميل المخازن...",-1)])])):((0,t.uX)(),(0,t.CE)("div",W,[Be.primaryWarehouses.length>0?((0,t.uX)(),(0,t.CE)("div",X,[r[36]||(r[36]=(0,t.Lk)("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"المخازن الرئيسية",-1)),(0,t.Lk)("div",D,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Be.primaryWarehouses,e=>((0,t.uX)(),(0,t.CE)("label",{key:e.id,class:(0,s.C4)(["relative flex items-start p-3 border rounded-lg transition-colors duration-200 group",{"border-blue-300 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/20":Be.formData.allowed_warehouses.includes(e.id),"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600":!Be.formData.allowed_warehouses.includes(e.id)}])},[(0,t.Lk)("div",j,[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":r[7]||(r[7]=e=>Be.formData.allowed_warehouses=e),class:"h-4 w-4 text-blue-600 dark:text-blue-400 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400"},null,8,U),[[o.lH,Be.formData.allowed_warehouses]])]),(0,t.Lk)("div",P,[(0,t.Lk)("div",S,[(0,t.Lk)("div",null,[(0,t.Lk)("div",A,(0,s.v_)(e.name_ar),1),(0,t.Lk)("div",R,(0,s.v_)(e.name_en),1)]),(0,t.Lk)("div",B,[(0,t.Lk)("button",{type:"button",onClick:(0,o.D$)(r=>Be.editWarehouse(e),["stop"]),class:"p-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",title:"تعديل"},[...r[34]||(r[34]=[(0,t.Lk)("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,K)])]),(0,t.Lk)("div",V,[(0,t.Lk)("span",null,"السعة: "+(0,s.v_)(e.capacity||"غير محددة"),1),r[35]||(r[35]=(0,t.Lk)("span",null,"•",-1)),(0,t.Lk)("span",null,"الموقع: "+(0,s.v_)(e.location||"غير محدد"),1)])])],2))),128))])])):(0,t.Q3)("",!0),Be.dispatchWarehouses.length>0?((0,t.uX)(),(0,t.CE)("div",z,[r[37]||(r[37]=(0,t.Lk)("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"مواقع الصرف",-1)),(0,t.Lk)("div",Q,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Be.dispatchWarehouses,e=>((0,t.uX)(),(0,t.CE)("label",{key:e.id,class:(0,s.C4)(["relative flex items-start p-3 border rounded-lg transition-colors duration-200",{"border-purple-300 dark:border-purple-500 bg-purple-50 dark:bg-purple-900/20":Be.formData.allowed_warehouses.includes(e.id),"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600":!Be.formData.allowed_warehouses.includes(e.id)}])},[(0,t.Lk)("div",I,[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":r[8]||(r[8]=e=>Be.formData.allowed_warehouses=e),class:"h-4 w-4 text-purple-600 dark:text-purple-400 border-gray-300 dark:border-gray-600 rounded focus:ring-purple-500 dark:focus:ring-purple-400"},null,8,F),[[o.lH,Be.formData.allowed_warehouses]])]),(0,t.Lk)("div",H,[(0,t.Lk)("div",N,(0,s.v_)(e.name_ar),1),(0,t.Lk)("div",$,(0,s.v_)(e.description||e.name_en),1)])],2))),128))])])):(0,t.Q3)("",!0),Be.formData.allowed_warehouses.length>0?((0,t.uX)(),(0,t.CE)("div",T,[(0,t.Lk)("div",O,[r[38]||(r[38]=(0,t.Lk)("svg",{class:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),(0,t.Lk)("span",J," تم اختيار "+(0,s.v_)(Be.formData.allowed_warehouses.length)+" مخزن ",1)]),(0,t.Lk)("div",q,[r[39]||(r[39]=(0,t.Lk)("span",null,"المخازن المختارة:",-1)),(0,t.Lk)("span",G,(0,s.v_)(Be.getSelectedWarehouseNames().join("، ")),1)])])):(0,t.Q3)("",!0)])),Be.loadingWarehouses||0!==Be.allWarehouses.length?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",Z,[r[41]||(r[41]=(0,t.Lk)("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),r[42]||(r[42]=(0,t.Lk)("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"لا توجد مخازن",-1)),r[43]||(r[43]=(0,t.Lk)("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"ابدأ بإضافة مخازن جديدة للنظام.",-1)),(0,t.Lk)("div",Y,[(0,t.Lk)("button",{type:"button",onClick:r[9]||(r[9]=(...e)=>Be.addNewWarehouse&&Be.addNewWarehouse(...e)),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800"},[...r[40]||(r[40]=[(0,t.Lk)("svg",{class:"ml-2 -mr-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),(0,t.eW)(" إضافة مخزن جديد ",-1)])])])]))])):(0,t.Q3)("",!0),Be.formData.role?((0,t.uX)(),(0,t.CE)("div",ee,[(0,t.Lk)("div",re,[r[45]||(r[45]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," إدارة الصلاحيات ",-1)),(0,t.Lk)("button",{type:"button",onClick:r[10]||(r[10]=(...e)=>Be.toggleAllPermissions&&Be.toggleAllPermissions(...e)),class:"text-sm px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200"},(0,s.v_)(Be.allPermissionsSelected?"إلغاء الكل":"اختيار الكل"),1)]),(0,t.Lk)("div",ae,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Be.permissionGroups,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.category},[(0,t.Lk)("h4",te,(0,s.v_)(e.label),1),(0,t.Lk)("div",se,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.permissions,e=>((0,t.uX)(),(0,t.CE)("label",{key:e.value,class:(0,s.C4)(["flex items-center p-2 border rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200",{"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20":Be.formData.permissions.includes(e.value),"border-gray-200 dark:border-gray-700":!Be.formData.permissions.includes(e.value)}])},[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",value:e.value,"onUpdate:modelValue":r[11]||(r[11]=e=>Be.formData.permissions=e),class:"h-4 w-4 text-blue-600 dark:text-blue-400 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400"},null,8,oe),[[o.lH,Be.formData.permissions]]),(0,t.Lk)("div",le,[(0,t.Lk)("div",de,(0,s.v_)(e.name),1),(0,t.Lk)("div",ne,(0,s.v_)(e.description),1)])],2))),128))])]))),128))]),(0,t.Lk)("div",ie,[(0,t.Lk)("button",{type:"button",onClick:r[12]||(r[12]=e=>Be.applyPermissionSet("view_only")),class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200"}," صلاحيات مشاهدة فقط "),(0,t.Lk)("button",{type:"button",onClick:r[13]||(r[13]=e=>Be.applyPermissionSet("basic_operations")),class:"px-3 py-1 text-sm border border-blue-300 dark:border-blue-600 text-blue-700 dark:text-blue-300 rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors duration-200"}," عمليات أساسية "),(0,t.Lk)("button",{type:"button",onClick:r[14]||(r[14]=e=>Be.applyPermissionSet("full_access")),class:"px-3 py-1 text-sm border border-green-300 dark:border-green-600 text-green-700 dark:text-green-300 rounded-md hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors duration-200"}," صلاحيات كاملة "),(0,t.Lk)("button",{type:"button",onClick:r[15]||(r[15]=e=>Be.applyPermissionSet("warehouse_manager")),class:"px-3 py-1 text-sm border border-purple-300 dark:border-purple-600 text-purple-700 dark:text-purple-300 rounded-md hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-colors duration-200"}," مدير مخازن نموذجي ")])])):(0,t.Q3)("",!0),a.user?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",ue,[(0,t.Lk)("div",ce,[r[46]||(r[46]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[(0,t.eW)(" كلمة المرور "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.Lk)("div",ge,[(0,t.Lk)("button",{type:"button",onClick:r[16]||(r[16]=(...e)=>Be.togglePasswordVisibility&&Be.togglePasswordVisibility(...e)),class:"text-sm px-2 py-1 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},(0,s.v_)(Be.showPassword?"إخفاء":"إظهار"),1),(0,t.Lk)("button",{type:"button",onClick:r[17]||(r[17]=(...e)=>Be.generateStrongPassword&&Be.generateStrongPassword(...e)),class:"text-sm px-2 py-1 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"}," توليد قوي ")])]),(0,t.Lk)("div",me,[(0,t.bo)((0,t.Lk)("input",{type:Be.showPassword?"text":"password",required:"","onUpdate:modelValue":r[18]||(r[18]=e=>Be.formData.password=e),class:"flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"كلمة المرور المؤقتة"},null,8,ke),[[o.hp,Be.formData.password]]),(0,t.Lk)("button",{type:"button",onClick:r[19]||(r[19]=(...e)=>Be.generatePassword&&Be.generatePassword(...e)),class:"px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200 text-sm font-medium"}," توليد عشوائي ")]),(0,t.Lk)("div",pe,[(0,t.Lk)("div",xe,[r[47]||(r[47]=(0,t.Lk)("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"قوة كلمة المرور:",-1)),(0,t.Lk)("span",{class:(0,s.C4)(["text-xs font-medium",Be.passwordStrength.color])},(0,s.v_)(Be.passwordStrength.label),3)]),(0,t.Lk)("div",he,[(0,t.Lk)("div",{class:(0,s.C4)(["h-full transition-all duration-300",Be.passwordStrength.color]),style:(0,s.Tr)({width:Be.passwordStrength.percentage+"%"})},null,6)])]),r[51]||(r[51]=(0,t.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-2"}," يجب أن تكون كلمة المرور 8 أحرف على الأقل وتحتوي على حروف وأرقام ",-1)),Be.formData.password?((0,t.uX)(),(0,t.CE)("div",be,[r[49]||(r[49]=(0,t.Lk)("div",{class:"flex items-center gap-2 mb-2"},[(0,t.Lk)("svg",{class:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})]),(0,t.Lk)("span",{class:"text-sm font-medium text-yellow-800 dark:text-yellow-300"},"كلمة المرور المؤقتة")],-1)),(0,t.Lk)("div",ve,[(0,t.Lk)("code",ye,(0,s.v_)(Be.formData.password),1),(0,t.Lk)("button",{type:"button",onClick:r[20]||(r[20]=(...e)=>Be.copyPassword&&Be.copyPassword(...e)),class:"p-2 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",title:"نسخ"},[...r[48]||(r[48]=[(0,t.Lk)("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])])]),r[50]||(r[50]=(0,t.Lk)("p",{class:"text-xs text-yellow-700 dark:text-yellow-400 mt-2"}," سيتم إرسال هذه الكلمة إلى المستخدم. يجب عليه تغييرها عند أول دخول. ",-1))])):(0,t.Q3)("",!0)])),Be.formData.role?((0,t.uX)(),(0,t.CE)("div",we,[r[54]||(r[54]=(0,t.Lk)("h4",{class:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-3"},"ملخص المستخدم:",-1)),(0,t.Lk)("div",fe,[(0,t.Lk)("div",null,[r[52]||(r[52]=(0,t.Lk)("div",{class:"text-xs text-blue-600 dark:text-blue-400 mb-1"},"الدور والصلاحيات",-1)),(0,t.Lk)("div",Le,(0,s.v_)(Be.getRoleDisplay(Be.formData.role)),1),(0,t.Lk)("div",_e,(0,s.v_)(Be.formData.permissions.length)+" صلاحية محددة ",1)]),(0,t.Lk)("div",null,[r[53]||(r[53]=(0,t.Lk)("div",{class:"text-xs text-blue-600 dark:text-blue-400 mb-1"},"الوصول إلى المخازن",-1)),(0,t.Lk)("div",Ce,(0,s.v_)(Be.formData.allowed_warehouses.length)+" مخزن ",1),Be.formData.allowed_warehouses.length>0?((0,t.uX)(),(0,t.CE)("div",Ee,[(0,t.eW)((0,s.v_)(Be.getSelectedWarehouseNames().slice(0,2).join("، "))+" ",1),Be.formData.allowed_warehouses.length>2?((0,t.uX)(),(0,t.CE)("span",Me,"وآخرون")):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0)])])])):(0,t.Q3)("",!0),Be.validationErrors.length>0?((0,t.uX)(),(0,t.CE)("div",We,[r[55]||(r[55]=(0,t.Lk)("h4",{class:"text-sm font-medium text-red-800 dark:text-red-300 mb-2"},"خطأ في التحقق:",-1)),(0,t.Lk)("ul",Xe,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Be.validationErrors,e=>((0,t.uX)(),(0,t.CE)("li",{key:e},(0,s.v_)(e),1))),128))])])):(0,t.Q3)("",!0),Be.errorMessage?((0,t.uX)(),(0,t.CE)("div",De,[(0,t.Lk)("div",je,[r[56]||(r[56]=(0,t.Lk)("svg",{class:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),(0,t.Lk)("p",Ue,(0,s.v_)(Be.errorMessage),1)])])):(0,t.Q3)("",!0),(0,t.Lk)("div",Pe,[(0,t.Lk)("button",{type:"button",onClick:r[21]||(r[21]=r=>e.$emit("close")),class:"flex-1 py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 font-medium"}," إلغاء "),(0,t.Lk)("button",{type:"submit",disabled:Be.loading||!Be.isFormValid,class:"flex-1 py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-md hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 font-medium flex items-center justify-center gap-2"},[Be.loading?((0,t.uX)(),(0,t.CE)("svg",Ae,[...r[57]||(r[57]=[(0,t.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,t.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,t.uX)(),(0,t.CE)("svg",Re,[...r[58]||(r[58]=[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),(0,t.eW)(" "+(0,s.v_)(Be.loading?"جاري الحفظ...":a.user?"تحديث المستخدم":"إضافة مستخدم"),1)],8,Se)])],32)])])):(0,t.Q3)("",!0),Be.showWarehouseModal?((0,t.uX)(),(0,t.Wv)(ze,{key:1,warehouse:Be.editingWarehouse,onClose:Be.closeWarehouseModal,onSave:Be.handleWarehouseSave},null,8,["warehouse","onClose","onSave"])):(0,t.Q3)("",!0)],64)}var Ke=a(953),Ve=a(278),ze=a(556),Qe=a(496),Ie=a(884),Fe=a(727),He={name:"UserManagementModal",components:{WarehouseModal:Fe.A},props:{isOpen:{type:Boolean,required:!0},user:{type:Object,default:null}},emits:["close","save","warehouse-updated"],setup(e,{emit:r}){const a=(0,Ve.Pj)(),s=(0,Ke.KR)(!1),o=(0,Ke.KR)(!1),l=(0,Ke.KR)(""),d=(0,Ke.KR)([]),n=(0,Ke.KR)(!1),i=(0,Ke.KR)(!1),u=(0,Ke.KR)(null),c=(0,Ke.KR)({name:"",email:"",role:"company_manager",is_active:!0,phone:"",allowed_warehouses:[],permissions:[],password:""}),g=(0,Ke.KR)([{value:"superadmin",name:"المشرف العام",description:"صلاحيات كاملة على النظام"},{value:"warehouse_manager",name:"مدير المخازن",description:"إدارة المخزون والحركات في المخازن المحددة"},{value:"company_manager",name:"مدير الشركة",description:"عرض التقارير والبيانات (قراءة فقط)"}]),m=(0,Ke.KR)([{category:"inventory",label:"إدارة المخزون",permissions:[{value:"manage_inventory",name:"إدارة المخزون",description:"إضافة وتعديل المخزون"},{value:"create_transfers",name:"إنشاء التحويلات",description:"نقل المخزون بين المخازن"},{value:"dispatch_items",name:"صرف الأصناف",description:"صرف الأصناف للخارج"},{value:"update_items",name:"تحديث الأصناف",description:"تعديل بيانات الأصناف"},{value:"delete_items",name:"حذف الأصناف",description:"إزالة الأصناف من النظام"}]},{category:"reports",label:"التقارير والمتابعة",permissions:[{value:"view_reports",name:"عرض التقارير",description:"مشاهدة تقارير المخزون"},{value:"export_data",name:"تصدير البيانات",description:"تصدير البيانات إلى Excel"},{value:"view_analytics",name:"عرض التحليلات",description:"مشاهدة الإحصائيات والتحليلات"}]},{category:"system",label:"إدارة النظام",permissions:[{value:"manage_warehouses",name:"إدارة المخازن",description:"إضافة وتعديل المخازن"},{value:"manage_users",name:"إدارة المستخدمين",description:"إضافة وتعديل المستخدمين"},{value:"system_settings",name:"إعدادات النظام",description:"تعديل إعدادات النظام"}]},{category:"advanced",label:"صلاحيات متقدمة",permissions:[{value:"audit_logs",name:"سجلات المراجعة",description:"مشاهدة سجلات النظام"},{value:"backup_restore",name:"النسخ الاحتياطي",description:"النسخ والاستعادة"},{value:"full_access",name:"وصول كامل",description:"جميع الصلاحيات بدون قيود"}]}]),k=(0,t.EW)(()=>a.state.warehouses||[]),p=(0,t.EW)(()=>k.value.filter(e=>"primary"===e.type)),x=(0,t.EW)(()=>k.value.filter(e=>"dispatch"===e.type)),h=(0,t.EW)(()=>{const e=m.value.flatMap(e=>e.permissions.map(e=>e.value));return e.every(e=>c.value.permissions.includes(e))}),b=(0,t.EW)(()=>{const e=c.value.password||"";let r=0;e.length>=8&&(r+=1),/[A-Z]/.test(e)&&(r+=1),/[a-z]/.test(e)&&(r+=1),/\d/.test(e)&&(r+=1),/[^A-Za-z0-9]/.test(e)&&(r+=1);const a=r/5*100;return r<=1?{label:"ضعيفة",color:"bg-red-500",percentage:a}:r<=3?{label:"متوسطة",color:"bg-yellow-500",percentage:a}:{label:"قوية",color:"bg-green-500",percentage:a}}),v=(0,t.EW)(()=>(d.value=[],c.value.name.trim()||d.value.push("الاسم الكامل مطلوب"),c.value.email.trim()?y(c.value.email)||d.value.push("صيغة البريد الإلكتروني غير صحيحة"):d.value.push("البريد الإلكتروني مطلوب"),c.value.role||d.value.push("الدور مطلوب"),e.user||c.value.password?!e.user&&c.value.password.length<8&&d.value.push("كلمة المرور يجب أن تكون 8 أحرف على الأقل"):d.value.push("كلمة المرور مطلوبة"),"warehouse_manager"===c.value.role&&0===c.value.allowed_warehouses.length&&d.value.push("يجب اختيار مخزن واحد على الأقل لمدير المخازن"),c.value.phone&&!w(c.value.phone)&&d.value.push("رقم الهاتف غير صحيح"),"warehouse_manager"===c.value.role&&0===c.value.permissions.length&&d.value.push("يجب تحديد صلاحيات على الأقل لمدير المخازن"),0===d.value.length)),y=e=>{const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return r.test(e)},w=e=>{const r=/^01[0-9]{9}$/;return r.test(e)},f=e=>{const r={superadmin:"المشرف العام",warehouse_manager:"مدير المخازن",company_manager:"مدير الشركة"};return r[e]||e},L=()=>c.value.allowed_warehouses.map(e=>{const r=k.value.find(r=>r.id===e);return r?r.name_ar:e}),_=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let a=0;a<10;a++)r+=e.charAt(Math.floor(Math.random()*e.length));c.value.password=r},C=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="abcdefghijklmnopqrstuvwxyz",a="0123456789",t="!@#$%^&*";let s="";s+=e.charAt(Math.floor(Math.random()*e.length)),s+=r.charAt(Math.floor(Math.random()*r.length)),s+=a.charAt(Math.floor(Math.random()*a.length)),s+=t.charAt(Math.floor(Math.random()*t.length));const o=e+r+a+t;for(let l=4;l<12;l++)s+=o.charAt(Math.floor(Math.random()*o.length));c.value.password=s.split("").sort(()=>Math.random()-.5).join("")},E=()=>{n.value=!n.value},M=async()=>{try{await navigator.clipboard.writeText(c.value.password),a.dispatch("showNotification",{type:"success",message:"تم نسخ كلمة المرور"})}catch(e){console.error("Failed to copy password:",e)}},W=()=>{c.value.allowed_warehouses.length===k.value.length?c.value.allowed_warehouses=[]:c.value.allowed_warehouses=k.value.map(e=>e.id)},X=()=>{if(h.value)c.value.permissions=[];else{const e=m.value.flatMap(e=>e.permissions.map(e=>e.value));c.value.permissions=[...e]}},D=e=>{const r={view_only:["view_reports","export_data"],basic_operations:["manage_inventory","create_transfers","dispatch_items","view_reports"],full_access:["full_access"],warehouse_manager:["manage_inventory","create_transfers","dispatch_items","update_items","view_reports","export_data"]};c.value.permissions=r[e]||[]},j=()=>{r("warehouse-updated"),a.dispatch("showNotification",{type:"info",message:"يمكنك إدارة المخازن من قائمة المخازن في الشريط الجانبي"})},U=()=>{u.value=null,i.value=!0},P=e=>{u.value=e,i.value=!0},S=()=>{i.value=!1,u.value=null},A=async e=>{try{if(await a.dispatch("loadWarehouses"),c.value.allowed_warehouses.includes(e.id)){const r=c.value.allowed_warehouses.indexOf(e.id);r>-1&&(c.value.allowed_warehouses[r]=e.id)}S()}catch(r){console.error("Error handling warehouse save:",r)}},R=()=>{c.value={name:"",email:"",role:"company_manager",is_active:!0,phone:"",allowed_warehouses:[],permissions:[],password:""},l.value="",d.value=[],n.value=!1},B=async()=>{if(0===k.value.length){o.value=!0;try{await a.dispatch("loadWarehouses")}catch(e){console.error("Error loading warehouses:",e),l.value="خطأ في تحميل المخازن"}finally{o.value=!1}}},K=async()=>{if(v.value){s.value=!0,l.value="";try{const t={name:c.value.name.trim(),email:c.value.email.trim(),role:c.value.role,is_active:c.value.is_active,phone:c.value.phone.trim(),allowed_warehouses:"warehouse_manager"===c.value.role?c.value.allowed_warehouses:[],permissions:c.value.permissions,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};let s;if(e.user){if(t.created_at=e.user.created_at,t.id=e.user.id,s=await a.dispatch("updateUser",{userId:e.user.id,userData:t}),!s.success)throw new Error(s.error||"فشل في تحديث المستخدم");a.dispatch("showNotification",{type:"success",message:"تم تحديث المستخدم بنجاح"})}else{const e=await(0,Qe.eJ)(ze.j2,t.email,c.value.password);t.id=e.uid,t.created_by=a.state.user?.uid,await(0,Ie.BN)((0,Ie.H9)(ze.db,"users",e.uid),t);const r={...t,temporary_password:c.value.password};a.dispatch("showNotification",{type:"success",message:`تم إضافة المستخدم "${t.name}" بنجاح`}),s={success:!0,data:r}}r("save",s.data||t),r("close")}catch(t){console.error("Error in form submission:",t);let e=t.message||"حدث خطأ أثناء حفظ المستخدم";"auth/email-already-in-use"===t.code?e="البريد الإلكتروني مستخدم بالفعل":"auth/invalid-email"===t.code?e="صيغة البريد الإلكتروني غير صحيحة":"auth/weak-password"===t.code&&(e="كلمة المرور ضعيفة"),l.value=e,a.dispatch("showNotification",{type:"error",message:e})}finally{s.value=!1}}};return(0,t.wB)(()=>e.isOpen,async r=>{r&&(R(),e.user||(C(),D("warehouse_manager")),await B(),e.user&&(c.value={name:e.user.name||"",email:e.user.email||"",role:e.user.role||"company_manager",is_active:!1!==e.user.is_active,phone:e.user.phone||"",allowed_warehouses:e.user.allowed_warehouses||[],permissions:e.user.permissions||[]},delete c.value.password))}),(0,t.wB)(()=>c.value.role,e=>{"warehouse_manager"!==e&&(c.value.allowed_warehouses=[]),"company_manager"===e?D("view_only"):"warehouse_manager"===e?D("warehouse_manager"):"superadmin"===e&&D("full_access")}),(0,t.sV)(async()=>{await B()}),{loading:s,loadingWarehouses:o,errorMessage:l,validationErrors:d,showPassword:n,showWarehouseModal:i,editingWarehouse:u,formData:c,availableRoles:g,permissionGroups:m,allWarehouses:k,primaryWarehouses:p,dispatchWarehouses:x,allPermissionsSelected:h,passwordStrength:b,isFormValid:v,getRoleDisplay:f,getSelectedWarehouseNames:L,generatePassword:_,generateStrongPassword:C,togglePasswordVisibility:E,copyPassword:M,toggleAllWarehouses:W,toggleAllPermissions:X,applyPermissionSet:D,manageWarehouses:j,addNewWarehouse:U,editWarehouse:P,closeWarehouseModal:S,handleWarehouseSave:A,handleSubmit:K}}},Ne=a(262);const $e=(0,Ne.A)(He,[["render",Be]]);var Te=$e},808:function(e,r,a){a.r(r),a.d(r,{default:function(){return Se}});var t=a(641),s=a(33),o=a(751);const l={class:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200"},d={class:"sticky top-0 z-50 bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700"},n={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},i={class:"flex justify-between items-center h-16"},u={class:"flex items-center space-x-4 space-x-reverse"},c={class:"flex items-center space-x-3 space-x-reverse"},g={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},m={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},k={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow duration-200"},p={class:"flex items-center"},x={class:"text-2xl font-bold text-gray-900 dark:text-white"},h={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow duration-200"},b={class:"flex items-center"},v={class:"text-2xl font-bold text-gray-900 dark:text-white"},y={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow duration-200"},w={class:"flex items-center"},f={class:"text-2xl font-bold text-gray-900 dark:text-white"},L={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow duration-200"},_={class:"flex items-center"},C={class:"text-lg font-bold text-gray-900 dark:text-white"},E={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-8"},M={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},W={class:"flex-1"},X={class:"relative"},D={class:"flex space-x-3 space-x-reverse"},j=["disabled"],U={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},P={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},S={class:"flex items-center justify-between"},A={class:"text-sm text-gray-500 dark:text-gray-400"},R={key:0,class:"p-8 text-center"},B={key:1,class:"p-8 text-center"},K={class:"text-red-700 dark:text-red-300 mb-4"},V={key:2,class:"p-8 text-center"},z={class:"text-gray-500 dark:text-gray-400 mb-4"},Q={key:3,class:"overflow-x-auto"},I={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},F={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800"},H={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},N={class:"px-6 py-4"},$={class:"flex items-center"},T={class:"h-10 w-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center ml-3"},O={class:"text-white font-medium text-sm"},J={class:"text-sm font-medium text-gray-900 dark:text-white"},q={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},G={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},Z={class:"px-6 py-4 whitespace-nowrap"},Y={class:"px-6 py-4"},ee={class:"text-sm text-gray-900 dark:text-white max-w-xs truncate"},re={key:0},ae={key:1,class:"text-gray-500 dark:text-gray-400"},te={class:"px-6 py-4 whitespace-nowrap"},se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},oe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},le={class:"flex space-x-2 space-x-reverse"},de=["onClick"],ne=["onClick"],ie=["onClick","title"],ue={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ce={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"},ge={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},me=["onClick"],ke={key:4,class:"flex items-center justify-between px-4 py-3 border-t border-gray-200 dark:border-gray-700"},pe={class:"text-sm text-gray-700 dark:text-gray-300"},xe={class:"font-medium"},he={class:"font-medium"},be={class:"font-medium"},ve={class:"flex space-x-2 space-x-reverse"},ye=["disabled"],we={class:"flex space-x-1 space-x-reverse"},fe=["onClick"],Le=["disabled"],_e={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"};function Ce(e,r,a,Ce,Ee,Me){const We=(0,t.g2)("router-link"),Xe=(0,t.g2)("AddUserModal"),De=(0,t.g2)("UserModal"),je=(0,t.g2)("ResetPasswordModal");return(0,t.uX)(),(0,t.CE)("div",l,[(0,t.Lk)("header",d,[(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.Lk)("div",u,[(0,t.bF)(We,{to:"/",class:"flex items-center space-x-2 space-x-reverse hover:opacity-80 transition-opacity"},{default:(0,t.k6)(()=>[...r[15]||(r[15]=[(0,t.Lk)("div",{class:"h-8 w-8 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg flex items-center justify-center"},[(0,t.Lk)("span",{class:"text-white font-bold text-sm"},"م")],-1),(0,t.Lk)("div",null,[(0,t.Lk)("h1",{class:"text-lg font-bold text-gray-900 dark:text-white"},"إدارة المستخدمين"),(0,t.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"نظام إدارة المخزون")],-1)])]),_:1})]),(0,t.Lk)("div",c,[(0,t.Lk)("button",{onClick:r[0]||(r[0]=e=>Ce.showAddModal=!0),class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white text-sm font-medium rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-sm"},[...r[16]||(r[16]=[(0,t.Lk)("svg",{class:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),(0,t.eW)(" مستخدم جديد ",-1)])]),(0,t.bF)(We,{to:"/",class:"inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200"},{default:(0,t.k6)(()=>[...r[17]||(r[17]=[(0,t.eW)(" الرئيسية ",-1)])]),_:1})])])])]),(0,t.Lk)("main",g,[(0,t.Lk)("div",m,[(0,t.Lk)("div",k,[(0,t.Lk)("div",p,[r[19]||(r[19]=(0,t.Lk)("div",{class:"h-12 w-12 rounded-lg bg-blue-100 dark:bg-blue-900 flex items-center justify-center ml-4"},[(0,t.Lk)("svg",{class:"h-6 w-6 text-blue-600 dark:text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5 3.714a6 6 0 00-13 0"})])],-1)),(0,t.Lk)("div",null,[r[18]||(r[18]=(0,t.Lk)("p",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"إجمالي المستخدمين",-1)),(0,t.Lk)("p",x,(0,s.v_)(Ce.formatNumber(Ce.totalUsers)),1)])])]),(0,t.Lk)("div",h,[(0,t.Lk)("div",b,[r[21]||(r[21]=(0,t.Lk)("div",{class:"h-12 w-12 rounded-lg bg-green-100 dark:bg-green-900 flex items-center justify-center ml-4"},[(0,t.Lk)("svg",{class:"h-6 w-6 text-green-600 dark:text-green-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),(0,t.Lk)("div",null,[r[20]||(r[20]=(0,t.Lk)("p",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"نشطين",-1)),(0,t.Lk)("p",v,(0,s.v_)(Ce.formatNumber(Ce.activeUsers)),1)])])]),(0,t.Lk)("div",y,[(0,t.Lk)("div",w,[r[23]||(r[23]=(0,t.Lk)("div",{class:"h-12 w-12 rounded-lg bg-orange-100 dark:bg-orange-900 flex items-center justify-center ml-4"},[(0,t.Lk)("svg",{class:"h-6 w-6 text-orange-600 dark:text-orange-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),(0,t.Lk)("div",null,[r[22]||(r[22]=(0,t.Lk)("p",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"مديري المخازن",-1)),(0,t.Lk)("p",f,(0,s.v_)(Ce.formatNumber(Ce.warehouseManagers)),1)])])]),(0,t.Lk)("div",L,[(0,t.Lk)("div",_,[r[25]||(r[25]=(0,t.Lk)("div",{class:"h-12 w-12 rounded-lg bg-purple-100 dark:bg-purple-900 flex items-center justify-center ml-4"},[(0,t.Lk)("svg",{class:"h-6 w-6 text-purple-600 dark:text-purple-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.121 17.804A7.968 7.968 0 015 16c0-4.418 3.582-8 8-8s8 3.582 8 8-3.582 8-8 8-8-3.582-8-8c0-1.104.188-2.169.535-3.164"})])],-1)),(0,t.Lk)("div",null,[r[24]||(r[24]=(0,t.Lk)("p",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"آخر تسجيل",-1)),(0,t.Lk)("p",C,(0,s.v_)(Ce.lastLoginTime),1)])])])]),(0,t.Lk)("div",E,[(0,t.Lk)("div",M,[(0,t.Lk)("div",W,[(0,t.Lk)("div",X,[(0,t.bo)((0,t.Lk)("input",{type:"text","onUpdate:modelValue":r[1]||(r[1]=e=>Ce.searchTerm=e),onInput:r[2]||(r[2]=(...e)=>Ce.handleSearch&&Ce.handleSearch(...e)),placeholder:"ابحث باسم المستخدم، البريد الإلكتروني، أو الدور...",class:"w-full pr-12 pl-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),[[o.Jo,Ce.searchTerm]]),r[26]||(r[26]=(0,t.Lk)("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[(0,t.Lk)("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),(0,t.Lk)("div",D,[(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":r[3]||(r[3]=e=>Ce.roleFilter=e),onChange:r[4]||(r[4]=(...e)=>Ce.handleFilter&&Ce.handleFilter(...e)),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...r[27]||(r[27]=[(0,t.Lk)("option",{value:""},"جميع الأدوار",-1),(0,t.Lk)("option",{value:"superadmin"},"المشرف العام",-1),(0,t.Lk)("option",{value:"warehouse_manager"},"مدير المخازن",-1),(0,t.Lk)("option",{value:"company_manager"},"مدير الشركة",-1)])],544),[[o.u1,Ce.roleFilter]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":r[5]||(r[5]=e=>Ce.statusFilter=e),onChange:r[6]||(r[6]=(...e)=>Ce.handleFilter&&Ce.handleFilter(...e)),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...r[28]||(r[28]=[(0,t.Lk)("option",{value:""},"جميع الحالات",-1),(0,t.Lk)("option",{value:"active"},"نشيط",-1),(0,t.Lk)("option",{value:"inactive"},"غير نشيط",-1)])],544),[[o.u1,Ce.statusFilter]]),(0,t.Lk)("button",{onClick:r[7]||(r[7]=(...e)=>Ce.refreshData&&Ce.refreshData(...e)),class:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200",disabled:Ce.loading},[((0,t.uX)(),(0,t.CE)("svg",{class:(0,s.C4)(["w-5 h-5",Ce.loading?"animate-spin":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...r[29]||(r[29]=[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))],8,j)])])]),(0,t.Lk)("div",U,[(0,t.Lk)("div",P,[(0,t.Lk)("div",S,[r[30]||(r[30]=(0,t.Lk)("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"قائمة المستخدمين",-1)),(0,t.Lk)("div",A,(0,s.v_)(Ce.formatNumber(Ce.filteredUsers.length))+" مستخدم ",1)])]),Ce.loading?((0,t.uX)(),(0,t.CE)("div",R,[...r[31]||(r[31]=[(0,t.Lk)("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"},null,-1),(0,t.Lk)("p",{class:"text-gray-700 dark:text-gray-300"},"جاري تحميل البيانات...",-1)])])):Ce.error?((0,t.uX)(),(0,t.CE)("div",B,[r[32]||(r[32]=(0,t.Lk)("div",{class:"inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full mb-4"},[(0,t.Lk)("svg",{class:"w-8 h-8 text-red-600 dark:text-red-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),(0,t.Lk)("p",K,(0,s.v_)(Ce.error),1),(0,t.Lk)("button",{onClick:r[8]||(r[8]=(...e)=>Ce.refreshData&&Ce.refreshData(...e)),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200"}," إعادة المحاولة ")])):0===Ce.filteredUsers.length?((0,t.uX)(),(0,t.CE)("div",V,[r[33]||(r[33]=(0,t.Lk)("div",{class:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4"},[(0,t.Lk)("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})])],-1)),r[34]||(r[34]=(0,t.Lk)("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"لا توجد مستخدمين",-1)),(0,t.Lk)("p",z,(0,s.v_)(Ce.searchTerm?"لم يتم العثور على مستخدمين مطابقين للبحث":"لم يتم العثور على أي مستخدمين"),1),(0,t.Lk)("button",{onClick:r[9]||(r[9]=e=>Ce.showAddModal=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200"}," إضافة أول مستخدم ")])):((0,t.uX)(),(0,t.CE)("div",Q,[(0,t.Lk)("table",I,[r[38]||(r[38]=(0,t.Lk)("thead",{class:"bg-gray-50 dark:bg-gray-800"},[(0,t.Lk)("tr",null,[(0,t.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," # "),(0,t.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," المستخدم "),(0,t.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," البريد الإلكتروني "),(0,t.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," الدور "),(0,t.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," المخازن المسموحة "),(0,t.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," الحالة "),(0,t.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," آخر تسجيل "),(0,t.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," الإجراءات ")])],-1)),(0,t.Lk)("tbody",F,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Ce.paginatedUsers,(e,a)=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-150"},[(0,t.Lk)("td",H,(0,s.v_)(Ce.startIndex+a+1),1),(0,t.Lk)("td",N,[(0,t.Lk)("div",$,[(0,t.Lk)("div",T,[(0,t.Lk)("span",O,(0,s.v_)(Ce.getUserInitials(e.name)),1)]),(0,t.Lk)("div",null,[(0,t.Lk)("div",J,(0,s.v_)(e.name),1),e.phone?((0,t.uX)(),(0,t.CE)("div",q,(0,s.v_)(e.phone),1)):(0,t.Q3)("",!0)])])]),(0,t.Lk)("td",G,(0,s.v_)(e.email),1),(0,t.Lk)("td",Z,[(0,t.Lk)("span",{class:(0,s.C4)(Ce.getRoleBadgeClass(e.role))},(0,s.v_)(Ce.getRoleText(e.role)),3)]),(0,t.Lk)("td",Y,[(0,t.Lk)("div",ee,[e.allowed_warehouses&&e.allowed_warehouses.length>0?((0,t.uX)(),(0,t.CE)("span",re,(0,s.v_)(e.allowed_warehouses.length)+" مخزن ",1)):((0,t.uX)(),(0,t.CE)("span",ae,"غير محدد"))])]),(0,t.Lk)("td",te,[(0,t.Lk)("span",{class:(0,s.C4)(Ce.getStatusBadgeClass(e))},(0,s.v_)(Ce.getStatusText(e)),3)]),(0,t.Lk)("td",se,(0,s.v_)(Ce.formatDate(e.last_login)||"لم يسجل دخول"),1),(0,t.Lk)("td",oe,[(0,t.Lk)("div",le,[(0,t.Lk)("button",{onClick:r=>Ce.editUser(e),class:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",title:"تعديل"},[...r[35]||(r[35]=[(0,t.Lk)("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,de),(0,t.Lk)("button",{onClick:r=>Ce.resetPassword(e),class:"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300",title:"إعادة تعيين كلمة المرور"},[...r[36]||(r[36]=[(0,t.Lk)("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m0 0v2m0-2h2m-2 0H9m3-6a3 3 0 110-6 3 3 0 010 6zm2 7a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,ne),e.id!==Ce.currentUserId?((0,t.uX)(),(0,t.CE)("button",{key:0,onClick:r=>Ce.toggleUserStatus(e),class:(0,s.C4)(Ce.getStatusButtonClass(e)),title:e.is_active?"تعطيل":"تفعيل"},[((0,t.uX)(),(0,t.CE)("svg",ue,[e.is_active?((0,t.uX)(),(0,t.CE)("path",ce)):((0,t.uX)(),(0,t.CE)("path",ge))]))],10,ie)):(0,t.Q3)("",!0),e.id!==Ce.currentUserId&&"superadmin"!==e.role?((0,t.uX)(),(0,t.CE)("button",{key:1,onClick:r=>Ce.deleteUser(e),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",title:"حذف"},[...r[37]||(r[37]=[(0,t.Lk)("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,me)):(0,t.Q3)("",!0)])])]))),128))])])])),Ce.filteredUsers.length>0&&Ce.totalPages>1?((0,t.uX)(),(0,t.CE)("div",ke,[(0,t.Lk)("div",pe,[r[39]||(r[39]=(0,t.eW)(" عرض ",-1)),(0,t.Lk)("span",xe,(0,s.v_)(Ce.startIndex+1),1),r[40]||(r[40]=(0,t.eW)(" إلى ",-1)),(0,t.Lk)("span",he,(0,s.v_)(Math.min(Ce.endIndex,Ce.filteredUsers.length)),1),r[41]||(r[41]=(0,t.eW)(" من ",-1)),(0,t.Lk)("span",be,(0,s.v_)(Ce.formatNumber(Ce.filteredUsers.length)),1),r[42]||(r[42]=(0,t.eW)(" نتيجة ",-1))]),(0,t.Lk)("div",ve,[(0,t.Lk)("button",{onClick:r[10]||(r[10]=(...e)=>Ce.prevPage&&Ce.prevPage(...e)),disabled:1===Ce.currentPage,class:"px-3 py-1 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200"}," السابق ",8,ye),(0,t.Lk)("div",we,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Ce.visiblePages,e=>((0,t.uX)(),(0,t.CE)("button",{key:e,onClick:r=>Ce.goToPage(e),class:(0,s.C4)(["w-8 h-8 rounded-lg flex items-center justify-center transition-colors duration-200",e===Ce.currentPage?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"])},(0,s.v_)(e),11,fe))),128))]),(0,t.Lk)("button",{onClick:r[11]||(r[11]=(...e)=>Ce.nextPage&&Ce.nextPage(...e)),disabled:Ce.currentPage===Ce.totalPages,class:"px-3 py-1 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200"}," التالي ",8,Le)])])):(0,t.Q3)("",!0)])]),Ce.showAddModal?((0,t.uX)(),(0,t.Wv)(Xe,{key:0,show:Ce.showAddModal,onClose:r[12]||(r[12]=e=>Ce.showAddModal=!1),onSaved:Ce.handleUserAdded},null,8,["show","onSaved"])):(0,t.Q3)("",!0),Ce.showEditModal?((0,t.uX)(),(0,t.Wv)(De,{key:1,show:Ce.showEditModal,"user-id":Ce.selectedUserId,onClose:r[13]||(r[13]=e=>Ce.showEditModal=!1),onSaved:Ce.handleUserUpdated},null,8,["show","user-id","onSaved"])):(0,t.Q3)("",!0),Ce.showResetPasswordModal?((0,t.uX)(),(0,t.Wv)(je,{key:2,show:Ce.showResetPasswordModal,"user-id":Ce.selectedUserId,onClose:r[14]||(r[14]=e=>Ce.showResetPasswordModal=!1),onSaved:Ce.handlePasswordReset},null,8,["show","user-id","onSaved"])):(0,t.Q3)("",!0),Ce.operationLoading?((0,t.uX)(),(0,t.CE)("div",_e,[...r[43]||(r[43]=[(0,t.Lk)("div",{class:"bg-white dark:bg-gray-800 rounded-xl p-8 flex flex-col items-center shadow-xl"},[(0,t.Lk)("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),(0,t.Lk)("p",{class:"text-gray-700 dark:text-gray-300 font-medium"},"جاري المعالجة..."),(0,t.Lk)("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},"يرجى الانتظار")],-1)])])):(0,t.Q3)("",!0)])}var Ee=a(953),Me=a(278),We=a(188),Xe=a(155),De=a(949),je={name:"Users",components:{AddUserModal:We.A,UserModal:Xe.A,ResetPasswordModal:De.A},setup(){const e=(0,Me.Pj)(),r=(0,Ee.KR)(!1),a=(0,Ee.KR)(""),s=(0,Ee.KR)(!1),o=(0,Ee.KR)(!1),l=(0,Ee.KR)(!1),d=(0,Ee.KR)(null),n=(0,Ee.KR)(""),i=(0,Ee.KR)(""),u=(0,Ee.KR)(""),c=(0,Ee.KR)(1),g=10,m=(0,Ee.KR)([]),k=(0,t.EW)(()=>e.state.user?.uid),p=(0,t.EW)(()=>e.state.operationLoading),x=(0,t.EW)(()=>{let e=[...m.value];if(n.value){const r=n.value.toLowerCase();e=e.filter(e=>e.name?.toLowerCase().includes(r)||e.email?.toLowerCase().includes(r)||e.phone?.toLowerCase().includes(r))}return i.value&&(e=e.filter(e=>e.role===i.value)),u.value&&("active"===u.value?e=e.filter(e=>!1!==e.is_active):"inactive"===u.value&&(e=e.filter(e=>!1===e.is_active))),e}),h=(0,t.EW)(()=>m.value.length),b=(0,t.EW)(()=>m.value.filter(e=>!1!==e.is_active).length),v=(0,t.EW)(()=>m.value.filter(e=>"warehouse_manager"===e.role).length),y=(0,t.EW)(()=>{const e=m.value.filter(e=>e.last_login).sort((e,r)=>new Date(r.last_login)-new Date(e.last_login))[0];return e?W(e.last_login):"لا يوجد"}),w=(0,t.EW)(()=>Math.ceil(x.value.length/g)),f=(0,t.EW)(()=>(c.value-1)*g),L=(0,t.EW)(()=>f.value+g),_=(0,t.EW)(()=>x.value.slice(f.value,L.value)),C=(0,t.EW)(()=>{const e=[],r=5;let a=Math.max(1,c.value-Math.floor(r/2)),t=Math.min(w.value,a+r-1);t-a+1<r&&(a=Math.max(1,t-r+1));for(let s=a;s<=t;s++)e.push(s);return e}),E=e=>new Intl.NumberFormat("ar-EG").format(e||0),M=e=>{if(!e)return"";const r=new Date(e);return r.toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"})},W=e=>{if(!e)return"";const r=new Date(e),a=new Date,t=a-r,s=Math.floor(t/6e4),o=Math.floor(s/60),l=Math.floor(o/24);return s<1?"الآن":s<60?`منذ ${s} دقيقة`:o<24?`منذ ${o} ساعة`:l<7?`منذ ${l} يوم`:M(e)},X=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"??",D=e=>{const r={superadmin:"المشرف العام",warehouse_manager:"مدير المخازن",company_manager:"مدير الشركة"};return r[e]||e},j=e=>{const r={superadmin:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white",warehouse_manager:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white",company_manager:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gradient-to-r from-green-500 to-emerald-500 text-white"};return r[e]||"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},U=e=>!1===e.is_active?"غير نشيط":"نشيط",P=e=>!1===e.is_active?"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",S=e=>!1===e.is_active?"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300":"text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-300",A=()=>{c.value=1},R=()=>{c.value=1},B=async()=>{r.value=!0,a.value="";try{const r=await e.dispatch("loadAllUsers");m.value=r||[]}catch(t){a.value=t.message||"حدث خطأ في تحميل المستخدمين",m.value=O()}finally{r.value=!1}},K=e=>{d.value=e.id,o.value=!0},V=e=>{d.value=e.id,l.value=!0},z=async r=>{const a=!r.is_active,t=a?`هل تريد تفعيل المستخدم "${r.name}"؟`:`هل تريد تعطيل المستخدم "${r.name}"؟`;if(confirm(t))try{await e.dispatch("updateUser",{userId:r.id,userData:{is_active:a}}),alert(`تم ${a?"تفعيل":"تعطيل"} المستخدم بنجاح`),B()}catch(s){alert(s.message||"حدث خطأ في تحديث حالة المستخدم")}},Q=async r=>{if(confirm(`هل أنت متأكد من حذف المستخدم "${r.name}"؟\nهذا الإجراء لا يمكن التراجع عنه.`))try{await e.dispatch("deleteUser",r.id),alert("تم حذف المستخدم بنجاح"),B()}catch(a){alert(a.message||"حدث خطأ في حذف المستخدم")}},I=()=>{s.value=!1,alert("تم إضافة المستخدم بنجاح"),B()},F=()=>{o.value=!1,alert("تم تحديث المستخدم بنجاح"),B()},H=()=>{l.value=!1,alert("تم إعادة تعيين كلمة المرور بنجاح")},N=()=>{c.value>1&&c.value--},$=()=>{c.value<w.value&&c.value++},T=e=>{c.value=e},O=()=>[{id:"1",name:"المشرف العام",email:"superadmin@monofia.com",role:"superadmin",allowed_warehouses:["main_warehouse","tera_warehouse","shobeen_warehouse","hyper_warehouse"],is_active:!0,phone:"+201234567890",last_login:new Date("2024-01-15T10:30:00")},{id:"2",name:"مدير المخازن",email:"warehouse@monofia.com",role:"warehouse_manager",allowed_warehouses:["main_warehouse","tera_warehouse"],is_active:!0,phone:"+201112223344",last_login:new Date("2024-01-14T14:20:00")},{id:"3",name:"مدير الشركة",email:"company@monofia.com",role:"company_manager",allowed_warehouses:[],is_active:!0,phone:"+201556667788",last_login:new Date("2024-01-13T09:15:00")},{id:"4",name:"محمد أحمد",email:"mohamed@monofia.com",role:"warehouse_manager",allowed_warehouses:["shobeen_warehouse","hyper_warehouse"],is_active:!1,phone:"+201998887766",last_login:new Date("2023-12-20T11:45:00")}];return(0,t.sV)(()=>{B()}),{loading:r,error:a,showAddModal:s,showEditModal:o,showResetPasswordModal:l,selectedUserId:d,searchTerm:n,roleFilter:i,statusFilter:u,currentPage:c,users:m,currentUserId:k,operationLoading:p,filteredUsers:x,totalUsers:h,activeUsers:b,warehouseManagers:v,lastLoginTime:y,paginatedUsers:_,totalPages:w,startIndex:f,endIndex:L,visiblePages:C,formatNumber:E,formatDate:M,getUserInitials:X,getRoleText:D,getRoleBadgeClass:j,getStatusText:U,getStatusBadgeClass:P,getStatusButtonClass:S,handleSearch:A,handleFilter:R,refreshData:B,editUser:K,resetPassword:V,toggleUserStatus:z,deleteUser:Q,handleUserAdded:I,handleUserUpdated:F,handlePasswordReset:H,prevPage:N,nextPage:$,goToPage:T}}},Ue=a(262);const Pe=(0,Ue.A)(je,[["render",Ce],["__scopeId","data-v-7d0eb434"]]);var Se=Pe},949:function(e,r,a){a.d(r,{A:function(){return D}});var t=a(641),s=a(751),o=a(33);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},d={class:"bg-white rounded-lg w-full max-w-md rtl"},n={class:"flex justify-between items-center p-6 border-b border-gray-200"},i={key:0,class:"text-center"},u={class:"h-16 w-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3"},c={class:"text-indigo-600 font-medium text-lg"},g={class:"text-lg font-medium text-gray-900"},m={class:"text-sm text-gray-500 mt-1"},k={class:"mt-2"},p={key:1,class:"space-y-2"},x={class:"flex justify-between items-center"},h={class:"h-2 bg-gray-200 rounded-full overflow-hidden"},b={class:"text-xs text-gray-600 space-y-1 list-disc pr-5"},v={key:2,class:"bg-red-50 border border-red-200 rounded-md p-4"},y={class:"text-sm text-red-700"},w={class:"flex gap-3 pt-6 border-t border-gray-200"},f=["disabled"],L={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},_={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function C(e,r,a,C,E,M){return a.isOpen?((0,t.uX)(),(0,t.CE)("div",l,[(0,t.Lk)("div",d,[(0,t.Lk)("div",n,[r[6]||(r[6]=(0,t.Lk)("h2",{class:"text-xl font-semibold text-gray-800"},"إعادة تعيين كلمة المرور",-1)),(0,t.Lk)("button",{onClick:r[0]||(r[0]=r=>e.$emit("close")),class:"p-1 hover:bg-gray-100 rounded transition-colors duration-200"},[...r[5]||(r[5]=[(0,t.Lk)("svg",{class:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,t.Lk)("form",{onSubmit:r[4]||(r[4]=(0,s.D$)((...e)=>C.handleSubmit&&C.handleSubmit(...e),["prevent"])),class:"p-6 space-y-6"},[a.user?((0,t.uX)(),(0,t.CE)("div",i,[(0,t.Lk)("div",u,[(0,t.Lk)("span",c,(0,o.v_)(C.getUserInitials(a.user.name||a.user.email)),1)]),(0,t.Lk)("h3",g,(0,o.v_)(a.user.name||a.user.email),1),(0,t.Lk)("p",m,(0,o.v_)(a.user.email),1)])):(0,t.Q3)("",!0),(0,t.Lk)("div",null,[r[7]||(r[7]=(0,t.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[(0,t.eW)(" كلمة المرور الجديدة "),(0,t.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",required:"","onUpdate:modelValue":r[1]||(r[1]=e=>C.newPassword=e),class:"w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors duration-200",placeholder:"أدخل كلمة المرور الجديدة"},null,512),[[s.Jo,C.newPassword]]),(0,t.Lk)("div",k,[(0,t.Lk)("button",{type:"button",onClick:r[2]||(r[2]=(...e)=>C.generatePassword&&C.generatePassword(...e)),class:"text-sm text-indigo-600 hover:text-indigo-800"}," توليد كلمة مرور عشوائية ")]),r[8]||(r[8]=(0,t.Lk)("p",{class:"text-xs text-gray-500 mt-2"}," يجب أن تكون كلمة المرور 6 أحرف على الأقل. سيتمكن المستخدم من تغييرها بعد الدخول. ",-1))]),C.newPassword?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.Lk)("div",x,[r[9]||(r[9]=(0,t.Lk)("span",{class:"text-sm font-medium text-gray-700"},"قوة كلمة المرور:",-1)),(0,t.Lk)("span",{class:(0,o.C4)(["text-sm font-medium",C.passwordStrengthClass])},(0,o.v_)(C.passwordStrengthText),3)]),(0,t.Lk)("div",h,[(0,t.Lk)("div",{class:(0,o.C4)(["h-full transition-all duration-300",C.passwordStrengthClass]),style:(0,o.Tr)({width:C.passwordStrengthPercentage+"%"})},null,6)]),(0,t.Lk)("ul",b,[(0,t.Lk)("li",{class:(0,o.C4)(C.hasLength?"text-green-600":"")},"8 أحرف على الأقل",2),(0,t.Lk)("li",{class:(0,o.C4)(C.hasUppercase?"text-green-600":"")},"حرف كبير واحد على الأقل",2),(0,t.Lk)("li",{class:(0,o.C4)(C.hasLowercase?"text-green-600":"")},"حرف صغير واحد على الأقل",2),(0,t.Lk)("li",{class:(0,o.C4)(C.hasNumber?"text-green-600":"")},"رقم واحد على الأقل",2),(0,t.Lk)("li",{class:(0,o.C4)(C.hasSpecialChar?"text-green-600":"")},"رمز خاص واحد على الأقل",2)])])):(0,t.Q3)("",!0),C.errorMessage?((0,t.uX)(),(0,t.CE)("div",v,[(0,t.Lk)("p",y,(0,o.v_)(C.errorMessage),1)])):(0,t.Q3)("",!0),(0,t.Lk)("div",w,[(0,t.Lk)("button",{type:"button",onClick:r[3]||(r[3]=r=>e.$emit("close")),class:"flex-1 py-3 px-4 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200 font-medium"}," إلغاء "),(0,t.Lk)("button",{type:"submit",disabled:C.loading||!C.isFormValid,class:"flex-1 py-3 px-4 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 font-medium flex items-center justify-center gap-2"},[C.loading?((0,t.uX)(),(0,t.CE)("svg",L,[...r[10]||(r[10]=[(0,t.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,t.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,t.uX)(),(0,t.CE)("svg",_,[...r[11]||(r[11]=[(0,t.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"},null,-1)])])),(0,t.eW)(" "+(0,o.v_)(C.loading?"جاري التحديث...":"تحديث كلمة المرور"),1)],8,f)])],32)])])):(0,t.Q3)("",!0)}var E=a(953),M={name:"ResetPasswordModal",props:{isOpen:{type:Boolean,required:!0},user:{type:Object,default:null}},emits:["close","reset"],setup(e,{emit:r}){const a=(0,E.KR)(!1),s=(0,E.KR)(""),o=(0,E.KR)(""),l=(0,t.EW)(()=>{if(!o.value)return 0;let e=0;const r=o.value;return r.length>=8&&(e+=20),/[A-Z]/.test(r)&&(e+=20),/[a-z]/.test(r)&&(e+=20),/[0-9]/.test(r)&&(e+=20),/[^A-Za-z0-9]/.test(r)&&(e+=20),e}),d=(0,t.EW)(()=>Math.min(l.value,100)),n=(0,t.EW)(()=>{const e=l.value;return e<40?"ضعيفة":e<60?"متوسطة":e<80?"جيدة":"قوية جداً"}),i=(0,t.EW)(()=>{const e=l.value;return e<40?"bg-red-500 text-red-500":e<60?"bg-yellow-500 text-yellow-500":e<80?"bg-blue-500 text-blue-500":"bg-green-500 text-green-500"}),u=(0,t.EW)(()=>o.value.length>=8),c=(0,t.EW)(()=>/[A-Z]/.test(o.value)),g=(0,t.EW)(()=>/[a-z]/.test(o.value)),m=(0,t.EW)(()=>/[0-9]/.test(o.value)),k=(0,t.EW)(()=>/[^A-Za-z0-9]/.test(o.value)),p=(0,t.EW)(()=>o.value.length>=6),x=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"?",h=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let r="";for(let a=0;a<12;a++)r+=e.charAt(Math.floor(Math.random()*e.length));o.value=r},b=()=>{o.value="",s.value="",a.value=!1},v=async()=>{if(p.value&&e.user){a.value=!0,s.value="";try{r("reset",{userId:e.user.id,newPassword:o.value})}catch(t){console.error("Error in password reset:",t),s.value=t.message||"حدث خطأ أثناء إعادة تعيين كلمة المرور"}finally{a.value=!1}}};return(0,t.wB)(()=>e.isOpen,e=>{e&&(b(),h())}),{loading:a,errorMessage:s,newPassword:o,passwordStrengthPercentage:d,passwordStrengthText:n,passwordStrengthClass:i,hasLength:u,hasUppercase:c,hasLowercase:g,hasNumber:m,hasSpecialChar:k,isFormValid:p,getUserInitials:x,generatePassword:h,handleSubmit:v}}},W=a(262);const X=(0,W.A)(M,[["render",C]]);var D=X}}]);