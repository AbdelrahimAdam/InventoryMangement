"use strict";(self["webpackChunkmonofia_perfume_inventory"]=self["webpackChunkmonofia_perfume_inventory"]||[]).push([[282],{3727:function(e,t,a){a.d(t,{A:function(){return U}});var s=a(641),o=a(33),r=a(3751);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},n={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg rtl max-h-[90vh] overflow-y-auto"},i={class:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700"},u={class:"text-xl font-semibold text-gray-800 dark:text-white"},c=["readonly"],d={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},m=["value","onUpdate:modelValue"],p={class:"flex w-full items-center justify-between"},h={class:"flex items-center"},v={class:"text-sm"},g={class:"font-medium text-gray-900 dark:text-white"},k={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},b={key:0,class:"h-5 w-5 text-blue-600 dark:text-blue-400",viewBox:"0 0 20 20",fill:"currentColor"},f={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},y={class:"relative"},x={class:"relative inline-flex items-center cursor-pointer"},_={class:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300"},L={key:0},w={class:"flex items-center"},C={key:1,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},E={class:"text-sm text-red-700 dark:text-red-300 list-disc pr-5 space-y-1"},W={key:2,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},M={class:"flex items-center gap-2"},D={class:"text-sm text-red-700 dark:text-red-300"},I={class:"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700"},q=["disabled"],P={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},X={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function S(e,t,a,S,B,j){return a.isOpen?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",n,[(0,s.Lk)("div",i,[(0,s.Lk)("h2",u,(0,o.v_)(a.warehouse?"تعديل المخزن":"إضافة مخزن جديد"),1),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>S.closeModal&&S.closeModal(...e)),class:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors duration-200"},[...t[11]||(t[11]=[(0,s.Lk)("svg",{class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,s.Lk)("form",{onSubmit:t[10]||(t[10]=(0,r.D$)((...e)=>S.handleSubmit&&S.handleSubmit(...e),["prevent"])),class:"p-6 space-y-6"},[(0,s.Lk)("div",null,[t[12]||(t[12]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,s.eW)(" معرف المخزن "),(0,s.Lk)("span",{class:"text-red-500"},"*"),(0,s.Lk)("span",{class:"text-xs text-gray-500 dark:text-gray-400 block mt-1"},"يجب أن يكون معرفاً فريداً بالإنجليزية")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[1]||(t[1]=e=>S.formData.id=e),readonly:!!a.warehouse,class:(0,o.C4)(["w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono",{"bg-gray-100 dark:bg-gray-800":!!a.warehouse}]),placeholder:"مثال: main_warehouse"},null,10,c),[[r.Jo,S.formData.id]])]),(0,s.Lk)("div",null,[t[13]||(t[13]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,s.eW)(" اسم المخزن (عربي) "),(0,s.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[2]||(t[2]=e=>S.formData.name_ar=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-right",placeholder:"مخزن رئيسي"},null,512),[[r.Jo,S.formData.name_ar]])]),(0,s.Lk)("div",null,[t[14]||(t[14]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," اسم المخزن (إنجليزي) ",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>S.formData.name_en=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Main Warehouse"},null,512),[[r.Jo,S.formData.name_en]])]),(0,s.Lk)("div",null,[t[16]||(t[16]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},[(0,s.eW)(" نوع المخزن "),(0,s.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,s.Lk)("div",d,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(S.warehouseTypes,e=>((0,s.uX)(),(0,s.CE)("label",{key:e.value,class:(0,o.C4)(["relative flex cursor-pointer rounded-lg border p-4 focus:outline-none transition-colors duration-200",{"border-blue-600 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/20":S.formData.type===e.value,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700":S.formData.type!==e.value}])},[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:e.value,"onUpdate:modelValue":e=>S.formData.type=e,class:"sr-only"},null,8,m),[[r.XL,S.formData.type]]),(0,s.Lk)("div",p,[(0,s.Lk)("div",h,[(0,s.Lk)("div",v,[(0,s.Lk)("div",g,(0,o.v_)(e.name),1),(0,s.Lk)("div",k,(0,o.v_)(e.description),1)])]),S.formData.type===e.value?((0,s.uX)(),(0,s.CE)("svg",b,[...t[15]||(t[15]=[(0,s.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])])):(0,s.Q3)("",!0)])],2))),128))])]),(0,s.Lk)("div",f,[(0,s.Lk)("div",null,[t[18]||(t[18]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," السعة التخزينية ",-1)),(0,s.Lk)("div",y,[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=e=>S.formData.capacity=e),min:"0",step:"1",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white pr-10",placeholder:"1000"},null,512),[[r.Jo,S.formData.capacity,void 0,{number:!0}]]),t[17]||(t[17]=(0,s.Lk)("span",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400"},"وحدة",-1))])]),(0,s.Lk)("div",null,[t[19]||(t[19]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," الموقع ",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>S.formData.location=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"شارع الشيخ، المنوفية"},null,512),[[r.Jo,S.formData.location]])])]),(0,s.Lk)("div",null,[t[20]||(t[20]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," وصف المخزن ",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>S.formData.description=e),rows:"3",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"وصف إضافي للمخزن..."},null,512),[[r.Jo,S.formData.description]])]),(0,s.Lk)("div",null,[t[22]||(t[22]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"حالة المخزن",-1)),(0,s.Lk)("label",x,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>S.formData.status=e),"true-value":"active","false-value":"inactive",class:"sr-only peer"},null,512),[[r.lH,S.formData.status]]),t[21]||(t[21]=(0,s.Lk)("div",{class:"w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"},null,-1)),(0,s.Lk)("span",_,(0,o.v_)("active"===S.formData.status?"نشط":"غير نشط"),1)])]),"primary"===S.formData.type?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("div",w,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>S.formData.is_main=e),"true-value":!0,"false-value":!1,id:"is_main",class:"h-4 w-4 text-blue-600 dark:text-blue-400 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400"},null,512),[[r.lH,S.formData.is_main]]),t[23]||(t[23]=(0,s.Lk)("label",{for:"is_main",class:"mr-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," تعيين كمخزن رئيسي ",-1))]),t[24]||(t[24]=(0,s.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"}," المخزن الرئيسي هو المخزن الافتراضي في النظام ",-1))])):(0,s.Q3)("",!0),S.validationErrors.length>0?((0,s.uX)(),(0,s.CE)("div",C,[t[25]||(t[25]=(0,s.Lk)("h4",{class:"text-sm font-medium text-red-800 dark:text-red-300 mb-2"},"خطأ في التحقق:",-1)),(0,s.Lk)("ul",E,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(S.validationErrors,e=>((0,s.uX)(),(0,s.CE)("li",{key:e},(0,o.v_)(e),1))),128))])])):(0,s.Q3)("",!0),S.errorMessage?((0,s.uX)(),(0,s.CE)("div",W,[(0,s.Lk)("div",M,[t[26]||(t[26]=(0,s.Lk)("svg",{class:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),(0,s.Lk)("p",D,(0,o.v_)(S.errorMessage),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",I,[(0,s.Lk)("button",{type:"button",onClick:t[9]||(t[9]=(...e)=>S.closeModal&&S.closeModal(...e)),class:"flex-1 py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 font-medium"}," إلغاء "),(0,s.Lk)("button",{type:"submit",disabled:S.loading||!S.isFormValid,class:"flex-1 py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-md hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 font-medium flex items-center justify-center gap-2"},[S.loading?((0,s.uX)(),(0,s.CE)("svg",P,[...t[27]||(t[27]=[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,s.uX)(),(0,s.CE)("svg",X,[...t[28]||(t[28]=[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),(0,s.eW)(" "+(0,o.v_)(S.loading?"جاري الحفظ...":a.warehouse?"تحديث":"إضافة"),1)],8,q)])],32)])])):(0,s.Q3)("",!0)}var B=a(953),j=a(834),Q=a(3556),V=a(2405),A={name:"WarehouseModal",props:{isOpen:{type:Boolean,required:!0},warehouse:{type:Object,default:null}},emits:["close","save"],setup(e,{emit:t}){const a=(0,j.Pj)(),o=(0,B.KR)(!1),r=(0,B.KR)(""),l=(0,B.KR)([]),n=(0,B.KR)({id:"",name_ar:"",name_en:"",type:"primary",capacity:0,location:"",description:"",status:"active",is_main:!1}),i=(0,B.KR)([{value:"primary",name:"مخزن رئيسي",description:"مخزن للتخزين الداخلي"},{value:"dispatch",name:"موقع صرف",description:"موقع لصرف الأصناف للخارج"}]),u=(0,s.EW)(()=>(l.value=[],n.value.id.trim()?/^[a-z0-9_]+$/.test(n.value.id)||l.value.push("معرف المخزن يجب أن يحتوي على أحرف إنجليزية صغيرة وأرقام وشرطة سفلية فقط"):l.value.push("معرف المخزن مطلوب"),n.value.name_ar.trim()||l.value.push("اسم المخزن بالعربي مطلوب"),n.value.type||l.value.push("نوع المخزن مطلوب"),n.value.capacity<0&&l.value.push("السعة التخزينية لا يمكن أن تكون سالبة"),0===l.value.length)),c=()=>{n.value={id:"",name_ar:"",name_en:"",type:"primary",capacity:0,location:"",description:"",status:"active",is_main:!1},r.value="",l.value=[]},d=()=>{c(),t("close")},m=async e=>{try{const t=(0,V.H9)(Q.db,"warehouses",e),a=await(0,V.x7)(t);return a.exists()}catch(t){return console.error("Error checking warehouse existence:",t),!1}},p=async()=>{if(u.value){o.value=!0,r.value="";try{const s={id:n.value.id.trim(),name_ar:n.value.name_ar.trim(),name_en:n.value.name_en.trim()||n.value.name_ar.trim(),type:n.value.type,capacity:Number(n.value.capacity)||0,location:n.value.location.trim(),description:n.value.description.trim(),status:n.value.status,is_main:n.value.is_main||!1,updated_at:(new Date).toISOString()};if(e.warehouse)s.created_at=e.warehouse.created_at;else{const e=await m(s.id);if(e)throw new Error("المخزن موجود بالفعل");s.created_at=(new Date).toISOString()}if(!a.getters.canManageWarehouses)throw new Error("ليس لديك صلاحية لإدارة المخازن");const o=(0,V.H9)(Q.db,"warehouses",s.id);await(0,V.BN)(o,s,{merge:!0}),console.log("Warehouse saved successfully:",s.id),a.dispatch("showNotification",{type:"success",message:`تم ${e.warehouse?"تحديث":"إضافة"} المخزن "${s.name_ar}" بنجاح`}),t("save",s),d()}catch(s){console.error("Error saving warehouse:",s),r.value=s.message||"حدث خطأ أثناء حفظ المخزن",a.dispatch("showNotification",{type:"error",message:r.value})}finally{o.value=!1}}};return(0,s.wB)(()=>e.isOpen,t=>{t&&(c(),e.warehouse&&(n.value={id:e.warehouse.id,name_ar:e.warehouse.name_ar||"",name_en:e.warehouse.name_en||"",type:e.warehouse.type||"primary",capacity:e.warehouse.capacity||0,location:e.warehouse.location||"",description:e.warehouse.description||"",status:e.warehouse.status||"active",is_main:e.warehouse.is_main||!1}))}),(0,s.wB)(()=>n.value.type,e=>{"dispatch"===e&&(n.value.is_main=!1)}),{loading:o,errorMessage:r,validationErrors:l,formData:n,warehouseTypes:i,isFormValid:u,closeModal:d,handleSubmit:p}}},R=a(6262);const F=(0,R.A)(A,[["render",S]]);var U=F},4243:function(e,t,a){a.d(t,{A:function(){return h}});var s=a(641);const o={key:2,class:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-950"};function r(e,t,a,r,l,n){const i=(0,s.g2)("MobileLayout"),u=(0,s.g2)("DesktopLayout");return r.isMobile&&!r.initializing?((0,s.uX)(),(0,s.Wv)(i,{key:0})):r.initializing?((0,s.uX)(),(0,s.CE)("div",o,[...t[0]||(t[0]=[(0,s.Lk)("div",{class:"text-center"},[(0,s.Lk)("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),(0,s.Lk)("p",{class:"mt-4 text-gray-600 dark:text-gray-400 font-medium"},"جاري تحميل النظام...")],-1)])])):((0,s.uX)(),(0,s.Wv)(u,{key:1}))}var l=a(953),n=a(834),i=a(5499),u=a(8696),c=a(3613),d={name:"App",components:{MobileLayout:u.A,DesktopLayout:c["default"]},setup(){const e=(0,n.Pj)(),t=(0,i.rd)(),a=(0,l.KR)(!0),o=(0,l.KR)(!1),r=()=>{o.value=window.innerWidth<1024};return(0,s.sV)(async()=>{try{await e.dispatch("initializeAuth"),r(),window.addEventListener("resize",r);const a=e.subscribe((e,a)=>{"SET_AUTH_STATE"===e.type&&(a.isAuthenticated||t.currentRoute.value.meta?.public||t.push("/login"))});e.state.unsubscribeAuthListener=a}catch(s){console.error("App initialization error:",s)}finally{setTimeout(()=>{a.value=!1},500)}}),(0,s.hi)(()=>{window.removeEventListener("resize",r),e.state.unsubscribeAuthListener&&e.state.unsubscribeAuthListener()}),{initializing:a,isMobile:o}}},m=a(6262);const p=(0,m.A)(d,[["render",r]]);var h=p},4502:function(e,t,a){a.d(t,{A:function(){return ue}});var s=a(641),o=a(3751),r=a(33);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},n={class:"bg-white rounded-lg w-full max-w-2xl rtl flex flex-col",style:{height:"90vh"}},i={class:"flex justify-between items-center p-4 border-b shrink-0 bg-white"},u={class:"flex-1 overflow-hidden flex flex-col"},c={class:"flex-1 overflow-y-auto min-h-0"},d={class:"p-4 space-y-4"},m={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},p=["value"],h={class:"border border-gray-200 rounded-lg overflow-hidden bg-white"},v={key:0,class:"text-center py-8 text-gray-500 text-sm"},g={key:1},k=["onClick"],b={class:"col-span-1 px-2 py-3 flex items-center justify-center"},f=["value"],y={class:"col-span-7 px-2 py-3"},x={class:"space-y-1"},_={class:"font-medium text-gray-900 line-clamp-1"},L={class:"text-gray-500 text-xs line-clamp-1"},w={class:"text-gray-400 text-xs"},C={class:"col-span-2 px-2 py-3 flex items-center text-gray-500 text-xs"},E={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg overflow-hidden"},W={class:"p-3 space-y-3"},M={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},D={class:"space-y-2"},I={class:"flex justify-between items-center"},q={class:"font-medium text-xs sm:text-sm text-gray-900"},P={class:"flex justify-between items-center"},X={class:"font-medium text-xs sm:text-sm text-gray-900"},S={class:"grid grid-cols-2 gap-2 text-xs sm:text-sm"},B={class:"text-center p-2 bg-blue-100 rounded"},j={class:"font-bold text-blue-700"},Q={class:"text-center p-2 bg-blue-100 rounded"},V={class:"font-bold text-blue-700"},A={class:"space-y-2"},R={class:"grid grid-cols-2 gap-2"},F=["max"],U={class:"text-xs text-gray-500 mt-1"},$=["max"],H={class:"text-xs text-gray-500 mt-1"},z=["value"],K={class:"pt-2 border-t border-blue-200"},T={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2"},O={class:"text-xs sm:text-sm"},J={class:"text-gray-400"},N={class:"p-3 border-t bg-white shrink-0 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]"},G={class:"flex flex-col sm:flex-row gap-2"},Y=["disabled"],Z={key:0,class:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ee={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},te={key:0,class:"mt-2 text-xs text-center text-red-600 bg-red-50 p-1.5 rounded border border-red-200"},ae={key:1,class:"mt-2 text-xs text-center text-green-600 bg-green-50 p-1.5 rounded border border-green-200"};function se(e,t,a,se,oe,re){return a.isOpen?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",n,[(0,s.Lk)("div",i,[t[14]||(t[14]=(0,s.Lk)("h2",{class:"text-lg font-semibold text-gray-800"},"نقل الأصناف بين المخازن",-1)),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>se.closeModal&&se.closeModal(...e)),class:"p-1 hover:bg-gray-100 rounded transition-colors duration-200"},[...t[13]||(t[13]=[(0,s.Lk)("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,s.Lk)("div",u,[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.Lk)("div",m,[(0,s.Lk)("div",null,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>se.searchTerm=e),placeholder:"ابحث بالاسم، الكود، اللون...",class:"w-full p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[o.Jo,se.searchTerm]])]),(0,s.Lk)("div",null,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>se.filterWarehouse=e),class:"w-full p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[t[15]||(t[15]=(0,s.Lk)("option",{value:""},"جميع المخازن",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(se.primaryWarehouses,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,r.v_)(e.name_ar),9,p))),128))],512),[[o.u1,se.filterWarehouse]])])]),(0,s.Lk)("div",h,[t[17]||(t[17]=(0,s.Fv)('<div class="sticky top-0 z-10 bg-gray-50 border-b border-gray-200" data-v-e2e72018><div class="grid grid-cols-12 text-xs font-medium text-gray-500 uppercase tracking-wider" data-v-e2e72018><div class="col-span-1 px-2 py-3 text-center" data-v-e2e72018> ✓ </div><div class="col-span-7 px-2 py-3 text-right" data-v-e2e72018> الصنف </div><div class="col-span-2 px-2 py-3 text-right" data-v-e2e72018> المخزن </div><div class="col-span-2 px-2 py-3 text-center" data-v-e2e72018> المتوفر </div></div></div>',1)),(0,s.Lk)("div",{class:"overflow-y-auto",style:(0,r.Tr)({maxHeight:se.selectedItem?"150px":"250px",minHeight:"100px"})},[0===se.filteredItems.length?((0,s.uX)(),(0,s.CE)("div",v,[...t[16]||(t[16]=[(0,s.Lk)("svg",{class:"mx-auto h-10 w-10 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m8-8V4a1 1 0 00-1-1h-2a1 1 0 00-1 1v1M9 7h6"})],-1),(0,s.Lk)("p",{class:"font-medium"},"لا توجد أصناف متاحة للنقل",-1),(0,s.Lk)("p",{class:"text-xs mt-1"},"قم بتعديل البحث أو الفلتر",-1)])])):((0,s.uX)(),(0,s.CE)("div",g,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(se.filteredItems,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,onClick:t=>se.selectItem(e),class:(0,r.C4)(["grid grid-cols-12 cursor-pointer transition-colors duration-150 text-sm border-b border-gray-100 hover:bg-gray-50",se.selectedItem?.id===e.id?"bg-blue-50 border-r-2 border-r-blue-500":""])},[(0,s.Lk)("div",b,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=e=>se.formData.item_id=e),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,f),[[o.XL,se.formData.item_id]])]),(0,s.Lk)("div",y,[(0,s.Lk)("div",x,[(0,s.Lk)("div",_,(0,r.v_)(e.name),1),(0,s.Lk)("div",L,(0,r.v_)(e.code)+" - "+(0,r.v_)(e.color),1),(0,s.Lk)("div",w,(0,r.v_)(e.cartons_count)+"×"+(0,r.v_)(e.per_carton_count)+" + "+(0,r.v_)(e.single_bottles_count)+" فردي ",1)])]),(0,s.Lk)("div",C,(0,r.v_)(se.getWarehouseShortName(se.getWarehouseName(e.warehouse_id))),1),(0,s.Lk)("div",{class:(0,r.C4)(["col-span-2 px-2 py-3 flex items-center justify-center font-semibold text-sm",se.getQuantityClass(e.remaining_quantity)])},(0,r.v_)(e.remaining_quantity),3)],10,k))),128))]))],4)]),se.selectedItem?((0,s.uX)(),(0,s.CE)("div",E,[(0,s.Lk)("button",{onClick:t[4]||(t[4]=e=>se.isDetailsExpanded=!se.isDetailsExpanded),class:"w-full flex justify-between items-center p-3 bg-blue-100 hover:bg-blue-200 transition-colors duration-200 sm:hidden"},[t[19]||(t[19]=(0,s.Lk)("span",{class:"text-sm font-semibold text-blue-800"},"تفاصيل النقل",-1)),((0,s.uX)(),(0,s.CE)("svg",{class:(0,r.C4)(["w-5 h-5 text-blue-600 transform transition-transform duration-200",se.isDetailsExpanded?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[18]||(t[18]=[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),(0,s.Lk)("div",{class:(0,r.C4)(["sm:block",se.isDetailsExpanded?"block":"hidden"])},[(0,s.Lk)("div",W,[t[29]||(t[29]=(0,s.Lk)("h3",{class:"text-sm font-semibold text-blue-800 hidden sm:block"},"تفاصيل النقل",-1)),(0,s.Lk)("div",M,[(0,s.Lk)("div",D,[(0,s.Lk)("div",I,[t[20]||(t[20]=(0,s.Lk)("span",{class:"text-xs sm:text-sm text-gray-600"},"من المخزن:",-1)),(0,s.Lk)("span",q,(0,r.v_)(se.getWarehouseName(se.selectedItem.warehouse_id)),1)]),(0,s.Lk)("div",P,[t[21]||(t[21]=(0,s.Lk)("span",{class:"text-xs sm:text-sm text-gray-600"},"المتاح:",-1)),(0,s.Lk)("span",X,(0,r.v_)(se.selectedItem.remaining_quantity),1)]),(0,s.Lk)("div",S,[(0,s.Lk)("div",B,[t[22]||(t[22]=(0,s.Lk)("div",{class:"text-gray-600"},"الكراتين",-1)),(0,s.Lk)("div",j,(0,r.v_)(se.selectedItem.cartons_count),1)]),(0,s.Lk)("div",Q,[t[23]||(t[23]=(0,s.Lk)("div",{class:"text-gray-600"},"الفردي",-1)),(0,s.Lk)("div",V,(0,r.v_)(se.selectedItem.single_bottles_count),1)])])]),(0,s.Lk)("div",A,[(0,s.Lk)("div",R,[(0,s.Lk)("div",null,[t[24]||(t[24]=(0,s.Lk)("label",{class:"block text-xs sm:text-sm font-medium text-gray-700 mb-1"},"كراتين",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",min:"0",max:se.selectedItem.cartons_count,"onUpdate:modelValue":t[5]||(t[5]=e=>se.formData.cartons=e),class:"w-full p-1 sm:p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent",onChange:t[6]||(t[6]=(...e)=>se.validateQuantities&&se.validateQuantities(...e))},null,40,F),[[o.Jo,se.formData.cartons,void 0,{number:!0}]]),(0,s.Lk)("div",U,"حد: "+(0,r.v_)(se.selectedItem.cartons_count),1)]),(0,s.Lk)("div",null,[t[25]||(t[25]=(0,s.Lk)("label",{class:"block text-xs sm:text-sm font-medium text-gray-700 mb-1"},"فردي",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",min:"0",max:se.selectedItem.single_bottles_count,"onUpdate:modelValue":t[7]||(t[7]=e=>se.formData.single_bottles=e),class:"w-full p-1 sm:p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent",onChange:t[8]||(t[8]=(...e)=>se.validateQuantities&&se.validateQuantities(...e))},null,40,$),[[o.Jo,se.formData.single_bottles,void 0,{number:!0}]]),(0,s.Lk)("div",H,"حد: "+(0,r.v_)(se.selectedItem.single_bottles_count),1)])]),(0,s.Lk)("div",null,[t[27]||(t[27]=(0,s.Lk)("label",{class:"block text-xs sm:text-sm font-medium text-gray-700 mb-1"},"إلى المخزن",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>se.formData.to_warehouse=e),required:"",class:"w-full p-1 sm:p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent"},[t[26]||(t[26]=(0,s.Lk)("option",{value:""},"اختر المخزن",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(se.availableDestinationWarehouses,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,r.v_)(se.getWarehouseShortName(e.name_ar)),9,z))),128))],512),[[o.u1,se.formData.to_warehouse]])])])]),(0,s.Lk)("div",K,[(0,s.Lk)("div",T,[(0,s.Lk)("div",O,[t[28]||(t[28]=(0,s.Lk)("span",{class:"text-gray-600"},"الإجمالي:",-1)),(0,s.Lk)("span",{class:(0,r.C4)(["font-bold mx-1",se.getQuantityClass(se.totalRequestedQuantity)])},(0,r.v_)(se.totalRequestedQuantity),3),(0,s.Lk)("span",J,"/ "+(0,r.v_)(se.selectedItem.remaining_quantity),1)]),se.validationMessage?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,r.C4)(["px-2 py-1 rounded text-xs font-medium whitespace-nowrap mt-1 sm:mt-0","error"===se.validationMessage.type?"bg-red-100 text-red-700 border border-red-200":"bg-green-100 text-green-700 border border-green-200"])},(0,r.v_)(se.validationMessage.text),3)):(0,s.Q3)("",!0)])])])],2)])):(0,s.Q3)("",!0),se.selectedItem?((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,r.C4)(["sm:block",se.isDetailsExpanded?"block":"hidden sm:block"])},[t[30]||(t[30]=(0,s.Lk)("label",{class:"block text-xs sm:text-sm font-medium text-gray-700 mb-1"},"ملاحظات (اختياري)",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[10]||(t[10]=e=>se.formData.notes=e),rows:"2",class:"w-full p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"أضف ملاحظات حول عملية النقل..."},null,512),[[o.Jo,se.formData.notes]])],2)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",N,[(0,s.Lk)("div",G,[(0,s.Lk)("button",{type:"button",onClick:t[11]||(t[11]=(...e)=>se.closeModal&&se.closeModal(...e)),class:"py-2.5 px-3 text-sm font-medium border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors duration-200 flex-1 min-h-[44px]"}," إلغاء "),(0,s.Lk)("button",{type:"button",onClick:t[12]||(t[12]=(...e)=>se.handleSubmit&&se.handleSubmit(...e)),disabled:se.loading||!se.isFormValid,class:"py-2.5 px-3 text-sm font-medium bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center gap-2 flex-1 min-h-[44px]"},[se.loading?((0,s.uX)(),(0,s.CE)("svg",Z,[...t[31]||(t[31]=[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,s.uX)(),(0,s.CE)("svg",ee,[...t[32]||(t[32]=[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7l4-4m0 0l4 4m-4-4v18m0 0l-4-4m4 4l4-4"},null,-1)])])),(0,s.eW)(" "+(0,r.v_)(se.loading?"جاري النقل...":"تأكيد النقل"),1)],8,Y)]),se.selectedItem&&!se.isFormValid?((0,s.uX)(),(0,s.CE)("div",te," ❌ املأ جميع الحقول المطلوبة بشكل صحيح ")):se.selectedItem&&se.isFormValid?((0,s.uX)(),(0,s.CE)("div",ae," ✅ جاهز للنقل - "+(0,r.v_)(se.totalRequestedQuantity)+" وحدة ",1)):(0,s.Q3)("",!0)])])])])):(0,s.Q3)("",!0)}var oe=a(953),re=a(834),le={name:"TransferModal",props:{isOpen:Boolean,item:{type:Object,default:null}},emits:["close","success"],setup(e,{emit:t}){const a=(0,re.Pj)(),o=(0,oe.KR)(!1),r=(0,oe.KR)(""),l=(0,oe.KR)(""),n=(0,oe.KR)(!0),i=(0,oe.KR)({item_id:"",from_warehouse:"",to_warehouse:"",cartons:0,single_bottles:0,notes:""}),u=(0,s.EW)(()=>a.state.warehouses.filter(e=>"primary"===e.type)),c=(0,s.EW)(()=>a.state.inventory||[]),d=(0,s.EW)(()=>c.value.filter(e=>e.remaining_quantity>0)),m=(0,s.EW)(()=>{let e=d.value;if(r.value){const t=r.value.toLowerCase();e=e.filter(e=>(e.name?.toLowerCase().includes(t)||e.code?.toLowerCase().includes(t)||e.color?.toLowerCase().includes(t)||e.supplier?.toLowerCase().includes(t))&&e.remaining_quantity>0)}return l.value&&(e=e.filter(e=>e.warehouse_id===l.value)),e}),p=(0,s.EW)(()=>i.value.item_id?c.value.find(e=>e.id===i.value.item_id):null),h=(0,s.EW)(()=>p.value?u.value.filter(e=>e.id!==p.value.warehouse_id):[]),v=(0,s.EW)(()=>p.value?.per_carton_count||1),g=(0,s.EW)(()=>i.value.cartons*v.value+i.value.single_bottles),k=(0,s.EW)(()=>{if(!p.value)return null;const e=p.value.remaining_quantity;return 0===g.value?{type:"error",text:"❗ حدد كمية"}:g.value>e?{type:"error",text:`❌ ${g.value} > ${e}`}:i.value.cartons>p.value.cartons_count?{type:"error",text:`❌ كراتين: ${i.value.cartons} > ${p.value.cartons_count}`}:i.value.single_bottles>p.value.single_bottles_count?{type:"error",text:`❌ فردي: ${i.value.single_bottles} > ${p.value.single_bottles_count}`}:i.value.to_warehouse?i.value.from_warehouse===i.value.to_warehouse?{type:"error",text:"❌ نفس المخزن"}:{type:"success",text:`✅ ${g.value} / ${e}`}:{type:"error",text:"❗ اختر المخزن"}}),b=(0,s.EW)(()=>p.value&&i.value.to_warehouse&&g.value>0&&"success"===k.value?.type),f=e=>0===e?"text-red-600":e<10?"text-orange-600":"text-green-600",y=e=>{const t=a.state.warehouses.find(t=>t.id===e);return t?t.name_ar:e},x=e=>{const t={"مخزن شارع الشيخ":"الشيخ","مخزن الترعه":"الترعه","مخزن موقف شبين":"شبين","مخزن هايبر التهامي":"التهامي","مخزن المنوفية":"المنوفية","مخزن الزهراء":"الزهراء","مصنع البران":"البران"};return t[e]||(e?e.substring(0,8):"")},_=e=>{i.value.item_id=e.id,i.value.from_warehouse=e.warehouse_id,i.value.cartons=Math.min(1,e.cartons_count),i.value.single_bottles=Math.min(1,e.single_bottles_count),i.value.to_warehouse="",window.innerWidth<640&&(n.value=!0)},L=()=>{if(!p.value)return;i.value.cartons>p.value.cartons_count&&(i.value.cartons=p.value.cartons_count),i.value.single_bottles>p.value.single_bottles_count&&(i.value.single_bottles=p.value.single_bottles_count),i.value.cartons<0&&(i.value.cartons=0),i.value.single_bottles<0&&(i.value.single_bottles=0);const e=i.value.cartons*v.value+i.value.single_bottles;if(e>p.value.remaining_quantity){const e=Math.floor(p.value.remaining_quantity/v.value);if(e<i.value.cartons)i.value.cartons=e,i.value.single_bottles=p.value.remaining_quantity-i.value.cartons*v.value;else{const e=p.value.remaining_quantity-i.value.cartons*v.value;e<i.value.single_bottles&&(i.value.single_bottles=e)}}},w=()=>{t("close"),C()},C=()=>{i.value={item_id:"",from_warehouse:"",to_warehouse:"",cartons:0,single_bottles:0,notes:""},r.value="",l.value="",n.value=window.innerWidth>=640},E=async()=>{if(a.state.user&&p.value&&b.value)if(i.value.from_warehouse!==i.value.to_warehouse){if(g.value<=0)alert("❗ يجب تحديد كمية للنقل");else if(g.value>p.value.remaining_quantity)alert("❌ الكمية المطلوبة تتجاوز الكمية المتاحة");else if(confirm(`هل أنت متأكد من نقل ${g.value} وحدة من "${p.value.name}"؟`)){o.value=!0;try{const e={item_id:i.value.item_id,from_warehouse:i.value.from_warehouse,to_warehouse:i.value.to_warehouse,cartons:i.value.cartons,single_bottles:i.value.single_bottles,notes:i.value.notes,total_quantity:g.value,item_name:p.value.name,item_code:p.value.code,item_color:p.value.color};await a.dispatch("transferItem",e),t("success"),w()}catch(e){console.error("Error transferring item:",e),alert(`❌ خطأ في النقل: ${e.message||"حدث خطأ غير متوقع"}`)}finally{o.value=!1}}}else alert("❌ لا يمكن النقل إلى نفس المخزن")};return"undefined"!==typeof window&&(n.value=window.innerWidth>=640),(0,s.wB)(()=>e.isOpen,t=>{t&&(C(),e.item&&_(e.item))}),(0,s.wB)(()=>i.value.cartons,()=>{L()}),(0,s.wB)(()=>i.value.single_bottles,()=>{L()}),(0,s.wB)(()=>p.value,e=>{e&&L()}),{loading:o,formData:i,searchTerm:r,filterWarehouse:l,isDetailsExpanded:n,primaryWarehouses:u,availableItems:d,filteredItems:m,selectedItem:p,availableDestinationWarehouses:h,totalRequestedQuantity:g,validationMessage:k,isFormValid:b,getQuantityClass:f,getWarehouseName:y,getWarehouseShortName:x,selectItem:_,validateQuantities:L,closeModal:w,handleSubmit:E}}},ne=a(6262);const ie=(0,ne.A)(le,[["render",se],["__scopeId","data-v-e2e72018"]]);var ue=ie},6106:function(e,t,a){a.d(t,{A:function(){return le}});var s=a(641),o=a(33),r=a(3751);const l={class:"card"},n={key:0,class:"export-container"},i=["disabled"],u={key:0},c={key:1},d=["disabled"],m={key:0},p={key:1},h={class:"table-view"},v={class:"table-container"},g={class:"table"},k={class:"table-header-row"},b={key:0,class:"table-header-cell"},f={key:1,class:"table-header-cell"},y={key:0,class:"table-cell photo-cell"},x={key:0,class:"photo-container"},_=["src","alt","onClick"],L={key:1,class:"no-photo"},w={class:"table-cell"},C={class:"table-cell table-cell-mono"},E={class:"table-cell"},W={class:"table-cell"},M={class:"table-cell"},D={class:"table-cell"},I={class:"table-cell"},q={class:"table-cell"},P={class:"table-cell"},X={class:"table-cell"},S={class:"table-cell"},B={key:1,class:"table-cell"},j={class:"action-buttons"},Q={class:"main-action-buttons"},V=["onClick"],A=["onClick"],R={key:0,class:"admin-action-buttons"},F=["onClick"],U=["onClick"],$={class:"table-cell"},H={class:"date-text"},z={key:1,class:"empty-state"},K=["src"],T={key:3,class:"progress-modal"},O={class:"progress-modal-content"},J={class:"progress-info"},N={class:"progress-text"},G={class:"progress-details"},Y={class:"progress-bar-container"},Z={class:"progress-stats"};function ee(e,t,a,ee,te,ae){return(0,s.uX)(),(0,s.CE)("div",l,[a.items.length>0&&ae.canExport?((0,s.uX)(),(0,s.CE)("div",n,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>ae.exportSingleCard&&ae.exportSingleCard(...e)),class:"export-btn",disabled:te.exporting},[t[6]||(t[6]=(0,s.Lk)("svg",{class:"export-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),te.exporting?((0,s.uX)(),(0,s.CE)("span",c,"جاري التصدير...")):((0,s.uX)(),(0,s.CE)("span",u,"تصدير كرت مفرد"))],8,i),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>ae.exportAllCards&&ae.exportAllCards(...e)),class:"export-btn export-all-btn",disabled:te.exporting},[t[7]||(t[7]=(0,s.Lk)("svg",{class:"export-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})],-1)),te.exporting?((0,s.uX)(),(0,s.CE)("span",p,"جاري التصدير...")):((0,s.uX)(),(0,s.CE)("span",m,"تصدير جميع الكروت"))],8,d)])):(0,s.Q3)("",!0),(0,s.Lk)("div",h,[(0,s.Lk)("div",v,[(0,s.Lk)("table",g,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",k,[a.showPhotoColumn?((0,s.uX)(),(0,s.CE)("th",b,"الصورة")):(0,s.Q3)("",!0),t[8]||(t[8]=(0,s.Lk)("th",{class:"table-header-cell"},"الاسم",-1)),t[9]||(t[9]=(0,s.Lk)("th",{class:"table-header-cell"},"الكود",-1)),t[10]||(t[10]=(0,s.Lk)("th",{class:"table-header-cell"},"اللون",-1)),t[11]||(t[11]=(0,s.Lk)("th",{class:"table-header-cell"},"المخزن",-1)),t[12]||(t[12]=(0,s.Lk)("th",{class:"table-header-cell"},"المورد",-1)),t[13]||(t[13]=(0,s.Lk)("th",{class:"table-header-cell"},"مكان الصنف",-1)),t[14]||(t[14]=(0,s.Lk)("th",{class:"table-header-cell"},"الكراتين",-1)),t[15]||(t[15]=(0,s.Lk)("th",{class:"table-header-cell"},"في الكرتونة",-1)),t[16]||(t[16]=(0,s.Lk)("th",{class:"table-header-cell"},"الفردي",-1)),t[17]||(t[17]=(0,s.Lk)("th",{class:"table-header-cell"},"المضاف",-1)),t[18]||(t[18]=(0,s.Lk)("th",{class:"table-header-cell"},"المتبقي",-1)),t[19]||(t[19]=(0,s.Lk)("th",{class:"table-header-cell"},"الحالة",-1)),!a.readonly&&a.showActions?((0,s.uX)(),(0,s.CE)("th",f,"الإجراءات")):(0,s.Q3)("",!0),t[20]||(t[20]=(0,s.Lk)("th",{class:"table-header-cell"},"آخر تحديث",-1))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.items,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:"table-row"},[a.showPhotoColumn?((0,s.uX)(),(0,s.CE)("td",y,[e.photo_url?((0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("img",{src:ae.getPhotoUrl(e.photo_url),alt:e.name,class:"item-photo",onClick:t=>ae.openPhotoPreview(ae.getPhotoUrl(e.photo_url))},null,8,_)])):((0,s.uX)(),(0,s.CE)("div",L,[...t[21]||(t[21]=[(0,s.Lk)("svg",{class:"no-photo-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]))])):(0,s.Q3)("",!0),(0,s.Lk)("td",w,(0,o.v_)(e.name),1),(0,s.Lk)("td",C,(0,o.v_)(e.code),1),(0,s.Lk)("td",E,(0,o.v_)(e.color),1),(0,s.Lk)("td",W,(0,o.v_)(ae.getWarehouseLabel(e.warehouse_id)),1),(0,s.Lk)("td",M,(0,o.v_)(e.supplier||"-"),1),(0,s.Lk)("td",D,(0,o.v_)(e.item_location||"-"),1),(0,s.Lk)("td",I,(0,o.v_)(e.cartons_count),1),(0,s.Lk)("td",q,(0,o.v_)(e.per_carton_count),1),(0,s.Lk)("td",P,(0,o.v_)(e.single_bottles_count),1),(0,s.Lk)("td",X,(0,o.v_)(e.total_added),1),(0,s.Lk)("td",{class:(0,o.C4)(["table-cell",ae.getQuantityClass(e.remaining_quantity)])},(0,o.v_)(e.remaining_quantity),3),(0,s.Lk)("td",S,[(0,s.Lk)("span",{class:(0,o.C4)([ae.getStockStatusClass(e.remaining_quantity),"stock-status"])},(0,o.v_)(ae.getStockStatus(e.remaining_quantity)),3)]),!a.readonly&&a.showActions?((0,s.uX)(),(0,s.CE)("td",B,[(0,s.Lk)("div",j,[(0,s.Lk)("div",Q,[ae.canTransferItem(e)?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t=>ae.handleTransfer(e),class:"action-btn action-btn-transfer",title:"نقل"},[...t[22]||(t[22]=[(0,s.Lk)("svg",{class:"action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1),(0,s.Lk)("span",{class:"action-text"},"نقل",-1)])],8,V)):(0,s.Q3)("",!0),ae.canDispatchItem(e)?((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:t=>ae.handleDispatch(e),class:"action-btn action-btn-dispatch",title:"صرف"},[...t[23]||(t[23]=[(0,s.Lk)("svg",{class:"action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),(0,s.Lk)("span",{class:"action-text"},"صرف",-1)])],8,A)):(0,s.Q3)("",!0)]),ae.showAdminControls?((0,s.uX)(),(0,s.CE)("div",R,[ae.canEditItem(e)?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t=>ae.handleEdit(e),class:"action-btn action-btn-edit",title:"تعديل"},[...t[24]||(t[24]=[(0,s.Lk)("svg",{class:"action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),(0,s.Lk)("span",{class:"action-text"},"تعديل",-1)])],8,F)):(0,s.Q3)("",!0),ae.canDeleteItem(e)?((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:t=>ae.handleDelete(e),class:"action-btn action-btn-delete",title:"حذف"},[...t[25]||(t[25]=[(0,s.Lk)("svg",{class:"action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),(0,s.Lk)("span",{class:"action-text"},"حذف",-1)])],8,U)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),(0,s.Lk)("td",$,[(0,s.Lk)("span",H,(0,o.v_)(ae.formatDate(e.updated_at)),1)])]))),128))])])])]),0===a.items.length?((0,s.uX)(),(0,s.CE)("div",z,[...t[26]||(t[26]=[(0,s.Lk)("svg",{class:"empty-state-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m8-8V4a1 1 0 00-1-1h-2a1 1 0 00-1 1v1M9 7h6"})],-1),(0,s.Lk)("h3",{class:"empty-state-title"},"لا توجد بيانات",-1),(0,s.Lk)("p",{class:"empty-state-text"},"لم يتم إضافة أي أصناف بعد.",-1)])])):(0,s.Q3)("",!0),te.showPhotoModal?((0,s.uX)(),(0,s.CE)("div",{key:2,class:"photo-modal",onClick:t[4]||(t[4]=(...e)=>ae.closePhotoPreview&&ae.closePhotoPreview(...e))},[(0,s.Lk)("div",{class:"photo-modal-content",onClick:t[3]||(t[3]=(0,r.D$)(()=>{},["stop"]))},[(0,s.Lk)("button",{class:"close-modal-btn",onClick:t[2]||(t[2]=(...e)=>ae.closePhotoPreview&&ae.closePhotoPreview(...e))},[...t[27]||(t[27]=[(0,s.Lk)("svg",{class:"close-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),(0,s.Lk)("img",{src:te.selectedPhotoUrl,class:"modal-photo"},null,8,K)])])):(0,s.Q3)("",!0),te.exportProgress.show?((0,s.uX)(),(0,s.CE)("div",T,[(0,s.Lk)("div",O,[t[28]||(t[28]=(0,s.Lk)("h3",{class:"progress-title"},"جاري تصدير كروت الأصناف",-1)),(0,s.Lk)("div",J,[(0,s.Lk)("div",N,(0,o.v_)(te.exportProgress.status),1),(0,s.Lk)("div",G,(0,o.v_)(te.exportProgress.details),1)]),(0,s.Lk)("div",Y,[(0,s.Lk)("div",{class:"progress-bar",style:(0,o.Tr)({width:te.exportProgress.percentage+"%"})},null,4)]),(0,s.Lk)("div",Z,[(0,s.Lk)("span",null,"تم تصدير "+(0,o.v_)(te.exportProgress.processed)+" من "+(0,o.v_)(te.exportProgress.total),1)]),te.exportProgress.completed?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[5]||(t[5]=(...e)=>ae.closeProgressDialog&&ae.closeProgressDialog(...e)),class:"close-progress-btn"}," إغلاق ")):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)])}var te=a(834),ae=a(3959),se=(a(4213),{name:"InventoryTable",props:{items:{type:Array,required:!0},readonly:{type:Boolean,default:!1},showActions:{type:Boolean,default:!0},showPhotoColumn:{type:Boolean,default:!0}},emits:["transfer","dispatch","edit","delete"],data(){return{exporting:!1,showPhotoModal:!1,selectedPhotoUrl:"",exportProgress:{show:!1,status:"",details:"",percentage:0,processed:0,total:0,completed:!1}}},computed:{...(0,te.L8)(["userRole","allowedWarehouses","canEdit","canDelete","canDispatch","getWarehouseLabel","getArabicLabel"]),...(0,te.aH)({storeUserProfile:e=>e.userProfile,storeWarehouses:e=>e.warehouses,storeTransactions:e=>e.transactions}),showAdminControls(){return("superadmin"===this.userRole||"warehouse_manager"===this.userRole)&&this.showActions},canExport(){return["superadmin","warehouse_manager","company_manager"].includes(this.userRole)}},methods:{getPhotoUrl(e){return e?(e.startsWith("data:image/")||e.startsWith("https://"),e):""},handleTransfer(e){this.$emit("transfer",e)},handleDispatch(e){this.$emit("dispatch",e)},handleEdit(e){this.$emit("edit",e)},handleDelete(e){this.$emit("delete",e)},canTransferItem(e){if(!this.showActions||this.readonly)return!1;if(!["superadmin","warehouse_manager"].includes(this.userRole))return!1;if("warehouse_manager"===this.userRole){const t=this.allowedWarehouses||[];if(t.length>0&&!t.includes(e.warehouse_id))return!1}return e.remaining_quantity>0},canDispatchItem(e){if(!this.showActions||this.readonly)return!1;if("superadmin"!==this.userRole){if("warehouse_manager"!==this.userRole)return!1;{const e=this.storeUserProfile?.permissions||[];if(!e.includes("dispatch_items"))return!1}}if("warehouse_manager"===this.userRole){const t=this.allowedWarehouses||[];if(t.length>0&&!t.includes(e.warehouse_id))return!1}return e.remaining_quantity>0},canEditItem(e){if(!this.showActions||this.readonly)return!1;if(!this.canEdit)return!1;if("warehouse_manager"===this.userRole){const t=this.allowedWarehouses||[];if(t.length>0&&!t.includes(e.warehouse_id))return!1}return!0},canDeleteItem(e){if(!this.showActions||this.readonly)return!1;if(!this.canDelete)return!1;if("warehouse_manager"===this.userRole){const t=this.allowedWarehouses||[];if(t.length>0&&!t.includes(e.warehouse_id))return!1}return!0},getStockStatus(e){return 0===e?"نفذ":e<10?"منخفض":"متوفر"},getStockStatusClass(e){return 0===e?"badge badge-danger":e<10?"badge badge-warning":"badge badge-success"},getQuantityClass(e){return 0===e?"quantity-danger":e<10?"quantity-warning":"quantity-success"},getWarehouseLabel(e){if(this.getWarehouseLabel)return this.getWarehouseLabel(e);if(this.storeWarehouses&&this.storeWarehouses.length>0){const t=this.storeWarehouses.find(t=>t.id===e);return t?t.name_ar:e}return e},formatDate(e){if(!e)return"-";const t=e.toDate?e.toDate():new Date(e);return new Intl.DateTimeFormat("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(t)},openPhotoPreview(e){this.selectedPhotoUrl=e,this.showPhotoModal=!0,document.body.style.overflow="hidden"},closePhotoPreview(){this.showPhotoModal=!1,document.body.style.overflow=""},showProgressDialog(e){this.exportProgress={show:!0,status:"جاري تجهيز البيانات...",details:"",percentage:0,processed:0,total:e,completed:!1}},updateProgress(e,t,a,s){this.exportProgress.status=e,this.exportProgress.details=t,this.exportProgress.processed=a,this.exportProgress.percentage=s},completeProgress(){this.exportProgress.status="اكتمل التصدير",this.exportProgress.details=`تم تصدير ${this.exportProgress.total} كارت بنجاح`,this.exportProgress.percentage=100,this.exportProgress.processed=this.exportProgress.total,this.exportProgress.completed=!0},closeProgressDialog(){this.exportProgress.show=!1,this.exporting=!1},async exportSingleCard(){try{this.exporting=!0;const e=this.items[0];if(!e)return void this.$store.dispatch("showNotification",{type:"error",message:"يرجى اختيار صنف أولاً"});await this.createProfessionalReport([e],"كرت صنف مفرد")}catch(e){console.error("Error exporting single card:",e),this.$store.dispatch("showNotification",{type:"error",message:"حدث خطأ أثناء تصدير الكرت المفرد"})}finally{this.exporting=!1}},async exportAllCards(){try{this.exporting=!0;const e=this.items.length;if(0===e)return void this.$store.dispatch("showNotification",{type:"info",message:"لا توجد أصناف في المخزون"});this.showProgressDialog(e),await this.createProfessionalReport(this.items,"تقرير المخزون العام")}catch(e){console.error("Error exporting all cards:",e),this.$store.dispatch("showNotification",{type:"error",message:"حدث خطأ أثناء تصدير جميع الكروت"}),this.closeProgressDialog()}},async createProfessionalReport(e,t){const a=ae.Wp.book_new();await this.createSummarySheet(a,e,t),await this.createDetailsSheet(a,e),await this.createStatisticsSheet(a,e),await this.createIndividualCards(a,e);const s=(new Date).toISOString().split("T")[0].replace(/-/g,""),o=`تقرير_المخزون_${s}.xlsx`;ae._h(a,o),this.completeProgress(),this.$store.dispatch("showNotification",{type:"success",message:`تم إنشاء التقرير بنجاح: ${o}`})},async createSummarySheet(e,t,a){const s=[];s.push([this.getCompanyHeader()]),s.push([a]),s.push([`تاريخ الإصدار: ${(new Date).toLocaleDateString("ar-EG")}`]),s.push([]);const o=["م","كود الصنف","اسم الصنف","اللون","المخزن","الكراتين","في الكرتونة","الفردي","الرصيد الكلي","الحالة","المورد","آخر تحديث"];s.push(o),t.forEach((e,t)=>{s.push([t+1,e.code,e.name,e.color,this.getWarehouseLabel(e.warehouse_id),e.cartons_count,e.per_carton_count,e.single_bottles_count,e.remaining_quantity,this.getStockStatus(e.remaining_quantity),e.supplier||"-",this.formatDate(e.updated_at)])}),s.push([]),s.push(["إحصائيات المخزون"]),s.push(["إجمالي الأصناف:",t.length]),s.push(["إجمالي الرصيد:",t.reduce((e,t)=>e+t.remaining_quantity,0)]);const r=ae.Wp.aoa_to_sheet(s);ae.Wp.book_append_sheet(e,r,"ملخص المخزون")},async createDetailsSheet(e,t){const a=[];a.push([this.getCompanyHeader()]),a.push(["تفاصيل المخزون"]),a.push([]),t.forEach((e,t)=>{a.push([`الصنف ${t+1}: ${e.name} (${e.code})`]),a.push(["كود الصنف:",e.code]),a.push(["الاسم:",e.name]),a.push(["اللون:",e.color]),a.push(["المخزن:",this.getWarehouseLabel(e.warehouse_id)]),a.push(["مكان التخزين:",e.item_location||"-"]),a.push(["المورد:",e.supplier||"-"]),a.push(["الكراتين:",e.cartons_count]),a.push(["في الكرتونة:",e.per_carton_count]),a.push(["الفردي:",e.single_bottles_count]),a.push(["الرصيد الكلي:",e.remaining_quantity]),a.push(["الكمية المضافة:",e.total_added]),a.push(["الحالة:",this.getStockStatus(e.remaining_quantity)]),a.push(["آخر تحديث:",this.formatDate(e.updated_at)]),a.push(["ملاحظات:",e.notes||"-"]),a.push([]);const s=this.getItemTransactions(e.id);if(s.length>0){a.push(["آخر 5 حركات:"]);const e=["التاريخ","نوع الحركة","الكمية","الجهة","ملاحظات","الرصيد"];a.push(e),s.slice(0,5).forEach(e=>{a.push([e.date,e.type,e.quantity,e.party,e.notes,e.balance])})}a.push([]),a.push(["---"]),a.push([])});const s=ae.Wp.aoa_to_sheet(a);ae.Wp.book_append_sheet(e,s,"التفاصيل الكاملة")},async createStatisticsSheet(e,t){const a=[];a.push([this.getCompanyHeader()]),a.push(["الإحصائيات والتحليل"]),a.push([]);const s={};t.forEach(e=>{const t=this.getWarehouseLabel(e.warehouse_id);s[t]||(s[t]={count:0,total:0,items:[]}),s[t].count++,s[t].total+=e.remaining_quantity,s[t].items.push(e)}),a.push(["تحليل حسب المخازن"]),a.push(["المخزن","عدد الأصناف","إجمالي الرصيد","النسبة"]),Object.entries(s).forEach(([e,s])=>{const o=(s.count/t.length*100).toFixed(1);a.push([e,s.count,s.total,`${o}%`])}),a.push([]);const o={"متوفر":0,"منخفض":0,"نفذ":0};t.forEach(e=>{const t=this.getStockStatus(e.remaining_quantity);o[t]++}),a.push(["تحليل حسب الحالة"]),a.push(["الحالة","عدد الأصناف","النسبة"]),Object.entries(o).forEach(([e,s])=>{const o=(s/t.length*100).toFixed(1);a.push([e,s,`${o}%`])}),a.push([]);const r=t.filter(e=>e.remaining_quantity<10&&e.remaining_quantity>0),l=t.filter(e=>0===e.remaining_quantity);r.length>0&&(a.push(["الأصناف ذات المخزون المنخفض (تحت 10 وحدات)"]),a.push(["م","الكود","الاسم","اللون","المخزن","الرصيد"]),r.forEach((e,t)=>{a.push([t+1,e.code,e.name,e.color,this.getWarehouseLabel(e.warehouse_id),e.remaining_quantity])}),a.push([])),l.length>0&&(a.push(["الأصناف المنتهية"]),a.push(["م","الكود","الاسم","اللون","المخزن"]),l.forEach((e,t)=>{a.push([t+1,e.code,e.name,e.color,this.getWarehouseLabel(e.warehouse_id)])}));const n=ae.Wp.aoa_to_sheet(a);ae.Wp.book_append_sheet(e,n,"الإحصائيات")},async createIndividualCards(e,t){for(let a=0;a<t.length;a++){const s=t[a],o=Math.round((a+1)/t.length*100);this.updateProgress("جاري إنشاء كروت الأصناف",`جاري إنشاء كارت: ${s.code}`,a+1,o);const r=[];r.push([this.getCompanyHeader()]),r.push(["كارت الصنف"]),r.push([]),r.push(["معلومات الصنف الأساسية"]),r.push(["كود الصنف:",s.code]),r.push(["اسم الصنف:",s.name]),r.push(["اللون:",s.color]),r.push(["المخزن:",this.getWarehouseLabel(s.warehouse_id)]),r.push(["مكان التخزين:",s.item_location||"-"]),r.push(["المورد:",s.supplier||"-"]),r.push([]),r.push(["معلومات الكميات"]),r.push(["الكراتين:",s.cartons_count]),r.push(["في الكرتونة:",s.per_carton_count]),r.push(["الفردي:",s.single_bottles_count]),r.push(["الرصيد الكلي:",s.remaining_quantity]),r.push(["الكمية المضافة:",s.total_added]),r.push(["الحالة:",this.getStockStatus(s.remaining_quantity)]),r.push([]),r.push(["معلومات إضافية"]),r.push(["تاريخ الإنشاء:",this.formatDate(s.created_at)]),r.push(["آخر تحديث:",this.formatDate(s.updated_at)]),r.push(["آخر تحديث للكميات:",this.getLastTransactionDate(s.id)]),r.push(["ملاحظات:",s.notes||"-"]),r.push([]);const l=this.getItemTransactions(s.id);if(l.length>0){r.push(["تاريخ الحركات"]);const e=["التاريخ","نوع الحركة","الكمية","الجهة","ملاحظات","الرصيد"];r.push(e),l.slice(0,10).forEach(e=>{r.push([e.date,e.type,e.quantity,e.party,e.notes,e.balance])})}r.push([]),r.push(["ملخص الحركات"]);const n=l.filter(e=>"وارد"===e.type).reduce((e,t)=>e+t.quantity,0),i=l.filter(e=>"منصرف"===e.type).reduce((e,t)=>e+t.quantity,0);r.push(["إجمالي الوارد:",n]),r.push(["إجمالي المنصرف:",i]),r.push(["صافي الحركة:",n-i]),s.photo_url&&(r.push([]),r.push(["ملاحظة:","✓ يوجد صورة مرفقة بالصنف"]));const u=this.createSafeSheetName(s.code,s.name,a+1),c=ae.Wp.aoa_to_sheet(r);ae.Wp.book_append_sheet(e,c,u)}},getCompanyHeader(){return"شركة ABC للتجارة والمقاولات - قسم إدارة المخزون"},getItemTransactions(e){return this.storeTransactions?this.storeTransactions.filter(t=>t.item_id===e).map(e=>{const t="IN"===e.type?(e.cartons_delta||0)*(e.per_carton_updated||1)+(e.single_delta||0):-((e.cartons_delta||0)*(e.per_carton_updated||1)+(e.single_delta||0));return{date:this.formatDate(e.timestamp),type:"IN"===e.type?"وارد":"منصرف",quantity:Math.abs(t),party:e.to_warehouse||e.from_warehouse||"",notes:e.notes||"",balance:e.new_remaining||0}}).sort((e,t)=>new Date(t.date)-new Date(e.date)):[]},getLastTransactionDate(e){const t=this.getItemTransactions(e);return t.length>0?t[0].date:"-"},createSafeSheetName(e,t,a){let s=`${a.toString().padStart(3,"0")}_${e}_${t}`;const o=["[","]",":","*","?","/","\\"];return o.forEach(e=>{s=s.replaceAll(e,"")}),s.substring(0,31)},handleClickOutside(e){this.showPhotoModal&&!e.target.closest(".photo-modal-content")&&this.closePhotoPreview()}},mounted(){document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside),this.closePhotoPreview()}}),oe=a(6262);const re=(0,oe.A)(se,[["render",ee],["__scopeId","data-v-e8deb3e4"]]);var le=re},6217:function(e,t,a){a.d(t,{A:function(){return ie}});var s=a(641),o=a(33),r=a(3751);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},n={class:"bg-white rounded-2xl shadow-xl w-full max-w-2xl rtl max-h-[90vh] overflow-hidden"},i={class:"sticky top-0 bg-white z-10 px-6 py-4 border-b border-gray-200"},u={class:"flex items-center justify-between"},c={class:"p-6 space-y-6 overflow-y-auto max-h-[calc(90vh-180px)]"},d=["value"],m={class:"grid grid-cols-3 gap-2"},p=["onClick"],h={class:"flex items-center justify-between mb-3"},v={class:"text-xs text-gray-500"},g={class:"relative mb-4"},k={class:"border border-gray-200 rounded-lg overflow-hidden"},b={class:"max-h-60 overflow-y-auto"},f={class:"col-span-5 p-3"},y={class:"font-medium text-sm text-gray-900"},x={class:"text-xs text-gray-500 mt-1"},_={key:0,class:"ml-2"},L={key:1,class:"text-gray-400"},w={class:"col-span-2 p-3 text-center"},C={class:"text-xs font-mono bg-gray-100 text-gray-700 px-2 py-1 rounded"},E={class:"col-span-2 p-3 text-center"},W={class:"col-span-3 p-3 text-center"},M=["onClick"],D={key:0,class:"p-8 text-center"},I={key:0,class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},q={class:"flex items-center justify-between mb-3"},P={class:"grid grid-cols-2 gap-3"},X={class:"text-sm font-medium text-blue-900"},S={class:"text-sm font-medium text-blue-900"},B={class:"text-sm font-medium text-blue-900"},j={key:1},Q={class:"space-y-4"},V={class:"block text-sm font-medium text-gray-700 mb-2"},A={class:"text-xs font-normal text-gray-500"},R={class:"flex items-center space-x-3 space-x-reverse"},F=["disabled"],U=["max"],$=["disabled"],H={class:"flex items-center justify-between mt-2"},z={class:"text-xs text-gray-500"},K={class:"grid grid-cols-3 gap-2"},T=["onClick"],O={key:2,class:"bg-red-50 border border-red-200 rounded-lg p-4"},J={class:"flex items-center"},N={class:"text-sm text-red-600"},G={class:"sticky bottom-0 bg-white border-t border-gray-200 px-6 py-4"},Y={class:"flex space-x-3 space-x-reverse"},Z=["disabled"],ee={key:0,class:"animate-spin h-4 w-4 ml-2 text-white",fill:"none",viewBox:"0 0 24 24"},te={key:1,class:"h-4 w-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function ae(e,t,a,ae,se,oe){return a.isOpen?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",n,[(0,s.Lk)("div",i,[(0,s.Lk)("div",u,[t[13]||(t[13]=(0,s.Lk)("div",null,[(0,s.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"صرف أصناف للفروع"),(0,s.Lk)("p",{class:"text-sm text-gray-500 mt-1"},"اختر الصنف من القائمة وأدخل كمية الصرف")],-1)),(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors duration-200"},[...t[12]||(t[12]=[(0,s.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),(0,s.Lk)("div",c,[(0,s.Lk)("div",null,[t[15]||(t[15]=(0,s.Lk)("h4",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},[(0,s.Lk)("span",{class:"h-6 w-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs ml-2"},"1"),(0,s.eW)(" اختر المخزن المصدر ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>ae.form.sourceWarehouse=e),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",onChange:t[2]||(t[2]=(...e)=>ae.onWarehouseChange&&ae.onWarehouseChange(...e))},[t[14]||(t[14]=(0,s.Lk)("option",{value:""},"اختر المخزن المصدر",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ae.warehouses,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,o.v_)(e.name_ar),9,d))),128))],544),[[r.u1,ae.form.sourceWarehouse]])]),(0,s.Lk)("div",null,[t[16]||(t[16]=(0,s.Lk)("h4",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},[(0,s.Lk)("span",{class:"h-6 w-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs ml-2"},"2"),(0,s.eW)(" اختر الفرع المستلم ")],-1)),(0,s.Lk)("div",m,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ae.destinations,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,onClick:t=>ae.form.destinationBranch=e.id,class:(0,o.C4)(["p-3 border rounded-lg text-sm transition-all duration-200",ae.form.destinationBranch===e.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"])},(0,o.v_)(e.name_ar),11,p))),128))])]),(0,s.Lk)("div",null,[(0,s.Lk)("div",h,[t[17]||(t[17]=(0,s.Lk)("h4",{class:"text-sm font-medium text-gray-700 flex items-center"},[(0,s.Lk)("span",{class:"h-6 w-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs ml-2"},"3"),(0,s.eW)(" اختر الصنف المراد صرفه ")],-1)),(0,s.Lk)("div",v,(0,o.v_)(ae.filteredItems.length)+" صنف متاح ",1)]),(0,s.Lk)("div",g,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>ae.searchTerm=e),type:"text",placeholder:"ابحث عن صنف بالاسم أو الكود...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"},null,512),[[r.Jo,ae.searchTerm]]),t[18]||(t[18]=(0,s.Lk)("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[(0,s.Lk)("svg",{class:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),(0,s.Lk)("div",k,[t[20]||(t[20]=(0,s.Fv)('<div class="grid grid-cols-12 bg-gray-50 text-xs font-medium text-gray-600 border-b border-gray-200" data-v-770c4848><div class="col-span-5 p-3" data-v-770c4848>الصنف</div><div class="col-span-2 p-3 text-center" data-v-770c4848>الكود</div><div class="col-span-2 p-3 text-center" data-v-770c4848>المتاح</div><div class="col-span-3 p-3 text-center" data-v-770c4848>الإجراء</div></div>',1)),(0,s.Lk)("div",b,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ae.filteredItems,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,o.C4)(["grid grid-cols-12 border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150",ae.selectedItem?.id===e.id?"bg-blue-50 border-blue-200":""])},[(0,s.Lk)("div",f,[(0,s.Lk)("div",y,(0,o.v_)(e.الاسم||e.name),1),(0,s.Lk)("div",x,[e.اللون||e.color?((0,s.uX)(),(0,s.CE)("span",_,(0,o.v_)(e.اللون||e.color),1)):(0,s.Q3)("",!0),e.المورد||e.supplier?((0,s.uX)(),(0,s.CE)("span",L,"المورد: "+(0,o.v_)(e.المورد||e.supplier),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",w,[(0,s.Lk)("span",C,(0,o.v_)(e.الكود||e.code),1)]),(0,s.Lk)("div",E,[(0,s.Lk)("span",{class:(0,o.C4)(["text-sm font-medium",ae.getStockClass(e.الكميه_المتبقيه||e.remaining_quantity)])},(0,o.v_)(e.الكميه_المتبقيه||e.remaining_quantity),3)]),(0,s.Lk)("div",W,[(0,s.Lk)("button",{onClick:t=>ae.selectItem(e),class:(0,o.C4)(["px-3 py-1.5 text-xs font-medium rounded-lg transition-colors duration-200",ae.selectedItem?.id===e.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},(0,o.v_)(ae.selectedItem?.id===e.id?"محدد":"اختر"),11,M)])],2))),128)),0===ae.filteredItems.length?((0,s.uX)(),(0,s.CE)("div",D,[...t[19]||(t[19]=[(0,s.Lk)("svg",{class:"mx-auto h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m8-8V4a1 1 0 00-1-1h-2a1 1 0 00-1 1v1M9 7h6"})],-1),(0,s.Lk)("p",{class:"text-sm text-gray-500 mt-2"},"لا توجد أصناف مطابقة للبحث",-1)])])):(0,s.Q3)("",!0)])])]),ae.selectedItem?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",q,[t[21]||(t[21]=(0,s.Lk)("h5",{class:"text-sm font-medium text-blue-800"},"الصنف المحدد",-1)),(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>ae.clearSelection&&ae.clearSelection(...e)),class:"text-xs text-blue-600 hover:text-blue-800"}," إلغاء التحديد ")]),(0,s.Lk)("div",P,[(0,s.Lk)("div",null,[t[22]||(t[22]=(0,s.Lk)("div",{class:"text-xs text-blue-600"},"الاسم",-1)),(0,s.Lk)("div",X,(0,o.v_)(ae.selectedItem.الاسم||ae.selectedItem.name),1)]),(0,s.Lk)("div",null,[t[23]||(t[23]=(0,s.Lk)("div",{class:"text-xs text-blue-600"},"الكود",-1)),(0,s.Lk)("div",S,(0,o.v_)(ae.selectedItem.الكود||ae.selectedItem.code),1)]),(0,s.Lk)("div",null,[t[24]||(t[24]=(0,s.Lk)("div",{class:"text-xs text-blue-600"},"المخزن الحالي",-1)),(0,s.Lk)("div",B,(0,o.v_)(ae.getWarehouseName(ae.selectedItem.المخزن_id||ae.selectedItem.warehouse_id)),1)]),(0,s.Lk)("div",null,[t[25]||(t[25]=(0,s.Lk)("div",{class:"text-xs text-blue-600"},"الكمية المتاحة",-1)),(0,s.Lk)("div",{class:(0,o.C4)(["text-sm font-medium",ae.getStockClass(ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity)])},(0,o.v_)(ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity),3)])])])):(0,s.Q3)("",!0),ae.selectedItem?((0,s.uX)(),(0,s.CE)("div",j,[t[31]||(t[31]=(0,s.Lk)("h4",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},[(0,s.Lk)("span",{class:"h-6 w-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-xs ml-2"},"4"),(0,s.eW)(" أدخل تفاصيل الصرف ")],-1)),(0,s.Lk)("div",Q,[(0,s.Lk)("div",null,[(0,s.Lk)("label",V,[t[26]||(t[26]=(0,s.eW)(" الكمية المراد صرفها ",-1)),(0,s.Lk)("span",A," (الحد الأقصى: "+(0,o.v_)(ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity)+") ",1)]),(0,s.Lk)("div",R,[(0,s.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>ae.decreaseQuantity&&ae.decreaseQuantity(...e)),disabled:ae.form.quantity<=1,class:"w-10 h-10 flex items-center justify-center border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[...t[27]||(t[27]=[(0,s.Lk)("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)])],8,F),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>ae.form.quantity=e),type:"number",max:ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity,min:"1",required:"",class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg font-medium"},null,8,U),[[r.Jo,ae.form.quantity,void 0,{number:!0}]]),(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>ae.increaseQuantity&&ae.increaseQuantity(...e)),disabled:ae.form.quantity>=(ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity),class:"w-10 h-10 flex items-center justify-center border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[...t[28]||(t[28]=[(0,s.Lk)("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,$)]),(0,s.Lk)("div",H,[(0,s.Lk)("span",z," سيتبقى بعد الصرف: "+(0,o.v_)((ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity)-ae.form.quantity),1),(0,s.Lk)("button",{onClick:t[8]||(t[8]=e=>ae.form.quantity=ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity),class:"text-xs text-blue-600 hover:text-blue-800"}," استخدام الكل ")])]),(0,s.Lk)("div",null,[t[29]||(t[29]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"أولوية الصرف",-1)),(0,s.Lk)("div",K,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ae.priorityOptions,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.value,onClick:t=>ae.form.priority=e.value,class:(0,o.C4)(["p-3 border rounded-lg text-sm transition-all duration-200 flex items-center justify-center space-x-2 space-x-reverse",ae.form.priority===e.value?e.borderClass+" "+e.bgClass+" "+e.textClass:"border-gray-200 hover:border-gray-300 hover:bg-gray-50 text-gray-700"])},[(0,s.Lk)("span",{class:(0,o.C4)(e.iconClass)},(0,o.v_)(e.icon),3),(0,s.Lk)("span",null,(0,o.v_)(e.label),1)],10,T))),128))])]),(0,s.Lk)("div",null,[t[30]||(t[30]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ملاحظات",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>ae.form.notes=e),rows:"2",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"أضف أي ملاحظات حول عملية الصرف..."},null,512),[[r.Jo,ae.form.notes]])])])])):(0,s.Q3)("",!0),ae.error?((0,s.uX)(),(0,s.CE)("div",O,[(0,s.Lk)("div",J,[t[32]||(t[32]=(0,s.Lk)("svg",{class:"h-5 w-5 text-red-400 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),(0,s.Lk)("p",N,(0,o.v_)(ae.error),1)])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",G,[(0,s.Lk)("div",Y,[(0,s.Lk)("button",{type:"button",onClick:t[10]||(t[10]=t=>e.$emit("close")),class:"flex-1 px-4 py-3 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors duration-200"}," إلغاء "),(0,s.Lk)("button",{type:"submit",onClick:t[11]||(t[11]=(...e)=>ae.handleSubmit&&ae.handleSubmit(...e)),disabled:ae.loading||!ae.selectedItem||!ae.form.destinationBranch||!ae.form.sourceWarehouse||ae.form.quantity>(ae.selectedItem?.الكميه_المتبقيه||ae.selectedItem?.remaining_quantity||0),class:"flex-1 px-4 py-3 text-sm font-medium text-white bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center"},[ae.loading?((0,s.uX)(),(0,s.CE)("svg",ee,[...t[33]||(t[33]=[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,s.uX)(),(0,s.CE)("svg",te,[...t[34]||(t[34]=[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"},null,-1)])])),(0,s.Lk)("span",null,(0,o.v_)(ae.loading?"جاري الصرف...":"تأكيد الصرف"),1)],8,Z)])])])])):(0,s.Q3)("",!0)}var se=a(953),oe=a(834),re={name:"DispatchModal",props:{isOpen:{type:Boolean,default:!1},item:{type:Object,default:null}},emits:["close","success"],setup(e,{emit:t}){const a=(0,oe.Pj)(),o=(0,se.KR)(!1),r=(0,se.KR)(""),l=(0,se.KR)(null),n=(0,se.KR)(""),i=(0,se.Kh)({sourceWarehouse:"",destinationBranch:"",quantity:1,notes:"",priority:"normal"}),u=[{id:"مصنع البران",name_ar:"مصنع البران",icon:"🏭"},{id:"مخزن الزهراء",name_ar:"مخزن الزهراء",icon:"🏪"}],c=[{value:"normal",label:"عادية",icon:"⏱️",bgClass:"bg-blue-50",borderClass:"border-blue-300",textClass:"text-blue-700",iconClass:"text-blue-500"},{value:"high",label:"عالية",icon:"⚠️",bgClass:"bg-orange-50",borderClass:"border-orange-300",textClass:"text-orange-700",iconClass:"text-orange-500"},{value:"urgent",label:"عاجلة",icon:"🚨",bgClass:"bg-red-50",borderClass:"border-red-300",textClass:"text-red-700",iconClass:"text-red-500"}],d=(0,s.EW)(()=>a.state.warehouses||[]),m=(0,s.EW)(()=>a.state.inventory||[]),p=(0,s.EW)(()=>i.sourceWarehouse?m.value.filter(e=>(e.المخزن_id||e.warehouse_id)===i.sourceWarehouse&&(e.الكميه_المتبقيه||e.remaining_quantity)>0):[]),h=(0,s.EW)(()=>{if(!n.value.trim())return p.value;const e=n.value.toLowerCase().trim();return p.value.filter(t=>{const a=(t.الاسم||t.name||"").toLowerCase(),s=(t.الكود||t.code||"").toLowerCase(),o=(t.اللون||t.color||"").toLowerCase(),r=(t.المورد||t.supplier||"").toLowerCase();return a.includes(e)||s.includes(e)||o.includes(e)||r.includes(e)})}),v=e=>{const t=d.value.find(t=>t.id===e);return t?t.name_ar:e},g=e=>0===e?"text-red-600":e<10?"text-yellow-600":"text-green-600",k=()=>{Object.assign(i,{sourceWarehouse:"",destinationBranch:"",quantity:1,notes:"",priority:"normal"}),l.value=null,r.value="",n.value=""},b=e=>{l.value?.id===e.id?l.value=null:(l.value=e,i.quantity=1)},f=()=>{l.value=null},y=()=>{l.value=null,n.value=""},x=()=>{const e=l.value?.الكميه_المتبقيه||l.value?.remaining_quantity||0;i.quantity<e&&i.quantity++},_=()=>{i.quantity>1&&i.quantity--};(0,s.wB)(()=>e.isOpen,t=>{t&&(k(),e.item&&(b(e.item),i.sourceWarehouse=e.item.المخزن_id||e.item.warehouse_id))}),(0,s.wB)(()=>e.item,t=>{t&&e.isOpen&&(b(t),i.sourceWarehouse=t.المخزن_id||t.warehouse_id)}),(0,s.wB)(()=>i.quantity,e=>{if(l.value){const t=l.value.الكميه_المتبقيه||l.value.remaining_quantity||0;e>t?i.quantity=t:e<1&&(i.quantity=1)}});const L=async()=>{if(!i.sourceWarehouse)return void(r.value="يرجى اختيار المخزن المصدر");if(!i.destinationBranch)return void(r.value="يرجى اختيار الفرع المستلم");if(!l.value)return void(r.value="يرجى اختيار صنف للصرف");if(!i.quantity||i.quantity<=0)return void(r.value="يرجى إدخال كمية صحيحة");const e=l.value.الكميه_المتبقيه||l.value.remaining_quantity||0;if(i.quantity>e)r.value=`الكمية المطلوبة (${i.quantity}) تتجاوز الكمية المتاحة (${e})`;else{o.value=!0,r.value="";try{const e={item_id:l.value.id,from_warehouse:i.sourceWarehouse,to_destination:i.destinationBranch,quantity:i.quantity,cartons:0,single_bottles:i.quantity,notes:i.notes,priority:i.priority};console.log("Dispatching item with data:",e);const s=await a.dispatch("dispatchItem",e);if(!s?.success)throw new Error("فشل في عملية الصرف");console.log("Dispatch completed successfully:",s),k(),t("success",s),setTimeout(()=>{t("close")},500)}catch(s){console.error("Error creating dispatch:",s),r.value=s.message||"فشل في عملية الصرف. يرجى المحاولة مرة أخرى."}finally{o.value=!1}}};return{form:i,loading:o,error:r,selectedItem:l,searchTerm:n,warehouses:d,destinations:u,priorityOptions:c,availableItems:p,filteredItems:h,selectItem:b,clearSelection:f,onWarehouseChange:y,increaseQuantity:x,decreaseQuantity:_,getWarehouseName:v,getStockClass:g,handleSubmit:L}}},le=a(6262);const ne=(0,le.A)(re,[["render",ae],["__scopeId","data-v-770c4848"]]);var ie=ne},8038:function(e,t,a){a.d(t,{A:function(){return le}});var s=a(641),o=a(3751),r=a(33);const l={key:0,class:"modal-overlay"},n={class:"modal-content"},i={class:"modal-header"},u={class:"modal-body"},c={class:"form-group"},d={class:"photo-upload-container"},m={class:"photo-preview-wrapper"},p={class:"photo-actions"},h=["disabled"],v={key:0,class:"spinner spinner-xs",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},g={key:1,class:"photo-action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},k={key:0,class:"photo-info"},b={class:"photo-info-text"},f={class:"form-group"},y={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},x={class:"form-group"},_={class:"form-group"},L={class:"form-group"},w=["value"],C={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},E={class:"form-group"},W={class:"form-group"},M={class:"form-group"},D={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 sm:space-x-reverse mb-4"},I={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},q={class:"form-group"},P={class:"form-group"},X={key:1,class:"form-group"},S={class:"form-group"},B={key:2,class:"alert alert-info"},j={class:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},Q={key:0},V={key:1},A={class:"col-span-full border-t pt-1 font-medium mt-1"},R={key:3,class:"alert alert-warning"},F={class:"mt-2 text-sm"},U={key:0},$={key:4,class:"alert alert-danger"},H={class:"alert-message"},z={key:5,class:"alert alert-success"},K={class:"alert-message"},T={key:6,class:"alert alert-danger"},O={class:"alert-message"},J={class:"modal-footer"},N={class:"flex gap-2"},G=["disabled"],Y={key:0,class:"spinner spinner-sm",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Z={key:1,class:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function ee(e,t,a,ee,te,ae){return a.isOpen?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",n,[(0,s.Lk)("div",i,[t[23]||(t[23]=(0,s.Lk)("h2",{class:"modal-title"},"إضافة صنف جديد",-1)),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>ee.closeModal&&ee.closeModal(...e)),class:"modal-close-btn"},[...t[22]||(t[22]=[(0,s.Lk)("svg",{class:"modal-close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,s.Lk)("div",u,[(0,s.Lk)("form",{onSubmit:t[21]||(t[21]=(0,o.D$)((...e)=>ee.handleSubmit&&ee.handleSubmit(...e),["prevent"])),class:"space-y-4"},[(0,s.Lk)("div",c,[t[30]||(t[30]=(0,s.Lk)("label",{class:"form-label"}," صورة الصنف ",-1)),(0,s.Lk)("div",d,[(0,s.Lk)("div",m,[ee.previewPhoto?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"photo-preview",style:(0,r.Tr)({backgroundImage:`url(${ee.previewPhoto})`}),onClick:t[1]||(t[1]=(...e)=>ee.openFilePicker&&ee.openFilePicker(...e))},[...t[24]||(t[24]=[(0,s.Lk)("div",{class:"photo-overlay"},[(0,s.Lk)("svg",{class:"photo-edit-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)])],4)):((0,s.uX)(),(0,s.CE)("div",{key:1,class:"photo-placeholder",onClick:t[2]||(t[2]=(...e)=>ee.openFilePicker&&ee.openFilePicker(...e))},[...t[25]||(t[25]=[(0,s.Lk)("svg",{class:"photo-placeholder-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),(0,s.Lk)("span",{class:"photo-placeholder-text"},"انقر لاختيار صورة",-1)])]))]),(0,s.Lk)("div",p,[(0,s.Lk)("input",{type:"file",ref:"fileInput",accept:"image/*",class:"hidden",onChange:t[3]||(t[3]=(...e)=>ee.handleFileUpload&&ee.handleFileUpload(...e))},null,544),(0,s.Lk)("button",{type:"button",onClick:t[4]||(t[4]=(...e)=>ee.openFilePicker&&ee.openFilePicker(...e)),class:"photo-action-btn"},[...t[26]||(t[26]=[(0,s.Lk)("svg",{class:"photo-action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),(0,s.eW)(" اختيار صورة ",-1)])]),(0,s.Lk)("button",{type:"button",onClick:t[5]||(t[5]=(...e)=>ee.handlePasteFromClipboard&&ee.handlePasteFromClipboard(...e)),class:"photo-action-btn",disabled:ee.clipboardLoading},[ee.clipboardLoading?((0,s.uX)(),(0,s.CE)("svg",v,[...t[27]||(t[27]=[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,s.uX)(),(0,s.CE)("svg",g,[...t[28]||(t[28]=[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])),(0,s.eW)(" "+(0,r.v_)(ee.clipboardLoading?"جاري اللصق...":"لصق من الحافظة"),1)],8,h),ee.previewPhoto?((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",onClick:t[6]||(t[6]=(...e)=>ee.removePhoto&&ee.removePhoto(...e)),class:"photo-action-btn photo-action-btn-danger"},[...t[29]||(t[29]=[(0,s.Lk)("svg",{class:"photo-action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),(0,s.eW)(" إزالة الصورة ",-1)])])):(0,s.Q3)("",!0)]),ee.selectedFile?((0,s.uX)(),(0,s.CE)("div",k,[(0,s.Lk)("p",b,(0,r.v_)(ee.selectedFile.name)+" ("+(0,r.v_)(ee.formatFileSize(ee.selectedFile.size))+") ",1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",f,[t[31]||(t[31]=(0,s.Lk)("label",{class:"form-label"},[(0,s.eW)(" الاسم "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[7]||(t[7]=e=>ee.formData.name=e),class:"form-input",placeholder:"أدخل اسم الصنف"},null,512),[[o.Jo,ee.formData.name]])]),(0,s.Lk)("div",y,[(0,s.Lk)("div",x,[t[32]||(t[32]=(0,s.Lk)("label",{class:"form-label"},[(0,s.eW)(" الكود "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[8]||(t[8]=e=>ee.formData.code=e),class:"form-input",placeholder:"كود الصنف"},null,512),[[o.Jo,ee.formData.code]])]),(0,s.Lk)("div",_,[t[33]||(t[33]=(0,s.Lk)("label",{class:"form-label"},[(0,s.eW)(" اللون "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[9]||(t[9]=e=>ee.formData.color=e),class:"form-input",placeholder:"لون الصنف"},null,512),[[o.Jo,ee.formData.color]])])]),(0,s.Lk)("div",L,[t[35]||(t[35]=(0,s.Lk)("label",{class:"form-label"},[(0,s.eW)(" المخزن "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>ee.formData.warehouse_id=e),class:"form-select",required:""},[t[34]||(t[34]=(0,s.Lk)("option",{value:""},"اختر المخزن",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ee.accessibleWarehouses,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,r.v_)(e.name_ar),9,w))),128))],512),[[o.u1,ee.formData.warehouse_id]])]),(0,s.Lk)("div",C,[(0,s.Lk)("div",E,[t[36]||(t[36]=(0,s.Lk)("label",{class:"form-label"}," المورد ",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>ee.formData.supplier=e),class:"form-input",placeholder:"اسم المورد"},null,512),[[o.Jo,ee.formData.supplier]])]),(0,s.Lk)("div",W,[t[37]||(t[37]=(0,s.Lk)("label",{class:"form-label"}," مكان الصنف ",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>ee.formData.item_location=e),class:"form-input",placeholder:"مكان الصنف داخل المخزن"},null,512),[[o.Jo,ee.formData.item_location]])])]),(0,s.Lk)("div",M,[t[38]||(t[38]=(0,s.Lk)("label",{class:"form-label"}," طريقة الإضافة ",-1)),(0,s.Lk)("div",D,[(0,s.Lk)("button",{type:"button",onClick:t[13]||(t[13]=e=>ee.addMode="cartons"),class:(0,r.C4)(["mode-btn","cartons"===ee.addMode?"mode-btn-active":"mode-btn-inactive"])}," كراتين ",2),(0,s.Lk)("button",{type:"button",onClick:t[14]||(t[14]=e=>ee.addMode="single"),class:(0,r.C4)(["mode-btn","single"===ee.addMode?"mode-btn-active":"mode-btn-inactive"])}," فردي ",2),(0,s.Lk)("button",{type:"button",onClick:t[15]||(t[15]=e=>ee.addMode="both"),class:(0,r.C4)(["mode-btn","both"===ee.addMode?"mode-btn-active":"mode-btn-inactive"])}," الاثنين معاً ",2)])]),"cartons"===ee.addMode||"both"===ee.addMode?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",q,[t[39]||(t[39]=(0,s.Lk)("label",{class:"form-label"},[(0,s.eW)(" عدد الكراتين "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",min:"0",required:"","onUpdate:modelValue":t[16]||(t[16]=e=>ee.formData.cartons_count=e),class:"form-input"},null,512),[[o.Jo,ee.formData.cartons_count,void 0,{number:!0}]])]),(0,s.Lk)("div",P,[t[40]||(t[40]=(0,s.Lk)("label",{class:"form-label"},[(0,s.eW)(" عدد في الكرتونة "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",min:"1",required:"","onUpdate:modelValue":t[17]||(t[17]=e=>ee.formData.per_carton_count=e),class:"form-input"},null,512),[[o.Jo,ee.formData.per_carton_count,void 0,{number:!0}]])])])):(0,s.Q3)("",!0),"single"===ee.addMode||"both"===ee.addMode?((0,s.uX)(),(0,s.CE)("div",X,[t[41]||(t[41]=(0,s.Lk)("label",{class:"form-label"},[(0,s.eW)(" عدد القزاز الفردي "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",min:"0",required:"","onUpdate:modelValue":t[18]||(t[18]=e=>ee.formData.single_bottles_count=e),class:"form-input"},null,512),[[o.Jo,ee.formData.single_bottles_count,void 0,{number:!0}]])])):(0,s.Q3)("",!0),(0,s.Lk)("div",S,[t[42]||(t[42]=(0,s.Lk)("label",{class:"form-label"}," ملاحظات ",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[19]||(t[19]=e=>ee.formData.notes=e),rows:"2",class:"form-textarea",placeholder:"ملاحظات إضافية (اختياري)"},null,512),[[o.Jo,ee.formData.notes]])]),ee.showSummary?((0,s.uX)(),(0,s.CE)("div",B,[t[43]||(t[43]=(0,s.Lk)("h4",{class:"alert-title"},"ملخص الكمية:",-1)),(0,s.Lk)("div",j,["cartons"===ee.addMode||"both"===ee.addMode?((0,s.uX)(),(0,s.CE)("div",Q," الكراتين: "+(0,r.v_)(ee.formData.cartons_count)+" × "+(0,r.v_)(ee.formData.per_carton_count)+" = "+(0,r.v_)(ee.cartonsTotal),1)):(0,s.Q3)("",!0),"single"===ee.addMode||"both"===ee.addMode?((0,s.uX)(),(0,s.CE)("div",V," الفردي: "+(0,r.v_)(ee.formData.single_bottles_count),1)):(0,s.Q3)("",!0),(0,s.Lk)("div",A," الإجمالي: "+(0,r.v_)(ee.totalQuantity),1)])])):(0,s.Q3)("",!0),ee.existingItem&&!ee.storeOperationError?((0,s.uX)(),(0,s.CE)("div",R,[t[44]||(t[44]=(0,s.Fv)('<div class="flex items-center" data-v-bf359d62><svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20" data-v-bf359d62><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" data-v-bf359d62></path></svg><h4 class="alert-title" data-v-bf359d62>تم العثور على صنف موجود</h4></div><p class="alert-message" data-v-bf359d62> يوجد بالفعل صنف بنفس الاسم واللون والكود في هذا المخزن. سيتم تحديث الكميات بدلاً من إنشاء صنف جديد. </p>',2)),(0,s.Lk)("div",F,[(0,s.Lk)("p",null,"الكمية الحالية: "+(0,r.v_)(ee.existingItem.remaining_quantity),1),(0,s.Lk)("p",null,"الكمية المضافة سابقاً: "+(0,r.v_)(ee.existingItem.total_added),1),ee.existingItem.photo_url?((0,s.uX)(),(0,s.CE)("p",U,"يوجد صورة مرفقة سابقاً")):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),ee.storeOperationError?((0,s.uX)(),(0,s.CE)("div",$,[(0,s.Lk)("p",H,(0,r.v_)(ee.storeOperationError),1)])):(0,s.Q3)("",!0),ee.successMessage?((0,s.uX)(),(0,s.CE)("div",z,[(0,s.Lk)("p",K,(0,r.v_)(ee.successMessage),1)])):(0,s.Q3)("",!0),ee.errorMessage?((0,s.uX)(),(0,s.CE)("div",T,[(0,s.Lk)("p",O,(0,r.v_)(ee.errorMessage),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",J,[(0,s.Lk)("div",N,[(0,s.Lk)("button",{type:"button",onClick:t[20]||(t[20]=(...e)=>ee.closeModal&&ee.closeModal(...e)),class:"btn-secondary"}," إلغاء "),(0,s.Lk)("button",{type:"submit",disabled:ee.loading||ee.storeOperationLoading||!ee.isFormValid||ee.uploadingPhoto,class:"btn-primary"},[ee.loading||ee.storeOperationLoading||ee.uploadingPhoto?((0,s.uX)(),(0,s.CE)("svg",Y,[...t[45]||(t[45]=[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,s.uX)(),(0,s.CE)("svg",Z,[...t[46]||(t[46]=[(0,s.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"},null,-1)])])),(0,s.eW)(" "+(0,r.v_)(ee.loading||ee.storeOperationLoading||ee.uploadingPhoto?"جاري الحفظ...":ee.existingItem?"تحديث الكميات":"إضافة الصنف"),1)],8,G)])])],32)])])])):(0,s.Q3)("",!0)}var te=a(953),ae=a(834),se={name:"AddItemModal",props:{isOpen:{type:Boolean,required:!0}},emits:["close","success"],setup(e,{emit:t}){const a=(0,ae.Pj)(),o=(0,te.KR)(!1),r=(0,te.KR)(""),l=(0,te.KR)(""),n=(0,te.KR)("both"),i=(0,te.KR)(null),u=(0,te.KR)(!1),c=(0,te.KR)(!1),d=(0,te.KR)(null),m=(0,te.KR)(""),p=(0,te.KR)(null),h=(0,te.KR)({name:"",code:"",color:"",warehouse_id:"",supplier:"",item_location:"",cartons_count:0,per_carton_count:12,single_bottles_count:0,notes:"",photo_url:null}),v=(0,s.EW)(()=>a.getters.accessibleWarehouses),g=(0,s.EW)(()=>a.state.operationLoading),k=(0,s.EW)(()=>a.state.operationError),b=((0,s.EW)(()=>a.state.user),(0,s.EW)(()=>a.state.user?.uid)),f=((0,s.EW)(()=>a.state.userProfile),(0,s.EW)(()=>h.value.cartons_count*h.value.per_carton_count)),y=(0,s.EW)(()=>{const e=f.value,t=h.value.single_bottles_count||0;return e+t}),x=(0,s.EW)(()=>y.value>0),_=(0,s.EW)(()=>!!h.value.name.trim()&&(!!h.value.code.trim()&&(!!h.value.color.trim()&&(!!h.value.warehouse_id&&("cartons"===n.value?h.value.cartons_count>0&&h.value.per_carton_count>0:"single"===n.value?h.value.single_bottles_count>0:"both"===n.value&&y.value>0))))),L=(0,s.EW)(()=>("cartons"===n.value||"both"===n.value)&&h.value.cartons_count>0);(0,s.wB)(()=>e.isOpen,e=>{if(e&&(C(),v.value.length>0)){const e=a.getters.mainWarehouse;h.value.warehouse_id=e?.id||v.value[0].id}}),(0,s.wB)(v,e=>{if(e.length>0&&!h.value.warehouse_id){const t=a.getters.mainWarehouse;h.value.warehouse_id=t?.id||e[0].id}}),(0,s.wB)([()=>h.value.name,()=>h.value.code,()=>h.value.color,()=>h.value.warehouse_id],async([e,t,a,s])=>{e&&t&&a&&s?await P():i.value=null},{immediate:!0});const w=()=>{t("close"),C()},C=()=>{h.value={name:"",code:"",color:"",warehouse_id:v.value.length>0?a.getters.mainWarehouse?.id||v.value[0].id:"",supplier:"",item_location:"",cartons_count:0,per_carton_count:12,single_bottles_count:0,notes:"",photo_url:null},n.value="both",r.value="",l.value="",i.value=null,d.value=null,m.value="",a.dispatch("clearOperationError")},E=e=>{if(0===e)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,s)).toFixed(2))+" "+a[s]},W=()=>{p.value&&p.value.click()},M=e=>{const t=e.target.files[0];if(!t)return;if(!t.type.startsWith("image/"))return void(r.value="يرجى اختيار ملف صورة فقط");if(t.size>5242880)return void(r.value="حجم الصورة يجب أن يكون أقل من 5MB");d.value=t;const a=new FileReader;a.onload=e=>{m.value=e.target.result},a.readAsDataURL(t),p.value&&(p.value.value="")},D=()=>{d.value=null,m.value="",h.value.photo_url=null},I=async()=>{c.value=!0,r.value="";try{if(!navigator.clipboard||!navigator.clipboard.read)return void(r.value="ميزة لصق الصور من الحافظة غير مدعومة في هذا المتصفح");const e=await navigator.clipboard.read();for(const t of e){const e=t.types.filter(e=>e.startsWith("image/"));if(e.length>0){const a=e[0],s=await t.getType(a),o=new File([s],`pasted-image-${Date.now()}.${a.split("/")[1]}`,{type:a});d.value=o;const r=new FileReader;r.onload=e=>{m.value=e.target.result},r.readAsDataURL(s),l.value="تم لصق الصورة من الحافظة بنجاح";break}}d.value||(r.value="لا توجد صورة في الحافظة")}catch(e){console.error("Error pasting from clipboard:",e),r.value="حدث خطأ أثناء لصق الصورة من الحافظة. تأكد من وجود صورة في الحافظة وأنك قد منحت الإذن للوصول إلى الحافظة."}finally{c.value=!1}},q=async()=>{if(!d.value)return null;u.value=!0;try{return new Promise(e=>{const t=new FileReader;t.onload=t=>{setTimeout(()=>{e(t.target.result)},1e3)},t.readAsDataURL(d.value)})}catch(e){return console.error("Error uploading photo:",e),r.value="حدث خطأ أثناء رفع الصورة",null}finally{u.value=!1}},P=async()=>{if(h.value.name&&h.value.code&&h.value.color&&h.value.warehouse_id)try{const e=await a.dispatch("checkExistingItem",{name:h.value.name.trim(),code:h.value.code.trim(),color:h.value.color.trim(),warehouse_id:h.value.warehouse_id});e&&e.exists&&e.item?(i.value=e.item,e.item.photo_url&&(m.value=e.item.photo_url,h.value.photo_url=e.item.photo_url)):i.value=null}catch(e){console.error("Error checking existing item:",e),i.value=null}else i.value=null},X=()=>{if(r.value="",a.dispatch("clearOperationError"),!h.value.name.trim())return r.value="يرجى إدخال اسم الصنف",!1;if(!h.value.code.trim())return r.value="يرجى إدخال كود الصنف",!1;if(!h.value.color.trim())return r.value="يرجى إدخال لون الصنف",!1;if(!h.value.warehouse_id)return r.value="يرجى اختيار المخزن",!1;if(!b.value)return r.value="يجب تسجيل الدخول أولاً",!1;if(!a.getters.canEdit)return r.value="ليس لديك صلاحية لإضافة أصناف",!1;if("cartons"===n.value){if(!h.value.cartons_count||h.value.cartons_count<=0)return r.value="يرجى إدخال عدد كراتين صحيح",!1;if(!h.value.per_carton_count||h.value.per_carton_count<=0)return r.value="يرجى إدخال عدد صحيح في الكرتونة",!1}else if("single"===n.value){if(!h.value.single_bottles_count||h.value.single_bottles_count<=0)return r.value="يرجى إدخال عدد فردي صحيح",!1}else if("both"===n.value){const e=h.value.cartons_count&&h.value.cartons_count>0&&h.value.per_carton_count&&h.value.per_carton_count>0,t=h.value.single_bottles_count&&h.value.single_bottles_count>0;if(!e&&!t)return r.value="يرجى إدخال كميات صحيحة إما في الكراتين أو الفردي",!1}return!(y.value<=0)||(r.value="يرجى إدخال كمية صحيحة",!1)},S=async()=>{if(X()){o.value=!0,r.value="",l.value="";try{if(d.value&&!m.value.startsWith("data:image/")){const e=await q();e&&(h.value.photo_url=e)}else m.value&&m.value.startsWith("data:image/")&&(h.value.photo_url=m.value);const e=b.value;if(!e)throw new Error("يجب تسجيل الدخول أولاً");const s=L.value,o={name:h.value.name.trim(),code:h.value.code.trim(),color:h.value.color.trim(),warehouse_id:h.value.warehouse_id,cartons_count:h.value.cartons_count||0,per_carton_count:h.value.per_carton_count||(s?12:1),single_bottles_count:h.value.single_bottles_count||0,supplier:h.value.supplier?.trim()||"",item_location:h.value.item_location?.trim()||"",notes:h.value.notes?.trim()||"",photo_url:h.value.photo_url||null};console.log("Submitting item with data:",{itemData:o,userId:e,addingCartons:s,existingItem:i.value});const r=await a.dispatch("addInventoryItemAtomic",{itemData:o,userId:e,isAddingCartons:s});console.log("Item operation completed:",r),l.value="created"===r?.type?"تم إضافة الصنف الجديد بنجاح!":"updated"===r?.type?"تم تحديث الكميات بنجاح!":"تم حفظ التغييرات بنجاح!",setTimeout(()=>{t("success",r||{type:i.value?"updated":"created"}),w()},1500)}catch(e){console.error("Error in handleSubmit:",e),e.message?.includes("يجب تسجيل الدخول")?r.value="يجب تسجيل الدخول أولاً":e.message?.includes("صلاحية")?r.value="ليس لديك صلاحية لإضافة أصناف. يرجى التواصل مع المشرف.":e.message?.includes("مطلوب")||e.message?.includes("الحقل")?r.value=e.message:e.message?.includes("الشبكة")||e.message?.includes("الاتصال")?r.value="خطأ في الاتصال بالشبكة. يرجى التحقق من اتصال الإنترنت والمحاولة مرة أخرى.":k.value?r.value=k.value:r.value=`حدث خطأ أثناء حفظ الصنف: ${e.message||"خطأ غير معروف"}`}finally{o.value=!1}}};return{loading:o,errorMessage:r,successMessage:l,addMode:n,existingItem:i,formData:h,accessibleWarehouses:v,storeOperationLoading:g,storeOperationError:k,cartonsTotal:f,totalQuantity:y,showSummary:x,isFormValid:_,uploadingPhoto:u,clipboardLoading:c,selectedFile:d,previewPhoto:m,fileInput:p,closeModal:w,handleSubmit:S,formatFileSize:E,openFilePicker:W,handleFileUpload:M,handlePasteFromClipboard:I,removePhoto:D}}},oe=a(6262);const re=(0,oe.A)(se,[["render",ee],["__scopeId","data-v-bf359d62"]]);var le=re}}]);