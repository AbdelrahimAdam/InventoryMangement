(function(){"use strict";var e={62:function(e,t,r){r.d(t,{Qi:function(){return n},VX:function(){return i},XY:function(){return s},cE:function(){return u},t2:function(){return c}});var a=r(884),o=r(556);const s={name:"الاسم",code:"الكود",color:"اللون",cartons_count:"عدد الكراتين",per_carton_count:"عدد في الكرتونة",single_bottles_count:"عدد القزاز الفردي",total_added:"الكميه المضافه",remaining_quantity:"الكميه المتبقيه",warehouse_id:"المخزن",supplier:"المورد",item_location:"مكان الصنف",created_at:"تاريخ الإنشاء",updated_at:"تاريخ التحديث",created_by:"تم الإنشاء بواسطة",updated_by:"تم التحديث بواسطة",notes:"ملاحظات"},n={main_warehouse:"مخزن شارع الشيخ",tera_warehouse:"مخزن الترعه",shobeen_warehouse:"مخزن موقف شبين",hyper_warehouse:"مخزن هايبر التهامي"},i={factory:"صرف الي مصنع البران",zahra:"صرف الي مخزن الزهراء"},c={ADD:"ADD",TRANSFER:"TRANSFER",DISPATCH:"DISPATCH"},l={ITEM_NOT_FOUND:"الصنف غير موجود",WRONG_WAREHOUSE:"الصنف ليس في المخزن المحدد",INSUFFICIENT_QUANTITY:"الكمية المطلوبة غير متوفرة",UNAUTHORIZED:"ليس لديك صلاحية للقيام بهذا الإجراء",NETWORK_ERROR:"خطأ في الاتصال بالشبكة",UNKNOWN_ERROR:"حدث خطأ غير متوقع",INVALID_DATA:"بيانات غير صحيحة"};class u{static async addOrUpdateItem(e,t,r=!0){try{const{warehouse_id:a,code:o,color:s,name:n}=e;if(!a||!o||!s||!n)throw new Error("بيانات غير مكتملة: يرجى التأكد من إدخال جميع الحقول المطلوبة (الاسم، الكود، اللون، المخزن)");if(!t)throw new Error("يجب تسجيل الدخول أولاً");const i=this._cleanItemData(e),c=await this._findExistingItem(i);return c?await this._updateExistingItem(c,i,t,r):await this._createNewItem(i,t)}catch(a){throw console.error("Error in addOrUpdateItem:",a),this._handleError(a)}}static async _findExistingItem(e){try{const t=(0,a.rJ)(o.db,"items");if(!e.warehouse_id||!e.code||!e.color||!e.name)return console.warn("Missing required fields for query:",e),null;const r=(0,a.P)(t,(0,a._M)("warehouse_id","==",e.warehouse_id),(0,a._M)("code","==",e.code.trim()),(0,a._M)("color","==",e.color.trim()),(0,a._M)("name","==",e.name.trim())),s=await(0,a.GG)(r);return s.empty?null:{id:s.docs[0].id,...s.docs[0].data()}}catch(t){return console.error("Error finding existing item:",t),null}}static _cleanItemData(e){const t={...e};if(t.name=t.name?.trim()||"",t.code=t.code?.trim()||"",t.color=t.color?.trim()||"",t.supplier=t.supplier?.trim()||"",t.item_location=t.item_location?.trim()||"",t.notes=t.notes?.trim()||"",!t.name)throw new Error("اسم الصنف مطلوب");if(!t.code)throw new Error("كود الصنف مطلوب");if(!t.color)throw new Error("لون الصنف مطلوب");if(!t.warehouse_id)throw new Error("المخزن مطلوب");if(t.cartons_count=Number(t.cartons_count)||0,t.per_carton_count=Number(t.per_carton_count)||1,t.single_bottles_count=Number(t.single_bottles_count)||0,t.supplier=t.supplier||"",t.item_location=t.item_location||"",t.notes=t.notes||"",t.cartons_count<0)throw new Error("عدد الكراتين لا يمكن أن يكون سالباً");if(t.per_carton_count<1)throw new Error("عدد القطع في الكرتونة يجب أن يكون 1 على الأقل");if(t.single_bottles_count<0)throw new Error("عدد القزاز الفردي لا يمكن أن يكون سالباً");return t}static async _updateExistingItem(e,t,r,s){const n=(0,a.wP)(o.db),i=new Date,l={updated_at:i,updated_by:r};let u=0;if(s){const r=e.cartons_count||0,a=t.cartons_count||0;l.cartons_count=r+a,void 0!==t.per_carton_count&&null!==t.per_carton_count&&t.per_carton_count>=1?l.per_carton_count=t.per_carton_count:l.per_carton_count=e.per_carton_count||1;const o=l.per_carton_count;u=a*o,l.single_bottles_count=e.single_bottles_count||0}else void 0!==t.single_bottles_count&&null!==t.single_bottles_count?(l.single_bottles_count=Math.max(0,t.single_bottles_count),u=t.single_bottles_count):l.single_bottles_count=e.single_bottles_count||0,l.cartons_count=e.cartons_count||0,l.per_carton_count=e.per_carton_count||1;const d=e.total_added||0,m=e.remaining_quantity||0;if(l.total_added=d+u,l.remaining_quantity=m+u,void 0!==t.notes&&(l.notes=t.notes),void 0!==t.supplier&&(l.supplier=t.supplier),void 0!==t.item_location&&(l.item_location=t.item_location),l.remaining_quantity<0)throw new Error("الكمية المتبقية لا يمكن أن تكون سالبة");if(l.total_added<d)throw new Error("الكمية المضافة التراكمية لا يمكن أن تقل");const h=(0,a.H9)(o.db,"items",e.id);n.update(h,l);const _=(0,a.H9)((0,a.rJ)(o.db,"transactions"));return n.set(_,{item_id:e.id,from_warehouse:null,to_warehouse:t.warehouse_id,type:c.ADD,cartons_delta:s&&t.cartons_count||0,single_delta:s?0:t.single_bottles_count||0,per_carton_updated:t.per_carton_count,previous_remaining:m,new_remaining:l.remaining_quantity,timestamp:i,user_id:r,notes:t.notes||(s?"إضافة كراتين للمخزن":"إضافة قزاز فردي للمخزن"),created_at:i}),await n.commit(),{type:"updated",id:e.id,addedQuantity:u}}static async _createNewItem(e,t){const r=(0,a.wP)(o.db),s=new Date,n=e.cartons_count||0,i=e.per_carton_count||1,l=e.single_bottles_count||0,u=n*i+l;if(!e.name||!e.code||!e.color||!e.warehouse_id)throw new Error("جميع الحقول المطلوبة يجب أن تكون مملوءة (الاسم، الكود، اللون، المخزن)");if(u<=0)throw new Error("يجب إدخال كمية صحيحة");const d={name:e.name,code:e.code,color:e.color,warehouse_id:e.warehouse_id,cartons_count:n,per_carton_count:i,single_bottles_count:l,total_added:u,remaining_quantity:u,supplier:e.supplier||"",item_location:e.item_location||"",notes:e.notes||"",created_at:s,created_by:t,updated_at:s,updated_by:t},m=(0,a.H9)((0,a.rJ)(o.db,"items"));r.set(m,d);const h=(0,a.H9)((0,a.rJ)(o.db,"transactions"));return r.set(h,{item_id:m.id,from_warehouse:null,to_warehouse:e.warehouse_id,type:c.ADD,cartons_delta:n,single_delta:l,per_carton_updated:i,previous_remaining:0,new_remaining:u,timestamp:s,user_id:t,notes:e.notes||"إنشاء صنف جديد",created_at:s}),await r.commit(),{type:"created",id:m.id,addedQuantity:u}}static async transferItem(e,t){try{const{item_id:r,from_warehouse:s,to_warehouse:i,cartons:u,single_bottles:d,notes:m}=e;if(!r||!s||!i)throw new Error("بيانات النقل غير مكتملة");if(!t)throw new Error("يجب تسجيل الدخول أولاً");const h=Number(u)||0,_=Number(d)||0;if(h<=0&&_<=0)throw new Error("يجب تحديد كمية للنقل");return await(0,a.c4)(o.db,async e=>{const u=(0,a.H9)(o.db,"items",r),d=await e.get(u);if(!d.exists())throw new Error(l.ITEM_NOT_FOUND);const p=d.data();if(p.warehouse_id!==s)throw new Error(l.WRONG_WAREHOUSE);const w=p.per_carton_count||1,g=h*w+_;if(g>p.remaining_quantity)throw new Error(l.INSUFFICIENT_QUANTITY);const f={remaining_quantity:p.remaining_quantity-g,updated_at:new Date,updated_by:t};h>0&&(f.cartons_count=Math.max(0,(p.cartons_count||0)-h)),_>0&&(f.single_bottles_count=Math.max(0,(p.single_bottles_count||0)-_)),await e.update(u,f),await this._handleDestinationItem(e,p,i,h,_,g,t);const y=(0,a.H9)((0,a.rJ)(o.db,"transactions"));return await e.set(y,{item_id:r,from_warehouse:s,to_warehouse:i,type:c.TRANSFER,cartons_delta:-h,single_delta:-_,per_carton_updated:p.per_carton_count,previous_remaining:p.remaining_quantity,new_remaining:f.remaining_quantity,timestamp:new Date,user_id:t,notes:m||`نقل من ${n[s]} إلى ${n[i]}`,created_at:new Date}),{success:!0,transferQty:g,sourceItemId:r,destinationWarehouse:i}})}catch(r){throw console.error("Error in transferItem:",r),this._handleError(r)}}static async _handleDestinationItem(e,t,r,s,n,i,c){const l=(0,a.rJ)(o.db,"items"),u=(0,a.P)(l,(0,a._M)("warehouse_id","==",r),(0,a._M)("code","==",t.code),(0,a._M)("color","==",t.color),(0,a._M)("name","==",t.name)),d=await(0,a.GG)(u),m=new Date;if(!d.empty&&d.docs.length>0){const t=d.docs[0],r=t.data(),l={total_added:(r.total_added||0)+i,remaining_quantity:(r.remaining_quantity||0)+i,cartons_count:(r.cartons_count||0)+s,single_bottles_count:(r.single_bottles_count||0)+n,updated_at:m,updated_by:c},u=(0,a.H9)(o.db,"items",t.id);await e.update(u,l)}else{const l={name:t.name,code:t.code,color:t.color,warehouse_id:r,cartons_count:s,per_carton_count:t.per_carton_count||1,single_bottles_count:n,total_added:i,remaining_quantity:i,supplier:t.supplier||"",item_location:t.item_location||"",notes:t.notes||"",created_at:m,created_by:c,updated_at:m,updated_by:c},u=(0,a.H9)((0,a.rJ)(o.db,"items"));await e.set(u,l)}}static async dispatchItem(e,t){try{const{item_id:r,from_warehouse:s,to_destination:n,cartons:u,single_bottles:d,notes:m}=e;if(!r||!s||!n)throw new Error("بيانات الصرف غير مكتملة");if(!t)throw new Error("يجب تسجيل الدخول أولاً");const h=Number(u)||0,_=Number(d)||0;if(h<=0&&_<=0)throw new Error("يجب تحديد كمية للصرف");return await(0,a.c4)(o.db,async e=>{const u=(0,a.H9)(o.db,"items",r),d=await e.get(u);if(!d.exists())throw new Error(l.ITEM_NOT_FOUND);const p=d.data();if(p.warehouse_id!==s)throw new Error(l.WRONG_WAREHOUSE);const w=p.per_carton_count||1,g=h*w+_;if(g>p.remaining_quantity)throw new Error(l.INSUFFICIENT_QUANTITY);const f={remaining_quantity:p.remaining_quantity-g,updated_at:new Date,updated_by:t};h>0&&(f.cartons_count=Math.max(0,(p.cartons_count||0)-h)),_>0&&(f.single_bottles_count=Math.max(0,(p.single_bottles_count||0)-_)),await e.update(u,f);const y=(0,a.H9)((0,a.rJ)(o.db,"transactions"));return await e.set(y,{item_id:r,from_warehouse:s,to_warehouse:n,type:c.DISPATCH,cartons_delta:-h,single_delta:-_,per_carton_updated:p.per_carton_count,previous_remaining:p.remaining_quantity,new_remaining:f.remaining_quantity,timestamp:new Date,user_id:t,notes:m||`صرف إلى ${i[n]||n}`,created_at:new Date}),{success:!0,dispatchQty:g,itemId:r,destination:n}})}catch(r){throw console.error("Error in dispatchItem:",r),this._handleError(r)}}static async getLowStockItems(e=null){try{let t=(0,a.rJ)(o.db,"items");t=e?(0,a.P)(t,(0,a._M)("warehouse_id","==",e),(0,a._M)("remaining_quantity","<",10)):(0,a.P)(t,(0,a._M)("remaining_quantity","<",10));const r=await(0,a.GG)(t);return r.docs.map(e=>({id:e.id,...e.data(),_display:{warehouse:n[e.data().warehouse_id]||e.data().warehouse_id}}))}catch(t){throw console.error("Error in getLowStockItems:",t),this._handleError(t)}}static async getRecentTransactions(e=50){try{const t=(0,a.P)((0,a.rJ)(o.db,"transactions"),(0,a.My)("timestamp","desc")),r=await(0,a.GG)(t),s=r.docs.slice(0,e).map(e=>({id:e.id,...e.data()}));return s.map(e=>({...e,_display:{from_warehouse:n[e.from_warehouse]||e.from_warehouse,to_warehouse:n[e.to_warehouse]||i[e.to_warehouse]||e.to_warehouse}}))}catch(t){throw console.error("Error in getRecentTransactions:",t),this._handleError(t)}}static async getWarehouseItems(e){try{if(!e)throw new Error("يجب تحديد المخزن");const t=(0,a.P)((0,a.rJ)(o.db,"items"),(0,a._M)("warehouse_id","==",e),(0,a.My)("name")),r=await(0,a.GG)(t);return r.docs.map(e=>({id:e.id,...e.data(),_display:{warehouse:n[e.data().warehouse_id]||e.data().warehouse_id}}))}catch(t){throw console.error("Error in getWarehouseItems:",t),this._handleError(t)}}static async getAllItems(e=50){try{const t=(0,a.P)((0,a.rJ)(o.db,"items"),(0,a.My)("name")),r=await(0,a.GG)(t),s=r.docs.slice(0,e).map(e=>({id:e.id,...e.data()}));return s.map(e=>({...e,_display:{warehouse:n[e.warehouse_id]||e.warehouse_id}}))}catch(t){throw console.error("Error in getAllItems:",t),this._handleError(t)}}static async searchItems(e,t=null){try{if(!e||e.trim().length<2)throw new Error("يجب إدخال مصطلح بحث مكون من حرفين على الأقل");const r=e.toLowerCase().trim();let a=[];return a=t?await this.getWarehouseItems(t):await this.getAllItems(1e3),a.filter(e=>e.name?.toLowerCase().includes(r)||e.code?.toLowerCase().includes(r)||e.color?.toLowerCase().includes(r)||e.supplier?.toLowerCase().includes(r))}catch(r){throw console.error("Error in searchItems:",r),this._handleError(r)}}static async getItemById(e){try{if(!e)throw new Error("معرف الصنف مطلوب");const t=await(0,a.x7)((0,a.H9)(o.db,"items",e));if(!t.exists())throw new Error(l.ITEM_NOT_FOUND);return{id:t.id,...t.data(),_display:{warehouse:n[t.data().warehouse_id]||t.data().warehouse_id}}}catch(t){throw console.error("Error in getItemById:",t),this._handleError(t)}}static async updateItemDetails(e,t,r){try{if(!e||!r)throw new Error("معرف الصنف ومعرف المستخدم مطلوبان");const s=["supplier","item_location","notes","per_carton_count"],n={};for(const e of s)void 0!==t[e]&&(n[e]=t[e]);if(void 0!==n.per_carton_count&&n.per_carton_count<1)throw new Error("عدد القطع في الكرتونة يجب أن يكون 1 على الأقل");n.updated_at=new Date,n.updated_by=r;const i=(0,a.H9)(o.db,"items",e);return await(0,a.mZ)(i,n),{success:!0,itemId:e}}catch(s){throw console.error("Error in updateItemDetails:",s),this._handleError(s)}}static async getWarehouseStats(e=null){try{let t=(0,a.rJ)(o.db,"items");e&&(t=(0,a.P)(t,(0,a._M)("warehouse_id","==",e)));const r=await(0,a.GG)(t),s=r.docs.map(e=>e.data()),i=s.length,c=s.reduce((e,t)=>e+(t.remaining_quantity||0),0),l=s.filter(e=>(e.remaining_quantity||0)<10).length,u=s.filter(e=>0===(e.remaining_quantity||0)).length;return{totalItems:i,totalQuantity:c,lowStockItems:l,outOfStockItems:u,warehouse:e?n[e]:"جميع المخازن"}}catch(t){throw console.error("Error in getWarehouseStats:",t),this._handleError(t)}}static convertForDisplay(e){return Array.isArray(e)?e.map(e=>this._addDisplayLabels(e)):this._addDisplayLabels(e)}static _addDisplayLabels(e){return e?{...e,_display:{warehouse:n[e.warehouse_id]||e.warehouse_id}}:e}static _handleError(e){if(console.error("Inventory Service Error:",e),e.code)switch(e.code){case"permission-denied":return new Error("ليس لديك صلاحية للقيام بهذا الإجراء");case"unavailable":return new Error("الخدمة غير متاحة حالياً. يرجى المحاولة لاحقاً");case"resource-exhausted":return new Error("تم تجاوز الحد المسموح. يرجى المحاولة لاحقاً");case"failed-precondition":return new Error("البيانات غير صالحة للعملية المطلوبة");case"invalid-argument":return new Error("بيانات غير صحيحة");default:return new Error(e.message||l.UNKNOWN_ERROR)}return e.message&&e.message.includes(" ")?e:new Error(e.message||l.UNKNOWN_ERROR)}static calculateTotalQuantity(e,t,r){const a=(Number(e)||0)*(Number(t)||1),o=Number(r)||0;return a+o}static validateItemData(e,t="create"){const r=[];if(e.name?.trim()||r.push("الاسم مطلوب"),e.code?.trim()||r.push("الكود مطلوب"),e.color?.trim()||r.push("اللون مطلوب"),e.warehouse_id||r.push("المخزن مطلوب"),"create"===t){const t=this.calculateTotalQuantity(e.cartons_count,e.per_carton_count,e.single_bottles_count);t<=0&&r.push("يجب إدخال كمية صحيحة")}if(r.length>0)throw new Error(r.join("، "));return!0}}},203:function(e,t,r){var a=r(884),o=r(496),s=r(556);class n{constructor(){this.usersCollection="users",this.logsCollection="user_logs",this.profilesCollection="user_profiles"}async _checkSuperAdminPermission(){try{if(!s.j2.currentUser)throw new Error("يجب تسجيل الدخول أولاً");const e=await(0,a.x7)((0,a.H9)(s.db,this.usersCollection,s.j2.currentUser.uid));if(!e.exists())throw new Error("ملف المستخدم غير موجود");const t=e.data();if("superadmin"!==t.role)throw new Error("ليس لديك صلاحية لإدارة المستخدمين");return t}catch(e){throw console.error("Permission check error:",e),e}}async getUsers(e={}){try{await this._checkSuperAdminPermission();const{page:t=1,limit:r=20,search:o="",role:n="",is_active:i=null,sort_by:c="created_at",sort_order:l="desc"}=e;let u=(0,a.rJ)(s.db,this.usersCollection);const d=[];n&&d.push((0,a._M)("role","==",n)),null!==i&&d.push((0,a._M)("is_active","==",i)),d.push((0,a.My)(c,l)),u=(0,a.P)(u,...d);const m=await(0,a.GG)(u);let h=[];m.forEach(e=>{const t=e.data();this._userMatchesSearch(t,o)&&h.push({id:e.id,...t,created_at:this._formatTimestamp(t.created_at),updated_at:this._formatTimestamp(t.updated_at),last_login:this._formatTimestamp(t.last_login)})});const _=h.length,p=(t-1)*r,w=h.slice(p,p+r);return{success:!0,data:w,pagination:{currentPage:t,totalPages:Math.ceil(_/r),totalItems:_,itemsPerPage:r}}}catch(t){return console.error("UserService.getUsers Error:",t),{success:!1,error:this._handleFirebaseError(t),data:[],pagination:{currentPage:1,totalPages:0,totalItems:0,itemsPerPage:20}}}}async getUserById(e){try{const t=(0,a.H9)(s.db,this.usersCollection,e),r=await(0,a.x7)(t);if(!r.exists())return{success:!1,error:"المستخدم غير موجود",data:null};const o=r.data(),n={id:r.id,...o,created_at:this._formatTimestamp(o.created_at),updated_at:this._formatTimestamp(o.updated_at),last_login:this._formatTimestamp(o.last_login)};return{success:!0,data:n,message:"تم تحميل المستخدم بنجاح"}}catch(t){return console.error("UserService.getUserById Error:",t),{success:!1,error:this._handleFirebaseError(t),data:null}}}async createUser(e){try{await this._checkSuperAdminPermission();const t=this.validateUserData(e,!1);if(!t.isValid)return{success:!1,error:t.errors[0],data:null};const r=await(0,o.eJ)(s.j2,e.email.trim().toLowerCase(),e.password),n=r.user,i=n.uid,c={name:e.name.trim(),email:e.email.trim().toLowerCase(),phone:e.phone?.trim()||null,role:e.role,is_active:!1!==e.is_active,allowed_warehouses:e.allowed_warehouses||[],created_at:(0,a.O5)(),updated_at:(0,a.O5)(),created_by:s.j2.currentUser?.uid||"system",email_verified:!1,last_login:null,profile_complete:!1};await(0,o.r7)(n,{displayName:e.name.trim()}),await(0,o.gA)(n);const l=(0,a.H9)(s.db,this.usersCollection,i);await(0,a.BN)(l,c);const u=(0,a.H9)(s.db,this.profilesCollection,i);return await(0,a.BN)(u,{user_id:i,preferences:{language:"ar",theme:"light",notifications:!0},created_at:(0,a.O5)(),updated_at:(0,a.O5)()}),await this._logUserAction("create",i,{name:c.name,email:c.email,role:c.role}),{success:!0,data:{id:i,...c,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},message:"تم إنشاء المستخدم بنجاح"}}catch(t){return console.error("UserService.createUser Error:",t),{success:!1,error:this._handleFirebaseError(t),data:null}}}async updateUser(e,t){try{await this._checkSuperAdminPermission();const n=await this.getUserById(e);if(!n.success)return n;const i=this.validateUserData(t,!0);if(!i.isValid)return{success:!1,error:i.errors[0],data:null};const c={name:t.name?.trim()||n.data.name,phone:t.phone?.trim()||n.data.phone||null,role:t.role||n.data.role,is_active:!1!==t.is_active,allowed_warehouses:t.allowed_warehouses||n.data.allowed_warehouses||[],updated_at:(0,a.O5)(),updated_by:s.j2.currentUser?.uid};if(t.name&&t.name!==n.data.name)try{const r=s.j2.currentUser;r?.uid===e&&await(0,o.r7)(r,{displayName:t.name.trim()})}catch(r){console.warn("Could not update Firebase Auth profile:",r)}const l=(0,a.H9)(s.db,this.usersCollection,e);return await(0,a.mZ)(l,c),await this._logUserAction("update",e,{name:c.name,role:c.role,is_active:c.is_active}),{success:!0,data:{...n.data,...c,updated_at:(new Date).toISOString()},message:"تم تحديث المستخدم بنجاح"}}catch(r){return console.error("UserService.updateUser Error:",r),{success:!1,error:this._handleFirebaseError(r),data:null}}}async deleteUser(e){try{await this._checkSuperAdminPermission();const t=(0,a.H9)(s.db,this.usersCollection,e),r=await(0,a.x7)(t);if(!r.exists())return{success:!1,error:"المستخدم غير موجود"};if(s.j2.currentUser?.uid===e)return{success:!1,error:"لا يمكن حذف حسابك الشخصي"};const o=r.data();if("superadmin"===o.role)return{success:!1,error:"لا يمكن حذف مشرف عام آخر"};await(0,a.kd)(t);const n=(0,a.H9)(s.db,this.profilesCollection,e);return await(0,a.kd)(n),await this._logUserAction("delete",e,{name:o.name,email:o.email}),{success:!0,message:"تم حذف المستخدم بنجاح"}}catch(t){return console.error("UserService.deleteUser Error:",t),{success:!1,error:this._handleFirebaseError(t)}}}async updateUserStatus(e,t){try{await this._checkSuperAdminPermission();const r=(0,a.H9)(s.db,this.usersCollection,e),o=await(0,a.x7)(r);if(!o.exists())return{success:!1,error:"المستخدم غير موجود"};const n=o.data();return s.j2.currentUser?.uid===e&&"superadmin"===n.role?{success:!1,error:"لا يمكن تعطيل حساب المشرف العام"}:t||"superadmin"!==n.role?(await(0,a.mZ)(r,{is_active:t,updated_at:(0,a.O5)(),updated_by:s.j2.currentUser?.uid}),await this._logUserAction(t?"activate":"deactivate",e,{name:n.name,previous_status:n.is_active,new_status:t}),{success:!0,message:`تم ${t?"تفعيل":"تعطيل"} المستخدم بنجاح`}):{success:!1,error:"لا يمكن تعطيل مشرف عام آخر"}}catch(r){return console.error("UserService.updateUserStatus Error:",r),{success:!1,error:this._handleFirebaseError(r)}}}async searchUsers(e,t=10){try{await this._checkSuperAdminPermission();const r=(0,a.rJ)(s.db,this.usersCollection),o=await(0,a.GG)(r),n=[];o.forEach(t=>{const r=t.data();this._userMatchesSearch(r,e)&&n.push({id:t.id,...r,created_at:this._formatTimestamp(r.created_at),updated_at:this._formatTimestamp(r.updated_at)})});const i=n.sort((t,r)=>{const a=this._calculateSearchScore(t,e),o=this._calculateSearchScore(r,e);return o-a});return{success:!0,data:i.slice(0,t),message:"تم البحث بنجاح"}}catch(r){return console.error("UserService.searchUsers Error:",r),{success:!1,error:this._handleFirebaseError(r),data:[]}}}async getUserStats(){try{await this._checkSuperAdminPermission();const e=(0,a.rJ)(s.db,this.usersCollection),t=await(0,a.GG)(e);let r=0,o=0,n=0,i=0,c=0;return t.forEach(e=>{const t=e.data();switch(r++,!1!==t.is_active&&o++,t.role){case"superadmin":n++;break;case"warehouse_manager":i++;break;case"company_manager":c++;break}}),{success:!0,data:{total_users:r,active_users:o,inactive_users:r-o,superadmins:n,warehouse_managers:i,company_managers:c,roles_distribution:{superadmin:n,warehouse_manager:i,company_manager:c}}}}catch(e){return console.error("UserService.getUserStats Error:",e),{success:!1,error:this._handleFirebaseError(e),data:null}}}generateRandomPassword(e=12){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let r="";for(let a=0;a<e;a++){const e=Math.floor(Math.random()*t.length);r+=t[e]}return r}async _logUserAction(e,t,r=null){try{const o=(0,a.rJ)(s.db,this.logsCollection),n={action:e,user_id:t,performed_by:s.j2.currentUser?.uid||"system",performed_by_name:s.j2.currentUser?.displayName||"System",data:r?JSON.stringify(r):null,timestamp:(0,a.O5)(),ip_address:"unknown"};await(0,a.BN)((0,a.H9)(o),n)}catch(o){console.error("Failed to log user action:",o)}}_userMatchesSearch(e,t){if(!t.trim())return!0;const r=t.toLowerCase().trim(),a=(e.name||"").toLowerCase(),o=(e.email||"").toLowerCase(),s=(e.phone||"").toLowerCase();return a.includes(r)||o.includes(r)||s.includes(r)}_calculateSearchScore(e,t){let r=0;const a=t.toLowerCase().trim();return e.name?.toLowerCase().includes(a)&&(r+=3),e.email?.toLowerCase().includes(a)&&(r+=2),e.phone?.toLowerCase().includes(a)&&(r+=1),r}_formatTimestamp(e){return e?e instanceof a.Dc||e.toDate?e.toDate().toISOString():e:null}_handleFirebaseError(e){console.error("Firebase Error:",e.code,e.message);const t={"auth/email-already-in-use":"البريد الإلكتروني مسجل مسبقاً","auth/invalid-email":"البريد الإلكتروني غير صالح","auth/operation-not-allowed":"عملية غير مسموحة","auth/weak-password":"كلمة المرور ضعيفة جداً","auth/user-disabled":"هذا الحساب معطل","auth/user-not-found":"المستخدم غير موجود","auth/wrong-password":"كلمة المرور غير صحيحة","auth/too-many-requests":"محاولات كثيرة جداً، يرجى الانتظار","permission-denied":"ليس لديك صلاحية للقيام بهذا الإجراء","not-found":"المستند غير موجود","already-exists":"المستند موجود مسبقاً",unavailable:"الخدمة غير متاحة حالياً"};return t[e.code]||e.message||"حدث خطأ غير متوقع"}validateUserData(e,t=!1){const r=[];if((!e.name||e.name.trim().length<2)&&r.push("الاسم يجب أن يكون على الأقل حرفين"),!t||e.email){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;e.email&&t.test(e.email)||r.push("البريد الإلكتروني غير صالح")}e.phone&&!/^01[0-9]{9}$/.test(e.phone)&&r.push("رقم الهاتف يجب أن يبدأ بـ 01 ويتكون من 11 رقماً");const a=["superadmin","warehouse_manager","company_manager"];return e.role&&a.includes(e.role)||r.push("الدور غير صالح"),t||(!e.password||e.password.length<8)&&r.push("كلمة المرور يجب أن تكون 8 أحرف على الأقل"),"warehouse_manager"===e.role&&(e.allowed_warehouses&&0!==e.allowed_warehouses.length||r.push("يجب اختيار مخزن واحد على الأقل لمدير المخازن")),{isValid:0===r.length,errors:r}}formatUserForDisplay(e){return{id:e.id,name:e.name||"غير معروف",email:e.email||"",phone:e.phone||"-",role:e.role||"user",role_name:this.getRoleName(e.role),is_active:!1!==e.is_active,status:!1!==e.is_active?"نشط":"غير نشط",status_color:!1!==e.is_active?"green":"red",allowed_warehouses:e.allowed_warehouses||[],created_at:e.created_at?new Date(e.created_at).toLocaleDateString("ar-EG"):"-",updated_at:e.updated_at?new Date(e.updated_at).toLocaleDateString("ar-EG"):"-",last_login:e.last_login?new Date(e.last_login).toLocaleDateString("ar-EG"):"لم يسجل دخول"}}getRoleName(e){const t={superadmin:"المشرف العام",warehouse_manager:"مدير المخازن",company_manager:"مدير الشركة"};return t[e]||e}getRolePermissions(e){const t={superadmin:["الوصول الكامل إلى جميع المخازن","إدارة المستخدمين والأدوار","إنشاء وتعديل وحذف الأصناف","إدارة الحركات والنقل","تصدير التقارير والبيانات","إعدادات النظام"],warehouse_manager:["الوصول إلى المخازن المحددة فقط","إنشاء وتعديل الأصناف في المخازن المسموحة","إدارة الحركات والنقل بين المخازن المسموحة","عرض التقارير للمخازن المسموحة","تصدير بيانات المخازن المسموحة"],company_manager:["عرض جميع البيانات للقراءة فقط","تصفية البيانات والتقارير","تصدير التقارير والبيانات","لا يمكن التعديل أو الحذف"]};return t[e]||[]}}const i=new n;t.A=i},435:function(e,t,r){var a=r(751),o=r(641),s=r(33);const n={id:"app",dir:"rtl",class:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200"},i={key:0,class:"flex items-center justify-center min-h-screen"},c={key:1,class:"h-screen flex flex-col"},l={key:0,class:"flex-1 overflow-y-auto"},u={class:"lg:hidden"},d={class:"bg-white dark:bg-gray-800 shadow-md border-b border-gray-200 dark:border-gray-700"},m={class:"px-4 py-3"},h={class:"flex items-center justify-between"},_={class:"flex items-center space-x-3 space-x-reverse"},p={class:"w-5 h-5 text-gray-600 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},w={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"},g={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},f={class:"flex items-center space-x-2 space-x-reverse"},y=["aria-label"],E={key:0,class:"w-5 h-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20"},b={key:1,class:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20"},v={key:0,class:"absolute -top-1 -left-1 h-5 w-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center"},k={key:0,class:"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg"},T={class:"px-4 py-3 border-b border-gray-200 dark:border-gray-700"},R={class:"relative"},x={class:"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50"},N={class:"flex items-center"},O={class:"h-10 w-10 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 flex items-center justify-center shadow-sm ml-3"},I={class:"text-white font-medium text-sm"},S={class:"text-right flex-1"},A={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},L={class:"text-xs text-gray-500 dark:text-gray-400 truncate"},C={class:"px-4 py-3 space-y-1"},P={key:2,class:"pt-2 pb-1 px-3"},D={class:"space-y-1"},M={key:0,class:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm"},U={class:"flex overflow-x-auto scrollbar-hide px-4 py-2"},W={class:"flex-shrink-0 px-3 text-center border-l border-gray-200 dark:border-gray-700 first:border-l-0"},H={class:"text-sm font-bold text-gray-900 dark:text-white"},G={class:"flex-shrink-0 px-3 text-center border-l border-gray-200 dark:border-gray-700"},F={class:"text-sm font-bold text-gray-900 dark:text-white"},j={class:"flex-shrink-0 px-3 text-center border-l border-gray-200 dark:border-gray-700"},B={class:"text-sm font-bold text-red-600 dark:text-red-400"},q={class:"flex-shrink-0 px-3 text-center border-l border-gray-200 dark:border-gray-700"},z={class:"text-sm font-bold text-gray-900 dark:text-white"},$={key:0,class:"lg:hidden fixed bottom-0 left-0 right-0 z-40 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 pb-safe"},Q={class:"flex justify-around p-2"};function J(e,t,r,J,V,X){const Y=(0,o.g2)("router-view"),K=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",n,[J.initializing?((0,o.uX)(),(0,o.CE)("div",i,[...t[22]||(t[22]=[(0,o.Lk)("div",{class:"text-center"},[(0,o.Lk)("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600 mx-auto"}),(0,o.Lk)("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"جاري التحميل...")],-1)])])):((0,o.uX)(),(0,o.CE)("div",c,[J.isPublicRoute?((0,o.uX)(),(0,o.CE)("div",l,[(0,o.bF)(Y)])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.Lk)("div",u,[(0,o.Lk)("header",d,[(0,o.Lk)("div",m,[(0,o.Lk)("div",h,[(0,o.Lk)("div",_,[(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>J.toggleMobileMenu&&J.toggleMobileMenu(...e)),class:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"فتح القائمة"},[((0,o.uX)(),(0,o.CE)("svg",p,[J.mobileMenuOpen?((0,o.uX)(),(0,o.CE)("path",g)):((0,o.uX)(),(0,o.CE)("path",w))]))]),(0,o.bF)(K,{to:"/",class:"flex items-center space-x-2 space-x-reverse",onClick:t[1]||(t[1]=e=>J.mobileMenuOpen=!1)},{default:(0,o.k6)(()=>[...t[23]||(t[23]=[(0,o.Lk)("div",{class:"h-8 w-8 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center shadow-sm"},[(0,o.Lk)("span",{class:"text-white font-bold text-sm"},"م")],-1),(0,o.Lk)("div",null,[(0,o.Lk)("h1",{class:"text-sm font-bold text-gray-900 dark:text-white"},"نظام المخزون"),(0,o.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"مونوفيا")],-1)])]),_:1})]),(0,o.Lk)("div",f,[(0,o.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>J.toggleDarkMode&&J.toggleDarkMode(...e)),class:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":J.isDarkMode?"الوضع النهاري":"الوضع الليلي"},[J.isDarkMode?((0,o.uX)(),(0,o.CE)("svg",E,[...t[24]||(t[24]=[(0,o.Lk)("path",{"fill-rule":"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z","clip-rule":"evenodd"},null,-1)])])):((0,o.uX)(),(0,o.CE)("svg",b,[...t[25]||(t[25]=[(0,o.Lk)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"},null,-1)])]))],8,y),(0,o.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>J.showNotifications&&J.showNotifications(...e)),class:"relative p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"الإشعارات"},[t[26]||(t[26]=(0,o.Lk)("svg",{class:"w-5 h-5 text-gray-600 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),J.notificationCount>0?((0,o.uX)(),(0,o.CE)("span",v,(0,s.v_)(J.notificationCount>9?"9+":J.notificationCount),1)):(0,o.Q3)("",!0)])])])]),J.mobileMenuOpen?((0,o.uX)(),(0,o.CE)("div",k,[(0,o.Lk)("div",T,[(0,o.Lk)("div",R,[t[27]||(t[27]=(0,o.Lk)("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[(0,o.Lk)("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>J.mobileSearchTerm=e),onInput:t[5]||(t[5]=(...e)=>J.handleMobileSearch&&J.handleMobileSearch(...e)),onKeyup:t[6]||(t[6]=(0,a.jR)((...e)=>J.handleMobileSearchEnter&&J.handleMobileSearchEnter(...e),["enter"])),placeholder:"ابحث عن صنف...",class:"block w-full pr-10 pl-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500","aria-label":"بحث عن صنف"},null,544),[[a.Jo,J.mobileSearchTerm]])])]),(0,o.Lk)("div",x,[(0,o.Lk)("div",N,[(0,o.Lk)("div",O,[(0,o.Lk)("span",I,(0,s.v_)(J.getUserInitials(J.userProfile?.name||J.userProfile?.email)),1)]),(0,o.Lk)("div",S,[(0,o.Lk)("p",A,(0,s.v_)(J.userProfile?.name||J.userProfile?.email),1),(0,o.Lk)("p",L,(0,s.v_)(J.getRoleName(J.userRole)),1)]),(0,o.Lk)("span",{class:(0,s.C4)(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",J.roleBadgeClass])},(0,s.v_)(J.getRoleName(J.userRole)),3)])]),(0,o.Lk)("div",C,[(0,o.bF)(K,{to:"/",onClick:t[7]||(t[7]=e=>J.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/"!==e.$route.path}]),"aria-current":"page"},{default:(0,o.k6)(()=>[...t[28]||(t[28]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})],-1),(0,o.eW)(" لوحة التحكم ",-1)])]),_:1},8,["class"]),J.canManageWarehouses?((0,o.uX)(),(0,o.Wv)(K,{key:0,to:"/warehouses",onClick:t[8]||(t[8]=e=>J.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":"/warehouses"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/warehouses"!==e.$route.path}])},{default:(0,o.k6)(()=>[...t[29]||(t[29]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1),(0,o.eW)(" إدارة المخازن ",-1)])]),_:1},8,["class"])):(0,o.Q3)("",!0),J.canManageUsers?((0,o.uX)(),(0,o.Wv)(K,{key:1,to:"/users",onClick:t[9]||(t[9]=e=>J.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/users"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/users"!==e.$route.path}])},{default:(0,o.k6)(()=>[...t[30]||(t[30]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})],-1),(0,o.eW)(" إدارة المستخدمين ",-1)])]),_:1},8,["class"])):(0,o.Q3)("",!0),J.canModifyItems?((0,o.uX)(),(0,o.CE)("div",P,[t[35]||(t[35]=(0,o.Lk)("p",{class:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2"}," إجراءات سريعة ",-1)),(0,o.Lk)("div",D,[(0,o.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>J.openAddItemModal&&J.openAddItemModal(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-yellow-600 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 transition-colors duration-200"},[...t[31]||(t[31]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),(0,o.eW)(" إضافة صنف جديد ",-1)])]),(0,o.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>J.openTransferModal&&J.openTransferModal(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors duration-200"},[...t[32]||(t[32]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1),(0,o.eW)(" نقل بين المخازن ",-1)])]),(0,o.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>J.openDispatchModal&&J.openDispatchModal(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-orange-600 dark:text-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors duration-200"},[...t[33]||(t[33]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),(0,o.eW)(" صرف إلى خارجي ",-1)])]),J.canManageWarehouses?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:t[13]||(t[13]=(...e)=>J.openAddWarehouseModal&&J.openAddWarehouseModal(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors duration-200"},[...t[34]||(t[34]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),(0,o.eW)(" إضافة مخزن جديد ",-1)])])):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),(0,o.bF)(K,{to:"/transactions",onClick:t[14]||(t[14]=e=>J.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/transactions"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/transactions"!==e.$route.path}])},{default:(0,o.k6)(()=>[...t[36]||(t[36]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),(0,o.eW)(" سجل الحركات ",-1)])]),_:1},8,["class"]),J.canViewReports?((0,o.uX)(),(0,o.Wv)(K,{key:3,to:"/reports",onClick:t[15]||(t[15]=e=>J.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/reports"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/reports"!==e.$route.path}])},{default:(0,o.k6)(()=>[...t[37]||(t[37]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),(0,o.eW)(" التقارير ",-1)])]),_:1},8,["class"])):(0,o.Q3)("",!0),(0,o.bF)(K,{to:"/profile",onClick:t[16]||(t[16]=e=>J.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/profile"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/profile"!==e.$route.path}])},{default:(0,o.k6)(()=>[...t[38]||(t[38]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),(0,o.eW)(" إعدادات الحساب ",-1)])]),_:1},8,["class"]),(0,o.Lk)("button",{onClick:t[17]||(t[17]=(...e)=>J.logout&&J.logout(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors duration-200"},[...t[39]||(t[39]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),(0,o.eW)(" تسجيل خروج ",-1)])])])])):(0,o.Q3)("",!0)]),J.dashboardStats&&"/"===e.$route.path?((0,o.uX)(),(0,o.CE)("div",M,[(0,o.Lk)("div",U,[(0,o.Lk)("div",W,[t[40]||(t[40]=(0,o.Lk)("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"الأصناف",-1)),(0,o.Lk)("div",H,(0,s.v_)(J.dashboardStats.totalItems||0),1)]),(0,o.Lk)("div",G,[t[41]||(t[41]=(0,o.Lk)("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"الكمية",-1)),(0,o.Lk)("div",F,(0,s.v_)(J.formatNumber(J.dashboardStats.totalQuantity)||0),1)]),(0,o.Lk)("div",j,[t[42]||(t[42]=(0,o.Lk)("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"قليلة",-1)),(0,o.Lk)("div",B,(0,s.v_)(J.dashboardStats.lowStockItems||0),1)]),(0,o.Lk)("div",q,[t[43]||(t[43]=(0,o.Lk)("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"الحركات",-1)),(0,o.Lk)("div",z,(0,s.v_)(J.dashboardStats.recentTransactions||0),1)])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",{class:(0,s.C4)(["flex-1 flex flex-col overflow-hidden",{"lg:pt-0":J.isAuthenticated}])},[(0,o.Lk)("div",{class:(0,s.C4)(["flex-1 overflow-y-auto",{"pt-[70px] lg:pt-0":J.isAuthenticated&&"/login"!==e.$route.path}])},[(0,o.bF)(Y)],2),J.isAuthenticated&&J.showBottomNav?((0,o.uX)(),(0,o.CE)("div",$,[(0,o.Lk)("div",Q,[(0,o.bF)(K,{to:"/",class:(0,s.C4)(["flex flex-col items-center p-2 flex-1 transition-colors duration-200",{"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg":"/"===e.$route.path}]),onClick:t[18]||(t[18]=e=>J.mobileMenuOpen=!1)},{default:(0,o.k6)(()=>[...t[44]||(t[44]=[(0,o.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})],-1),(0,o.Lk)("span",{class:"text-xs mt-1"},"الرئيسية",-1)])]),_:1},8,["class"]),J.canModifyItems?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:t[19]||(t[19]=(...e)=>J.openAddItemModal&&J.openAddItemModal(...e)),class:"flex flex-col items-center p-2 flex-1 text-yellow-600 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 rounded-lg transition-colors duration-200"},[...t[45]||(t[45]=[(0,o.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),(0,o.Lk)("span",{class:"text-xs mt-1"},"إضافة",-1)])])):(0,o.Q3)("",!0),(0,o.bF)(K,{to:"/transactions",class:(0,s.C4)(["flex flex-col items-center p-2 flex-1 transition-colors duration-200",{"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg":"/transactions"===e.$route.path}]),onClick:t[20]||(t[20]=e=>J.mobileMenuOpen=!1)},{default:(0,o.k6)(()=>[...t[46]||(t[46]=[(0,o.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),(0,o.Lk)("span",{class:"text-xs mt-1"},"الحركات",-1)])]),_:1},8,["class"]),(0,o.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>J.toggleProfileMenu&&J.toggleProfileMenu(...e)),class:(0,s.C4)(["flex flex-col items-center p-2 flex-1 transition-colors duration-200",{"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg":J.profileMenuOpen}])},[...t[47]||(t[47]=[(0,o.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),(0,o.Lk)("span",{class:"text-xs mt-1"},"حسابي",-1)])],2)])])):(0,o.Q3)("",!0)],2)],64))]))])}var V=r(953),X=r(278),Y=r(499),K=r(543),Z={name:"App",setup(){const e=(0,X.Pj)(),t=(0,Y.lq)(),r=(0,Y.rd)(),a=(0,V.KR)(!0),s=(0,V.KR)(!1),n=(0,V.KR)(!1),i=(0,V.KR)(!1),c=(0,V.KR)(""),l=(0,o.EW)(()=>e.getters.isAuthenticated),u=(0,o.EW)(()=>{const e=["Login","Unauthorized","NotFound"];return e.includes(t.name)}),d=(0,o.EW)(()=>{const e=["/login","/unauthorized","/notfound"];return!e.includes(t.path)&&l.value}),m=(0,o.EW)(()=>e.getters.userRole),h=(0,o.EW)(()=>e.state.userProfile),_=(0,o.EW)(()=>e.getters.dashboardStats),p=(0,o.EW)(()=>e.getters.dashboardStats?.lowStockItems||0),w=(0,o.EW)(()=>{const e=m.value,t=h.value;if("superadmin"===e)return!0;if("warehouse_manager"===e){const e=t?.allowed_warehouses?.length>0,r=t?.permissions?.includes("full_access")||t?.permissions?.includes("manage_inventory");return e&&r}return!1}),g=(0,o.EW)(()=>e.getters.canManageUsers),f=(0,o.EW)(()=>e.getters.canManageWarehouses),y=(0,o.EW)(()=>"superadmin"===e.getters.userRole||"company_manager"===e.getters.userRole),E=e=>{const t={superadmin:"المشرف العام",warehouse_manager:"مدير المخازن",company_manager:"مدير الشركة"};return t[e]||e},b=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"؟",v=(0,o.EW)(()=>{const e={superadmin:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white",warehouse_manager:"bg-gradient-to-r from-blue-500 to-cyan-500 text-white",company_manager:"bg-gradient-to-r from-green-500 to-emerald-500 text-white"};return e[m.value]||"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}),k=()=>{const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;"dark"===e||!e&&t?(i.value=!0,document.documentElement.classList.add("dark")):(i.value=!1,document.documentElement.classList.remove("dark"))},T=()=>{i.value=!i.value,i.value?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},R=()=>{s.value=!s.value,n.value&&(n.value=!1)},x=()=>{n.value=!n.value,s.value&&(s.value=!1)},N=()=>{r.push("/transactions"),s.value=!1},O=()=>{s.value=!1,window.dispatchEvent(new CustomEvent("open-add-item-modal"))},I=()=>{s.value=!1,window.dispatchEvent(new CustomEvent("open-transfer-modal"))},S=()=>{s.value=!1,window.dispatchEvent(new CustomEvent("open-dispatch-modal"))},A=()=>{s.value=!1,window.dispatchEvent(new CustomEvent("open-add-warehouse-modal"))},L=(0,K.debounce)(()=>{window.dispatchEvent(new CustomEvent("mobile-search",{detail:{searchTerm:c.value}}))},300),C=()=>{"/"!==t.path&&r.push("/"),window.dispatchEvent(new CustomEvent("mobile-search",{detail:{searchTerm:c.value,immediate:!0}}))},P=e=>e||0===e?new Intl.NumberFormat("ar-EG").format(e):"0",D=async()=>{try{s.value=!1,n.value=!1,await e.dispatch("logout"),r.push("/login")}catch(t){console.error("Logout error:",t),r.push("/login")}};return(0,o.sV)(async()=>{try{await e.dispatch("initializeAuth"),e.getters.isAuthenticated&&await e.dispatch("loadWarehouses"),k(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||(e.matches?(document.documentElement.classList.add("dark"),i.value=!0):(document.documentElement.classList.remove("dark"),i.value=!1))}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(s.value=!1,n.value=!1)})}catch(t){console.error("App initialization error:",t)}finally{setTimeout(()=>{a.value=!1},300)}}),(0,o.wB)(()=>t.path,()=>{s.value=!1,n.value=!1}),{initializing:a,isAuthenticated:l,isPublicRoute:u,showBottomNav:d,mobileMenuOpen:s,profileMenuOpen:n,isDarkMode:i,mobileSearchTerm:c,notificationCount:p,dashboardStats:_,userRole:m,userProfile:h,canModifyItems:w,canManageUsers:g,canManageWarehouses:f,canViewReports:y,getRoleName:E,getUserInitials:b,roleBadgeClass:v,toggleDarkMode:T,toggleMobileMenu:R,toggleProfileMenu:x,showNotifications:N,openAddItemModal:O,openTransferModal:I,openDispatchModal:S,openAddWarehouseModal:A,handleMobileSearch:L,handleMobileSearchEnter:C,formatNumber:P,logout:D}}},ee=r(262);const te=(0,ee.A)(Z,[["render",J],["__scopeId","data-v-b4ea3480"]]);var re=te;const ae=[{path:"/login",name:"Login",component:()=>r.e(821).then(r.bind(r,821)),meta:{requiresGuest:!0,layout:"empty"}},{path:"/",name:"Dashboard",component:()=>Promise.all([r.e(502),r.e(217),r.e(727),r.e(808),r.e(473),r.e(696),r.e(962)]).then(r.bind(r,471)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager","warehouse_manager"]}},{path:"/warehouses",name:"Warehouses",component:()=>Promise.all([r.e(727),r.e(473),r.e(563)]).then(r.bind(r,473)),meta:{requiresAuth:!0,allowedRoles:["superadmin"]}},{path:"/users",name:"Users",component:()=>Promise.all([r.e(727),r.e(808),r.e(76)]).then(r.bind(r,808)),meta:{requiresAuth:!0,allowedRoles:["superadmin"]}},{path:"/inventory",name:"Inventory",component:()=>Promise.all([r.e(96),r.e(502),r.e(217),r.e(696),r.e(848)]).then(r.bind(r,296)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager","warehouse_manager"],permissions:{company_manager:"viewer",warehouse_manager:"full_access"}}},{path:"/inventory/add",name:"AddInventory",component:()=>Promise.all([r.e(96),r.e(502),r.e(217),r.e(696),r.e(848)]).then(r.bind(r,296)),meta:{requiresAuth:!0,allowedRoles:["superadmin","warehouse_manager"],permissions:{company_manager:"none",warehouse_manager:"full_access"}}},{path:"/inventory/edit/:id",name:"EditInventory",component:()=>Promise.all([r.e(96),r.e(502),r.e(217),r.e(696),r.e(848)]).then(r.bind(r,296)),meta:{requiresAuth:!0,allowedRoles:["superadmin","warehouse_manager"],permissions:{company_manager:"none",warehouse_manager:"full_access"}}},{path:"/transfers",name:"Transfers",component:()=>Promise.all([r.e(502),r.e(513)]).then(r.bind(r,287)),meta:{requiresAuth:!0,allowedRoles:["superadmin","warehouse_manager"],permissions:{company_manager:"none",warehouse_manager:"full_access"}}},{path:"/dispatch",name:"Dispatch",component:()=>Promise.all([r.e(217),r.e(569)]).then(r.bind(r,877)),meta:{requiresAuth:!0,allowedRoles:["superadmin","warehouse_manager"],permissions:{company_manager:"none",warehouse_manager:"full_access"}}},{path:"/transactions",name:"Transactions",component:()=>r.e(989).then(r.bind(r,989)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager","warehouse_manager"],permissions:{company_manager:"viewer",warehouse_manager:"viewer"}}},{path:"/reports",name:"Reports",component:()=>r.e(621).then(r.bind(r,621)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager"],permissions:{company_manager:"viewer",warehouse_manager:"none"}}},{path:"/profile",name:"Profile",component:()=>r.e(630).then(r.bind(r,630)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager","warehouse_manager"]}},{path:"/unauthorized",name:"Unauthorized",component:{template:'\n        <div class="min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center px-4">\n          <div class="text-center">\n            <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full mb-6">\n              <svg class="w-8 h-8 text-red-600 dark:text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m0 0v2m0-2h2m-2 0H9m3-6a3 3 0 110-6 3 3 0 010 6zm2 7a9 9 0 11-18 0 9 9 0 0118 0z"/>\n              </svg>\n            </div>\n            <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">صلاحية مرفوضة</h1>\n            <p class="text-xl text-gray-600 dark:text-gray-400 mb-8">\n              ليس لديك الصلاحية للوصول إلى هذه الصفحة\n            </p>\n            <router-link to="/" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200">\n              العودة للرئيسية\n            </router-link>\n          </div>\n        </div>\n      '},meta:{layout:"empty"}},{path:"/:pathMatch(.*)*",name:"NotFound",component:{template:'\n        <div class="min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center px-4">\n          <div class="text-center">\n            <h1 class="text-6xl font-bold text-gray-900 dark:text-white mb-4">404</h1>\n            <p class="text-xl text-gray-600 dark:text-gray-400 mb-8">\n              الصفحة غير موجودة\n            </p>\n            <router-link to="/" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200">\n              العودة للرئيسية\n            </router-link>\n          </div>\n        </div>\n      '},meta:{layout:"empty"}}],oe=(0,Y.aE)({history:(0,Y.LA)(),routes:ae}),se=(e,t)=>{if(!t.allowedRoles)return!0;if(!t.allowedRoles.includes(e))return!1;if(t.permissions){const r=t.permissions[e];if("none"===r)return!1}return!0},ne=(e,t)=>{if("warehouse_manager"!==e?.role)return!0;const r=e?.allowed_warehouses||[];return!t?.includes("Inventory")||0!==r.length};oe.beforeEach((e,t,r)=>{const a=(0,X.Pj)(),o=a.state.user,s=a.state.userProfile,n=null===t.name||void 0===t.name;if(n&&"/login"===e.path)r();else if(!e.meta.requiresAuth||o){if(e.meta.requiresGuest&&o)return e.path,void r("/");if(o&&s){const t=s.role;if(e.meta.allowedRoles){if(!se(t,e.meta))return void r("/unauthorized");if(!ne(s,e.name))return void r("/unauthorized")}}r()}else"/login"!==e.path?r("/login"):r()}),oe.onError(e=>{console.error("Router error:",e),e.message.includes("redirected")&&(window.location.href="/login")});var ie=oe,ce=r(556),le=r(496),ue=r(884),de=r(62),me=r(203);const he={arabicToEnglish:{"الاسم":"name","الكود":"code","اللون":"color","المخزن_id":"warehouse_id","المخزن":"warehouse_id","عدد_الكراتين":"cartons_count","عدد_في_الكرتونه":"per_carton_count","عدد_القزاز_الفردي":"single_bottles_count","الكميه_المضافه":"total_added","الكميه_المتبقيه":"remaining_quantity","المورد":"supplier","مكان_الصنف":"item_location"},englishToArabic:de.XY};var _e=(0,X.y$)({state:{user:null,userProfile:null,loading:!1,warehouses:[],warehousesLoaded:!1,inventory:[],transactions:[],itemHistory:[],filters:{warehouse:"",search:""},authError:null,operationLoading:!1,operationError:null,fieldMappings:he,notifications:[],unsubscribeInventory:null,unsubscribeTransactions:null,unsubscribeWarehouses:null,recentTransactions:[],recentTransactionsLoading:!1},mutations:{SET_USER(e,t){e.user=t},SET_USER_PROFILE(e,t){e.userProfile=t},SET_LOADING(e,t){e.loading=t},SET_OPERATION_LOADING(e,t){e.operationLoading=t},SET_OPERATION_ERROR(e,t){e.operationError=t},SET_WAREHOUSES(e,t){e.warehouses=t},SET_WAREHOUSES_LOADED(e,t){e.warehousesLoaded=t},SET_INVENTORY(e,t){e.inventory=t},SET_TRANSACTIONS(e,t){e.transactions=t},SET_ITEM_HISTORY(e,t){e.itemHistory=t},SET_FILTERS(e,t){e.filters={...e.filters,...t}},ADD_ITEM(e,t){e.inventory.push(t)},UPDATE_ITEM(e,t){const r=e.inventory.findIndex(e=>e.id===t.id);-1!==r&&e.inventory.splice(r,1,t)},REMOVE_ITEM(e,t){e.inventory=e.inventory.filter(e=>e.id!==t)},SET_AUTH_ERROR(e,t){e.authError=t},CLEAR_OPERATION_ERROR(e){e.operationError=null},ADD_NOTIFICATION(e,t){t.id=Date.now().toString(),t.timestamp=new Date,e.notifications.push(t),setTimeout(()=>{const r=e.notifications.findIndex(e=>e.id===t.id);-1!==r&&e.notifications.splice(r,1)},5e3)},REMOVE_NOTIFICATION(e,t){e.notifications=e.notifications.filter(e=>e.id!==t)},CLEAR_NOTIFICATIONS(e){e.notifications=[]},SET_UNSUBSCRIBE_INVENTORY(e,t){e.unsubscribeInventory&&e.unsubscribeInventory(),e.unsubscribeInventory=t},SET_UNSUBSCRIBE_TRANSACTIONS(e,t){e.unsubscribeTransactions&&e.unsubscribeTransactions(),e.unsubscribeTransactions=t},SET_UNSUBSCRIBE_WAREHOUSES(e,t){e.unsubscribeWarehouses&&e.unsubscribeWarehouses(),e.unsubscribeWarehouses=t},CLEAR_UNSUBSCRIBERS(e){e.unsubscribeInventory&&(e.unsubscribeInventory(),e.unsubscribeInventory=null),e.unsubscribeTransactions&&(e.unsubscribeTransactions(),e.unsubscribeTransactions=null),e.unsubscribeWarehouses&&(e.unsubscribeWarehouses(),e.unsubscribeWarehouses=null)},SET_RECENT_TRANSACTIONS(e,t){e.recentTransactions=t},SET_RECENT_TRANSACTIONS_LOADING(e,t){e.recentTransactionsLoading=t},ADD_RECENT_TRANSACTION(e,t){e.recentTransactions.unshift(t),e.recentTransactions.length>50&&(e.recentTransactions=e.recentTransactions.slice(0,50))}},actions:{showNotification({commit:e,getters:t},r){if(!r||!r.message)return void console.warn("Invalid notification:",r);const a={type:"info",title:"",message:"",duration:5e3},o={...a,...r};e("ADD_NOTIFICATION",o),console.log(`[Notification:${o.type}] ${o.title||""}: ${o.message}`),"error"===o.type&&console.error("Notification Error:",o.message)},async initializeAuth({commit:e,dispatch:t}){return new Promise(r=>{(0,le.hg)(ce.j2,async a=>{if(a){e("SET_USER",a);try{const r=await(0,ue.x7)((0,ue.H9)(ce.db,"users",a.uid));if(r.exists()){const a=r.data();e("SET_USER_PROFILE",a),console.log("User profile loaded:",a.role,a.allowed_warehouses),await t("loadWarehouses"),t("subscribeToInventory"),t("subscribeToTransactions")}else console.log("User document not found, creating default profile..."),await t("createUserProfile",a)}catch(o){console.error("Error loading user profile:",o),e("SET_AUTH_ERROR","فشل في تحميل بيانات المستخدم")}}else e("SET_USER",null),e("SET_USER_PROFILE",null),e("SET_INVENTORY",[]),e("SET_TRANSACTIONS",[]),e("SET_ITEM_HISTORY",[]),e("SET_RECENT_TRANSACTIONS",[]),e("SET_WAREHOUSES_LOADED",!1),e("CLEAR_UNSUBSCRIBERS");r()})})},async createUserProfile({commit:e,dispatch:t},r){try{let a={email:r.email,role:"company_manager",name:r.email.split("@")[0],allowed_warehouses:[],permissions:["view_reports"],created_at:new Date};"superadmin@monofia.com"===r.email?a={...a,role:"superadmin",name:"المشرف العام",allowed_warehouses:["main_warehouse","tera_warehouse","shobeen_warehouse","hyper_warehouse","matbaa_warehouse","ghabashi_warehouse","factory","zahra"],permissions:["all"]}:"warehouse@monofia.com"===r.email?a={...a,role:"warehouse_manager",name:"مدير المخازن",allowed_warehouses:["main_warehouse","tera_warehouse","shobeen_warehouse","hyper_warehouse"],permissions:["full_access","manage_inventory","create_transfers","dispatch_items","view_reports","delete_items","update_items"]}:"company@monofia.com"===r.email&&(a={...a,role:"company_manager",name:"مدير الشركة",allowed_warehouses:["main_warehouse","tera_warehouse","shobeen_warehouse","hyper_warehouse","matbaa_warehouse","ghabashi_warehouse"],permissions:["view_reports","export_data"]}),await(0,ue.BN)((0,ue.H9)(ce.db,"users",r.uid),a),e("SET_USER_PROFILE",a),t("showNotification",{type:"success",message:`مرحباً ${a.name}! تم إنشاء حسابك بنجاح.`}),await t("loadWarehouses")}catch(a){throw console.error("Error creating user profile:",a),t("showNotification",{type:"error",message:"خطأ في إنشاء حساب المستخدم"}),a}},async login({commit:e,dispatch:t},{email:r,password:a}){e("SET_LOADING",!0),e("SET_AUTH_ERROR",null);try{console.log("Attempting login with:",r);const o=await(0,le.x9)(ce.j2,r,a),s=o.user;console.log("Login successful, user:",s.uid);const n=await(0,ue.x7)((0,ue.H9)(ce.db,"users",s.uid));if(n.exists()){const r=n.data();e("SET_USER_PROFILE",r),console.log("User profile loaded:",r.role,r.allowed_warehouses),t("showNotification",{type:"success",message:`مرحباً ${r.name}! تم تسجيل الدخول بنجاح.`}),await t("loadWarehouses"),t("subscribeToInventory"),t("subscribeToTransactions"),t("getRecentTransactions")}else console.log("Creating new user profile..."),await t("createUserProfile",s);return e("SET_USER",s),s}catch(o){console.error("Login error details:",o);const r=pe(o.code);throw e("SET_AUTH_ERROR",r),t("showNotification",{type:"error",message:r}),new Error(r)}finally{e("SET_LOADING",!1)}},async logout({commit:e,dispatch:t}){try{await(0,le.CI)(ce.j2),e("SET_USER",null),e("SET_USER_PROFILE",null),e("SET_INVENTORY",[]),e("SET_TRANSACTIONS",[]),e("SET_ITEM_HISTORY",[]),e("SET_RECENT_TRANSACTIONS",[]),e("SET_AUTH_ERROR",null),e("SET_OPERATION_ERROR",null),e("SET_WAREHOUSES_LOADED",!1),e("CLEAR_UNSUBSCRIBERS"),t("showNotification",{type:"info",message:"تم تسجيل الخروج بنجاح"})}catch(r){throw console.error("Logout error:",r),t("showNotification",{type:"error",message:"خطأ في تسجيل الخروج"}),r}},async loadWarehouses({commit:e,dispatch:t,state:r}){try{if(r.warehousesLoaded)return void console.log("Warehouses already loaded, skipping...");console.log("Loading warehouses from Firestore..."),await t("initializeDefaultWarehouses"),await t("subscribeToWarehouses"),e("SET_WAREHOUSES_LOADED",!0),console.log("Warehouses loaded successfully")}catch(a){console.error("Error loading warehouses:",a),t("showNotification",{type:"error",message:"خطأ في تحميل المخازن"}),e("SET_WAREHOUSES_LOADED",!1)}},async subscribeToWarehouses({commit:e,state:t,dispatch:r}){if(t.unsubscribeWarehouses&&t.unsubscribeWarehouses(),t.userProfile){console.log("Subscribing to warehouses...");try{let a;if("superadmin"===t.userProfile.role)a=(0,ue.P)((0,ue.rJ)(ce.db,"warehouses"),(0,ue.My)("name_ar"));else if("warehouse_manager"===t.userProfile.role){const r=t.userProfile.allowed_warehouses||[];if(r.length>0){const t=r.slice(0,10),a=(0,ue.P)((0,ue.rJ)(ce.db,"warehouses"),(0,ue._M)("id","in",t)),o=(0,ue.P)((0,ue.rJ)(ce.db,"warehouses"),(0,ue._M)("type","==","dispatch")),[s,n]=await Promise.all([(0,ue.GG)(a),(0,ue.GG)(o)]),i=[...s.docs.map(e=>({id:e.id,...e.data()})),...n.docs.map(e=>({id:e.id,...e.data()}))],c=Array.from(new Map(i.map(e=>[e.id,e])).values());return void e("SET_WAREHOUSES",c)}a=(0,ue.P)((0,ue.rJ)(ce.db,"warehouses"),(0,ue._M)("type","==","dispatch"))}else{if("company_manager"!==t.userProfile.role)return void e("SET_WAREHOUSES",[]);a=(0,ue.P)((0,ue.rJ)(ce.db,"warehouses"),(0,ue.My)("name_ar"))}const o=(0,ue.aQ)(a,t=>{console.log("Warehouses snapshot received:",t.size,"warehouses");const r=t.docs.map(e=>({id:e.id,...e.data()}));console.log("Warehouses loaded:",r.length),e("SET_WAREHOUSES",r)},e=>{console.error("Error in warehouses subscription:",e),r("showNotification",{type:"error",message:"خطأ في تحديث بيانات المخازن"})});e("SET_UNSUBSCRIBE_WAREHOUSES",o)}catch(a){console.error("Error setting up warehouses subscription:",a),r("showNotification",{type:"error",message:"خطأ في إعداد اشتراك المخازن"})}}else console.log("Cannot subscribe to warehouses: User not authenticated")},async initializeDefaultWarehouses({commit:e,dispatch:t}){try{console.log("Checking/initializing default warehouses...");const e=[{id:"main_warehouse",name_ar:"مخزن شارع الشيخ",name_en:"Main Warehouse",type:"primary",is_main:!0,status:"active",capacity:1e3,location:"شارع الشيخ، المنوفية",created_at:new Date,updated_at:new Date},{id:"tera_warehouse",name_ar:"مخزن الترعه",name_en:"Teraa Warehouse",type:"primary",status:"active",capacity:800,location:"الترعة، المنوفية",created_at:new Date,updated_at:new Date},{id:"shobeen_warehouse",name_ar:"مخزن موقف شبين",name_en:"Shobeen Warehouse",type:"primary",status:"active",capacity:600,location:"موقف شبين، المنوفية",created_at:new Date,updated_at:new Date},{id:"hyper_warehouse",name_ar:"مخزن هايبر التهامي",name_en:"Hyper El Tahamy Warehouse",type:"primary",status:"active",capacity:500,location:"هايبر التهامي، المنوفية",created_at:new Date,updated_at:new Date},{id:"matbaa_warehouse",name_ar:"مخزن المطبعه",name_en:"Matbaa Warehouse",type:"primary",status:"active",capacity:400,location:"المطبعة، المنوفية",created_at:new Date,updated_at:new Date},{id:"ghabashi_warehouse",name_ar:"مخزن الغباشي",name_en:"Ghabashi Warehouse",type:"primary",status:"active",capacity:300,location:"الغباشي، المنوفية",created_at:new Date,updated_at:new Date},{id:"factory",name_ar:"صرف الي مصنع البران",name_en:"Al Bran Factory Dispatch",type:"dispatch",status:"active",description:"مصنع البران للتصنيع",created_at:new Date,updated_at:new Date},{id:"zahra",name_ar:"صرف الي مخزن الزهراء",name_en:"Al Zahra Warehouse Dispatch",type:"dispatch",status:"active",description:"مخزن الزهراء للتوزيع",created_at:new Date,updated_at:new Date}],r=(0,ue.wP)(ce.db);let a=!1;for(const t of e){const e=(0,ue.H9)(ce.db,"warehouses",t.id),o=await(0,ue.x7)(e);o.exists()||(a=!0,r.set(e,t),console.log(`Adding warehouse: ${t.name_ar}`))}a?(await r.commit(),console.log("Default warehouses initialized successfully"),t("showNotification",{type:"success",message:"تم تهيئة المخازن الافتراضية"})):console.log("Warehouses already exist, skipping initialization")}catch(r){throw console.error("Error initializing default warehouses:",r),t("showNotification",{type:"error",message:"خطأ في تهيئة المخازن الافتراضية"}),r}},async createWarehouse({commit:e,dispatch:t,getters:r},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لإضافة مخازن");if(!a.id?.trim()||!a.name_ar?.trim())throw new Error("المعرف والاسم العربي للمخزن مطلوبان");const e={id:a.id.trim(),name_ar:a.name_ar.trim(),name_en:a.name_en?.trim()||a.name_ar.trim(),type:a.type||"primary",status:a.status||"active",capacity:Number(a.capacity)||0,location:a.location?.trim()||"",description:a.description?.trim()||"",is_main:a.is_main||!1,created_at:new Date,updated_at:new Date},o=(0,ue.H9)(ce.db,"warehouses",e.id),s=await(0,ue.x7)(o);if(s.exists())throw new Error("المخزن موجود بالفعل");return await(0,ue.BN)(o,e),console.log("Warehouse created successfully:",e.id),t("showNotification",{type:"success",message:`تم إنشاء المخزن "${e.name_ar}" بنجاح`}),{success:!0,id:e.id,data:e}}catch(o){return console.error("Error creating warehouse:",o),e("SET_OPERATION_ERROR",o.message),t("showNotification",{type:"error",message:o.message||"حدث خطأ في إنشاء المخزن"}),{success:!1,error:o.message}}finally{e("SET_OPERATION_LOADING",!1)}},async updateWarehouse({commit:e,dispatch:t,getters:r},{warehouseId:a,warehouseData:o}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لتحديث المخازن");const e=(0,ue.H9)(ce.db,"warehouses",a),s=await(0,ue.x7)(e);if(!s.exists())throw new Error("المخزن غير موجود");const n={updated_at:new Date,...o};return n.name_ar&&(n.name_ar=n.name_ar.trim()),n.name_en&&(n.name_en=n.name_en.trim()),n.location&&(n.location=n.location.trim()),n.description&&(n.description=n.description.trim()),await(0,ue.mZ)(e,n),console.log("Warehouse updated successfully:",a),t("showNotification",{type:"success",message:"تم تحديث بيانات المخزن بنجاح"}),{success:!0,id:a}}catch(s){return console.error("Error updating warehouse:",s),e("SET_OPERATION_ERROR",s.message),t("showNotification",{type:"error",message:s.message||"حدث خطأ في تحديث المخزن"}),{success:!1,error:s.message}}finally{e("SET_OPERATION_LOADING",!1)}},async deleteWarehouse({commit:e,dispatch:t,getters:r},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لحذف المخازن");const e=(0,ue.H9)(ce.db,"warehouses",a),o=await(0,ue.x7)(e);if(!o.exists())throw new Error("المخزن غير موجود");const s=(0,ue.P)((0,ue.rJ)(ce.db,"items"),(0,ue._M)("warehouse_id","==",a),(0,ue.AB)(1)),n=await(0,ue.GG)(s);if(!n.empty)throw new Error("لا يمكن حذف مخزن يحتوي على أصناف");return await(0,ue.kd)(e),console.log("Warehouse deleted successfully:",a),t("showNotification",{type:"success",message:"تم حذف المخزن بنجاح"}),{success:!0,id:a}}catch(o){return console.error("Error deleting warehouse:",o),e("SET_OPERATION_ERROR",o.message),t("showNotification",{type:"error",message:o.message||"حدث خطأ في حذف المخزن"}),{success:!1,error:o.message}}finally{e("SET_OPERATION_LOADING",!1)}},async getWarehouseStats({commit:e,dispatch:t,getters:r}){try{if(!r.canManageUsers&&"company_manager"!==r.userRole)throw new Error("ليس لديك صلاحية لعرض إحصائيات المخازن");const e=r.accessibleWarehouses,t=state.inventory,a=e.map(e=>{const r=t.filter(t=>t.warehouse_id===e.id),a=r.length,o=r.reduce((e,t)=>e+(t.remaining_quantity||0),0),s=r.filter(e=>(e.remaining_quantity||0)<10).length;return{warehouse_id:e.id,warehouse_name:e.name_ar,total_items:a,total_quantity:o,low_stock_items:s}});return a}catch(a){return console.error("Error getting warehouse stats:",a),t("showNotification",{type:"error",message:a.message||"حدث خطأ في تحميل إحصائيات المخازن"}),[]}},async loadAllUsers({commit:e,dispatch:t,getters:r}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لعرض المستخدمين");const e=await me.A.getUsers();if(e.success)return e.data;throw new Error(e.error||"فشل في تحميل المستخدمين")}catch(a){throw console.error("Error loading users:",a),e("SET_OPERATION_ERROR",a.message),t("showNotification",{type:"error",message:a.message||"حدث خطأ في تحميل المستخدمين"}),a}finally{e("SET_OPERATION_LOADING",!1)}},async createUser({commit:e,dispatch:t,getters:r},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لإضافة مستخدمين");const e=await me.A.createUser(a);if(e.success)return t("showNotification",{type:"success",message:e.message||"تم إضافة المستخدم بنجاح"}),{success:!0,data:e.data,message:e.message};throw new Error(e.error||"فشل في إنشاء المستخدم")}catch(o){return console.error("Error creating user:",o),e("SET_OPERATION_ERROR",o.message),t("showNotification",{type:"error",message:o.message||"حدث خطأ في إضافة المستخدم"}),{success:!1,error:o.message}}finally{e("SET_OPERATION_LOADING",!1)}},async updateUser({commit:e,dispatch:t,getters:r},{userId:a,userData:o}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لتحديث المستخدمين");const e=await me.A.updateUser(a,o);if(e.success)return t("showNotification",{type:"success",message:e.message||"تم تحديث المستخدم بنجاح"}),{success:!0,data:e.data,message:e.message};throw new Error(e.error||"فشل في تحديث المستخدم")}catch(s){return console.error("Error updating user:",s),e("SET_OPERATION_ERROR",s.message),t("showNotification",{type:"error",message:s.message||"حدث خطأ في تحديث المستخدم"}),{success:!1,error:s.message}}finally{e("SET_OPERATION_LOADING",!1)}},async deleteUser({commit:e,dispatch:t,getters:r},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لحذف المستخدمين");const e=await me.A.deleteUser(a);if(e.success)return t("showNotification",{type:"success",message:e.message||"تم حذف المستخدم بنجاح"}),{success:!0,message:e.message};throw new Error(e.error||"فشل في حذف المستخدم")}catch(o){return console.error("Error deleting user:",o),e("SET_OPERATION_ERROR",o.message),t("showNotification",{type:"error",message:o.message||"حدث خطأ في حذف المستخدم"}),{success:!1,error:o.message}}finally{e("SET_OPERATION_LOADING",!1)}},async updateUserStatus({commit:e,dispatch:t,getters:r},{userId:a,isActive:o}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لتغيير حالة المستخدمين");const e=await me.A.updateUserStatus(a,o);if(e.success)return t("showNotification",{type:"success",message:e.message||`تم ${o?"تفعيل":"تعطيل"} المستخدم بنجاح`}),{success:!0,message:e.message};throw new Error(e.error||"فشل في تغيير حالة المستخدم")}catch(s){return console.error("Error updating user status:",s),e("SET_OPERATION_ERROR",s.message),t("showNotification",{type:"error",message:s.message||"حدث خطأ في تغيير حالة المستخدم"}),{success:!1,error:s.message}}finally{e("SET_OPERATION_LOADING",!1)}},async getUserStats({commit:e,dispatch:t,getters:r}){try{if(!r.canManageUsers)throw new Error("ليس لديك صلاحية لعرض إحصائيات المستخدمين");const e=await me.A.getUserStats();if(e.success)return e.data;throw new Error(e.error||"فشل في تحميل إحصائيات المستخدمين")}catch(a){throw console.error("Error loading user stats:",a),t("showNotification",{type:"error",message:a.message||"حدث خطأ في تحميل إحصائيات المستخدمين"}),a}},subscribeToInventory({commit:e,state:t,dispatch:r}){if(t.unsubscribeInventory&&t.unsubscribeInventory(),t.userProfile){console.log("Subscribing to inventory for user role:",t.userProfile.role),console.log("Allowed warehouses:",t.userProfile.allowed_warehouses);try{let a;const o=(0,ue.rJ)(ce.db,"items");if("superadmin"===t.userProfile.role)a=(0,ue.P)(o);else if("company_manager"===t.userProfile.role)a=(0,ue.P)(o);else{if("warehouse_manager"!==t.userProfile.role)return console.log("User role not authorized for inventory access"),void e("SET_INVENTORY",[]);{const r=t.userProfile.allowed_warehouses||[];if(0===r.length)return console.log("No warehouses assigned to this warehouse manager"),void e("SET_INVENTORY",[]);a=r.includes("all")?(0,ue.P)(o):r.length<=10?(0,ue.P)(o,(0,ue._M)("warehouse_id","in",r)):(0,ue.P)(o)}}const s=(0,ue.aQ)(a,r=>{console.log("Inventory snapshot received:",r.size,"items");const a=r.docs.map(e=>{const t=e.data();return de.cE.convertForDisplay({id:e.id,...t})});let o=a;if("warehouse_manager"===t.userProfile.role){const e=t.userProfile.allowed_warehouses||[];e.length>0&&!e.includes("all")&&(o=a.filter(t=>e.includes(t.warehouse_id)))}console.log("Inventory loaded:",o.length,"items"),e("SET_INVENTORY",o)},t=>{console.error("Error in inventory subscription:",t),r("showNotification",{type:"error",message:"خطأ في تحميل المخزون"}),e("SET_INVENTORY",[])});e("SET_UNSUBSCRIBE_INVENTORY",s)}catch(a){console.error("Error setting up inventory subscription:",a),r("showNotification",{type:"error",message:"خطأ في إعداد اشتراك المخزون"}),e("SET_INVENTORY",[])}}else console.log("Cannot subscribe to inventory: User not authenticated")},subscribeToTransactions({commit:e,state:t,dispatch:r}){if(t.unsubscribeTransactions&&t.unsubscribeTransactions(),t.userProfile){console.log("Subscribing to transactions...");try{const t=(0,ue.P)((0,ue.rJ)(ce.db,"transactions"),(0,ue.My)("timestamp","desc")),a=(0,ue.aQ)(t,t=>{console.log("Transactions snapshot received:",t.size,"transactions");const r=t.docs.map(e=>{const t=e.data();return{id:e.id,...t,_display:{from_warehouse:de.Qi[t.from_warehouse]||t.from_warehouse,to_warehouse:de.Qi[t.to_warehouse]||de.VX[t.to_warehouse]||t.to_warehouse}}});console.log("Transactions loaded:",r.length,"transactions"),e("SET_TRANSACTIONS",r)},t=>{console.error("Error in transactions subscription:",t),r("showNotification",{type:"error",message:"خطأ في تحميل الحركات"}),e("SET_TRANSACTIONS",[])});e("SET_UNSUBSCRIBE_TRANSACTIONS",a)}catch(a){console.error("Error setting up transactions subscription:",a),e("SET_TRANSACTIONS",[])}}else console.log("Cannot subscribe to transactions: User not authenticated")},async getRecentTransactions({commit:e,dispatch:t,state:r}){e("SET_RECENT_TRANSACTIONS_LOADING",!0);try{if(!r.userProfile)return console.log("Cannot load recent transactions: User not authenticated"),[];console.log("Loading recent transactions...");const t=new Date(Date.now()-864e5),a=(0,ue.P)((0,ue.rJ)(ce.db,"transactions"),(0,ue._M)("timestamp",">=",t),(0,ue.My)("timestamp","desc"),(0,ue.AB)(20)),o=await(0,ue.GG)(a),s=o.docs.map(e=>{const t=e.data();return{id:e.id,...t,_display:{from_warehouse:de.Qi[t.from_warehouse]||t.from_warehouse,to_warehouse:de.Qi[t.to_warehouse]||de.VX[t.to_warehouse]||t.to_warehouse}}});return console.log("Recent transactions loaded:",s.length),e("SET_RECENT_TRANSACTIONS",s),s}catch(a){return console.error("Error loading recent transactions:",a),t("showNotification",{type:"error",message:"خطأ في تحميل الحركات الحديثة"}),[]}finally{e("SET_RECENT_TRANSACTIONS_LOADING",!1)}},clearOperationError({commit:e}){e("CLEAR_OPERATION_ERROR")},async checkExistingItem({commit:e,dispatch:t,state:r},{code:a,color:o,name:s,warehouse_id:n}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.userProfile)throw new Error("يجب تسجيل الدخول أولاً");if(!r.user?.uid)throw new Error("معرف المستخدم غير متوفر");if(!a?.trim()||!o?.trim()||!s?.trim()||!n)throw new Error("جميع الحقول المطلوبة للبحث عن الصنف يجب أن تكون مملوءة");const e=a.trim(),t=o.trim(),i=s.trim();console.log("Checking existing item with:",{cleanCode:e,cleanColor:t,cleanName:i,warehouse_id:n});const c=(0,ue.rJ)(ce.db,"items"),l=(0,ue.P)(c,(0,ue._M)("warehouse_id","==",n),(0,ue._M)("code","==",e),(0,ue._M)("color","==",t),(0,ue._M)("name","==",i)),u=await(0,ue.GG)(l);if(!u.empty){const e=u.docs[0],t={id:e.id,...e.data()};return console.log("Found existing item:",t.id),{exists:!0,item:de.cE.convertForDisplay(t)}}return console.log("No existing item found"),{exists:!1}}catch(i){console.error("Error checking existing item:",i);const r=i.message||"حدث خطأ في التحقق من وجود الصنف";throw e("SET_OPERATION_ERROR",r),t("showNotification",{type:"error",message:r}),i}finally{e("SET_OPERATION_LOADING",!1)}},async addInventoryItemAtomic({commit:e,dispatch:t,state:r},{itemData:a,userId:o,isAddingCartons:s=!0}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.userProfile)throw new Error("يجب تسجيل الدخول أولاً");if(!["superadmin","warehouse_manager"].includes(r.userProfile.role))throw new Error("ليس لديك صلاحية لإضافة أصناف");if(!o)throw new Error("معرف المستخدم غير متوفر");const n=["name","code","color","warehouse_id"];for(const e of n)if(!a[e]?.trim())throw new Error(`الحقل ${e} مطلوب`);const i={name:a.name.trim(),code:a.code.trim(),color:a.color.trim(),warehouse_id:a.warehouse_id,cartons_count:Number(a.cartons_count)||0,per_carton_count:Number(a.per_carton_count)||(s?12:1),single_bottles_count:Number(a.single_bottles_count)||0,supplier:a.supplier?.trim()||"",item_location:a.item_location?.trim()||"",notes:a.notes?.trim()||""};if(s){if(i.cartons_count<0)throw new Error("عدد الكراتين لا يمكن أن يكون سالباً");if(i.per_carton_count<1)throw new Error("عدد القطع في الكرتونة يجب أن يكون 1 على الأقل")}else if(i.single_bottles_count<0)throw new Error("عدد القزاز الفردي لا يمكن أن يكون سالباً");console.log("Performing atomic item operation with data:",i);const c=(0,ue.wP)(ce.db),l=new Date,u=(0,ue.rJ)(ce.db,"items"),d=(0,ue.P)(u,(0,ue._M)("warehouse_id","==",i.warehouse_id),(0,ue._M)("code","==",i.code),(0,ue._M)("color","==",i.color),(0,ue._M)("name","==",i.name)),m=await(0,ue.GG)(d);let h;if(m.empty){console.log("Creating new item");const e=i.cartons_count||0,t=i.per_carton_count||1,r=i.single_bottles_count||0,a=e*t+r;if(a<=0)throw new Error("يجب إدخال كمية صحيحة");const s={name:i.name,code:i.code,color:i.color,warehouse_id:i.warehouse_id,cartons_count:e,per_carton_count:t,single_bottles_count:r,total_added:a,remaining_quantity:a,supplier:i.supplier,item_location:i.item_location,notes:i.notes,created_at:l,created_by:o,updated_at:l,updated_by:o},n=(0,ue.H9)((0,ue.rJ)(ce.db,"items"));c.set(n,s);const u=(0,ue.H9)((0,ue.rJ)(ce.db,"transactions"));c.set(u,{item_id:n.id,from_warehouse:null,to_warehouse:i.warehouse_id,type:de.t2.ADD,cartons_delta:e,single_delta:r,per_carton_updated:t,previous_remaining:0,new_remaining:a,timestamp:l,user_id:o,notes:i.notes||"إنشاء صنف جديد",created_at:l}),h={type:"created",id:n.id,addedQuantity:a}}else{const e=m.docs[0],t=e.data();console.log("Updating existing item:",e.id);const r={updated_at:l,updated_by:o};let a=0;if(s){const e=t.cartons_count||0,o=i.cartons_count||0;r.cartons_count=e+o,void 0!==i.per_carton_count&&null!==i.per_carton_count&&i.per_carton_count>=1?r.per_carton_count=i.per_carton_count:r.per_carton_count=t.per_carton_count||1;const s=r.per_carton_count;a=o*s,r.single_bottles_count=t.single_bottles_count||0}else void 0!==i.single_bottles_count&&null!==i.single_bottles_count?(r.single_bottles_count=(t.single_bottles_count||0)+i.single_bottles_count,a=i.single_bottles_count):r.single_bottles_count=t.single_bottles_count||0,r.cartons_count=t.cartons_count||0,r.per_carton_count=t.per_carton_count||1;const n=t.total_added||0,u=t.remaining_quantity||0;if(r.total_added=n+a,r.remaining_quantity=u+a,void 0!==i.notes&&(r.notes=i.notes),void 0!==i.supplier&&(r.supplier=i.supplier),void 0!==i.item_location&&(r.item_location=i.item_location),r.remaining_quantity<0)throw new Error("الكمية المتبقية لا يمكن أن تكون سالبة");const d=(0,ue.H9)(ce.db,"items",e.id);c.update(d,r);const _=(0,ue.H9)((0,ue.rJ)(ce.db,"transactions"));c.set(_,{item_id:e.id,from_warehouse:null,to_warehouse:i.warehouse_id,type:de.t2.ADD,cartons_delta:s&&i.cartons_count||0,single_delta:s?0:i.single_bottles_count||0,per_carton_updated:i.per_carton_count,previous_remaining:u,new_remaining:r.remaining_quantity,timestamp:l,user_id:o,notes:i.notes||(s?"إضافة كراتين للمخزن":"إضافة قزاز فردي للمخزن"),created_at:l}),h={type:"updated",id:e.id,addedQuantity:a}}return await c.commit(),console.log(`Item ${h.type} successfully:`,h.id),e("ADD_RECENT_TRANSACTION",{type:de.t2.ADD,item_id:h.id,timestamp:l,notes:i.notes||"عملية إضافة"}),t("showNotification",{type:"success",message:`تم ${"created"===h.type?"إضافة":"تحديث"} الصنف "${i.name}" بنجاح`}),h}catch(n){console.error("Error in atomic item operation:",n);const r=n.message||"حدث خطأ غير متوقع أثناء إضافة الصنف";throw e("SET_OPERATION_ERROR",r),t("showNotification",{type:"error",message:r}),n}finally{e("SET_OPERATION_LOADING",!1)}},async addInventoryItem({commit:e,dispatch:t,state:r},{itemData:a,isAddingCartons:o=!0}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.userProfile)throw new Error("يجب تسجيل الدخول أولاً");if(!["superadmin","warehouse_manager"].includes(r.userProfile.role))throw new Error("ليس لديك صلاحية لإضافة أصناف");if(!r.user?.uid)throw new Error("معرف المستخدم غير متوفر");if(!a.name?.trim()||!a.code?.trim()||!a.color?.trim()||!a.warehouse_id)throw new Error("جميع الحقول المطلوبة يجب أن تكون مملوءة (الاسم، الكود، اللون، المخزن)");const s=de.cE.calculateTotalQuantity(a.cartons_count,a.per_carton_count,a.single_bottles_count);if(s<=0)throw new Error("يجب إدخال كمية صحيحة");const n={name:a.name.trim(),code:a.code.trim(),color:a.color.trim(),warehouse_id:a.warehouse_id,cartons_count:Number(a.cartons_count)||0,per_carton_count:Number(a.per_carton_count)||12,single_bottles_count:Number(a.single_bottles_count)||0,supplier:a.supplier?.trim()||"",item_location:a.item_location?.trim()||"",notes:a.notes?.trim()||""};console.log("Adding item with cleaned data:",n);const i=await de.cE.addOrUpdateItem(n,r.user.uid,o);return console.log(`Item ${i.type} successfully:`,i.id),e("ADD_RECENT_TRANSACTION",{type:de.t2.ADD,item_id:i.id,timestamp:new Date,notes:n.notes||"عملية إضافة"}),t("showNotification",{type:"success",message:`تم ${"created"===i.type?"إضافة":"تحديث"} الصنف "${n.name}" بنجاح`}),i}catch(s){console.error("Error adding inventory item:",s);const r=s.message||"حدث خطأ غير متوقع أثناء إضافة الصنف";throw e("SET_OPERATION_ERROR",r),t("showNotification",{type:"error",message:r}),s}finally{e("SET_OPERATION_LOADING",!1)}},async transferItem({commit:e,dispatch:t,state:r},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.userProfile)throw new Error("يجب تسجيل الدخول أولاً");if(!["superadmin","warehouse_manager"].includes(r.userProfile.role))throw new Error("ليس لديك صلاحية لنقل الأصناف");if(!r.user?.uid)throw new Error("معرف المستخدم غير متوفر");const o=await de.cE.transferItem(a,r.user.uid);return console.log("Transfer completed successfully:",o.transferQty),e("ADD_RECENT_TRANSACTION",{type:de.t2.TRANSFER,item_id:a.itemId,timestamp:new Date,notes:"نقل بين المخازن"}),t("showNotification",{type:"success",message:"تم نقل الصنف بنجاح"}),o}catch(o){throw console.error("Error transferring item:",o),e("SET_OPERATION_ERROR",o.message),t("showNotification",{type:"error",message:o.message||"حدث خطأ أثناء نقل الصنف"}),o}finally{e("SET_OPERATION_LOADING",!1)}},async dispatchItem({commit:e,dispatch:t,state:r},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!r.userProfile)throw new Error("يجب تسجيل الدخول أولاً");const o="superadmin"===r.userProfile.role||"warehouse_manager"===r.userProfile.role&&r.userProfile.permissions?.includes("dispatch_items");if(!o)throw new Error("ليس لديك صلاحية لصرف الأصناف");if(!r.user?.uid)throw new Error("معرف المستخدم غير متوفر");if("warehouse_manager"===r.userProfile.role){const e=r.userProfile.allowed_warehouses||[];if(!e.includes(a.from_warehouse_id))throw new Error("ليس لديك صلاحية للصرف من هذا المخزن")}const s=await de.cE.dispatchItem(a,r.user.uid);return console.log("Dispatch completed successfully:",s.dispatchQty),e("ADD_RECENT_TRANSACTION",{type:de.t2.DISPATCH,item_id:a.itemId,timestamp:new Date,notes:"صرف إلى خارجي"}),t("showNotification",{type:"success",message:"تم صرف الصنف بنجاح"}),s}catch(o){throw console.error("Error dispatching item:",o),e("SET_OPERATION_ERROR",o.message),t("showNotification",{type:"error",message:o.message||"حدث خطأ أثناء صرف الصنف"}),o}finally{e("SET_OPERATION_LOADING",!1)}},updateFilters({commit:e},t){e("SET_FILTERS",t)},removeNotification({commit:e},t){e("REMOVE_NOTIFICATION",t)},clearNotifications({commit:e}){e("CLEAR_NOTIFICATIONS")}},getters:{notifications:e=>e.notifications,recentTransactions:e=>e.recentTransactions,recentTransactionsLoading:e=>e.recentTransactionsLoading,isAuthenticated:e=>!!e.user,userRole:e=>e.userProfile?.role,userName:e=>e.userProfile?.name||e.userProfile?.email?.split("@")[0],allowedWarehouses:e=>e.userProfile?.allowed_warehouses||[],userPermissions:e=>e.userProfile?.permissions||[],authError:e=>e.authError,operationError:e=>e.operationError,operationLoading:e=>e.operationLoading,fieldMappings:e=>e.fieldMappings,warehousesLoaded:e=>e.warehousesLoaded,canEdit:(e,t)=>["superadmin","warehouse_manager"].includes(t.userRole),canDelete:(e,t)=>"superadmin"===t.userRole||"warehouse_manager"===t.userRole&&(t.userPermissions.includes("full_access")||t.userPermissions.includes("delete_items")),canManageUsers:e=>"superadmin"===e.userProfile?.role,canManageWarehouses:e=>"superadmin"===e.userProfile?.role,canDispatch:(e,t)=>"superadmin"===t.userRole||"warehouse_manager"===t.userRole&&t.userPermissions.includes("dispatch_items"),mainWarehouse:e=>e.warehouses.find(e=>e.is_main),primaryWarehouses:e=>e.warehouses.filter(e=>"primary"===e.type),dispatchWarehouses:e=>e.warehouses.filter(e=>"dispatch"===e.type),accessibleWarehouses:(e,t)=>{if(!e.warehousesLoaded)return[];if("superadmin"===t.userRole)return e.warehouses;if("warehouse_manager"===t.userRole){const r=t.allowedWarehouses;if(r&&r.length>0){const t=e.warehouses.filter(e=>"primary"===e.type&&r.includes(e.id)),a=e.warehouses.filter(e=>"dispatch"===e.type);return[...t,...a]}}return"company_manager"===t.userRole?e.warehouses:[]},accessiblePrimaryWarehouses:(e,t)=>{const r=t.accessibleWarehouses;return r.filter(e=>"primary"===e.type)},accessibleDispatchWarehouses:(e,t)=>{const r=t.accessibleWarehouses;return r.filter(e=>"dispatch"===e.type)},dispatchFromWarehouses:(e,t)=>{if(!e.warehousesLoaded)return[];if("superadmin"===t.userRole)return e.warehouses.filter(e=>"primary"===e.type);if("warehouse_manager"===t.userRole){const r=t.allowedWarehouses;if(r&&r.length>0)return e.warehouses.filter(e=>"primary"===e.type&&r.includes(e.id))}return[]},filteredInventory:e=>{let t=e.inventory;if("warehouse_manager"===e.userProfile?.role||"company_manager"===e.userProfile?.role){const r=e.userProfile.allowed_warehouses||[];r.length>0&&(t=t.filter(e=>r.includes(e.warehouse_id)))}if(e.filters.search){const r=e.filters.search.toLowerCase();t=t.filter(e=>e.name?.toLowerCase().includes(r)||e.code?.toLowerCase().includes(r)||e.color?.toLowerCase().includes(r)||e.supplier?.toLowerCase().includes(r))}return e.filters.warehouse&&(t=t.filter(t=>t.warehouse_id===e.filters.warehouse)),t},dashboardStats:e=>{let t=e.inventory;if("warehouse_manager"===e.userProfile?.role||"company_manager"===e.userProfile?.role){const r=e.userProfile.allowed_warehouses||[];r.length>0&&(t=t.filter(e=>r.includes(e.warehouse_id)))}const r=t.length,a=t.reduce((e,t)=>e+(t.remaining_quantity||0),0),o=t.filter(e=>(e.remaining_quantity||0)<10).length,s=e.recentTransactions.length;return{totalItems:r,totalQuantity:a,lowStockItems:o,recentTransactions:s}},getArabicLabel:e=>t=>e.fieldMappings.englishToArabic[t]||t,getWarehouseLabel:e=>t=>{if(!t)return"";const r=e.warehouses.find(e=>e.id===t);return r?r.name_ar||t:de.Qi[t]||t},getDestinationLabel:()=>e=>de.VX[e]||e,getWarehouseById:e=>t=>e.warehouses.find(e=>e.id===t)}});function pe(e){const t={"auth/invalid-email":"البريد الإلكتروني غير صحيح","auth/user-disabled":"هذا الحساب معطل","auth/user-not-found":"لا يوجد حساب بهذا البريد الإلكتروني","auth/wrong-password":"كلمة المرور غير صحيحة","auth/email-already-in-use":"هذا البريد الإلكتروني مستخدم بالفعل","auth/weak-password":"كلمة المرور ضعيفة","auth/network-request-failed":"خطأ في الاتصال بالشبكة. يرجى المحاولة مرة أخرى","auth/too-many-requests":"محاولات تسجيل دخول كثيرة. يرجى المحاولة لاحقاً","auth/configuration-not-found":"خطأ في إعدادات النظام. يرجى التواصل مع الدعم الفني"};return t[e]||"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى"}const we=(0,a.Ef)(re);we.use(_e),we.use(ie),we.mount("#app")},556:function(e,t,r){r.d(t,{db:function(){return u},j2:function(){return l}});var a=r(223),o=r(496),s=r(884),n=r(904);const i={apiKey:"AIzaSyDxpbXvFH6UvfE2I6OJ_wNFnA889Zu-NEQ",authDomain:"monofia-inventory.firebaseapp.com",projectId:"monofia-inventory",storageBucket:"monofia-inventory.firebasestorage.app",messagingSenderId:"788480597316",appId:"1:788480597316:web:776a05277fb4e60806cb11"},c=(0,a.Wp)(i),l=(0,o.xI)(c),u=(0,s.aU)(c);(0,n.c7)(c);l.languageCode="ar"}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.m=e,function(){var e=[];r.O=function(t,a,o,s){if(!a){var n=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],s=e[u][2];for(var i=!0,c=0;c<a.length;c++)(!1&s||n>=s)&&Object.keys(r.O).every(function(e){return r.O[e](a[c])})?a.splice(c--,1):(i=!1,s<n&&(n=s));if(i){e.splice(u--,1);var l=o();void 0!==l&&(t=l)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[a,o,s]}}(),function(){r.d=function(e,t){for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce(function(t,a){return r.f[a](e,t),t},[]))}}(),function(){r.u=function(e){return"js/"+e+"."+{217:"5f5bc30f",473:"3c2e1910",502:"ff0c78d4",513:"af6d9cf3",569:"bb03801c",621:"2df24c43",630:"4259b8ca",696:"c356a15f",727:"9bcbc58f",808:"91a1fec6",821:"1ab850df",848:"615f83b1",962:"91a34c14",989:"38bc8264"}[e]+".js"}}(),function(){r.miniCssF=function(e){return"css/"+e+"."+{76:"5cd14916",513:"32c23152",563:"66b08e74",569:"2f4bf41d",621:"4de43379",630:"8929d808",821:"27e844dd",848:"3b7b0740",962:"516419a1",989:"062df114"}[e]+".css"}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="monofia-perfume-inventory:";r.l=function(a,o,s,n){if(e[a])e[a].push(o);else{var i,c;if(void 0!==s)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==a||d.getAttribute("data-webpack")==t+s){i=d;break}}i||(c=!0,i=document.createElement("script"),i.charset="utf-8",r.nc&&i.setAttribute("nonce",r.nc),i.setAttribute("data-webpack",t+s),i.src=a),e[a]=[o];var m=function(t,r){i.onerror=i.onload=null,clearTimeout(h);var o=e[a];if(delete e[a],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach(function(e){return e(r)}),t)return t(r)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=m.bind(null,i.onerror),i.onload=m.bind(null,i.onload),c&&document.head.appendChild(i)}}}(),function(){r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){r.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){r.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,o,s){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",r.nc&&(n.nonce=r.nc);var i=function(r){if(n.onerror=n.onload=null,"load"===r.type)o();else{var a=r&&r.type,i=r&&r.target&&r.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+i+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=a,c.request=i,n.parentNode&&n.parentNode.removeChild(n),s(c)}};return n.onerror=n.onload=i,n.href=t,a?a.parentNode.insertBefore(n,a.nextSibling):document.head.appendChild(n),n},t=function(e,t){for(var r=document.getElementsByTagName("link"),a=0;a<r.length;a++){var o=r[a],s=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(s===e||s===t))return o}var n=document.getElementsByTagName("style");for(a=0;a<n.length;a++){o=n[a],s=o.getAttribute("data-href");if(s===e||s===t)return o}},a=function(a){return new Promise(function(o,s){var n=r.miniCssF(a),i=r.p+n;if(t(n,i))return o();e(a,i,null,o,s)})},o={524:0};r.f.miniCss=function(e,t){var r={76:1,513:1,563:1,569:1,621:1,630:1,821:1,848:1,962:1,989:1};o[e]?t.push(o[e]):0!==o[e]&&r[e]&&t.push(o[e]=a(e).then(function(){o[e]=0},function(t){throw delete o[e],t}))}}}(),function(){var e={524:0};r.f.j=function(t,a){var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)a.push(o[2]);else if(/^(563|76)$/.test(t))e[t]=0;else{var s=new Promise(function(r,a){o=e[t]=[r,a]});a.push(o[2]=s);var n=r.p+r.u(t),i=new Error,c=function(a){if(r.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var s=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.src;i.message="Loading chunk "+t+" failed.\n("+s+": "+n+")",i.name="ChunkLoadError",i.type=s,i.request=n,o[1](i)}};r.l(n,c,"chunk-"+t,t)}},r.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,s,n=a[0],i=a[1],c=a[2],l=0;if(n.some(function(t){return 0!==e[t]})){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(c)var u=c(r)}for(t&&t(a);l<n.length;l++)s=n[l],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(u)},a=self["webpackChunkmonofia_perfume_inventory"]=self["webpackChunkmonofia_perfume_inventory"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=r.O(void 0,[96],function(){return r(435)});a=r.O(a)})();