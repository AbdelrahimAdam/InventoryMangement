"use strict";(self["webpackChunkmonofia_perfume_inventory"]=self["webpackChunkmonofia_perfume_inventory"]||[]).push([[524],{203:function(e,r,t){var a=t(2405),o=t(1032),s=t(3556);class n{constructor(){this.usersCollection="users",this.logsCollection="user_logs",this.profilesCollection="user_profiles"}async _checkSuperAdminPermission(){try{if(!s.j2.currentUser)throw new Error("يجب تسجيل الدخول أولاً");const e=await(0,a.x7)((0,a.H9)(s.db,this.usersCollection,s.j2.currentUser.uid));if(!e.exists())throw new Error("ملف المستخدم غير موجود");const r=e.data();if("superadmin"!==r.role)throw new Error("ليس لديك صلاحية لإدارة المستخدمين");return r}catch(e){throw console.error("Permission check error:",e),e}}async getUsers(e={}){try{await this._checkSuperAdminPermission();const{page:r=1,limit:t=20,search:o="",role:n="",is_active:i=null,sort_by:l="created_at",sort_order:c="desc"}=e;let u=(0,a.rJ)(s.db,this.usersCollection);const d=[];n&&d.push((0,a._M)("role","==",n)),null!==i&&d.push((0,a._M)("is_active","==",i)),d.push((0,a.My)(l,c)),u=(0,a.P)(u,...d);const m=await(0,a.GG)(u);let h=[];m.forEach(e=>{const r=e.data();this._userMatchesSearch(r,o)&&h.push({id:e.id,...r,created_at:this._formatTimestamp(r.created_at),updated_at:this._formatTimestamp(r.updated_at),last_login:this._formatTimestamp(r.last_login)})});const p=h.length,_=(r-1)*t,g=h.slice(_,_+t);return{success:!0,data:g,pagination:{currentPage:r,totalPages:Math.ceil(p/t),totalItems:p,itemsPerPage:t}}}catch(r){return console.error("UserService.getUsers Error:",r),{success:!1,error:this._handleFirebaseError(r),data:[],pagination:{currentPage:1,totalPages:0,totalItems:0,itemsPerPage:20}}}}async getUserById(e){try{const r=(0,a.H9)(s.db,this.usersCollection,e),t=await(0,a.x7)(r);if(!t.exists())return{success:!1,error:"المستخدم غير موجود",data:null};const o=t.data(),n={id:t.id,...o,created_at:this._formatTimestamp(o.created_at),updated_at:this._formatTimestamp(o.updated_at),last_login:this._formatTimestamp(o.last_login)};return{success:!0,data:n,message:"تم تحميل المستخدم بنجاح"}}catch(r){return console.error("UserService.getUserById Error:",r),{success:!1,error:this._handleFirebaseError(r),data:null}}}async createUser(e){try{console.log("UserService.createUser called with:",e),await this._checkSuperAdminPermission();const r=this.validateUserData(e,!1);if(!r.isValid)return console.error("Validation errors:",r.errors),{success:!1,error:r.errors[0],data:null};const t=await(0,o.eJ)(s.j2,e.email.trim().toLowerCase(),e.password),n=t.user,i=n.uid,l=this.getDefaultPermissionsForRole(e.role),c={name:e.name?e.name.trim():"",email:e.email?e.email.trim().toLowerCase():"",phone:e.phone?e.phone.trim():null,role:e.role||"company_manager",is_active:!1!==e.is_active,permissions:Array.isArray(e.permissions)&&e.permissions.length>0?e.permissions:l,allowed_warehouses:"warehouse_manager"===e.role&&Array.isArray(e.allowed_warehouses)?e.allowed_warehouses:[],created_at:(0,a.O5)(),updated_at:(0,a.O5)(),created_by:s.j2.currentUser?.uid||"system",email_verified:!1,last_login:null,profile_complete:!0};console.log("Creating user document:",c),await(0,o.r7)(n,{displayName:c.name}),await(0,o.gA)(n);const u=(0,a.H9)(s.db,this.usersCollection,i);await(0,a.BN)(u,c);const d=(0,a.H9)(s.db,this.profilesCollection,i);return await(0,a.BN)(d,{user_id:i,preferences:{language:"ar",theme:"light",notifications:!0},created_at:(0,a.O5)(),updated_at:(0,a.O5)()}),await this._logUserAction("create",i,{name:c.name,email:c.email,role:c.role,permissions:c.permissions,allowed_warehouses:c.allowed_warehouses}),{success:!0,data:{id:i,...c,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},message:"تم إنشاء المستخدم بنجاح"}}catch(r){return console.error("UserService.createUser Error:",r),{success:!1,error:this._handleFirebaseError(r),data:null}}}async updateUser(e,r){try{console.log("UserService.updateUser called for:",e,"with data:",r),await this._checkSuperAdminPermission();const n=await this.getUserById(e);if(!n.success)return n;const i=this.validateUserData(r,!0);if(!i.isValid)return{success:!1,error:i.errors[0],data:null};const l={name:r.name?r.name.trim():n.data.name,phone:r.phone?r.phone.trim():n.data.phone||null,role:r.role||n.data.role,is_active:!1!==r.is_active,permissions:Array.isArray(r.permissions)&&r.permissions.length>0?r.permissions:n.data.permissions||[],allowed_warehouses:"warehouse_manager"===r.role&&Array.isArray(r.allowed_warehouses)?r.allowed_warehouses:[],updated_at:(0,a.O5)(),updated_by:s.j2.currentUser?.uid};if(console.log("Updating user with data:",l),r.name&&r.name!==n.data.name)try{const r=s.j2.currentUser;r?.uid===e&&await(0,o.r7)(r,{displayName:l.name})}catch(t){console.warn("Could not update Firebase Auth profile:",t)}const c=(0,a.H9)(s.db,this.usersCollection,e);return await(0,a.mZ)(c,l),await this._logUserAction("update",e,{name:l.name,role:l.role,is_active:l.is_active,permissions:l.permissions,allowed_warehouses:l.allowed_warehouses}),{success:!0,data:{...n.data,...l,updated_at:(new Date).toISOString()},message:"تم تحديث المستخدم بنجاح"}}catch(t){return console.error("UserService.updateUser Error:",t),{success:!1,error:this._handleFirebaseError(t),data:null}}}async deleteUser(e){try{await this._checkSuperAdminPermission();const r=(0,a.H9)(s.db,this.usersCollection,e),t=await(0,a.x7)(r);if(!t.exists())return{success:!1,error:"المستخدم غير موجود"};if(s.j2.currentUser?.uid===e)return{success:!1,error:"لا يمكن حذف حسابك الشخصي"};const o=t.data();if("superadmin"===o.role)return{success:!1,error:"لا يمكن حذف مشرف عام آخر"};await(0,a.kd)(r);const n=(0,a.H9)(s.db,this.profilesCollection,e);return await(0,a.kd)(n),await this._logUserAction("delete",e,{name:o.name||"غير معروف",email:o.email||"غير معروف"}),{success:!0,message:"تم حذف المستخدم بنجاح"}}catch(r){return console.error("UserService.deleteUser Error:",r),{success:!1,error:this._handleFirebaseError(r)}}}async updateUserStatus(e,r){try{await this._checkSuperAdminPermission();const t=(0,a.H9)(s.db,this.usersCollection,e),o=await(0,a.x7)(t);if(!o.exists())return{success:!1,error:"المخدم غير موجود"};const n=o.data();return s.j2.currentUser?.uid===e&&"superadmin"===n.role?{success:!1,error:"لا يمكن تعطيل حساب المشرف العام"}:r||"superadmin"!==n.role?(await(0,a.mZ)(t,{is_active:r,updated_at:(0,a.O5)(),updated_by:s.j2.currentUser?.uid}),await this._logUserAction(r?"activate":"deactivate",e,{name:n.name||"غير معروف",previous_status:n.is_active,new_status:r}),{success:!0,message:`تم ${r?"تفعيل":"تعطيل"} المستخدم بنجاح`}):{success:!1,error:"لا يمكن تعطيل مشرف عام آخر"}}catch(t){return console.error("UserService.updateUserStatus Error:",t),{success:!1,error:this._handleFirebaseError(t)}}}async searchUsers(e,r=10){try{await this._checkSuperAdminPermission();const t=(0,a.rJ)(s.db,this.usersCollection),o=await(0,a.GG)(t),n=[];o.forEach(r=>{const t=r.data();this._userMatchesSearch(t,e)&&n.push({id:r.id,...t,created_at:this._formatTimestamp(t.created_at),updated_at:this._formatTimestamp(t.updated_at)})});const i=n.sort((r,t)=>{const a=this._calculateSearchScore(r,e),o=this._calculateSearchScore(t,e);return o-a});return{success:!0,data:i.slice(0,r),message:"تم البحث بنجاح"}}catch(t){return console.error("UserService.searchUsers Error:",t),{success:!1,error:this._handleFirebaseError(t),data:[]}}}async getUserStats(){try{await this._checkSuperAdminPermission();const e=(0,a.rJ)(s.db,this.usersCollection),r=await(0,a.GG)(e);let t=0,o=0,n=0,i=0,l=0;return r.forEach(e=>{const r=e.data();switch(t++,!1!==r.is_active&&o++,r.role){case"superadmin":n++;break;case"warehouse_manager":i++;break;case"company_manager":l++;break}}),{success:!0,data:{total_users:t,active_users:o,inactive_users:t-o,superadmins:n,warehouse_managers:i,company_managers:l,roles_distribution:{superadmin:n,warehouse_manager:i,company_manager:l}}}}catch(e){return console.error("UserService.getUserStats Error:",e),{success:!1,error:this._handleFirebaseError(e),data:null}}}generateRandomPassword(e=12){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let t="";for(let a=0;a<e;a++){const e=Math.floor(Math.random()*r.length);t+=r[e]}return t}async _logUserAction(e,r,t=null){try{const o=(0,a.rJ)(s.db,this.logsCollection),n={action:e,user_id:r,performed_by:s.j2.currentUser?.uid||"system",performed_by_name:s.j2.currentUser?.displayName||"System",data:t?JSON.stringify(t):null,timestamp:(0,a.O5)(),ip_address:"unknown"};await(0,a.BN)((0,a.H9)(o),n)}catch(o){console.error("Failed to log user action:",o)}}_userMatchesSearch(e,r){if(!r||"string"!==typeof r)return!0;const t=r.toLowerCase().trim();if(!t)return!0;const a=(e.name||"").toLowerCase(),o=(e.email||"").toLowerCase(),s=(e.phone||"").toLowerCase();return a.includes(t)||o.includes(t)||s.includes(t)}_calculateSearchScore(e,r){if(!e||!r||"string"!==typeof r)return 0;let t=0;const a=r.toLowerCase().trim();return e.name&&"string"===typeof e.name&&e.name.toLowerCase().includes(a)&&(t+=3),e.email&&"string"===typeof e.email&&e.email.toLowerCase().includes(a)&&(t+=2),e.phone&&"string"===typeof e.phone&&e.phone.toLowerCase().includes(a)&&(t+=1),t}_formatTimestamp(e){return e?e instanceof a.Dc||e.toDate?e.toDate().toISOString():e:null}_handleFirebaseError(e){if(!e)return"حدث خطأ غير معروف";console.error("Firebase Error:",e.code,e.message);const r={"auth/email-already-in-use":"البريد الإلكتروني مسجل مسبقاً","auth/invalid-email":"البريد الإلكتروني غير صالح","auth/operation-not-allowed":"عملية غير مسموحة","auth/weak-password":"كلمة المرور ضعيفة جداً","auth/user-disabled":"هذا الحساب معطل","auth/user-not-found":"المستخدم غير موجود","auth/wrong-password":"كلمة المرور غير صحيحة","auth/too-many-requests":"محاولات كثيرة جداً، يرجى الانتظار","permission-denied":"ليس لديك صلاحية للقيام بهذا الإجراء","not-found":"المستند غير موجود","already-exists":"المستند موجود مسبقاً",unavailable:"الخدمة غير متاحة حالياً"};return e.code&&r[e.code]?r[e.code]:e.message||"حدث خطأ غير متوقع"}validateUserData(e,r=!1){const t=[];if(!e||"object"!==typeof e)return{isValid:!1,errors:["بيانات المستخدم غير صالحة"]};if((!e.name||"string"!==typeof e.name||e.name.trim().length<2)&&t.push("الاسم يجب أن يكون على الأقل حرفين"),!r||e.email){const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;e.email&&"string"===typeof e.email&&r.test(e.email.trim())||t.push("البريد الإلكتروني غير صالح")}if(e.phone&&"string"===typeof e.phone&&e.phone.trim()){const r=/^01[0-9]{9}$/;r.test(e.phone.trim())||t.push("رقم الهاتف يجب أن يبدأ بـ 01 ويتكون من 11 رقماً")}const a=["superadmin","warehouse_manager","company_manager"];return e.role&&a.includes(e.role)||t.push("الدور غير صالح"),r||(!e.password||"string"!==typeof e.password||e.password.length<8)&&t.push("كلمة المرور يجب أن تكون 8 أحرف على الأقل"),"warehouse_manager"===e.role&&(Array.isArray(e.allowed_warehouses)&&0!==e.allowed_warehouses.length||t.push("يجب اختيار مخزن واحد على الأقل لمدير المخازن")),e.permissions&&!Array.isArray(e.permissions)&&t.push("صلاحيات المستخدم يجب أن تكون مصفوفة"),{isValid:0===t.length,errors:t}}formatUserForDisplay(e){return e&&"object"===typeof e?{id:e.id||"غير معروف",name:e.name||"غير معروف",email:e.email||"",phone:e.phone||"-",role:e.role||"user",role_name:this.getRoleName(e.role),is_active:!1!==e.is_active,status:!1!==e.is_active?"نشط":"غير نشط",status_color:!1!==e.is_active?"green":"red",allowed_warehouses:Array.isArray(e.allowed_warehouses)?e.allowed_warehouses:[],permissions:Array.isArray(e.permissions)?e.permissions:[],created_at:e.created_at?new Date(e.created_at).toLocaleDateString("ar-EG"):"-",updated_at:e.updated_at?new Date(e.updated_at).toLocaleDateString("ar-EG"):"-",last_login:e.last_login?new Date(e.last_login).toLocaleDateString("ar-EG"):"لم يسجل دخول"}:{id:"غير معروف",name:"غير معروف",email:"",phone:"-",role:"user",role_name:"غير معروف",is_active:!1,status:"غير نشط",status_color:"red",allowed_warehouses:[],permissions:[],created_at:"-",updated_at:"-",last_login:"لم يسجل دخول"}}getRoleName(e){if(!e||"string"!==typeof e)return"غير معروف";const r={superadmin:"المشرف العام",warehouse_manager:"مدير المخازن",company_manager:"مدير الشركة"};return r[e]||e}getRolePermissions(e){if(!e||"string"!==typeof e)return[];const r={superadmin:["الوصول الكامل إلى جميع المخازن","إدارة المستخدمين والأدوار","إنشاء وتعديل وحذف الأصناف","إدارة الحركات والنقل","تصدير التقارير والبيانات","إعدادات النظام"],warehouse_manager:["الوصول إلى المخازن المحددة فقط","إنشاء وتعديل الأصناف في المخازن المسموحة","إدارة الحركات والنقل بين المخازن المسموحة","عرض التقارير للمخازن المسموحة","تصدير بيانات المخازن المسموحة"],company_manager:["عرض جميع البيانات للقراءة فقط","تصفية البيانات والتقارير","تصدير التقارير والبيانات","لا يمكن التعديل أو الحذف"]};return r[e]||[]}cleanUserData(e){return e&&"object"===typeof e?{name:e.name?e.name.trim():"",email:e.email?e.email.trim().toLowerCase():"",phone:e.phone?e.phone.trim():null,role:e.role||"company_manager",is_active:!1!==e.is_active,allowed_warehouses:Array.isArray(e.allowed_warehouses)?e.allowed_warehouses:[],permissions:Array.isArray(e.permissions)?e.permissions:[]}:{name:"",email:"",role:"company_manager",is_active:!0,allowed_warehouses:[],permissions:[]}}getDefaultPermissionsForRole(e){const r={superadmin:["all"],warehouse_manager:["manage_inventory","create_transfers","dispatch_items","update_items","view_reports","export_data"],company_manager:["view_reports","export_data","view_inventory"]};return r[e]||["view_reports"]}hasPermission(e,r){if(!e||!r)return!1;const t=Array.isArray(e.permissions)?e.permissions:[];return"superadmin"===e.role||(t.includes(r)||t.includes("all")||t.includes("full_access"))}}const i=new n;r.A=i},3556:function(e,r,t){t.d(r,{db:function(){return u},j2:function(){return c}});var a=t(223),o=t(1032),s=t(2405),n=t(5904);const i={apiKey:"AIzaSyDxpbXvFH6UvfE2I6OJ_wNFnA889Zu-NEQ",authDomain:"monofia-inventory.firebaseapp.com",projectId:"monofia-inventory",storageBucket:"monofia-inventory.firebasestorage.app",messagingSenderId:"788480597316",appId:"1:788480597316:web:776a05277fb4e60806cb11"},l=(0,a.Wp)(i),c=(0,o.xI)(l),u=(0,s.aU)(l);(0,n.c7)(l);c.languageCode="ar"},3795:function(e,r,t){var a=t(3751),o=t(641),s=t(33);const n={id:"app",dir:"rtl",class:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200"},i={key:0,class:"flex items-center justify-center min-h-screen"},l={key:1,class:"h-screen flex flex-col"},c={key:0,class:"flex-1 overflow-y-auto"},u={class:"lg:hidden"},d={class:"bg-white dark:bg-gray-800 shadow-md border-b border-gray-200 dark:border-gray-700"},m={class:"px-4 py-3"},h={class:"flex items-center justify-between"},p={class:"flex items-center space-x-3 space-x-reverse"},_={class:"w-5 h-5 text-gray-600 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},g={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"},w={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},y={class:"flex items-center space-x-2 space-x-reverse"},f=["aria-label"],E={key:0,class:"w-5 h-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20"},b={key:1,class:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20"},v={key:0,class:"absolute -top-1 -left-1 h-5 w-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center"},k={key:0,class:"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg"},x={class:"px-4 py-3 border-b border-gray-200 dark:border-gray-700"},T={class:"relative"},S={class:"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50"},R={class:"flex items-center"},I={class:"h-10 w-10 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 flex items-center justify-center shadow-sm ml-3"},A={class:"text-white font-medium text-sm"},N={class:"text-right flex-1"},O={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},L={class:"text-xs text-gray-500 dark:text-gray-400 truncate"},C={class:"px-4 py-3 space-y-1"},U={key:2,class:"pt-2 pb-1 px-3"},M={class:"space-y-1"},P={key:0,class:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm"},D={class:"flex overflow-x-auto scrollbar-hide px-4 py-2"},W={class:"flex-shrink-0 px-3 text-center border-l border-gray-200 dark:border-gray-700 first:border-l-0"},H={class:"text-sm font-bold text-gray-900 dark:text-white"},F={class:"flex-shrink-0 px-3 text-center border-l border-gray-200 dark:border-gray-700"},B={class:"text-sm font-bold text-gray-900 dark:text-white"},j={class:"flex-shrink-0 px-3 text-center border-l border-gray-200 dark:border-gray-700"},G={class:"text-sm font-bold text-red-600 dark:text-red-400"},z={class:"flex-shrink-0 px-3 text-center border-l border-gray-200 dark:border-gray-700"},q={class:"text-sm font-bold text-gray-900 dark:text-white"},Q={key:0,class:"lg:hidden fixed bottom-0 left-0 right-0 z-40 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 pb-safe"},V={class:"flex justify-around p-2"};function X(e,r,t,X,$,J){const Y=(0,o.g2)("router-view"),K=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",n,[X.initializing?((0,o.uX)(),(0,o.CE)("div",i,[...r[22]||(r[22]=[(0,o.Lk)("div",{class:"text-center"},[(0,o.Lk)("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600 mx-auto"}),(0,o.Lk)("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"جاري التحميل...")],-1)])])):((0,o.uX)(),(0,o.CE)("div",l,[X.isPublicRoute?((0,o.uX)(),(0,o.CE)("div",c,[(0,o.bF)(Y)])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.Lk)("div",u,[(0,o.Lk)("header",d,[(0,o.Lk)("div",m,[(0,o.Lk)("div",h,[(0,o.Lk)("div",p,[(0,o.Lk)("button",{onClick:r[0]||(r[0]=(...e)=>X.toggleMobileMenu&&X.toggleMobileMenu(...e)),class:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"فتح القائمة"},[((0,o.uX)(),(0,o.CE)("svg",_,[X.mobileMenuOpen?((0,o.uX)(),(0,o.CE)("path",w)):((0,o.uX)(),(0,o.CE)("path",g))]))]),(0,o.bF)(K,{to:"/",class:"flex items-center space-x-2 space-x-reverse",onClick:r[1]||(r[1]=e=>X.mobileMenuOpen=!1)},{default:(0,o.k6)(()=>[...r[23]||(r[23]=[(0,o.Lk)("div",{class:"h-8 w-8 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center shadow-sm"},[(0,o.Lk)("span",{class:"text-white font-bold text-sm"},"م")],-1),(0,o.Lk)("div",null,[(0,o.Lk)("h1",{class:"text-sm font-bold text-gray-900 dark:text-white"},"نظام المخزون"),(0,o.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"مونوفيا")],-1)])]),_:1})]),(0,o.Lk)("div",y,[(0,o.Lk)("button",{onClick:r[2]||(r[2]=(...e)=>X.toggleDarkMode&&X.toggleDarkMode(...e)),class:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":X.isDarkMode?"الوضع النهاري":"الوضع الليلي"},[X.isDarkMode?((0,o.uX)(),(0,o.CE)("svg",E,[...r[24]||(r[24]=[(0,o.Lk)("path",{"fill-rule":"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z","clip-rule":"evenodd"},null,-1)])])):((0,o.uX)(),(0,o.CE)("svg",b,[...r[25]||(r[25]=[(0,o.Lk)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"},null,-1)])]))],8,f),(0,o.Lk)("button",{onClick:r[3]||(r[3]=(...e)=>X.showNotifications&&X.showNotifications(...e)),class:"relative p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"الإشعارات"},[r[26]||(r[26]=(0,o.Lk)("svg",{class:"w-5 h-5 text-gray-600 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),X.notificationCount>0?((0,o.uX)(),(0,o.CE)("span",v,(0,s.v_)(X.notificationCount>9?"9+":X.notificationCount),1)):(0,o.Q3)("",!0)])])])]),X.mobileMenuOpen?((0,o.uX)(),(0,o.CE)("div",k,[(0,o.Lk)("div",x,[(0,o.Lk)("div",T,[r[27]||(r[27]=(0,o.Lk)("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[(0,o.Lk)("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":r[4]||(r[4]=e=>X.mobileSearchTerm=e),onInput:r[5]||(r[5]=(...e)=>X.handleMobileSearch&&X.handleMobileSearch(...e)),onKeyup:r[6]||(r[6]=(0,a.jR)((...e)=>X.handleMobileSearchEnter&&X.handleMobileSearchEnter(...e),["enter"])),placeholder:"ابحث عن صنف...",class:"block w-full pr-10 pl-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500","aria-label":"بحث عن صنف"},null,544),[[a.Jo,X.mobileSearchTerm]])])]),(0,o.Lk)("div",S,[(0,o.Lk)("div",R,[(0,o.Lk)("div",I,[(0,o.Lk)("span",A,(0,s.v_)(X.getUserInitials(X.userProfile?.name||X.userProfile?.email)),1)]),(0,o.Lk)("div",N,[(0,o.Lk)("p",O,(0,s.v_)(X.userProfile?.name||X.userProfile?.email),1),(0,o.Lk)("p",L,(0,s.v_)(X.getRoleName(X.userRole)),1)]),(0,o.Lk)("span",{class:(0,s.C4)(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",X.roleBadgeClass])},(0,s.v_)(X.getRoleName(X.userRole)),3)])]),(0,o.Lk)("div",C,[(0,o.bF)(K,{to:"/",onClick:r[7]||(r[7]=e=>X.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/"!==e.$route.path}]),"aria-current":"page"},{default:(0,o.k6)(()=>[...r[28]||(r[28]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})],-1),(0,o.eW)(" لوحة التحكم ",-1)])]),_:1},8,["class"]),X.canManageWarehouses?((0,o.uX)(),(0,o.Wv)(K,{key:0,to:"/warehouses",onClick:r[8]||(r[8]=e=>X.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":"/warehouses"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/warehouses"!==e.$route.path}])},{default:(0,o.k6)(()=>[...r[29]||(r[29]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1),(0,o.eW)(" إدارة المخازن ",-1)])]),_:1},8,["class"])):(0,o.Q3)("",!0),X.canManageUsers?((0,o.uX)(),(0,o.Wv)(K,{key:1,to:"/users",onClick:r[9]||(r[9]=e=>X.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/users"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/users"!==e.$route.path}])},{default:(0,o.k6)(()=>[...r[30]||(r[30]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})],-1),(0,o.eW)(" إدارة المستخدمين ",-1)])]),_:1},8,["class"])):(0,o.Q3)("",!0),X.canModifyItems?((0,o.uX)(),(0,o.CE)("div",U,[r[35]||(r[35]=(0,o.Lk)("p",{class:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2"}," إجراءات سريعة ",-1)),(0,o.Lk)("div",M,[(0,o.Lk)("button",{onClick:r[10]||(r[10]=(...e)=>X.openAddItemModal&&X.openAddItemModal(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-yellow-600 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 transition-colors duration-200"},[...r[31]||(r[31]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),(0,o.eW)(" إضافة صنف جديد ",-1)])]),(0,o.Lk)("button",{onClick:r[11]||(r[11]=(...e)=>X.openTransferModal&&X.openTransferModal(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors duration-200"},[...r[32]||(r[32]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1),(0,o.eW)(" نقل بين المخازن ",-1)])]),(0,o.Lk)("button",{onClick:r[12]||(r[12]=(...e)=>X.openDispatchModal&&X.openDispatchModal(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-orange-600 dark:text-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors duration-200"},[...r[33]||(r[33]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),(0,o.eW)(" صرف إلى خارجي ",-1)])]),X.canManageWarehouses?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:r[13]||(r[13]=(...e)=>X.openAddWarehouseModal&&X.openAddWarehouseModal(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors duration-200"},[...r[34]||(r[34]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),(0,o.eW)(" إضافة مخزن جديد ",-1)])])):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),(0,o.bF)(K,{to:"/transactions",onClick:r[14]||(r[14]=e=>X.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/transactions"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/transactions"!==e.$route.path}])},{default:(0,o.k6)(()=>[...r[36]||(r[36]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),(0,o.eW)(" سجل الحركات ",-1)])]),_:1},8,["class"]),X.canViewReports?((0,o.uX)(),(0,o.Wv)(K,{key:3,to:"/reports",onClick:r[15]||(r[15]=e=>X.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/reports"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/reports"!==e.$route.path}])},{default:(0,o.k6)(()=>[...r[37]||(r[37]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),(0,o.eW)(" التقارير ",-1)])]),_:1},8,["class"])):(0,o.Q3)("",!0),(0,o.bF)(K,{to:"/profile",onClick:r[16]||(r[16]=e=>X.mobileMenuOpen=!1),class:(0,s.C4)(["flex items-center px-3 py-3 rounded-lg text-base font-medium transition-colors duration-200",{"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400":"/profile"===e.$route.path,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":"/profile"!==e.$route.path}])},{default:(0,o.k6)(()=>[...r[38]||(r[38]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),(0,o.eW)(" إعدادات الحساب ",-1)])]),_:1},8,["class"]),(0,o.Lk)("button",{onClick:r[17]||(r[17]=(...e)=>X.logout&&X.logout(...e)),class:"w-full flex items-center px-3 py-3 rounded-lg text-base font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors duration-200"},[...r[39]||(r[39]=[(0,o.Lk)("svg",{class:"w-5 h-5 ml-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),(0,o.eW)(" تسجيل خروج ",-1)])])])])):(0,o.Q3)("",!0)]),X.dashboardStats&&"/"===e.$route.path?((0,o.uX)(),(0,o.CE)("div",P,[(0,o.Lk)("div",D,[(0,o.Lk)("div",W,[r[40]||(r[40]=(0,o.Lk)("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"الأصناف",-1)),(0,o.Lk)("div",H,(0,s.v_)(X.dashboardStats.totalItems||0),1)]),(0,o.Lk)("div",F,[r[41]||(r[41]=(0,o.Lk)("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"الكمية",-1)),(0,o.Lk)("div",B,(0,s.v_)(X.formatNumber(X.dashboardStats.totalQuantity)||0),1)]),(0,o.Lk)("div",j,[r[42]||(r[42]=(0,o.Lk)("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"قليلة",-1)),(0,o.Lk)("div",G,(0,s.v_)(X.dashboardStats.lowStockItems||0),1)]),(0,o.Lk)("div",z,[r[43]||(r[43]=(0,o.Lk)("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"الحركات",-1)),(0,o.Lk)("div",q,(0,s.v_)(X.dashboardStats.recentTransactions||0),1)])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",{class:(0,s.C4)(["flex-1 flex flex-col overflow-hidden",{"lg:pt-0":X.isAuthenticated}])},[(0,o.Lk)("div",{class:(0,s.C4)(["flex-1 overflow-y-auto",{"pt-[70px] lg:pt-0":X.isAuthenticated&&"/login"!==e.$route.path}])},[(0,o.bF)(Y)],2),X.isAuthenticated&&X.showBottomNav?((0,o.uX)(),(0,o.CE)("div",Q,[(0,o.Lk)("div",V,[(0,o.bF)(K,{to:"/",class:(0,s.C4)(["flex flex-col items-center p-2 flex-1 transition-colors duration-200",{"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg":"/"===e.$route.path}]),onClick:r[18]||(r[18]=e=>X.mobileMenuOpen=!1)},{default:(0,o.k6)(()=>[...r[44]||(r[44]=[(0,o.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})],-1),(0,o.Lk)("span",{class:"text-xs mt-1"},"الرئيسية",-1)])]),_:1},8,["class"]),X.canModifyItems?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:r[19]||(r[19]=(...e)=>X.openAddItemModal&&X.openAddItemModal(...e)),class:"flex flex-col items-center p-2 flex-1 text-yellow-600 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 rounded-lg transition-colors duration-200"},[...r[45]||(r[45]=[(0,o.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),(0,o.Lk)("span",{class:"text-xs mt-1"},"إضافة",-1)])])):(0,o.Q3)("",!0),(0,o.bF)(K,{to:"/transactions",class:(0,s.C4)(["flex flex-col items-center p-2 flex-1 transition-colors duration-200",{"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg":"/transactions"===e.$route.path}]),onClick:r[20]||(r[20]=e=>X.mobileMenuOpen=!1)},{default:(0,o.k6)(()=>[...r[46]||(r[46]=[(0,o.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),(0,o.Lk)("span",{class:"text-xs mt-1"},"الحركات",-1)])]),_:1},8,["class"]),(0,o.Lk)("button",{onClick:r[21]||(r[21]=(...e)=>X.toggleProfileMenu&&X.toggleProfileMenu(...e)),class:(0,s.C4)(["flex flex-col items-center p-2 flex-1 transition-colors duration-200",{"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg":X.profileMenuOpen}])},[...r[47]||(r[47]=[(0,o.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),(0,o.Lk)("span",{class:"text-xs mt-1"},"حسابي",-1)])],2)])])):(0,o.Q3)("",!0)],2)],64))]))])}var $=t(953),J=t(834),Y=t(5499),K=t(2543),Z={name:"App",setup(){const e=(0,J.Pj)(),r=(0,Y.lq)(),t=(0,Y.rd)(),a=(0,$.KR)(!0),s=(0,$.KR)(!1),n=(0,$.KR)(!1),i=(0,$.KR)(!1),l=(0,$.KR)(""),c=(0,o.EW)(()=>e.getters.isAuthenticated),u=(0,o.EW)(()=>{const e=["Login","Unauthorized","NotFound"];return e.includes(r.name)}),d=(0,o.EW)(()=>{const e=["/login","/unauthorized","/notfound"];return!e.includes(r.path)&&c.value}),m=(0,o.EW)(()=>e.getters.userRole),h=(0,o.EW)(()=>e.state.userProfile),p=(0,o.EW)(()=>e.getters.dashboardStats),_=(0,o.EW)(()=>e.getters.dashboardStats?.lowStockItems||0),g=(0,o.EW)(()=>{const e=m.value,r=h.value;if("superadmin"===e)return!0;if("warehouse_manager"===e){const e=r?.allowed_warehouses?.length>0,t=r?.permissions?.includes("full_access")||r?.permissions?.includes("manage_inventory");return e&&t}return!1}),w=(0,o.EW)(()=>e.getters.canManageUsers),y=(0,o.EW)(()=>e.getters.canManageWarehouses),f=(0,o.EW)(()=>"superadmin"===e.getters.userRole||"company_manager"===e.getters.userRole),E=e=>{const r={superadmin:"المشرف العام",warehouse_manager:"مدير المخازن",company_manager:"مدير الشركة"};return r[e]||e},b=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"؟",v=(0,o.EW)(()=>{const e={superadmin:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white",warehouse_manager:"bg-gradient-to-r from-blue-500 to-cyan-500 text-white",company_manager:"bg-gradient-to-r from-green-500 to-emerald-500 text-white"};return e[m.value]||"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}),k=()=>{const e=localStorage.getItem("theme"),r=window.matchMedia("(prefers-color-scheme: dark)").matches;"dark"===e||!e&&r?(i.value=!0,document.documentElement.classList.add("dark")):(i.value=!1,document.documentElement.classList.remove("dark"))},x=()=>{i.value=!i.value,i.value?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},T=()=>{s.value=!s.value,n.value&&(n.value=!1)},S=()=>{n.value=!n.value,s.value&&(s.value=!1)},R=()=>{t.push("/transactions"),s.value=!1},I=()=>{s.value=!1,window.dispatchEvent(new CustomEvent("open-add-item-modal"))},A=()=>{s.value=!1,window.dispatchEvent(new CustomEvent("open-transfer-modal"))},N=()=>{s.value=!1,window.dispatchEvent(new CustomEvent("open-dispatch-modal"))},O=()=>{s.value=!1,window.dispatchEvent(new CustomEvent("open-add-warehouse-modal"))},L=(0,K.debounce)(()=>{window.dispatchEvent(new CustomEvent("mobile-search",{detail:{searchTerm:l.value}}))},300),C=()=>{"/"!==r.path&&t.push("/"),window.dispatchEvent(new CustomEvent("mobile-search",{detail:{searchTerm:l.value,immediate:!0}}))},U=e=>e||0===e?new Intl.NumberFormat("ar-EG").format(e):"0",M=async()=>{try{s.value=!1,n.value=!1,await e.dispatch("logout"),t.push("/login")}catch(r){console.error("Logout error:",r),t.push("/login")}};return(0,o.sV)(async()=>{try{await e.dispatch("initializeAuth"),e.getters.isAuthenticated&&await e.dispatch("loadWarehouses"),k(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||(e.matches?(document.documentElement.classList.add("dark"),i.value=!0):(document.documentElement.classList.remove("dark"),i.value=!1))}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(s.value=!1,n.value=!1)})}catch(r){console.error("App initialization error:",r)}finally{setTimeout(()=>{a.value=!1},300)}}),(0,o.wB)(()=>r.path,()=>{s.value=!1,n.value=!1}),{initializing:a,isAuthenticated:c,isPublicRoute:u,showBottomNav:d,mobileMenuOpen:s,profileMenuOpen:n,isDarkMode:i,mobileSearchTerm:l,notificationCount:_,dashboardStats:p,userRole:m,userProfile:h,canModifyItems:g,canManageUsers:w,canManageWarehouses:y,canViewReports:f,getRoleName:E,getUserInitials:b,roleBadgeClass:v,toggleDarkMode:x,toggleMobileMenu:T,toggleProfileMenu:S,showNotifications:R,openAddItemModal:I,openTransferModal:A,openDispatchModal:N,openAddWarehouseModal:O,handleMobileSearch:L,handleMobileSearchEnter:C,formatNumber:U,logout:M}}},ee=t(6262);const re=(0,ee.A)(Z,[["render",X],["__scopeId","data-v-053846ca"]]);var te=re;const ae=[{path:"/login",name:"Login",component:()=>t.e(246).then(t.bind(t,2246)),meta:{requiresGuest:!0,layout:"empty"}},{path:"/",name:"Dashboard",component:()=>Promise.all([t.e(297),t.e(360),t.e(335),t.e(965),t.e(290),t.e(425),t.e(647),t.e(157),t.e(309),t.e(545),t.e(130),t.e(218),t.e(76),t.e(889)]).then(t.bind(t,7889)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager","warehouse_manager"]}},{path:"/warehouses",name:"Warehouses",component:()=>Promise.all([t.e(76),t.e(473)]).then(t.bind(t,6473)),meta:{requiresAuth:!0,allowedRoles:["superadmin"]}},{path:"/users",name:"Users",component:()=>Promise.all([t.e(76),t.e(260)]).then(t.bind(t,2260)),meta:{requiresAuth:!0,allowedRoles:["superadmin"]}},{path:"/inventory",name:"Inventory",component:()=>Promise.all([t.e(297),t.e(360),t.e(335),t.e(965),t.e(290),t.e(425),t.e(647),t.e(157),t.e(309),t.e(545),t.e(130),t.e(218),t.e(76),t.e(958)]).then(t.bind(t,4958)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager","warehouse_manager"],permissions:{company_manager:"viewer",warehouse_manager:"full_access"}}},{path:"/inventory/add",name:"AddInventory",component:()=>Promise.all([t.e(297),t.e(360),t.e(335),t.e(965),t.e(290),t.e(425),t.e(647),t.e(157),t.e(309),t.e(545),t.e(130),t.e(218),t.e(76),t.e(958)]).then(t.bind(t,4958)),meta:{requiresAuth:!0,allowedRoles:["superadmin","warehouse_manager"],permissions:{company_manager:"none",warehouse_manager:"full_access"}}},{path:"/inventory/edit/:id",name:"EditInventory",component:()=>Promise.all([t.e(297),t.e(360),t.e(335),t.e(965),t.e(290),t.e(425),t.e(647),t.e(157),t.e(309),t.e(545),t.e(130),t.e(218),t.e(76),t.e(958)]).then(t.bind(t,4958)),meta:{requiresAuth:!0,allowedRoles:["superadmin","warehouse_manager"],permissions:{company_manager:"none",warehouse_manager:"full_access"}}},{path:"/transfers",name:"Transfers",component:()=>Promise.all([t.e(76),t.e(287)]).then(t.bind(t,2287)),meta:{requiresAuth:!0,allowedRoles:["superadmin","warehouse_manager"],permissions:{company_manager:"none",warehouse_manager:"full_access"}}},{path:"/dispatch",name:"Dispatch",component:()=>Promise.all([t.e(76),t.e(877)]).then(t.bind(t,2877)),meta:{requiresAuth:!0,allowedRoles:["superadmin","warehouse_manager"],permissions:{company_manager:"none",warehouse_manager:"full_access"}}},{path:"/transactions",name:"Transactions",component:()=>t.e(253).then(t.bind(t,253)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager","warehouse_manager"],permissions:{company_manager:"viewer",warehouse_manager:"viewer"}}},{path:"/reports",name:"Reports",component:()=>t.e(621).then(t.bind(t,3621)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager"],permissions:{company_manager:"viewer",warehouse_manager:"none"}}},{path:"/profile",name:"Profile",component:()=>t.e(36).then(t.bind(t,1036)),meta:{requiresAuth:!0,allowedRoles:["superadmin","company_manager","warehouse_manager"]}},{path:"/unauthorized",name:"Unauthorized",component:{template:'\n        <div class="min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center px-4">\n          <div class="text-center">\n            <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full mb-6">\n              <svg class="w-8 h-8 text-red-600 dark:text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m0 0v2m0-2h2m-2 0H9m3-6a3 3 0 110-6 3 3 0 010 6zm2 7a9 9 0 11-18 0 9 9 0 0118 0z"/>\n              </svg>\n            </div>\n            <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">صلاحية مرفوضة</h1>\n            <p class="text-xl text-gray-600 dark:text-gray-400 mb-8">\n              ليس لديك الصلاحية للوصول إلى هذه الصفحة\n            </p>\n            <router-link to="/" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200">\n              العودة للرئيسية\n            </router-link>\n          </div>\n        </div>\n      '},meta:{layout:"empty"}},{path:"/:pathMatch(.*)*",name:"NotFound",component:{template:'\n        <div class="min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center px-4">\n          <div class="text-center">\n            <h1 class="text-6xl font-bold text-gray-900 dark:text-white mb-4">404</h1>\n            <p class="text-xl text-gray-600 dark:text-gray-400 mb-8">\n              الصفحة غير موجودة\n            </p>\n            <router-link to="/" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200">\n              العودة للرئيسية\n            </router-link>\n          </div>\n        </div>\n      '},meta:{layout:"empty"}}],oe=(0,Y.aE)({history:(0,Y.LA)(),routes:ae}),se=(e,r)=>{if(!r.allowedRoles)return!0;if(!r.allowedRoles.includes(e))return!1;if(r.permissions){const t=r.permissions[e];if("none"===t)return!1}return!0},ne=(e,r)=>{if("warehouse_manager"!==e?.role)return!0;const t=e?.allowed_warehouses||[];return!r?.includes("Inventory")||0!==t.length};oe.beforeEach((e,r,t)=>{const a=(0,J.Pj)(),o=a.state.user,s=a.state.userProfile,n=null===r.name||void 0===r.name;if(n&&"/login"===e.path)t();else if(!e.meta.requiresAuth||o){if(e.meta.requiresGuest&&o)return e.path,void t("/");if(o&&s){const r=s.role;if(e.meta.allowedRoles){if(!se(r,e.meta))return void t("/unauthorized");if(!ne(s,e.name))return void t("/unauthorized")}}t()}else"/login"!==e.path?t("/login"):t()}),oe.onError(e=>{console.error("Router error:",e),e.message.includes("redirected")&&(window.location.href="/login")});var ie=oe,le=t(3556),ce=t(1032),ue=t(2405),de=t(5062),me=t(203);const he={arabicToEnglish:{"الاسم":"name","الكود":"code","اللون":"color","المخزن_id":"warehouse_id","المخزن":"warehouse_id","عدد_الكراتين":"cartons_count","عدد_في_الكرتونه":"per_carton_count","عدد_القزاز_الفردي":"single_bottles_count","الكميه_المضافه":"total_added","الكميه_المتبقيه":"remaining_quantity","المورد":"supplier","مكان_الصنف":"item_location"},englishToArabic:de.XY};var pe=(0,J.y$)({state:{user:null,userProfile:null,loading:!1,warehouses:[],warehousesLoaded:!1,inventory:[],transactions:[],itemHistory:[],filters:{warehouse:"",search:""},authError:null,operationLoading:!1,operationError:null,fieldMappings:he,notifications:[],unsubscribeInventory:null,unsubscribeTransactions:null,unsubscribeWarehouses:null,recentTransactions:[],recentTransactionsLoading:!1,requiresCompositeIndex:!1,allUsers:[],usersLoading:!1},mutations:{SET_USER(e,r){e.user=r},SET_USER_PROFILE(e,r){e.userProfile=r},SET_LOADING(e,r){e.loading=r},SET_OPERATION_LOADING(e,r){e.operationLoading=r},SET_OPERATION_ERROR(e,r){e.operationError=r},SET_WAREHOUSES(e,r){e.warehouses=r},SET_WAREHOUSES_LOADED(e,r){e.warehousesLoaded=r},SET_INVENTORY(e,r){e.inventory=r},SET_TRANSACTIONS(e,r){e.transactions=r},SET_ITEM_HISTORY(e,r){e.itemHistory=r},SET_FILTERS(e,r){e.filters={...e.filters,...r}},ADD_ITEM(e,r){e.inventory.push(r)},UPDATE_ITEM(e,r){const t=e.inventory.findIndex(e=>e.id===r.id);-1!==t&&e.inventory.splice(t,1,r)},REMOVE_ITEM(e,r){e.inventory=e.inventory.filter(e=>e.id!==r)},SET_AUTH_ERROR(e,r){e.authError=r},CLEAR_OPERATION_ERROR(e){e.operationError=null},ADD_NOTIFICATION(e,r){r.id=Date.now().toString(),r.timestamp=new Date,e.notifications.push(r),setTimeout(()=>{const t=e.notifications.findIndex(e=>e.id===r.id);-1!==t&&e.notifications.splice(t,1)},5e3)},REMOVE_NOTIFICATION(e,r){e.notifications=e.notifications.filter(e=>e.id!==r)},CLEAR_NOTIFICATIONS(e){e.notifications=[]},SET_UNSUBSCRIBE_INVENTORY(e,r){e.unsubscribeInventory&&e.unsubscribeInventory(),e.unsubscribeInventory=r},SET_UNSUBSCRIBE_TRANSACTIONS(e,r){e.unsubscribeTransactions&&e.unsubscribeTransactions(),e.unsubscribeTransactions=r},SET_UNSUBSCRIBE_WAREHOUSES(e,r){e.unsubscribeWarehouses&&e.unsubscribeWarehouses(),e.unsubscribeWarehouses=r},CLEAR_UNSUBSCRIBERS(e){e.unsubscribeInventory&&(e.unsubscribeInventory(),e.unsubscribeInventory=null),e.unsubscribeTransactions&&(e.unsubscribeTransactions(),e.unsubscribeTransactions=null),e.unsubscribeWarehouses&&(e.unsubscribeWarehouses(),e.unsubscribeWarehouses=null)},SET_RECENT_TRANSACTIONS(e,r){e.recentTransactions=r},SET_RECENT_TRANSACTIONS_LOADING(e,r){e.recentTransactionsLoading=r},ADD_RECENT_TRANSACTION(e,r){e.recentTransactions.unshift(r),e.recentTransactions.length>50&&(e.recentTransactions=e.recentTransactions.slice(0,50))},SET_REQUIRES_COMPOSITE_INDEX(e,r){e.requiresCompositeIndex=r},SET_ALL_USERS(e,r){e.allUsers=r},SET_USERS_LOADING(e,r){e.usersLoading=r}},actions:{showNotification({commit:e,getters:r},t){if(!t||!t.message)return void console.warn("Invalid notification:",t);const a={type:"info",title:"",message:"",duration:5e3},o={...a,...t};e("ADD_NOTIFICATION",o),"error"===o.type&&console.error("Notification Error:",o.message)},async initializeAuth({commit:e,dispatch:r}){return new Promise(t=>{(0,ce.hg)(le.j2,async a=>{if(a){e("SET_USER",a);try{await r("loadUserProfile",a)}catch(o){console.error("Error in auth initialization:",o),e("SET_AUTH_ERROR","فشل في تحميل بيانات المستخدم")}}else e("SET_USER",null),e("SET_USER_PROFILE",null),e("SET_INVENTORY",[]),e("SET_TRANSACTIONS",[]),e("SET_ITEM_HISTORY",[]),e("SET_RECENT_TRANSACTIONS",[]),e("SET_WAREHOUSES_LOADED",!1),e("SET_REQUIRES_COMPOSITE_INDEX",!1),e("CLEAR_UNSUBSCRIBERS");t()})})},async loadUserProfile({commit:e,dispatch:r},t){try{console.log("Loading user profile for:",t.email);const a=await(0,ue.x7)((0,ue.H9)(le.db,"users",t.uid));if(!a.exists()){console.error("User profile not found in Firestore:",t.email);const a={email:t.email,name:t.email.split("@")[0],role:"pending",allowed_warehouses:[],permissions:["view_reports"],is_active:!1,profile_complete:!1,needs_approval:!0,created_at:new Date};return await(0,ue.BN)((0,ue.H9)(le.db,"users",t.uid),a),e("SET_USER_PROFILE",a),r("showNotification",{type:"warning",message:"حسابك قيد المراجعة. يرجى الانتظار حتى يتم تفعيله من قبل المشرف."}),void await r("notifyAdminAboutPendingUser",{userId:t.uid,userEmail:t.email})}const o=a.data();if(console.log("Loaded user profile:",o),!1===o.is_active)return r("showNotification",{type:"error",message:"حسابك غير نشط. يرجى التواصل مع المشرف."}),void await r("logout");e("SET_USER_PROFILE",o),console.log("User profile loaded with role:",o.role,"permissions:",o.permissions),r("showNotification",{type:"success",message:`مرحباً ${o.name}! تم تسجيل الدخول بنجاح.`}),await r("loadWarehouses"),r("subscribeToInventory"),r("subscribeToTransactions"),r("getRecentTransactions")}catch(a){console.error("Error loading user profile:",a),r("showNotification",{type:"error",message:"حدث خطأ في تحميل بيانات المستخدم"}),await r("logout")}},async notifyAdminAboutPendingUser({dispatch:e},{userId:r,userEmail:t}){try{const e=(0,ue.H9)((0,ue.rJ)(le.db,"admin_notifications"));await(0,ue.BN)(e,{type:"new_user_pending",user_id:r,user_email:t,timestamp:new Date,message:"مستخدم جديد يحتاج إلى التفعيل",read:!1}),console.log("Admin notified about pending user:",t)}catch(a){console.error("Error notifying admin:",a)}},async login({commit:e,dispatch:r},{email:t,password:a}){e("SET_LOADING",!0),e("SET_AUTH_ERROR",null);try{console.log("Attempting login with:",t);const o=await(0,ce.x9)(le.j2,t,a),s=o.user;return console.log("Login successful, user:",s.uid),await r("loadUserProfile",s),e("SET_USER",s),s}catch(o){console.error("Login error details:",o);const t=_e(o.code);throw e("SET_AUTH_ERROR",t),r("showNotification",{type:"error",message:t}),new Error(t)}finally{e("SET_LOADING",!1)}},async logout({commit:e,dispatch:r}){try{await(0,ce.CI)(le.j2),e("SET_USER",null),e("SET_USER_PROFILE",null),e("SET_INVENTORY",[]),e("SET_TRANSACTIONS",[]),e("SET_ITEM_HISTORY",[]),e("SET_RECENT_TRANSACTIONS",[]),e("SET_AUTH_ERROR",null),e("SET_OPERATION_ERROR",null),e("SET_WAREHOUSES_LOADED",!1),e("SET_REQUIRES_COMPOSITE_INDEX",!1),e("CLEAR_UNSUBSCRIBERS"),r("showNotification",{type:"info",message:"تم تسجيل الخروج بنجاح"})}catch(t){throw console.error("Logout error:",t),r("showNotification",{type:"error",message:"خطأ في تسجيل الخروج"}),t}},async loadAllUsers({commit:e,dispatch:r,getters:t}){e("SET_USERS_LOADING",!0);try{if(!t.canManageUsers)throw new Error("ليس لديك صلاحية لعرض المستخدمين");const r=await me.A.getUsers();if(r.success)return e("SET_ALL_USERS",r.data),r.data;throw new Error(r.error||"فشل في تحميل المستخدمين")}catch(a){throw console.error("Error loading users:",a),r("showNotification",{type:"error",message:a.message||"حدث خطأ في تحميل المستخدمين"}),a}finally{e("SET_USERS_LOADING",!1)}},async createUser({commit:e,dispatch:r,getters:t},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(console.log("Store.createUser called with:",a),!t.canManageUsers)throw new Error("ليس لديك صلاحية لإضافة مستخدمين");const e=await me.A.createUser(a);if(console.log("UserService.createUser result:",e),e.success)return r("showNotification",{type:"success",message:e.message||`تم إضافة المستخدم "${a.name}" بنجاح`}),{success:!0,data:e.data,message:e.message};throw new Error(e.error||"فشل في إنشاء المستخدم")}catch(o){return console.error("Error creating user:",o),e("SET_OPERATION_ERROR",o.message),r("showNotification",{type:"error",message:o.message||"حدث خطأ في إضافة المستخدم"}),{success:!1,error:o.message}}finally{e("SET_OPERATION_LOADING",!1)}},async updateUser({commit:e,dispatch:r,getters:t},{userId:a,userData:o}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(console.log("Store.updateUser called for:",a,"with:",o),!t.canManageUsers)throw new Error("ليس لديك صلاحية لتحديث المستخدمين");const s=await me.A.updateUser(a,o);if(console.log("UserService.updateUser result:",s),s.success){if(a===t.user?.uid){const r={...t.userProfile,...o};e("SET_USER_PROFILE",r)}return r("showNotification",{type:"success",message:s.message||"تم تحديث المستخدم بنجاح"}),{success:!0,data:s.data,message:s.message}}throw new Error(s.error||"فشل في تحديث المستخدم")}catch(s){return console.error("Error updating user:",s),e("SET_OPERATION_ERROR",s.message),r("showNotification",{type:"error",message:s.message||"حدث خطأ في تحديث المستخدم"}),{success:!1,error:s.message}}finally{e("SET_OPERATION_LOADING",!1)}},async deleteUser({commit:e,dispatch:r,getters:t},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!t.canManageUsers)throw new Error("ليس لديك صلاحية لحذف المستخدمين");const e=await me.A.deleteUser(a);if(e.success)return r("showNotification",{type:"success",message:e.message||"تم حذف المستخدم بنجاح"}),{success:!0,message:e.message};throw new Error(e.error||"فشل في حذف المستخدم")}catch(o){return console.error("Error deleting user:",o),e("SET_OPERATION_ERROR",o.message),r("showNotification",{type:"error",message:o.message||"حدث خطأ في حذف المستخدم"}),{success:!1,error:o.message}}finally{e("SET_OPERATION_LOADING",!1)}},async updateUserStatus({commit:e,dispatch:r,getters:t},{userId:a,isActive:o}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!t.canManageUsers)throw new Error("ليس لديك صلاحية لتغيير حالة المستخدمين");const e=await me.A.updateUserStatus(a,o);if(e.success)return r("showNotification",{type:"success",message:e.message||`تم ${o?"تفعيل":"تعطيل"} المستخدم بنجاح`}),{success:!0,message:e.message};throw new Error(e.error||"فشل في تغيير حالة المستخدم")}catch(s){return console.error("Error updating user status:",s),e("SET_OPERATION_ERROR",s.message),r("showNotification",{type:"error",message:s.message||"حدث خطأ في تغيير حالة المستخدم"}),{success:!1,error:s.message}}finally{e("SET_OPERATION_LOADING",!1)}},async getUserStats({commit:e,dispatch:r,getters:t}){try{if(!t.canManageUsers)throw new Error("ليس لديك صلاحية لعرض إحصائيات المستخدمين");const e=await me.A.getUserStats();if(e.success)return e.data;throw new Error(e.error||"فشل في تحميل إحصائيات المستخدمين")}catch(a){throw console.error("Error loading user stats:",a),r("showNotification",{type:"error",message:a.message||"حدث خطأ في تحميل إحصائيات المستخدمين"}),a}},async loadWarehouses({commit:e,dispatch:r,state:t}){try{if(t.warehousesLoaded)return void console.log("Warehouses already loaded, skipping...");console.log("Loading warehouses from Firestore..."),await r("initializeDefaultWarehouses"),await r("subscribeToWarehouses"),e("SET_WAREHOUSES_LOADED",!0),console.log("Warehouses loaded successfully")}catch(a){console.error("Error loading warehouses:",a),r("showNotification",{type:"error",message:"خطأ في تحميل المخازن"}),e("SET_WAREHOUSES_LOADED",!1)}},async subscribeToWarehouses({commit:e,state:r,dispatch:t}){if(r.unsubscribeWarehouses&&r.unsubscribeWarehouses(),r.userProfile){console.log("Subscribing to warehouses...");try{const r=(0,ue.P)((0,ue.rJ)(le.db,"warehouses"),(0,ue.My)("name_ar")),a=(0,ue.aQ)(r,r=>{console.log("Warehouses snapshot received:",r.size,"warehouses");const t=r.docs.map(e=>({id:e.id,...e.data()}));console.log("Warehouses loaded:",t.length),e("SET_WAREHOUSES",t)},e=>{console.error("Error in warehouses subscription:",e),t("showNotification",{type:"error",message:"خطأ في تحديث بيانات المخازن"})});e("SET_UNSUBSCRIBE_WAREHOUSES",a)}catch(a){console.error("Error setting up warehouses subscription:",a),t("showNotification",{type:"error",message:"خطأ في إعداد اشتراك المخازن"})}}else console.log("Cannot subscribe to warehouses: User not authenticated")},async initializeDefaultWarehouses({commit:e,dispatch:r}){try{console.log("Checking/initializing default warehouses...");const e=[{id:"main_warehouse",name_ar:"مخزن شارع الشيخ",name_en:"Main Warehouse",type:"primary",is_main:!0,status:"active",capacity:1e3,location:"شارع الشيخ، المنوفية",created_at:new Date,updated_at:new Date},{id:"tera_warehouse",name_ar:"مخزن الترعه",name_en:"Teraa Warehouse",type:"primary",status:"active",capacity:800,location:"الترعة، المنوفية",created_at:new Date,updated_at:new Date},{id:"shobeen_warehouse",name_ar:"مخزن موقف شبين",name_en:"Shobeen Warehouse",type:"primary",status:"active",capacity:600,location:"موقف شبين، المنوفية",created_at:new Date,updated_at:new Date},{id:"hyper_warehouse",name_ar:"مخزن هايبر التهامي",name_en:"Hyper El Tahamy Warehouse",type:"primary",status:"active",capacity:500,location:"هايبر التهامي، المنوفية",created_at:new Date,updated_at:new Date},{id:"matbaa_warehouse",name_ar:"مخزن المطبعه",name_en:"Matbaa Warehouse",type:"primary",status:"active",capacity:400,location:"المطبعة، المنوفية",created_at:new Date,updated_at:new Date},{id:"ghabashi_warehouse",name_ar:"مخزن الغباشي",name_en:"Ghabashi Warehouse",type:"primary",status:"active",capacity:300,location:"الغباشي، المنوفية",created_at:new Date,updated_at:new Date},{id:"factory",name_ar:"صرف الي مصنع البران",name_en:"Al Bran Factory Dispatch",type:"dispatch",status:"active",description:"مصنع البران للتصنيع",created_at:new Date,updated_at:new Date},{id:"zahra",name_ar:"صرف الي مخزن الزهراء",name_en:"Al Zahra Warehouse Dispatch",type:"dispatch",status:"active",description:"مخزن الزهراء للتوزيع",created_at:new Date,updated_at:new Date}],t=(0,ue.wP)(le.db);let a=!1;for(const r of e){const e=(0,ue.H9)(le.db,"warehouses",r.id),o=await(0,ue.x7)(e);o.exists()||(a=!0,t.set(e,r),console.log(`Adding warehouse: ${r.name_ar}`))}a?(await t.commit(),console.log("Default warehouses initialized successfully"),r("showNotification",{type:"success",message:"تم تهيئة المخازن الافتراضية"})):console.log("Warehouses already exist, skipping initialization")}catch(t){throw console.error("Error initializing default warehouses:",t),r("showNotification",{type:"error",message:"خطأ في تهيئة المخازن الافتراضية"}),t}},async subscribeToInventory({commit:e,state:r,dispatch:t}){if(r.unsubscribeInventory&&r.unsubscribeInventory(),r.userProfile){console.log("Subscribing to inventory for user role:",r.userProfile.role),console.log("Allowed warehouses:",r.userProfile.allowed_warehouses);try{let o;const s=(0,ue.rJ)(le.db,"items");if("superadmin"===r.userProfile.role)o=(0,ue.P)(s,(0,ue.My)("warehouse_id"),(0,ue.My)("name"));else if("company_manager"===r.userProfile.role||"user"===r.userProfile.role)o=(0,ue.P)(s,(0,ue.My)("warehouse_id"),(0,ue.My)("name"));else{if("warehouse_manager"!==r.userProfile.role)return console.log("User role not authorized for inventory access"),void e("SET_INVENTORY",[]);{const t=r.userProfile.allowed_warehouses||[];if(0===t.length)return console.log("No warehouses assigned to this warehouse manager"),void e("SET_INVENTORY",[]);if(t.includes("all"))o=(0,ue.P)(s,(0,ue.My)("warehouse_id"),(0,ue.My)("name"));else if(t.length<=10)try{o=(0,ue.P)(s,(0,ue._M)("warehouse_id","in",t),(0,ue.My)("warehouse_id"),(0,ue.My)("name"))}catch(a){if("failed-precondition"!==a.code)throw a;console.warn("Composite index required. Using client-side filtering."),e("SET_REQUIRES_COMPOSITE_INDEX",!0),o=(0,ue.P)(s,(0,ue.My)("warehouse_id"),(0,ue.My)("name"))}else console.log("More than 10 warehouses - using client-side filtering"),o=(0,ue.P)(s,(0,ue.My)("warehouse_id"),(0,ue.My)("name"))}}const n=(0,ue.aQ)(o,t=>{console.log("Inventory snapshot received:",t.size,"items");const a=t.docs.map(e=>{const r=e.data();return de.cE.convertForDisplay({id:e.id,...r})});let o=a;if("warehouse_manager"===r.userProfile.role){const e=r.userProfile.allowed_warehouses||[];e.length>0&&!e.includes("all")&&(e.length>10||r.requiresCompositeIndex)&&(o=a.filter(r=>e.includes(r.warehouse_id)))}console.log("Inventory loaded:",o.length,"items"),e("SET_INVENTORY",o)},r=>{console.error("Error in inventory subscription:",r),"failed-precondition"===r.code?(e("SET_REQUIRES_COMPOSITE_INDEX",!0),t("showNotification",{type:"warning",title:"تحذير الفهرس",message:"يجب إنشاء فهرس مركب لتحسين الأداء. راجع وحدة التحكم في Firebase."})):"permission-denied"===r.code?t("showNotification",{type:"error",message:"ليس لديك صلاحية لعرض المخزون"}):t("showNotification",{type:"error",message:"خطأ في تحميل المخزون"}),e("SET_INVENTORY",[])});e("SET_UNSUBSCRIBE_INVENTORY",n)}catch(a){console.error("Error setting up inventory subscription:",a),t("showNotification",{type:"error",message:"خطأ في إعداد اشتراك المخزون"}),e("SET_INVENTORY",[])}}else console.log("Cannot subscribe to inventory: User not authenticated")},async subscribeToTransactions({commit:e,state:r,dispatch:t}){if(r.unsubscribeTransactions&&r.unsubscribeTransactions(),r.userProfile){console.log("Subscribing to transactions...");try{const r=(0,ue.P)((0,ue.rJ)(le.db,"transactions"),(0,ue.My)("timestamp","desc")),a=(0,ue.aQ)(r,r=>{console.log("Transactions snapshot received:",r.size,"transactions");const t=r.docs.map(e=>{const r=e.data();return{id:e.id,...r,_display:{from_warehouse:de.Qi[r.from_warehouse]||r.from_warehouse,to_warehouse:de.Qi[r.to_warehouse]||de.VX[r.to_warehouse]||r.to_warehouse}}});console.log("Transactions loaded:",t.length,"transactions"),e("SET_TRANSACTIONS",t)},r=>{console.error("Error in transactions subscription:",r),t("showNotification",{type:"error",message:"خطأ في تحميل الحركات"}),e("SET_TRANSACTIONS",[])});e("SET_UNSUBSCRIBE_TRANSACTIONS",a)}catch(a){console.error("Error setting up transactions subscription:",a),e("SET_TRANSACTIONS",[])}}else console.log("Cannot subscribe to transactions: User not authenticated")},async getRecentTransactions({commit:e,dispatch:r,state:t}){e("SET_RECENT_TRANSACTIONS_LOADING",!0);try{if(!t.userProfile)return console.log("Cannot load recent transactions: User not authenticated"),[];console.log("Loading recent transactions...");const r=new Date(Date.now()-864e5),a=(0,ue.P)((0,ue.rJ)(le.db,"transactions"),(0,ue._M)("timestamp",">=",r),(0,ue.My)("timestamp","desc"),(0,ue.AB)(20)),o=await(0,ue.GG)(a),s=o.docs.map(e=>{const r=e.data();return{id:e.id,...r,_display:{from_warehouse:de.Qi[r.from_warehouse]||r.from_warehouse,to_warehouse:de.Qi[r.to_warehouse]||de.VX[r.to_warehouse]||r.to_warehouse}}});return console.log("Recent transactions loaded:",s.length),e("SET_RECENT_TRANSACTIONS",s),s}catch(a){return console.error("Error loading recent transactions:",a),r("showNotification",{type:"error",message:"خطأ في تحميل الحركات الحديثة"}),[]}finally{e("SET_RECENT_TRANSACTIONS_LOADING",!1)}},async addInventoryItem({commit:e,dispatch:r,state:t},{itemData:a,isAddingCartons:o=!0}){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!t.userProfile)throw new Error("يجب تسجيل الدخول أولاً");if(!["superadmin","warehouse_manager"].includes(t.userProfile.role))throw new Error("ليس لديك صلاحية لإضافة أصناف");if(!t.user?.uid)throw new Error("معرف المستخدم غير متوفر");if(!a.name?.trim()||!a.code?.trim()||!a.color?.trim()||!a.warehouse_id)throw new Error("جميع الحقول المطلوبة يجب أن تكون مملوءة (الاسم، الكود، اللون، المخزن)");if("warehouse_manager"===t.userProfile.role){const e=t.userProfile.allowed_warehouses||[];if(!e.includes(a.warehouse_id))throw new Error("ليس لديك صلاحية لإضافة أصناف في هذا المخزن")}const s=de.cE.calculateTotalQuantity(a.cartons_count,a.per_carton_count,a.single_bottles_count);if(s<=0)throw new Error("يجب إدخال كمية صحيحة");const n={name:a.name.trim(),code:a.code.trim(),color:a.color.trim(),warehouse_id:a.warehouse_id,cartons_count:Number(a.cartons_count)||0,per_carton_count:Number(a.per_carton_count)||12,single_bottles_count:Number(a.single_bottles_count)||0,supplier:a.supplier?.trim()||"",item_location:a.item_location?.trim()||"",notes:a.notes?.trim()||""};console.log("Adding item with cleaned data:",n);const i=await de.cE.addOrUpdateItem(n,t.user.uid,o);return console.log(`Item ${i.type} successfully:`,i.id),e("ADD_RECENT_TRANSACTION",{type:de.t2.ADD,item_id:i.id,timestamp:new Date,notes:n.notes||"عملية إضافة"}),r("showNotification",{type:"success",message:`تم ${"created"===i.type?"إضافة":"تحديث"} الصنف "${n.name}" بنجاح`}),i}catch(s){console.error("Error adding inventory item:",s);const t=s.message||"حدث خطأ غير متوقع أثناء إضافة الصنف";throw e("SET_OPERATION_ERROR",t),r("showNotification",{type:"error",message:t}),s}finally{e("SET_OPERATION_LOADING",!1)}},async transferItem({commit:e,dispatch:r,state:t},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!t.userProfile)throw new Error("يجب تسجيل الدخول أولاً");if(!["superadmin","warehouse_manager"].includes(t.userProfile.role))throw new Error("ليس لديك صلاحية لنقل الأصناف");if(!t.user?.uid)throw new Error("معرف المستخدم غير متوفر");if("warehouse_manager"===t.userProfile.role){const e=t.userProfile.allowed_warehouses||[];if(!e.includes(a.from_warehouse_id))throw new Error("ليس لديك صلاحية للنقل من هذا المخزن")}const o=await de.cE.transferItem(a,t.user.uid);return console.log("Transfer completed successfully:",o.transferQty),e("ADD_RECENT_TRANSACTION",{type:de.t2.TRANSFER,item_id:a.itemId,timestamp:new Date,notes:"نقل بين المخازن"}),r("showNotification",{type:"success",message:"تم نقل الصنف بنجاح"}),o}catch(o){throw console.error("Error transferring item:",o),e("SET_OPERATION_ERROR",o.message),r("showNotification",{type:"error",message:o.message||"حدث خطأ أثناء نقل الصنف"}),o}finally{e("SET_OPERATION_LOADING",!1)}},async dispatchItem({commit:e,dispatch:r,state:t},a){e("SET_OPERATION_LOADING",!0),e("CLEAR_OPERATION_ERROR");try{if(!t.userProfile)throw new Error("يجب تسجيل الدخول أولاً");const o="superadmin"===t.userProfile.role||"warehouse_manager"===t.userProfile.role&&t.userProfile.permissions?.includes("dispatch_items");if(!o)throw new Error("ليس لديك صلاحية لصرف الأصناف");if(!t.user?.uid)throw new Error("معرف المستخدم غير متوفر");if("warehouse_manager"===t.userProfile.role){const e=t.userProfile.allowed_warehouses||[];if(!e.includes(a.from_warehouse_id))throw new Error("ليس لديك صلاحية للصرف من هذا المخزن")}const s=await de.cE.dispatchItem(a,t.user.uid);return console.log("Dispatch completed successfully:",s.dispatchQty),e("ADD_RECENT_TRANSACTION",{type:de.t2.DISPATCH,item_id:a.itemId,timestamp:new Date,notes:"صرف إلى خارجي"}),r("showNotification",{type:"success",message:"تم صرف الصنف بنجاح"}),s}catch(o){throw console.error("Error dispatching item:",o),e("SET_OPERATION_ERROR",o.message),r("showNotification",{type:"error",message:o.message||"حدث خطأ أثناء صرف الصنف"}),o}finally{e("SET_OPERATION_LOADING",!1)}},updateFilters({commit:e},r){e("SET_FILTERS",r)},removeNotification({commit:e},r){e("REMOVE_NOTIFICATION",r)},clearNotifications({commit:e}){e("CLEAR_NOTIFICATIONS")},clearOperationError({commit:e}){e("CLEAR_OPERATION_ERROR")}},getters:{isAuthenticated:e=>!!e.user,userRole:e=>e.userProfile?.role,userName:e=>e.userProfile?.name||e.userProfile?.email?.split("@")[0],allowedWarehouses:e=>e.userProfile?.allowed_warehouses||[],userPermissions:e=>e.userProfile?.permissions||[],authError:e=>e.authError,operationError:e=>e.operationError,operationLoading:e=>e.operationLoading,fieldMappings:e=>e.fieldMappings,warehousesLoaded:e=>e.warehousesLoaded,notifications:e=>e.notifications,recentTransactions:e=>e.recentTransactions,recentTransactionsLoading:e=>e.recentTransactionsLoading,requiresCompositeIndex:e=>e.requiresCompositeIndex,allUsers:e=>e.allUsers,usersLoading:e=>e.usersLoading,canEdit:(e,r)=>["superadmin","warehouse_manager"].includes(r.userRole),canDelete:(e,r)=>"superadmin"===r.userRole||"warehouse_manager"===r.userRole&&(r.userPermissions.includes("full_access")||r.userPermissions.includes("delete_items")),canManageUsers:e=>"superadmin"===e.userProfile?.role,canManageWarehouses:e=>"superadmin"===e.userProfile?.role,canDispatch:(e,r)=>"superadmin"===r.userRole||"warehouse_manager"===r.userRole&&r.userPermissions.includes("dispatch_items"),mainWarehouse:e=>e.warehouses.find(e=>e.is_main),primaryWarehouses:e=>e.warehouses.filter(e=>"primary"===e.type),dispatchWarehouses:e=>e.warehouses.filter(e=>"dispatch"===e.type),accessibleWarehouses:(e,r)=>{if(!e.warehousesLoaded)return[];if("superadmin"===r.userRole)return e.warehouses;if("warehouse_manager"===r.userRole){const t=r.allowedWarehouses;if(t&&t.length>0){const r=e.warehouses.filter(e=>"primary"===e.type&&t.includes(e.id)),a=e.warehouses.filter(e=>"dispatch"===e.type);return[...r,...a]}}return"company_manager"===r.userRole?e.warehouses:[]},accessiblePrimaryWarehouses:(e,r)=>{const t=r.accessibleWarehouses;return t.filter(e=>"primary"===e.type)},accessibleDispatchWarehouses:(e,r)=>{const t=r.accessibleWarehouses;return t.filter(e=>"dispatch"===e.type)},dispatchFromWarehouses:(e,r)=>{if(!e.warehousesLoaded)return[];if("superadmin"===r.userRole)return e.warehouses.filter(e=>"primary"===e.type);if("warehouse_manager"===r.userRole){const t=r.allowedWarehouses;if(t&&t.length>0)return e.warehouses.filter(e=>"primary"===e.type&&t.includes(e.id))}return[]},filteredInventory:e=>{let r=e.inventory;if("warehouse_manager"===e.userProfile?.role||"company_manager"===e.userProfile?.role){const t=e.userProfile.allowed_warehouses||[];t.length>0&&(r=r.filter(e=>t.includes(e.warehouse_id)))}if(e.filters.search){const t=e.filters.search.toLowerCase();r=r.filter(e=>e.name?.toLowerCase().includes(t)||e.code?.toLowerCase().includes(t)||e.color?.toLowerCase().includes(t)||e.supplier?.toLowerCase().includes(t)||e.item_location?.toLowerCase().includes(t))}return e.filters.warehouse&&(r=r.filter(r=>r.warehouse_id===e.filters.warehouse)),r},dashboardStats:e=>{let r=e.inventory;if("warehouse_manager"===e.userProfile?.role||"company_manager"===e.userProfile?.role){const t=e.userProfile.allowed_warehouses||[];t.length>0&&(r=r.filter(e=>t.includes(e.warehouse_id)))}const t=r.length,a=r.reduce((e,r)=>e+(r.remaining_quantity||0),0),o=r.filter(e=>(e.remaining_quantity||0)<10).length,s=r.filter(e=>0===(e.remaining_quantity||0)).length,n=50,i=a*n,l=e.recentTransactions.length,c=e.recentTransactions.filter(e=>e.type===de.t2.ADD).length,u=e.recentTransactions.filter(e=>e.type===de.t2.TRANSFER).length,d=e.recentTransactions.filter(e=>e.type===de.t2.DISPATCH).length;return{totalItems:t,totalQuantity:a,lowStockItems:o,outOfStockItems:s,estimatedValue:i,recentTransactions:l,addTransactions:c,transferTransactions:u,dispatchTransactions:d,transactionsByType:{add:c,transfer:u,dispatch:d}}},getArabicLabel:e=>r=>e.fieldMappings.englishToArabic[r]||r,getWarehouseLabel:e=>r=>{if(!r)return"";const t=e.warehouses.find(e=>e.id===r);return t?t.name_ar:r},getDestinationLabel:()=>e=>de.VX[e]||e,getWarehouseById:e=>r=>e.warehouses.find(e=>e.id===r)}});function _e(e){const r={"auth/invalid-email":"البريد الإلكتروني غير صحيح","auth/user-disabled":"هذا الحساب معطل","auth/user-not-found":"لا يوجد حساب بهذا البريد الإلكتروني","auth/wrong-password":"كلمة المرور غير صحيحة","auth/email-already-in-use":"هذا البريد الإلكتروني مستخدم بالفعل","auth/weak-password":"كلمة المرور ضعيفة","auth/network-request-failed":"خطأ في الاتصال بالشبكة","auth/too-many-requests":"محاولات تسجيل دخول كثيرة. يرجى المحاولة لاحقاً","auth/configuration-not-found":"خطأ في إعدادات النظام"};return r[e]||"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى"}function ge(){const e=document.getElementById("app");e&&(e.innerHTML='\n    <div id="app-loading" style="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      color: white;\n      z-index: 9999;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', \'Tajawal\', sans-serif;\n    ">\n      <div style="text-align: center; max-width: 90%;">\n        <div style="\n          width: 80px;\n          height: 80px;\n          border: 6px solid rgba(255,255,255,0.3);\n          border-top-color: white;\n          border-radius: 50%;\n          animation: spin 1.5s linear infinite;\n          margin: 0 auto 30px;\n        "></div>\n\n        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">\n          نظام إدارة المخازن\n        </h1>\n\n        <p style="font-size: 16px; opacity: 0.9; margin-bottom: 40px;">\n          جاري تحميل النظام...\n        </p>\n\n        <div style="\n          width: 200px;\n          height: 4px;\n          background: rgba(255,255,255,0.2);\n          border-radius: 2px;\n          margin: 0 auto;\n          overflow: hidden;\n        ">\n          <div id="progress-bar" style="\n            width: 30%;\n            height: 100%;\n            background: white;\n            border-radius: 2px;\n            animation: progress 2s ease-in-out infinite;\n          "></div>\n        </div>\n\n        <p style="font-size: 12px; opacity: 0.7; margin-top: 30px;">\n          الإصدار 1.0.0 | Monofia Inventory\n        </p>\n      </div>\n      <style>\n        @keyframes spin { to { transform: rotate(360deg); } }\n        @keyframes progress {\n          0%, 100% { transform: translateX(-100%); }\n          50% { transform: translateX(250%); }\n        }\n      </style>\n    </div>\n  ')}async function we(){return new Promise((e,r)=>{console.log("🔐 Initializing Firebase authentication...");const t=(0,ce.hg)(le.j2,async r=>{if(console.log("✅ Firebase auth state:",r?`User: ${r.email}`:"No user"),r)try{pe.commit("SET_USER",r),await pe.dispatch("loadUserProfile",r),console.log("✅ User profile loaded"),e({user:r,isAuthenticated:!0})}catch(a){console.error("❌ Failed to load user profile:",a),pe.commit("SET_USER",null),e({user:null,isAuthenticated:!1})}else pe.commit("SET_USER",null),pe.commit("SET_USER_PROFILE",null),e({user:null,isAuthenticated:!1});t()},e=>{console.error("❌ Firebase auth error:",e),pe.commit("SET_USER",null),r(e)})})}async function ye(){try{ge();const e=await we(),r=(0,a.Ef)(te);return r.use(pe),r.use(ie),r.config.errorHandler=(e,r,t)=>{console.error("Vue Error:",e,t),pe.dispatch("showNotification",{type:"error",message:"حدث خطأ في النظام"})},r.mount("#app"),setTimeout(()=>{const e=document.getElementById("app-loading");e&&(e.style.opacity="0",e.style.transition="opacity 0.3s ease",setTimeout(()=>e.remove(),300))},500),console.log("✅ App initialized successfully"),console.log("📊 Initial auth state:",{isAuthenticated:e.isAuthenticated,user:e.user?.email}),{app:r,router:ie,store:pe}}catch(e){console.error("❌ Failed to initialize app:",e);const r=document.getElementById("app");throw r&&(r.innerHTML=`\n        <div style="\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: #f8f9fa;\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n          padding: 20px;\n          text-align: center;\n          font-family: system-ui;\n        ">\n          <div style="max-width: 500px;">\n            <h2 style="color: #e74c3c; margin-bottom: 20px;">⚠️ خطأ في التحميل</h2>\n            <p style="margin-bottom: 20px; color: #666;">${e.message||"حدث خطأ في تحميل التطبيق"}</p>\n            <button onclick="window.location.reload()" style="\n              padding: 12px 24px;\n              background: #3498db;\n              color: white;\n              border: none;\n              border-radius: 6px;\n              font-size: 16px;\n              cursor: pointer;\n              margin: 5px;\n            ">\n              🔄 إعادة التحميل\n            </button>\n          </div>\n        </div>\n      `),e}}console.log("🚀 Starting Warehouse Management System..."),ye().catch(console.error),console.log("📄 Main.js loaded")},5062:function(e,r,t){t.d(r,{Qi:function(){return n},VX:function(){return i},XY:function(){return s},cE:function(){return u},t2:function(){return l}});var a=t(2405),o=t(3556);const s={name:"الاسم",code:"الكود",color:"اللون",cartons_count:"عدد الكراتين",per_carton_count:"عدد في الكرتونة",single_bottles_count:"عدد القزاز الفردي",total_added:"الكميه المضافه",remaining_quantity:"الكميه المتبقيه",warehouse_id:"المخزن",supplier:"المورد",item_location:"مكان الصنف",created_at:"تاريخ الإنشاء",updated_at:"تاريخ التحديث",created_by:"تم الإنشاء بواسطة",updated_by:"تم التحديث بواسطة",notes:"ملاحظات"},n={main_warehouse:"مخزن شارع الشيخ",tera_warehouse:"مخزن الترعه",shobeen_warehouse:"مخزن موقف شبين",hyper_warehouse:"مخزن هايبر التهامي"},i={factory:"صرف الي مصنع البران",zahra:"صرف الي مخزن الزهراء"},l={ADD:"ADD",TRANSFER:"TRANSFER",DISPATCH:"DISPATCH"},c={ITEM_NOT_FOUND:"الصنف غير موجود",WRONG_WAREHOUSE:"الصنف ليس في المخزن المحدد",INSUFFICIENT_QUANTITY:"الكمية المطلوبة غير متوفرة",UNAUTHORIZED:"ليس لديك صلاحية للقيام بهذا الإجراء",NETWORK_ERROR:"خطأ في الاتصال بالشبكة",UNKNOWN_ERROR:"حدث خطأ غير متوقع",INVALID_DATA:"بيانات غير صحيحة"};class u{static async addOrUpdateItem(e,r,t=!0){try{const{warehouse_id:a,code:o,color:s,name:n}=e;if(!a||!o||!s||!n)throw new Error("بيانات غير مكتملة: يرجى التأكد من إدخال جميع الحقول المطلوبة (الاسم، الكود، اللون، المخزن)");if(!r)throw new Error("يجب تسجيل الدخول أولاً");const i=this._cleanItemData(e),l=await this._findExistingItem(i);return l?await this._updateExistingItem(l,i,r,t):await this._createNewItem(i,r)}catch(a){throw console.error("Error in addOrUpdateItem:",a),this._handleError(a)}}static async _findExistingItem(e){try{const r=(0,a.rJ)(o.db,"items");if(!e.warehouse_id||!e.code||!e.color||!e.name)return console.warn("Missing required fields for query:",e),null;const t=(0,a.P)(r,(0,a._M)("warehouse_id","==",e.warehouse_id),(0,a._M)("code","==",e.code.trim()),(0,a._M)("color","==",e.color.trim()),(0,a._M)("name","==",e.name.trim())),s=await(0,a.GG)(t);return s.empty?null:{id:s.docs[0].id,...s.docs[0].data()}}catch(r){return console.error("Error finding existing item:",r),null}}static _cleanItemData(e){const r={...e};if(r.name=r.name?.trim()||"",r.code=r.code?.trim()||"",r.color=r.color?.trim()||"",r.supplier=r.supplier?.trim()||"",r.item_location=r.item_location?.trim()||"",r.notes=r.notes?.trim()||"",!r.name)throw new Error("اسم الصنف مطلوب");if(!r.code)throw new Error("كود الصنف مطلوب");if(!r.color)throw new Error("لون الصنف مطلوب");if(!r.warehouse_id)throw new Error("المخزن مطلوب");if(r.cartons_count=Number(r.cartons_count)||0,r.per_carton_count=Number(r.per_carton_count)||1,r.single_bottles_count=Number(r.single_bottles_count)||0,r.supplier=r.supplier||"",r.item_location=r.item_location||"",r.notes=r.notes||"",r.cartons_count<0)throw new Error("عدد الكراتين لا يمكن أن يكون سالباً");if(r.per_carton_count<1)throw new Error("عدد القطع في الكرتونة يجب أن يكون 1 على الأقل");if(r.single_bottles_count<0)throw new Error("عدد القزاز الفردي لا يمكن أن يكون سالباً");return r}static async _updateExistingItem(e,r,t,s){const n=(0,a.wP)(o.db),i=new Date,c={updated_at:i,updated_by:t};let u=0;if(s){const t=e.cartons_count||0,a=r.cartons_count||0;c.cartons_count=t+a,void 0!==r.per_carton_count&&null!==r.per_carton_count&&r.per_carton_count>=1?c.per_carton_count=r.per_carton_count:c.per_carton_count=e.per_carton_count||1;const o=c.per_carton_count;u=a*o,c.single_bottles_count=e.single_bottles_count||0}else void 0!==r.single_bottles_count&&null!==r.single_bottles_count?(c.single_bottles_count=Math.max(0,r.single_bottles_count),u=r.single_bottles_count):c.single_bottles_count=e.single_bottles_count||0,c.cartons_count=e.cartons_count||0,c.per_carton_count=e.per_carton_count||1;const d=e.total_added||0,m=e.remaining_quantity||0;if(c.total_added=d+u,c.remaining_quantity=m+u,void 0!==r.notes&&(c.notes=r.notes),void 0!==r.supplier&&(c.supplier=r.supplier),void 0!==r.item_location&&(c.item_location=r.item_location),c.remaining_quantity<0)throw new Error("الكمية المتبقية لا يمكن أن تكون سالبة");if(c.total_added<d)throw new Error("الكمية المضافة التراكمية لا يمكن أن تقل");const h=(0,a.H9)(o.db,"items",e.id);n.update(h,c);const p=(0,a.H9)((0,a.rJ)(o.db,"transactions"));return n.set(p,{item_id:e.id,from_warehouse:null,to_warehouse:r.warehouse_id,type:l.ADD,cartons_delta:s&&r.cartons_count||0,single_delta:s?0:r.single_bottles_count||0,per_carton_updated:r.per_carton_count,previous_remaining:m,new_remaining:c.remaining_quantity,timestamp:i,user_id:t,notes:r.notes||(s?"إضافة كراتين للمخزن":"إضافة قزاز فردي للمخزن"),created_at:i}),await n.commit(),{type:"updated",id:e.id,addedQuantity:u}}static async _createNewItem(e,r){const t=(0,a.wP)(o.db),s=new Date,n=e.cartons_count||0,i=e.per_carton_count||1,c=e.single_bottles_count||0,u=n*i+c;if(!e.name||!e.code||!e.color||!e.warehouse_id)throw new Error("جميع الحقول المطلوبة يجب أن تكون مملوءة (الاسم، الكود، اللون، المخزن)");if(u<=0)throw new Error("يجب إدخال كمية صحيحة");const d={name:e.name,code:e.code,color:e.color,warehouse_id:e.warehouse_id,cartons_count:n,per_carton_count:i,single_bottles_count:c,total_added:u,remaining_quantity:u,supplier:e.supplier||"",item_location:e.item_location||"",notes:e.notes||"",created_at:s,created_by:r,updated_at:s,updated_by:r},m=(0,a.H9)((0,a.rJ)(o.db,"items"));t.set(m,d);const h=(0,a.H9)((0,a.rJ)(o.db,"transactions"));return t.set(h,{item_id:m.id,from_warehouse:null,to_warehouse:e.warehouse_id,type:l.ADD,cartons_delta:n,single_delta:c,per_carton_updated:i,previous_remaining:0,new_remaining:u,timestamp:s,user_id:r,notes:e.notes||"إنشاء صنف جديد",created_at:s}),await t.commit(),{type:"created",id:m.id,addedQuantity:u}}static async transferItem(e,r){try{const{item_id:t,from_warehouse:s,to_warehouse:i,cartons:u,single_bottles:d,notes:m}=e;if(!t||!s||!i)throw new Error("بيانات النقل غير مكتملة");if(!r)throw new Error("يجب تسجيل الدخول أولاً");const h=Number(u)||0,p=Number(d)||0;if(h<=0&&p<=0)throw new Error("يجب تحديد كمية للنقل");return await(0,a.c4)(o.db,async e=>{const u=(0,a.H9)(o.db,"items",t),d=await e.get(u);if(!d.exists())throw new Error(c.ITEM_NOT_FOUND);const _=d.data();if(_.warehouse_id!==s)throw new Error(c.WRONG_WAREHOUSE);const g=_.per_carton_count||1,w=h*g+p;if(w>_.remaining_quantity)throw new Error(c.INSUFFICIENT_QUANTITY);const y={remaining_quantity:_.remaining_quantity-w,updated_at:new Date,updated_by:r};h>0&&(y.cartons_count=Math.max(0,(_.cartons_count||0)-h)),p>0&&(y.single_bottles_count=Math.max(0,(_.single_bottles_count||0)-p)),await e.update(u,y),await this._handleDestinationItem(e,_,i,h,p,w,r);const f=(0,a.H9)((0,a.rJ)(o.db,"transactions"));return await e.set(f,{item_id:t,from_warehouse:s,to_warehouse:i,type:l.TRANSFER,cartons_delta:-h,single_delta:-p,per_carton_updated:_.per_carton_count,previous_remaining:_.remaining_quantity,new_remaining:y.remaining_quantity,timestamp:new Date,user_id:r,notes:m||`نقل من ${n[s]} إلى ${n[i]}`,created_at:new Date}),{success:!0,transferQty:w,sourceItemId:t,destinationWarehouse:i}})}catch(t){throw console.error("Error in transferItem:",t),this._handleError(t)}}static async _handleDestinationItem(e,r,t,s,n,i,l){const c=(0,a.rJ)(o.db,"items"),u=(0,a.P)(c,(0,a._M)("warehouse_id","==",t),(0,a._M)("code","==",r.code),(0,a._M)("color","==",r.color),(0,a._M)("name","==",r.name)),d=await(0,a.GG)(u),m=new Date;if(!d.empty&&d.docs.length>0){const r=d.docs[0],t=r.data(),c={total_added:(t.total_added||0)+i,remaining_quantity:(t.remaining_quantity||0)+i,cartons_count:(t.cartons_count||0)+s,single_bottles_count:(t.single_bottles_count||0)+n,updated_at:m,updated_by:l},u=(0,a.H9)(o.db,"items",r.id);await e.update(u,c)}else{const c={name:r.name,code:r.code,color:r.color,warehouse_id:t,cartons_count:s,per_carton_count:r.per_carton_count||1,single_bottles_count:n,total_added:i,remaining_quantity:i,supplier:r.supplier||"",item_location:r.item_location||"",notes:r.notes||"",created_at:m,created_by:l,updated_at:m,updated_by:l},u=(0,a.H9)((0,a.rJ)(o.db,"items"));await e.set(u,c)}}static async dispatchItem(e,r){try{const{item_id:t,from_warehouse:s,to_destination:n,cartons:u,single_bottles:d,notes:m}=e;if(!t||!s||!n)throw new Error("بيانات الصرف غير مكتملة");if(!r)throw new Error("يجب تسجيل الدخول أولاً");const h=Number(u)||0,p=Number(d)||0;if(h<=0&&p<=0)throw new Error("يجب تحديد كمية للصرف");return await(0,a.c4)(o.db,async e=>{const u=(0,a.H9)(o.db,"items",t),d=await e.get(u);if(!d.exists())throw new Error(c.ITEM_NOT_FOUND);const _=d.data();if(_.warehouse_id!==s)throw new Error(c.WRONG_WAREHOUSE);const g=_.per_carton_count||1,w=h*g+p;if(w>_.remaining_quantity)throw new Error(c.INSUFFICIENT_QUANTITY);const y={remaining_quantity:_.remaining_quantity-w,updated_at:new Date,updated_by:r};h>0&&(y.cartons_count=Math.max(0,(_.cartons_count||0)-h)),p>0&&(y.single_bottles_count=Math.max(0,(_.single_bottles_count||0)-p)),await e.update(u,y);const f=(0,a.H9)((0,a.rJ)(o.db,"transactions"));return await e.set(f,{item_id:t,from_warehouse:s,to_warehouse:n,type:l.DISPATCH,cartons_delta:-h,single_delta:-p,per_carton_updated:_.per_carton_count,previous_remaining:_.remaining_quantity,new_remaining:y.remaining_quantity,timestamp:new Date,user_id:r,notes:m||`صرف إلى ${i[n]||n}`,created_at:new Date}),{success:!0,dispatchQty:w,itemId:t,destination:n}})}catch(t){throw console.error("Error in dispatchItem:",t),this._handleError(t)}}static async getLowStockItems(e=null){try{let r=(0,a.rJ)(o.db,"items");r=e?(0,a.P)(r,(0,a._M)("warehouse_id","==",e),(0,a._M)("remaining_quantity","<",10)):(0,a.P)(r,(0,a._M)("remaining_quantity","<",10));const t=await(0,a.GG)(r);return t.docs.map(e=>({id:e.id,...e.data(),_display:{warehouse:n[e.data().warehouse_id]||e.data().warehouse_id}}))}catch(r){throw console.error("Error in getLowStockItems:",r),this._handleError(r)}}static async getRecentTransactions(e=50){try{const r=(0,a.P)((0,a.rJ)(o.db,"transactions"),(0,a.My)("timestamp","desc")),t=await(0,a.GG)(r),s=t.docs.slice(0,e).map(e=>({id:e.id,...e.data()}));return s.map(e=>({...e,_display:{from_warehouse:n[e.from_warehouse]||e.from_warehouse,to_warehouse:n[e.to_warehouse]||i[e.to_warehouse]||e.to_warehouse}}))}catch(r){throw console.error("Error in getRecentTransactions:",r),this._handleError(r)}}static async getWarehouseItems(e){try{if(!e)throw new Error("يجب تحديد المخزن");const r=(0,a.P)((0,a.rJ)(o.db,"items"),(0,a._M)("warehouse_id","==",e),(0,a.My)("name")),t=await(0,a.GG)(r);return t.docs.map(e=>({id:e.id,...e.data(),_display:{warehouse:n[e.data().warehouse_id]||e.data().warehouse_id}}))}catch(r){throw console.error("Error in getWarehouseItems:",r),this._handleError(r)}}static async getAllItems(e=50){try{const r=(0,a.P)((0,a.rJ)(o.db,"items"),(0,a.My)("name")),t=await(0,a.GG)(r),s=t.docs.slice(0,e).map(e=>({id:e.id,...e.data()}));return s.map(e=>({...e,_display:{warehouse:n[e.warehouse_id]||e.warehouse_id}}))}catch(r){throw console.error("Error in getAllItems:",r),this._handleError(r)}}static async searchItems(e,r=null){try{if(!e||e.trim().length<2)throw new Error("يجب إدخال مصطلح بحث مكون من حرفين على الأقل");const t=e.toLowerCase().trim();let a=[];return a=r?await this.getWarehouseItems(r):await this.getAllItems(1e3),a.filter(e=>e.name?.toLowerCase().includes(t)||e.code?.toLowerCase().includes(t)||e.color?.toLowerCase().includes(t)||e.supplier?.toLowerCase().includes(t))}catch(t){throw console.error("Error in searchItems:",t),this._handleError(t)}}static async getItemById(e){try{if(!e)throw new Error("معرف الصنف مطلوب");const r=await(0,a.x7)((0,a.H9)(o.db,"items",e));if(!r.exists())throw new Error(c.ITEM_NOT_FOUND);return{id:r.id,...r.data(),_display:{warehouse:n[r.data().warehouse_id]||r.data().warehouse_id}}}catch(r){throw console.error("Error in getItemById:",r),this._handleError(r)}}static async updateItemDetails(e,r,t){try{if(!e||!t)throw new Error("معرف الصنف ومعرف المستخدم مطلوبان");const s=["supplier","item_location","notes","per_carton_count"],n={};for(const e of s)void 0!==r[e]&&(n[e]=r[e]);if(void 0!==n.per_carton_count&&n.per_carton_count<1)throw new Error("عدد القطع في الكرتونة يجب أن يكون 1 على الأقل");n.updated_at=new Date,n.updated_by=t;const i=(0,a.H9)(o.db,"items",e);return await(0,a.mZ)(i,n),{success:!0,itemId:e}}catch(s){throw console.error("Error in updateItemDetails:",s),this._handleError(s)}}static async getWarehouseStats(e=null){try{let r=(0,a.rJ)(o.db,"items");e&&(r=(0,a.P)(r,(0,a._M)("warehouse_id","==",e)));const t=await(0,a.GG)(r),s=t.docs.map(e=>e.data()),i=s.length,l=s.reduce((e,r)=>e+(r.remaining_quantity||0),0),c=s.filter(e=>(e.remaining_quantity||0)<10).length,u=s.filter(e=>0===(e.remaining_quantity||0)).length;return{totalItems:i,totalQuantity:l,lowStockItems:c,outOfStockItems:u,warehouse:e?n[e]:"جميع المخازن"}}catch(r){throw console.error("Error in getWarehouseStats:",r),this._handleError(r)}}static convertForDisplay(e){return Array.isArray(e)?e.map(e=>this._addDisplayLabels(e)):this._addDisplayLabels(e)}static _addDisplayLabels(e){return e?{...e,_display:{warehouse:n[e.warehouse_id]||e.warehouse_id}}:e}static _handleError(e){if(console.error("Inventory Service Error:",e),e.code)switch(e.code){case"permission-denied":return new Error("ليس لديك صلاحية للقيام بهذا الإجراء");case"unavailable":return new Error("الخدمة غير متاحة حالياً. يرجى المحاولة لاحقاً");case"resource-exhausted":return new Error("تم تجاوز الحد المسموح. يرجى المحاولة لاحقاً");case"failed-precondition":return new Error("البيانات غير صالحة للعملية المطلوبة");case"invalid-argument":return new Error("بيانات غير صحيحة");default:return new Error(e.message||c.UNKNOWN_ERROR)}return e.message&&e.message.includes(" ")?e:new Error(e.message||c.UNKNOWN_ERROR)}static calculateTotalQuantity(e,r,t){const a=(Number(e)||0)*(Number(r)||1),o=Number(t)||0;return a+o}static validateItemData(e,r="create"){const t=[];if(e.name?.trim()||t.push("الاسم مطلوب"),e.code?.trim()||t.push("الكود مطلوب"),e.color?.trim()||t.push("اللون مطلوب"),e.warehouse_id||t.push("المخزن مطلوب"),"create"===r){const r=this.calculateTotalQuantity(e.cartons_count,e.per_carton_count,e.single_bottles_count);r<=0&&t.push("يجب إدخال كمية صحيحة")}if(t.length>0)throw new Error(t.join("، "));return!0}}}},function(e){var r=function(r){return e(e.s=r)};e.O(0,[297,360,335,965,290,425,647,157,309,545,130,218],function(){return r(3795)});e.O()}]);