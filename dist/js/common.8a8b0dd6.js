"use strict";(self["webpackChunkmonofia_perfume_inventory"]=self["webpackChunkmonofia_perfume_inventory"]||[]).push([[76],{3727:function(e,t,a){a.d(t,{A:function(){return R}});var r=a(641),o=a(33),s=a(3751);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},n={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg rtl max-h-[90vh] overflow-y-auto"},i={class:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700"},d={class:"text-xl font-semibold text-gray-800 dark:text-white"},u=["readonly"],c={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},m=["value","onUpdate:modelValue"],v={class:"flex w-full items-center justify-between"},p={class:"flex items-center"},g={class:"text-sm"},b={class:"font-medium text-gray-900 dark:text-white"},k={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},h={key:0,class:"h-5 w-5 text-blue-600 dark:text-blue-400",viewBox:"0 0 20 20",fill:"currentColor"},y={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},x={class:"relative"},f={class:"relative inline-flex items-center cursor-pointer"},w={class:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300"},L={key:0},_={class:"flex items-center"},C={key:1,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},E={class:"text-sm text-red-700 dark:text-red-300 list-disc pr-5 space-y-1"},W={key:2,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},M={class:"flex items-center gap-2"},D={class:"text-sm text-red-700 dark:text-red-300"},X={class:"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700"},I=["disabled"],j={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},q={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function B(e,t,a,B,V,Q){return a.isOpen?((0,r.uX)(),(0,r.CE)("div",l,[(0,r.Lk)("div",n,[(0,r.Lk)("div",i,[(0,r.Lk)("h2",d,(0,o.v_)(a.warehouse?"تعديل المخزن":"إضافة مخزن جديد"),1),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>B.closeModal&&B.closeModal(...e)),class:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors duration-200"},[...t[11]||(t[11]=[(0,r.Lk)("svg",{class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,r.Lk)("form",{onSubmit:t[10]||(t[10]=(0,s.D$)((...e)=>B.handleSubmit&&B.handleSubmit(...e),["prevent"])),class:"p-6 space-y-6"},[(0,r.Lk)("div",null,[t[12]||(t[12]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,r.eW)(" معرف المخزن "),(0,r.Lk)("span",{class:"text-red-500"},"*"),(0,r.Lk)("span",{class:"text-xs text-gray-500 dark:text-gray-400 block mt-1"},"يجب أن يكون معرفاً فريداً بالإنجليزية")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[1]||(t[1]=e=>B.formData.id=e),readonly:!!a.warehouse,class:(0,o.C4)(["w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono",{"bg-gray-100 dark:bg-gray-800":!!a.warehouse}]),placeholder:"مثال: main_warehouse"},null,10,u),[[s.Jo,B.formData.id]])]),(0,r.Lk)("div",null,[t[13]||(t[13]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,r.eW)(" اسم المخزن (عربي) "),(0,r.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[2]||(t[2]=e=>B.formData.name_ar=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-right",placeholder:"مخزن رئيسي"},null,512),[[s.Jo,B.formData.name_ar]])]),(0,r.Lk)("div",null,[t[14]||(t[14]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," اسم المخزن (إنجليزي) ",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>B.formData.name_en=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Main Warehouse"},null,512),[[s.Jo,B.formData.name_en]])]),(0,r.Lk)("div",null,[t[16]||(t[16]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},[(0,r.eW)(" نوع المخزن "),(0,r.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,r.Lk)("div",c,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(B.warehouseTypes,e=>((0,r.uX)(),(0,r.CE)("label",{key:e.value,class:(0,o.C4)(["relative flex cursor-pointer rounded-lg border p-4 focus:outline-none transition-colors duration-200",{"border-blue-600 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/20":B.formData.type===e.value,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700":B.formData.type!==e.value}])},[(0,r.bo)((0,r.Lk)("input",{type:"radio",value:e.value,"onUpdate:modelValue":e=>B.formData.type=e,class:"sr-only"},null,8,m),[[s.XL,B.formData.type]]),(0,r.Lk)("div",v,[(0,r.Lk)("div",p,[(0,r.Lk)("div",g,[(0,r.Lk)("div",b,(0,o.v_)(e.name),1),(0,r.Lk)("div",k,(0,o.v_)(e.description),1)])]),B.formData.type===e.value?((0,r.uX)(),(0,r.CE)("svg",h,[...t[15]||(t[15]=[(0,r.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])])):(0,r.Q3)("",!0)])],2))),128))])]),(0,r.Lk)("div",y,[(0,r.Lk)("div",null,[t[18]||(t[18]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," السعة التخزينية ",-1)),(0,r.Lk)("div",x,[(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=e=>B.formData.capacity=e),min:"0",step:"1",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white pr-10",placeholder:"1000"},null,512),[[s.Jo,B.formData.capacity,void 0,{number:!0}]]),t[17]||(t[17]=(0,r.Lk)("span",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400"},"وحدة",-1))])]),(0,r.Lk)("div",null,[t[19]||(t[19]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," الموقع ",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>B.formData.location=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"شارع الشيخ، المنوفية"},null,512),[[s.Jo,B.formData.location]])])]),(0,r.Lk)("div",null,[t[20]||(t[20]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," وصف المخزن ",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>B.formData.description=e),rows:"3",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"وصف إضافي للمخزن..."},null,512),[[s.Jo,B.formData.description]])]),(0,r.Lk)("div",null,[t[22]||(t[22]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"حالة المخزن",-1)),(0,r.Lk)("label",f,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>B.formData.status=e),"true-value":"active","false-value":"inactive",class:"sr-only peer"},null,512),[[s.lH,B.formData.status]]),t[21]||(t[21]=(0,r.Lk)("div",{class:"w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"},null,-1)),(0,r.Lk)("span",w,(0,o.v_)("active"===B.formData.status?"نشط":"غير نشط"),1)])]),"primary"===B.formData.type?((0,r.uX)(),(0,r.CE)("div",L,[(0,r.Lk)("div",_,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>B.formData.is_main=e),"true-value":!0,"false-value":!1,id:"is_main",class:"h-4 w-4 text-blue-600 dark:text-blue-400 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400"},null,512),[[s.lH,B.formData.is_main]]),t[23]||(t[23]=(0,r.Lk)("label",{for:"is_main",class:"mr-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," تعيين كمخزن رئيسي ",-1))]),t[24]||(t[24]=(0,r.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"}," المخزن الرئيسي هو المخزن الافتراضي في النظام ",-1))])):(0,r.Q3)("",!0),B.validationErrors.length>0?((0,r.uX)(),(0,r.CE)("div",C,[t[25]||(t[25]=(0,r.Lk)("h4",{class:"text-sm font-medium text-red-800 dark:text-red-300 mb-2"},"خطأ في التحقق:",-1)),(0,r.Lk)("ul",E,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(B.validationErrors,e=>((0,r.uX)(),(0,r.CE)("li",{key:e},(0,o.v_)(e),1))),128))])])):(0,r.Q3)("",!0),B.errorMessage?((0,r.uX)(),(0,r.CE)("div",W,[(0,r.Lk)("div",M,[t[26]||(t[26]=(0,r.Lk)("svg",{class:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),(0,r.Lk)("p",D,(0,o.v_)(B.errorMessage),1)])])):(0,r.Q3)("",!0),(0,r.Lk)("div",X,[(0,r.Lk)("button",{type:"button",onClick:t[9]||(t[9]=(...e)=>B.closeModal&&B.closeModal(...e)),class:"flex-1 py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 font-medium"}," إلغاء "),(0,r.Lk)("button",{type:"submit",disabled:B.loading||!B.isFormValid,class:"flex-1 py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-md hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 font-medium flex items-center justify-center gap-2"},[B.loading?((0,r.uX)(),(0,r.CE)("svg",j,[...t[27]||(t[27]=[(0,r.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,r.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,r.uX)(),(0,r.CE)("svg",q,[...t[28]||(t[28]=[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),(0,r.eW)(" "+(0,o.v_)(B.loading?"جاري الحفظ...":a.warehouse?"تحديث":"إضافة"),1)],8,I)])],32)])])):(0,r.Q3)("",!0)}var V=a(953),Q=a(834),S=a(3556),F=a(2405),K={name:"WarehouseModal",props:{isOpen:{type:Boolean,required:!0},warehouse:{type:Object,default:null}},emits:["close","save"],setup(e,{emit:t}){const a=(0,Q.Pj)(),o=(0,V.KR)(!1),s=(0,V.KR)(""),l=(0,V.KR)([]),n=(0,V.KR)({id:"",name_ar:"",name_en:"",type:"primary",capacity:0,location:"",description:"",status:"active",is_main:!1}),i=(0,V.KR)([{value:"primary",name:"مخزن رئيسي",description:"مخزن للتخزين الداخلي"},{value:"dispatch",name:"موقع صرف",description:"موقع لصرف الأصناف للخارج"}]),d=(0,r.EW)(()=>(l.value=[],n.value.id.trim()?/^[a-z0-9_]+$/.test(n.value.id)||l.value.push("معرف المخزن يجب أن يحتوي على أحرف إنجليزية صغيرة وأرقام وشرطة سفلية فقط"):l.value.push("معرف المخزن مطلوب"),n.value.name_ar.trim()||l.value.push("اسم المخزن بالعربي مطلوب"),n.value.type||l.value.push("نوع المخزن مطلوب"),n.value.capacity<0&&l.value.push("السعة التخزينية لا يمكن أن تكون سالبة"),0===l.value.length)),u=()=>{n.value={id:"",name_ar:"",name_en:"",type:"primary",capacity:0,location:"",description:"",status:"active",is_main:!1},s.value="",l.value=[]},c=()=>{u(),t("close")},m=async e=>{try{const t=(0,F.H9)(S.db,"warehouses",e),a=await(0,F.x7)(t);return a.exists()}catch(t){return console.error("Error checking warehouse existence:",t),!1}},v=async()=>{if(d.value){o.value=!0,s.value="";try{const r={id:n.value.id.trim(),name_ar:n.value.name_ar.trim(),name_en:n.value.name_en.trim()||n.value.name_ar.trim(),type:n.value.type,capacity:Number(n.value.capacity)||0,location:n.value.location.trim(),description:n.value.description.trim(),status:n.value.status,is_main:n.value.is_main||!1,updated_at:(new Date).toISOString()};if(e.warehouse)r.created_at=e.warehouse.created_at;else{const e=await m(r.id);if(e)throw new Error("المخزن موجود بالفعل");r.created_at=(new Date).toISOString()}if(!a.getters.canManageWarehouses)throw new Error("ليس لديك صلاحية لإدارة المخازن");const o=(0,F.H9)(S.db,"warehouses",r.id);await(0,F.BN)(o,r,{merge:!0}),console.log("Warehouse saved successfully:",r.id),a.dispatch("showNotification",{type:"success",message:`تم ${e.warehouse?"تحديث":"إضافة"} المخزن "${r.name_ar}" بنجاح`}),t("save",r),c()}catch(r){console.error("Error saving warehouse:",r),s.value=r.message||"حدث خطأ أثناء حفظ المخزن",a.dispatch("showNotification",{type:"error",message:s.value})}finally{o.value=!1}}};return(0,r.wB)(()=>e.isOpen,t=>{t&&(u(),e.warehouse&&(n.value={id:e.warehouse.id,name_ar:e.warehouse.name_ar||"",name_en:e.warehouse.name_en||"",type:e.warehouse.type||"primary",capacity:e.warehouse.capacity||0,location:e.warehouse.location||"",description:e.warehouse.description||"",status:e.warehouse.status||"active",is_main:e.warehouse.is_main||!1}))}),(0,r.wB)(()=>n.value.type,e=>{"dispatch"===e&&(n.value.is_main=!1)}),{loading:o,errorMessage:s,validationErrors:l,formData:n,warehouseTypes:i,isFormValid:d,closeModal:c,handleSubmit:v}}},P=a(6262);const U=(0,P.A)(K,[["render",B]]);var R=U},4013:function(e,t,a){a.d(t,{A:function(){return $e}});var r=a(641),o=a(33),s=a(3751);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},n={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl rtl max-h-[90vh] overflow-y-auto"},i={class:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700"},d={class:"text-xl font-semibold text-gray-800 dark:text-white"},u={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},c=["readonly"],m={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},v={class:"relative inline-flex items-center cursor-pointer"},p={class:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300"},g={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},b=["value","onUpdate:modelValue","disabled"],k={class:"flex w-full items-center justify-between"},h={class:"flex items-center"},y={class:"text-sm"},x={class:"font-medium text-gray-900 dark:text-white"},f={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},w={key:0,class:"h-5 w-5 text-blue-600 dark:text-blue-400",viewBox:"0 0 20 20",fill:"currentColor"},L={key:0,class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},_={key:0},C={class:"flex justify-between items-center mb-3"},E={class:"flex gap-2"},W={key:0,class:"text-center py-4"},M={key:1,class:"space-y-3"},D={key:0},X={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},I={class:"flex items-center h-5"},j=["value"],q={class:"mr-3 text-sm flex-1"},B={class:"flex justify-between items-start"},V={class:"font-medium text-gray-900 dark:text-white"},Q={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},S={class:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},F=["onClick"],K={class:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-2"},P={key:1},U={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},R={class:"flex items-center h-5"},z=["value"],A={class:"mr-3 text-sm"},H={class:"font-medium text-gray-900 dark:text-white"},O={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},$={key:2,class:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},J={class:"flex items-center gap-2"},N={class:"text-sm text-green-700 dark:text-green-300"},T={class:"mt-2 text-xs text-green-600 dark:text-green-400"},G={class:"mr-2 font-medium"},Z={key:2,class:"text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-600 rounded-lg"},Y={class:"mt-4"},ee={key:1},te={class:"flex justify-between items-center mb-3"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},oe={class:"space-y-2"},se=["value"],le={class:"mr-3 text-sm"},ne={class:"font-medium text-gray-700 dark:text-gray-300"},ie={class:"text-gray-500 dark:text-gray-400 text-xs mt-1"},de={class:"mt-4 flex gap-2 flex-wrap"},ue={key:2,class:"bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg"},ce={class:"flex justify-between items-center mb-2"},me={class:"flex gap-2"},ve={class:"flex gap-3"},pe=["type"],ge={class:"mt-2"},be={class:"flex items-center justify-between mb-1"},ke={class:"h-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},he={key:0,class:"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md"},ye={class:"flex items-center gap-2"},xe={class:"flex-1 font-mono text-sm bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700"},fe={key:3,class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Le={class:"text-sm text-blue-700 dark:text-blue-300"},_e={class:"mt-1 text-xs text-blue-600 dark:text-blue-400"},Ce={class:"text-sm text-blue-700 dark:text-blue-300"},Ee={key:0,class:"mt-1 text-xs text-blue-600 dark:text-blue-400 truncate"},We={key:0},Me={key:4,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},De={class:"text-sm text-red-700 dark:text-red-300 list-disc pr-5 space-y-1"},Xe={key:5,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},Ie={class:"flex items-center gap-2"},je={class:"text-sm text-red-700 dark:text-red-300"},qe={class:"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700"},Be=["disabled"],Ve={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Qe={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function Se(e,t,a,Se,Fe,Ke){const Pe=(0,r.g2)("WarehouseModal");return(0,r.uX)(),(0,r.CE)(r.FK,null,[a.isOpen?((0,r.uX)(),(0,r.CE)("div",l,[(0,r.Lk)("div",n,[(0,r.Lk)("div",i,[(0,r.Lk)("h2",d,(0,o.v_)(a.user?"تعديل المستخدم":"إضافة مستخدم جديد"),1),(0,r.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors duration-200"},[...t[23]||(t[23]=[(0,r.Lk)("svg",{class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,r.Lk)("form",{onSubmit:t[22]||(t[22]=(0,s.D$)((...e)=>Se.handleSubmit&&Se.handleSubmit(...e),["prevent"])),class:"p-6 space-y-6"},[(0,r.Lk)("div",u,[(0,r.Lk)("div",null,[t[24]||(t[24]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,r.eW)(" الاسم الكامل "),(0,r.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[1]||(t[1]=e=>Se.formData.name=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"أدخل الاسم الكامل"},null,512),[[s.Jo,Se.formData.name]])]),(0,r.Lk)("div",null,[t[25]||(t[25]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[(0,r.eW)(" البريد الإلكتروني "),(0,r.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"email",required:"","onUpdate:modelValue":t[2]||(t[2]=e=>Se.formData.email=e),readonly:!!a.user,class:(0,o.C4)(["w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",{"bg-gray-100 dark:bg-gray-800":!!a.user}]),placeholder:"example@company.com"},null,10,c),[[s.Jo,Se.formData.email]])])]),(0,r.Lk)("div",m,[(0,r.Lk)("div",null,[t[26]||(t[26]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," رقم الهاتف ",-1)),(0,r.bo)((0,r.Lk)("input",{type:"tel","onUpdate:modelValue":t[3]||(t[3]=e=>Se.formData.phone=e),class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"01XXXXXXXXX"},null,512),[[s.Jo,Se.formData.phone]])]),(0,r.Lk)("div",null,[t[28]||(t[28]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"حالة الحساب",-1)),(0,r.Lk)("label",v,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>Se.formData.is_active=e),class:"sr-only peer"},null,512),[[s.lH,Se.formData.is_active]]),t[27]||(t[27]=(0,r.Lk)("div",{class:"w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"},null,-1)),(0,r.Lk)("span",p,(0,o.v_)(Se.formData.is_active?"نشط":"غير نشط"),1)])])]),(0,r.Lk)("div",null,[t[30]||(t[30]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},[(0,r.eW)(" الدور "),(0,r.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,r.Lk)("div",g,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Se.availableRoles,e=>((0,r.uX)(),(0,r.CE)("label",{key:e.value,class:(0,o.C4)(["relative flex cursor-pointer rounded-lg border p-4 focus:outline-none transition-colors duration-200",{"border-blue-600 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/20":Se.formData.role===e.value,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700":Se.formData.role!==e.value}])},[(0,r.bo)((0,r.Lk)("input",{type:"radio",value:e.value,"onUpdate:modelValue":e=>Se.formData.role=e,disabled:"superadmin"===a.user?.role,class:"sr-only"},null,8,b),[[s.XL,Se.formData.role]]),(0,r.Lk)("div",k,[(0,r.Lk)("div",h,[(0,r.Lk)("div",y,[(0,r.Lk)("div",x,(0,o.v_)(e.name),1),(0,r.Lk)("div",f,(0,o.v_)(e.description),1)])]),Se.formData.role===e.value?((0,r.uX)(),(0,r.CE)("svg",w,[...t[29]||(t[29]=[(0,r.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])])):(0,r.Q3)("",!0)])],2))),128))]),"superadmin"===a.user?.role?((0,r.uX)(),(0,r.CE)("p",L," لا يمكن تغيير دور المشرف العام ")):(0,r.Q3)("",!0)]),"warehouse_manager"===Se.formData.role?((0,r.uX)(),(0,r.CE)("div",_,[(0,r.Lk)("div",C,[t[32]||(t[32]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[(0,r.eW)(" المخازن المسموحة "),(0,r.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,r.Lk)("div",E,[(0,r.Lk)("button",{type:"button",onClick:t[5]||(t[5]=(...e)=>Se.toggleAllWarehouses&&Se.toggleAllWarehouses(...e)),class:"text-sm px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200"},(0,o.v_)(Se.formData.allowed_warehouses.length===Se.allWarehouses.length?"إلغاء الكل":"اختيار الكل"),1),(0,r.Lk)("button",{type:"button",onClick:t[6]||(t[6]=(...e)=>Se.manageWarehouses&&Se.manageWarehouses(...e)),class:"text-sm px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-md hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors duration-200 flex items-center gap-1"},[...t[31]||(t[31]=[(0,r.Lk)("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),(0,r.eW)(" إدارة المخازن ",-1)])])])]),t[44]||(t[44]=(0,r.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-3"}," اختر المخازن التي يمكن للمستخدم الوصول إليها. سيتمكن المستخدم من إجراء جميع العمليات في المخازن المختارة. ",-1)),Se.loadingWarehouses?((0,r.uX)(),(0,r.CE)("div",W,[...t[33]||(t[33]=[(0,r.Lk)("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 dark:border-blue-400 mx-auto"},null,-1),(0,r.Lk)("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},"جاري تحميل المخازن...",-1)])])):((0,r.uX)(),(0,r.CE)("div",M,[Se.primaryWarehouses.length>0?((0,r.uX)(),(0,r.CE)("div",D,[t[36]||(t[36]=(0,r.Lk)("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"المخازن الرئيسية",-1)),(0,r.Lk)("div",X,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Se.primaryWarehouses,e=>((0,r.uX)(),(0,r.CE)("label",{key:e.id,class:(0,o.C4)(["relative flex items-start p-3 border rounded-lg transition-colors duration-200 group",{"border-blue-300 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/20":Se.formData.allowed_warehouses.includes(e.id),"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600":!Se.formData.allowed_warehouses.includes(e.id)}])},[(0,r.Lk)("div",I,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[7]||(t[7]=e=>Se.formData.allowed_warehouses=e),class:"h-4 w-4 text-blue-600 dark:text-blue-400 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400"},null,8,j),[[s.lH,Se.formData.allowed_warehouses]])]),(0,r.Lk)("div",q,[(0,r.Lk)("div",B,[(0,r.Lk)("div",null,[(0,r.Lk)("div",V,(0,o.v_)(e.name_ar),1),(0,r.Lk)("div",Q,(0,o.v_)(e.name_en),1)]),(0,r.Lk)("div",S,[(0,r.Lk)("button",{type:"button",onClick:(0,s.D$)(t=>Se.editWarehouse(e),["stop"]),class:"p-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",title:"تعديل"},[...t[34]||(t[34]=[(0,r.Lk)("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,F)])]),(0,r.Lk)("div",K,[(0,r.Lk)("span",null,"السعة: "+(0,o.v_)(e.capacity||"غير محددة"),1),t[35]||(t[35]=(0,r.Lk)("span",null,"•",-1)),(0,r.Lk)("span",null,"الموقع: "+(0,o.v_)(e.location||"غير محدد"),1)])])],2))),128))])])):(0,r.Q3)("",!0),Se.dispatchWarehouses.length>0?((0,r.uX)(),(0,r.CE)("div",P,[t[37]||(t[37]=(0,r.Lk)("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"مواقع الصرف",-1)),(0,r.Lk)("div",U,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Se.dispatchWarehouses,e=>((0,r.uX)(),(0,r.CE)("label",{key:e.id,class:(0,o.C4)(["relative flex items-start p-3 border rounded-lg transition-colors duration-200",{"border-purple-300 dark:border-purple-500 bg-purple-50 dark:bg-purple-900/20":Se.formData.allowed_warehouses.includes(e.id),"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600":!Se.formData.allowed_warehouses.includes(e.id)}])},[(0,r.Lk)("div",R,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[8]||(t[8]=e=>Se.formData.allowed_warehouses=e),class:"h-4 w-4 text-purple-600 dark:text-purple-400 border-gray-300 dark:border-gray-600 rounded focus:ring-purple-500 dark:focus:ring-purple-400"},null,8,z),[[s.lH,Se.formData.allowed_warehouses]])]),(0,r.Lk)("div",A,[(0,r.Lk)("div",H,(0,o.v_)(e.name_ar),1),(0,r.Lk)("div",O,(0,o.v_)(e.description||e.name_en),1)])],2))),128))])])):(0,r.Q3)("",!0),Se.formData.allowed_warehouses.length>0?((0,r.uX)(),(0,r.CE)("div",$,[(0,r.Lk)("div",J,[t[38]||(t[38]=(0,r.Lk)("svg",{class:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),(0,r.Lk)("span",N," تم اختيار "+(0,o.v_)(Se.formData.allowed_warehouses.length)+" مخزن ",1)]),(0,r.Lk)("div",T,[t[39]||(t[39]=(0,r.Lk)("span",null,"المخازن المختارة:",-1)),(0,r.Lk)("span",G,(0,o.v_)(Se.getSelectedWarehouseNames().join("، ")),1)])])):(0,r.Q3)("",!0)])),Se.loadingWarehouses||0!==Se.allWarehouses.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Z,[t[41]||(t[41]=(0,r.Lk)("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),t[42]||(t[42]=(0,r.Lk)("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"لا توجد مخازن",-1)),t[43]||(t[43]=(0,r.Lk)("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"ابدأ بإضافة مخازن جديدة للنظام.",-1)),(0,r.Lk)("div",Y,[(0,r.Lk)("button",{type:"button",onClick:t[9]||(t[9]=(...e)=>Se.addNewWarehouse&&Se.addNewWarehouse(...e)),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800"},[...t[40]||(t[40]=[(0,r.Lk)("svg",{class:"ml-2 -mr-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),(0,r.eW)(" إضافة مخزن جديد ",-1)])])])]))])):(0,r.Q3)("",!0),Se.formData.role?((0,r.uX)(),(0,r.CE)("div",ee,[(0,r.Lk)("div",te,[t[45]||(t[45]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," إدارة الصلاحيات ",-1)),(0,r.Lk)("button",{type:"button",onClick:t[10]||(t[10]=(...e)=>Se.toggleAllPermissions&&Se.toggleAllPermissions(...e)),class:"text-sm px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200"},(0,o.v_)(Se.allPermissionsSelected?"إلغاء الكل":"اختيار الكل"),1)]),(0,r.Lk)("div",ae,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Se.permissionGroups,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.category},[(0,r.Lk)("h4",re,(0,o.v_)(e.label),1),(0,r.Lk)("div",oe,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.permissions,e=>((0,r.uX)(),(0,r.CE)("label",{key:e.value,class:(0,o.C4)(["flex items-center p-2 border rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200",{"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20":Se.formData.permissions.includes(e.value),"border-gray-200 dark:border-gray-700":!Se.formData.permissions.includes(e.value)}])},[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:e.value,"onUpdate:modelValue":t[11]||(t[11]=e=>Se.formData.permissions=e),class:"h-4 w-4 text-blue-600 dark:text-blue-400 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400"},null,8,se),[[s.lH,Se.formData.permissions]]),(0,r.Lk)("div",le,[(0,r.Lk)("div",ne,(0,o.v_)(e.name),1),(0,r.Lk)("div",ie,(0,o.v_)(e.description),1)])],2))),128))])]))),128))]),(0,r.Lk)("div",de,[(0,r.Lk)("button",{type:"button",onClick:t[12]||(t[12]=e=>Se.applyPermissionSet("view_only")),class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200"}," صلاحيات مشاهدة فقط "),(0,r.Lk)("button",{type:"button",onClick:t[13]||(t[13]=e=>Se.applyPermissionSet("basic_operations")),class:"px-3 py-1 text-sm border border-blue-300 dark:border-blue-600 text-blue-700 dark:text-blue-300 rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors duration-200"}," عمليات أساسية "),(0,r.Lk)("button",{type:"button",onClick:t[14]||(t[14]=e=>Se.applyPermissionSet("full_access")),class:"px-3 py-1 text-sm border border-green-300 dark:border-green-600 text-green-700 dark:text-green-300 rounded-md hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors duration-200"}," صلاحيات كاملة "),(0,r.Lk)("button",{type:"button",onClick:t[15]||(t[15]=e=>Se.applyPermissionSet("warehouse_manager")),class:"px-3 py-1 text-sm border border-purple-300 dark:border-purple-600 text-purple-700 dark:text-purple-300 rounded-md hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-colors duration-200"}," مدير مخازن نموذجي ")])])):(0,r.Q3)("",!0),a.user?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",ue,[(0,r.Lk)("div",ce,[t[46]||(t[46]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[(0,r.eW)(" كلمة المرور "),(0,r.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,r.Lk)("div",me,[(0,r.Lk)("button",{type:"button",onClick:t[16]||(t[16]=(...e)=>Se.togglePasswordVisibility&&Se.togglePasswordVisibility(...e)),class:"text-sm px-2 py-1 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},(0,o.v_)(Se.showPassword?"إخفاء":"إظهار"),1),(0,r.Lk)("button",{type:"button",onClick:t[17]||(t[17]=(...e)=>Se.generateStrongPassword&&Se.generateStrongPassword(...e)),class:"text-sm px-2 py-1 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"}," توليد قوي ")])]),(0,r.Lk)("div",ve,[(0,r.bo)((0,r.Lk)("input",{type:Se.showPassword?"text":"password",required:"","onUpdate:modelValue":t[18]||(t[18]=e=>Se.formData.password=e),class:"flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"كلمة المرور المؤقتة"},null,8,pe),[[s.hp,Se.formData.password]]),(0,r.Lk)("button",{type:"button",onClick:t[19]||(t[19]=(...e)=>Se.generatePassword&&Se.generatePassword(...e)),class:"px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200 text-sm font-medium"}," توليد عشوائي ")]),(0,r.Lk)("div",ge,[(0,r.Lk)("div",be,[t[47]||(t[47]=(0,r.Lk)("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"قوة كلمة المرور:",-1)),(0,r.Lk)("span",{class:(0,o.C4)(["text-xs font-medium",Se.passwordStrength.color])},(0,o.v_)(Se.passwordStrength.label),3)]),(0,r.Lk)("div",ke,[(0,r.Lk)("div",{class:(0,o.C4)(["h-full transition-all duration-300",Se.passwordStrength.color]),style:(0,o.Tr)({width:Se.passwordStrength.percentage+"%"})},null,6)])]),t[51]||(t[51]=(0,r.Lk)("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-2"}," يجب أن تكون كلمة المرور 8 أحرف على الأقل وتحتوي على حروف وأرقام ",-1)),Se.formData.password?((0,r.uX)(),(0,r.CE)("div",he,[t[49]||(t[49]=(0,r.Lk)("div",{class:"flex items-center gap-2 mb-2"},[(0,r.Lk)("svg",{class:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})]),(0,r.Lk)("span",{class:"text-sm font-medium text-yellow-800 dark:text-yellow-300"},"كلمة المرور المؤقتة")],-1)),(0,r.Lk)("div",ye,[(0,r.Lk)("code",xe,(0,o.v_)(Se.formData.password),1),(0,r.Lk)("button",{type:"button",onClick:t[20]||(t[20]=(...e)=>Se.copyPassword&&Se.copyPassword(...e)),class:"p-2 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",title:"نسخ"},[...t[48]||(t[48]=[(0,r.Lk)("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])])]),t[50]||(t[50]=(0,r.Lk)("p",{class:"text-xs text-yellow-700 dark:text-yellow-400 mt-2"}," سيتم إرسال هذه الكلمة إلى المستخدم. يجب عليه تغييرها عند أول دخول. ",-1))])):(0,r.Q3)("",!0)])),Se.formData.role?((0,r.uX)(),(0,r.CE)("div",fe,[t[54]||(t[54]=(0,r.Lk)("h4",{class:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-3"},"ملخص المستخدم:",-1)),(0,r.Lk)("div",we,[(0,r.Lk)("div",null,[t[52]||(t[52]=(0,r.Lk)("div",{class:"text-xs text-blue-600 dark:text-blue-400 mb-1"},"الدور والصلاحيات",-1)),(0,r.Lk)("div",Le,(0,o.v_)(Se.getRoleDisplay(Se.formData.role)),1),(0,r.Lk)("div",_e,(0,o.v_)(Se.formData.permissions.length)+" صلاحية محددة ",1)]),(0,r.Lk)("div",null,[t[53]||(t[53]=(0,r.Lk)("div",{class:"text-xs text-blue-600 dark:text-blue-400 mb-1"},"الوصول إلى المخازن",-1)),(0,r.Lk)("div",Ce,(0,o.v_)(Se.formData.allowed_warehouses.length)+" مخزن ",1),Se.formData.allowed_warehouses.length>0?((0,r.uX)(),(0,r.CE)("div",Ee,[(0,r.eW)((0,o.v_)(Se.getSelectedWarehouseNames().slice(0,2).join("، "))+" ",1),Se.formData.allowed_warehouses.length>2?((0,r.uX)(),(0,r.CE)("span",We,"وآخرون")):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)])])])):(0,r.Q3)("",!0),Se.validationErrors.length>0?((0,r.uX)(),(0,r.CE)("div",Me,[t[55]||(t[55]=(0,r.Lk)("h4",{class:"text-sm font-medium text-red-800 dark:text-red-300 mb-2"},"خطأ في التحقق:",-1)),(0,r.Lk)("ul",De,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Se.validationErrors,e=>((0,r.uX)(),(0,r.CE)("li",{key:e},(0,o.v_)(e),1))),128))])])):(0,r.Q3)("",!0),Se.errorMessage?((0,r.uX)(),(0,r.CE)("div",Xe,[(0,r.Lk)("div",Ie,[t[56]||(t[56]=(0,r.Lk)("svg",{class:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),(0,r.Lk)("p",je,(0,o.v_)(Se.errorMessage),1)])])):(0,r.Q3)("",!0),(0,r.Lk)("div",qe,[(0,r.Lk)("button",{type:"button",onClick:t[21]||(t[21]=t=>e.$emit("close")),class:"flex-1 py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 font-medium"}," إلغاء "),(0,r.Lk)("button",{type:"submit",disabled:Se.loading||!Se.isFormValid,class:"flex-1 py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-md hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 font-medium flex items-center justify-center gap-2"},[Se.loading?((0,r.uX)(),(0,r.CE)("svg",Ve,[...t[57]||(t[57]=[(0,r.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,r.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,r.uX)(),(0,r.CE)("svg",Qe,[...t[58]||(t[58]=[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),(0,r.eW)(" "+(0,o.v_)(Se.loading?"جاري الحفظ...":a.user?"تحديث المستخدم":"إضافة مستخدم"),1)],8,Be)])],32)])])):(0,r.Q3)("",!0),Se.showWarehouseModal?((0,r.uX)(),(0,r.Wv)(Pe,{key:1,warehouse:Se.editingWarehouse,onClose:Se.closeWarehouseModal,onSave:Se.handleWarehouseSave},null,8,["warehouse","onClose","onSave"])):(0,r.Q3)("",!0)],64)}var Fe=a(953),Ke=a(834),Pe=a(3556),Ue=a(1032),Re=a(2405),ze=a(3727),Ae={name:"AddUserModal",components:{WarehouseModal:ze.A},props:{isOpen:{type:Boolean,required:!0},user:{type:Object,default:null}},emits:["close","save","warehouse-updated"],setup(e,{emit:t}){const a=(0,Ke.Pj)(),o=(0,Fe.KR)(!1),s=(0,Fe.KR)(!1),l=(0,Fe.KR)(""),n=(0,Fe.KR)([]),i=(0,Fe.KR)(!1),d=(0,Fe.KR)(!1),u=(0,Fe.KR)(null),c=(0,Fe.KR)({name:"",email:"",role:"company_manager",is_active:!0,phone:"",allowed_warehouses:[],permissions:[],password:""}),m=(0,Fe.KR)([{value:"superadmin",name:"المشرف العام",description:"صلاحيات كاملة على النظام"},{value:"warehouse_manager",name:"مدير المخازن",description:"إدارة المخزون والحركات في المخازن المحددة"},{value:"company_manager",name:"مدير الشركة",description:"عرض التقارير والبيانات (قراءة فقط)"}]),v=(0,Fe.KR)([{category:"inventory",label:"إدارة المخزون",permissions:[{value:"manage_inventory",name:"إدارة المخزون",description:"إضافة وتعديل المخزون"},{value:"create_transfers",name:"إنشاء التحويلات",description:"نقل المخزون بين المخازن"},{value:"dispatch_items",name:"صرف الأصناف",description:"صرف الأصناف للخارج"},{value:"update_items",name:"تحديث الأصناف",description:"تعديل بيانات الأصناف"},{value:"delete_items",name:"حذف الأصناف",description:"إزالة الأصناف من النظام"}]},{category:"reports",label:"التقارير والمتابعة",permissions:[{value:"view_reports",name:"عرض التقارير",description:"مشاهدة تقارير المخزون"},{value:"export_data",name:"تصدير البيانات",description:"تصدير البيانات إلى Excel"},{value:"view_analytics",name:"عرض التحليلات",description:"مشاهدة الإحصائيات والتحليلات"}]},{category:"system",label:"إدارة النظام",permissions:[{value:"manage_warehouses",name:"إدارة المخازن",description:"إضافة وتعديل المخازن"},{value:"manage_users",name:"إدارة المستخدمين",description:"إضافة وتعديل المستخدمين"},{value:"system_settings",name:"إعدادات النظام",description:"تعديل إعدادات النظام"}]},{category:"advanced",label:"صلاحيات متقدمة",permissions:[{value:"audit_logs",name:"سجلات المراجعة",description:"مشاهدة سجلات النظام"},{value:"backup_restore",name:"النسخ الاحتياطي",description:"النسخ والاستعادة"},{value:"full_access",name:"وصول كامل",description:"جميع الصلاحيات بدون قيود"}]}]),p=(0,r.EW)(()=>a.state.warehouses||[]),g=(0,r.EW)(()=>p.value.filter(e=>"primary"===e.type)),b=(0,r.EW)(()=>p.value.filter(e=>"dispatch"===e.type)),k=(0,r.EW)(()=>{const e=v.value.flatMap(e=>e.permissions.map(e=>e.value));return e.every(e=>c.value.permissions.includes(e))}),h=(0,r.EW)(()=>{const e=c.value.password||"";let t=0;e.length>=8&&(t+=1),/[A-Z]/.test(e)&&(t+=1),/[a-z]/.test(e)&&(t+=1),/\d/.test(e)&&(t+=1),/[^A-Za-z0-9]/.test(e)&&(t+=1);const a=t/5*100;return t<=1?{label:"ضعيفة",color:"bg-red-500",percentage:a}:t<=3?{label:"متوسطة",color:"bg-yellow-500",percentage:a}:{label:"قوية",color:"bg-green-500",percentage:a}}),y=(0,r.EW)(()=>(n.value=[],c.value.name.trim()||n.value.push("الاسم الكامل مطلوب"),c.value.email.trim()?x(c.value.email)||n.value.push("صيغة البريد الإلكتروني غير صحيحة"):n.value.push("البريد الإلكتروني مطلوب"),c.value.role||n.value.push("الدور مطلوب"),e.user||c.value.password?!e.user&&c.value.password.length<8&&n.value.push("كلمة المرور يجب أن تكون 8 أحرف على الأقل"):n.value.push("كلمة المرور مطلوبة"),"warehouse_manager"===c.value.role&&0===c.value.allowed_warehouses.length&&n.value.push("يجب اختيار مخزن واحد على الأقل لمدير المخازن"),c.value.phone&&!f(c.value.phone)&&n.value.push("رقم الهاتف غير صحيح"),"warehouse_manager"===c.value.role&&0===c.value.permissions.length&&n.value.push("يجب تحديد صلاحيات على الأقل لمدير المخازن"),0===n.value.length)),x=e=>{const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},f=e=>{const t=/^01[0-9]{9}$/;return t.test(e)},w=e=>{const t={superadmin:"المشرف العام",warehouse_manager:"مدير المخازن",company_manager:"مدير الشركة"};return t[e]||e},L=()=>c.value.allowed_warehouses.map(e=>{const t=p.value.find(t=>t.id===e);return t?t.name_ar:e}),_=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let a=0;a<10;a++)t+=e.charAt(Math.floor(Math.random()*e.length));c.value.password=t},C=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",t="abcdefghijklmnopqrstuvwxyz",a="0123456789",r="!@#$%^&*";let o="";o+=e.charAt(Math.floor(Math.random()*e.length)),o+=t.charAt(Math.floor(Math.random()*t.length)),o+=a.charAt(Math.floor(Math.random()*a.length)),o+=r.charAt(Math.floor(Math.random()*r.length));const s=e+t+a+r;for(let l=4;l<12;l++)o+=s.charAt(Math.floor(Math.random()*s.length));c.value.password=o.split("").sort(()=>Math.random()-.5).join("")},E=()=>{i.value=!i.value},W=async()=>{try{await navigator.clipboard.writeText(c.value.password),a.dispatch("showNotification",{type:"success",message:"تم نسخ كلمة المرور"})}catch(e){console.error("Failed to copy password:",e)}},M=()=>{c.value.allowed_warehouses.length===p.value.length?c.value.allowed_warehouses=[]:c.value.allowed_warehouses=p.value.map(e=>e.id)},D=()=>{if(k.value)c.value.permissions=[];else{const e=v.value.flatMap(e=>e.permissions.map(e=>e.value));c.value.permissions=[...e]}},X=e=>{const t={view_only:["view_reports","export_data"],basic_operations:["manage_inventory","create_transfers","dispatch_items","view_reports"],full_access:["full_access"],warehouse_manager:["manage_inventory","create_transfers","dispatch_items","update_items","view_reports","export_data"]};c.value.permissions=t[e]||[]},I=()=>{t("warehouse-updated"),a.dispatch("showNotification",{type:"info",message:"يمكنك إدارة المخازن من قائمة المخازن في الشريط الجانبي"})},j=()=>{u.value=null,d.value=!0},q=e=>{u.value=e,d.value=!0},B=()=>{d.value=!1,u.value=null},V=async e=>{try{if(await a.dispatch("loadWarehouses"),c.value.allowed_warehouses.includes(e.id)){const t=c.value.allowed_warehouses.indexOf(e.id);t>-1&&(c.value.allowed_warehouses[t]=e.id)}B()}catch(t){console.error("Error handling warehouse save:",t)}},Q=()=>{c.value={name:"",email:"",role:"company_manager",is_active:!0,phone:"",allowed_warehouses:[],permissions:[],password:""},l.value="",n.value=[],i.value=!1},S=async()=>{if(0===p.value.length){s.value=!0;try{await a.dispatch("loadWarehouses")}catch(e){console.error("Error loading warehouses:",e),l.value="خطأ في تحميل المخازن"}finally{s.value=!1}}},F=async()=>{if(y.value){o.value=!0,l.value="",n.value=[];try{console.log("Starting user submission process...");const r=a.state.user?.uid;if(!r)throw new Error("يجب تسجيل الدخول أولاً");const o={name:c.value.name.trim(),email:c.value.email.trim().toLowerCase(),role:c.value.role,is_active:!1!==c.value.is_active,phone:c.value.phone.trim()||null,allowed_warehouses:"warehouse_manager"===c.value.role?c.value.allowed_warehouses:[],permissions:Array.isArray(c.value.permissions)?c.value.permissions:[],profile_complete:!0,email_verified:!1,created_by:r,created_at:new Date,updated_at:new Date,last_login:null};let s;if(console.log("Prepared user data for Firestore:",o),e.user){if(console.log("Updating existing user:",e.user.id),delete o.created_at,delete o.created_by,delete o.profile_complete,delete o.email_verified,o.updated_at=new Date,s=await a.dispatch("updateUser",{userId:e.user.id,userData:o}),!s.success)throw new Error(s.error||"فشل في تحديث المستخدم");a.dispatch("showNotification",{type:"success",message:"تم تحديث المستخدم بنجاح"})}else{if(console.log("Creating new user..."),!c.value.password)throw new Error("كلمة المرور مطلوبة");if(c.value.password.length<8)throw new Error("كلمة المرور يجب أن تكون 8 أحرف على الأقل");const e=await(0,Ue.eJ)(Pe.j2,o.email,c.value.password);o.id=e.uid,console.log("Firebase Auth user created:",e.uid),console.log("Saving to Firestore:",o),await(0,Re.BN)((0,Re.H9)(Pe.db,"users",e.uid),o);const t={...o,temporary_password:c.value.password};a.dispatch("showNotification",{type:"success",message:`تم إضافة المستخدم "${o.name}" بنجاح`}),s={success:!0,data:t}}if(!s||!s.success)throw new Error("فشل في عملية الحفظ");t("save",s.data||o),setTimeout(()=>{t("close")},500)}catch(r){console.error("Error in form submission:",r),console.error("Error details:",r.message,r.code);let e=r.message||"حدث خطأ أثناء حفظ المستخدم";r.message.includes("الاسم يجب أن يكون على الأقل حرفين")?e="الاسم يجب أن يكون على الأقل حرفين":r.message.includes("البريد الإلكتروني غير صالح")?e="صيغة البريد الإلكتروني غير صحيحة":"auth/email-already-in-use"===r.code||r.message.includes("البريد الإلكتروني مستخدم بالفعل")?e="البريد الإلكتروني مستخدم بالفعل":"auth/invalid-email"===r.code?e="صيغة البريد الإلكتروني غير صحيحة":"auth/weak-password"===r.code||r.message.includes("كلمة المرور يجب أن تكون 8 أحرف على الأقل")?e="كلمة المرور يجب أن تكون 8 أحرف على الأقل":r.message.includes("يجب اختيار مخزن واحد على الأقل لمدير المخازن")?e="يجب اختيار مخزن واحد على الأقل لمدير المخازن":r.message.includes("يجب تسجيل الدخول أولاً")?e="يجب تسجيل الدخول أولاً":"permission-denied"===r.code?e="ليس لديك صلاحية لإجراء هذا الإجراء":"invalid-argument"===r.code?e="بيانات غير صالحة. يرجى التحقق من الحقول":"firestore/permission-denied"===r.code?e="ليس لديك صلاحية لإجراء هذا الإجراء. تأكد من أنك سوبر أدمن":r.message.includes("profile_complete")&&(e="بيانات المستخدم غير مكتملة. يرجى التحقق من الحقول المطلوبة"),l.value=e,n.value=[e],a.dispatch("showNotification",{type:"error",message:e})}finally{o.value=!1}}};return(0,r.wB)(()=>e.isOpen,async t=>{t&&(Q(),e.user||(C(),X("warehouse_manager")),await S(),e.user&&(c.value={name:e.user.name||"",email:e.user.email||"",role:e.user.role||"company_manager",is_active:!1!==e.user.is_active,phone:e.user.phone||"",allowed_warehouses:e.user.allowed_warehouses||[],permissions:e.user.permissions||[]},delete c.value.password))}),(0,r.wB)(()=>c.value.role,e=>{"warehouse_manager"!==e&&(c.value.allowed_warehouses=[]),"company_manager"===e?X("view_only"):"warehouse_manager"===e?X("warehouse_manager"):"superadmin"===e&&X("full_access")}),(0,r.sV)(async()=>{await S()}),{loading:o,loadingWarehouses:s,errorMessage:l,validationErrors:n,showPassword:i,showWarehouseModal:d,editingWarehouse:u,formData:c,availableRoles:m,permissionGroups:v,allWarehouses:p,primaryWarehouses:g,dispatchWarehouses:b,allPermissionsSelected:k,passwordStrength:h,isFormValid:y,getRoleDisplay:w,getSelectedWarehouseNames:L,generatePassword:_,generateStrongPassword:C,togglePasswordVisibility:E,copyPassword:W,toggleAllWarehouses:M,toggleAllPermissions:D,applyPermissionSet:X,manageWarehouses:I,addNewWarehouse:j,editWarehouse:q,closeWarehouseModal:B,handleWarehouseSave:V,handleSubmit:F}}},He=a(6262);const Oe=(0,He.A)(Ae,[["render",Se]]);var $e=Oe},4502:function(e,t,a){a.d(t,{A:function(){return de}});var r=a(641),o=a(3751),s=a(33);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},n={class:"bg-white rounded-lg w-full max-w-2xl rtl flex flex-col",style:{height:"90vh"}},i={class:"flex justify-between items-center p-4 border-b shrink-0 bg-white"},d={class:"flex-1 overflow-hidden flex flex-col"},u={class:"flex-1 overflow-y-auto min-h-0"},c={class:"p-4 space-y-4"},m={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},v=["value"],p={class:"border border-gray-200 rounded-lg overflow-hidden bg-white"},g={key:0,class:"text-center py-8 text-gray-500 text-sm"},b={key:1},k=["onClick"],h={class:"col-span-1 px-2 py-3 flex items-center justify-center"},y=["value"],x={class:"col-span-7 px-2 py-3"},f={class:"space-y-1"},w={class:"font-medium text-gray-900 line-clamp-1"},L={class:"text-gray-500 text-xs line-clamp-1"},_={class:"text-gray-400 text-xs"},C={class:"col-span-2 px-2 py-3 flex items-center text-gray-500 text-xs"},E={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg overflow-hidden"},W={class:"p-3 space-y-3"},M={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},D={class:"space-y-2"},X={class:"flex justify-between items-center"},I={class:"font-medium text-xs sm:text-sm text-gray-900"},j={class:"flex justify-between items-center"},q={class:"font-medium text-xs sm:text-sm text-gray-900"},B={class:"grid grid-cols-2 gap-2 text-xs sm:text-sm"},V={class:"text-center p-2 bg-blue-100 rounded"},Q={class:"font-bold text-blue-700"},S={class:"text-center p-2 bg-blue-100 rounded"},F={class:"font-bold text-blue-700"},K={class:"space-y-2"},P={class:"grid grid-cols-2 gap-2"},U=["max"],R={class:"text-xs text-gray-500 mt-1"},z=["max"],A={class:"text-xs text-gray-500 mt-1"},H=["value"],O={class:"pt-2 border-t border-blue-200"},$={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2"},J={class:"text-xs sm:text-sm"},N={class:"text-gray-400"},T={class:"p-3 border-t bg-white shrink-0 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]"},G={class:"flex flex-col sm:flex-row gap-2"},Z=["disabled"],Y={key:0,class:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ee={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},te={key:0,class:"mt-2 text-xs text-center text-red-600 bg-red-50 p-1.5 rounded border border-red-200"},ae={key:1,class:"mt-2 text-xs text-center text-green-600 bg-green-50 p-1.5 rounded border border-green-200"};function re(e,t,a,re,oe,se){return a.isOpen?((0,r.uX)(),(0,r.CE)("div",l,[(0,r.Lk)("div",n,[(0,r.Lk)("div",i,[t[14]||(t[14]=(0,r.Lk)("h2",{class:"text-lg font-semibold text-gray-800"},"نقل الأصناف بين المخازن",-1)),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>re.closeModal&&re.closeModal(...e)),class:"p-1 hover:bg-gray-100 rounded transition-colors duration-200"},[...t[13]||(t[13]=[(0,r.Lk)("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,r.Lk)("div",d,[(0,r.Lk)("div",u,[(0,r.Lk)("div",c,[(0,r.Lk)("div",m,[(0,r.Lk)("div",null,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>re.searchTerm=e),placeholder:"ابحث بالاسم، الكود، اللون...",class:"w-full p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[o.Jo,re.searchTerm]])]),(0,r.Lk)("div",null,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>re.filterWarehouse=e),class:"w-full p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[t[15]||(t[15]=(0,r.Lk)("option",{value:""},"جميع المخازن",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(re.primaryWarehouses,e=>((0,r.uX)(),(0,r.CE)("option",{key:e.id,value:e.id},(0,s.v_)(e.name_ar),9,v))),128))],512),[[o.u1,re.filterWarehouse]])])]),(0,r.Lk)("div",p,[t[17]||(t[17]=(0,r.Fv)('<div class="sticky top-0 z-10 bg-gray-50 border-b border-gray-200" data-v-e2e72018><div class="grid grid-cols-12 text-xs font-medium text-gray-500 uppercase tracking-wider" data-v-e2e72018><div class="col-span-1 px-2 py-3 text-center" data-v-e2e72018> ✓ </div><div class="col-span-7 px-2 py-3 text-right" data-v-e2e72018> الصنف </div><div class="col-span-2 px-2 py-3 text-right" data-v-e2e72018> المخزن </div><div class="col-span-2 px-2 py-3 text-center" data-v-e2e72018> المتوفر </div></div></div>',1)),(0,r.Lk)("div",{class:"overflow-y-auto",style:(0,s.Tr)({maxHeight:re.selectedItem?"150px":"250px",minHeight:"100px"})},[0===re.filteredItems.length?((0,r.uX)(),(0,r.CE)("div",g,[...t[16]||(t[16]=[(0,r.Lk)("svg",{class:"mx-auto h-10 w-10 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m8-8V4a1 1 0 00-1-1h-2a1 1 0 00-1 1v1M9 7h6"})],-1),(0,r.Lk)("p",{class:"font-medium"},"لا توجد أصناف متاحة للنقل",-1),(0,r.Lk)("p",{class:"text-xs mt-1"},"قم بتعديل البحث أو الفلتر",-1)])])):((0,r.uX)(),(0,r.CE)("div",b,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(re.filteredItems,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,onClick:t=>re.selectItem(e),class:(0,s.C4)(["grid grid-cols-12 cursor-pointer transition-colors duration-150 text-sm border-b border-gray-100 hover:bg-gray-50",re.selectedItem?.id===e.id?"bg-blue-50 border-r-2 border-r-blue-500":""])},[(0,r.Lk)("div",h,[(0,r.bo)((0,r.Lk)("input",{type:"radio",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=e=>re.formData.item_id=e),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,y),[[o.XL,re.formData.item_id]])]),(0,r.Lk)("div",x,[(0,r.Lk)("div",f,[(0,r.Lk)("div",w,(0,s.v_)(e.name),1),(0,r.Lk)("div",L,(0,s.v_)(e.code)+" - "+(0,s.v_)(e.color),1),(0,r.Lk)("div",_,(0,s.v_)(e.cartons_count)+"×"+(0,s.v_)(e.per_carton_count)+" + "+(0,s.v_)(e.single_bottles_count)+" فردي ",1)])]),(0,r.Lk)("div",C,(0,s.v_)(re.getWarehouseShortName(re.getWarehouseName(e.warehouse_id))),1),(0,r.Lk)("div",{class:(0,s.C4)(["col-span-2 px-2 py-3 flex items-center justify-center font-semibold text-sm",re.getQuantityClass(e.remaining_quantity)])},(0,s.v_)(e.remaining_quantity),3)],10,k))),128))]))],4)]),re.selectedItem?((0,r.uX)(),(0,r.CE)("div",E,[(0,r.Lk)("button",{onClick:t[4]||(t[4]=e=>re.isDetailsExpanded=!re.isDetailsExpanded),class:"w-full flex justify-between items-center p-3 bg-blue-100 hover:bg-blue-200 transition-colors duration-200 sm:hidden"},[t[19]||(t[19]=(0,r.Lk)("span",{class:"text-sm font-semibold text-blue-800"},"تفاصيل النقل",-1)),((0,r.uX)(),(0,r.CE)("svg",{class:(0,s.C4)(["w-5 h-5 text-blue-600 transform transition-transform duration-200",re.isDetailsExpanded?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[18]||(t[18]=[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),(0,r.Lk)("div",{class:(0,s.C4)(["sm:block",re.isDetailsExpanded?"block":"hidden"])},[(0,r.Lk)("div",W,[t[29]||(t[29]=(0,r.Lk)("h3",{class:"text-sm font-semibold text-blue-800 hidden sm:block"},"تفاصيل النقل",-1)),(0,r.Lk)("div",M,[(0,r.Lk)("div",D,[(0,r.Lk)("div",X,[t[20]||(t[20]=(0,r.Lk)("span",{class:"text-xs sm:text-sm text-gray-600"},"من المخزن:",-1)),(0,r.Lk)("span",I,(0,s.v_)(re.getWarehouseName(re.selectedItem.warehouse_id)),1)]),(0,r.Lk)("div",j,[t[21]||(t[21]=(0,r.Lk)("span",{class:"text-xs sm:text-sm text-gray-600"},"المتاح:",-1)),(0,r.Lk)("span",q,(0,s.v_)(re.selectedItem.remaining_quantity),1)]),(0,r.Lk)("div",B,[(0,r.Lk)("div",V,[t[22]||(t[22]=(0,r.Lk)("div",{class:"text-gray-600"},"الكراتين",-1)),(0,r.Lk)("div",Q,(0,s.v_)(re.selectedItem.cartons_count),1)]),(0,r.Lk)("div",S,[t[23]||(t[23]=(0,r.Lk)("div",{class:"text-gray-600"},"الفردي",-1)),(0,r.Lk)("div",F,(0,s.v_)(re.selectedItem.single_bottles_count),1)])])]),(0,r.Lk)("div",K,[(0,r.Lk)("div",P,[(0,r.Lk)("div",null,[t[24]||(t[24]=(0,r.Lk)("label",{class:"block text-xs sm:text-sm font-medium text-gray-700 mb-1"},"كراتين",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"0",max:re.selectedItem.cartons_count,"onUpdate:modelValue":t[5]||(t[5]=e=>re.formData.cartons=e),class:"w-full p-1 sm:p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent",onChange:t[6]||(t[6]=(...e)=>re.validateQuantities&&re.validateQuantities(...e))},null,40,U),[[o.Jo,re.formData.cartons,void 0,{number:!0}]]),(0,r.Lk)("div",R,"حد: "+(0,s.v_)(re.selectedItem.cartons_count),1)]),(0,r.Lk)("div",null,[t[25]||(t[25]=(0,r.Lk)("label",{class:"block text-xs sm:text-sm font-medium text-gray-700 mb-1"},"فردي",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"0",max:re.selectedItem.single_bottles_count,"onUpdate:modelValue":t[7]||(t[7]=e=>re.formData.single_bottles=e),class:"w-full p-1 sm:p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent",onChange:t[8]||(t[8]=(...e)=>re.validateQuantities&&re.validateQuantities(...e))},null,40,z),[[o.Jo,re.formData.single_bottles,void 0,{number:!0}]]),(0,r.Lk)("div",A,"حد: "+(0,s.v_)(re.selectedItem.single_bottles_count),1)])]),(0,r.Lk)("div",null,[t[27]||(t[27]=(0,r.Lk)("label",{class:"block text-xs sm:text-sm font-medium text-gray-700 mb-1"},"إلى المخزن",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>re.formData.to_warehouse=e),required:"",class:"w-full p-1 sm:p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent"},[t[26]||(t[26]=(0,r.Lk)("option",{value:""},"اختر المخزن",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(re.availableDestinationWarehouses,e=>((0,r.uX)(),(0,r.CE)("option",{key:e.id,value:e.id},(0,s.v_)(re.getWarehouseShortName(e.name_ar)),9,H))),128))],512),[[o.u1,re.formData.to_warehouse]])])])]),(0,r.Lk)("div",O,[(0,r.Lk)("div",$,[(0,r.Lk)("div",J,[t[28]||(t[28]=(0,r.Lk)("span",{class:"text-gray-600"},"الإجمالي:",-1)),(0,r.Lk)("span",{class:(0,s.C4)(["font-bold mx-1",re.getQuantityClass(re.totalRequestedQuantity)])},(0,s.v_)(re.totalRequestedQuantity),3),(0,r.Lk)("span",N,"/ "+(0,s.v_)(re.selectedItem.remaining_quantity),1)]),re.validationMessage?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,s.C4)(["px-2 py-1 rounded text-xs font-medium whitespace-nowrap mt-1 sm:mt-0","error"===re.validationMessage.type?"bg-red-100 text-red-700 border border-red-200":"bg-green-100 text-green-700 border border-green-200"])},(0,s.v_)(re.validationMessage.text),3)):(0,r.Q3)("",!0)])])])],2)])):(0,r.Q3)("",!0),re.selectedItem?((0,r.uX)(),(0,r.CE)("div",{key:1,class:(0,s.C4)(["sm:block",re.isDetailsExpanded?"block":"hidden sm:block"])},[t[30]||(t[30]=(0,r.Lk)("label",{class:"block text-xs sm:text-sm font-medium text-gray-700 mb-1"},"ملاحظات (اختياري)",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[10]||(t[10]=e=>re.formData.notes=e),rows:"2",class:"w-full p-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"أضف ملاحظات حول عملية النقل..."},null,512),[[o.Jo,re.formData.notes]])],2)):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",T,[(0,r.Lk)("div",G,[(0,r.Lk)("button",{type:"button",onClick:t[11]||(t[11]=(...e)=>re.closeModal&&re.closeModal(...e)),class:"py-2.5 px-3 text-sm font-medium border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors duration-200 flex-1 min-h-[44px]"}," إلغاء "),(0,r.Lk)("button",{type:"button",onClick:t[12]||(t[12]=(...e)=>re.handleSubmit&&re.handleSubmit(...e)),disabled:re.loading||!re.isFormValid,class:"py-2.5 px-3 text-sm font-medium bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center gap-2 flex-1 min-h-[44px]"},[re.loading?((0,r.uX)(),(0,r.CE)("svg",Y,[...t[31]||(t[31]=[(0,r.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,r.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,r.uX)(),(0,r.CE)("svg",ee,[...t[32]||(t[32]=[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7l4-4m0 0l4 4m-4-4v18m0 0l-4-4m4 4l4-4"},null,-1)])])),(0,r.eW)(" "+(0,s.v_)(re.loading?"جاري النقل...":"تأكيد النقل"),1)],8,Z)]),re.selectedItem&&!re.isFormValid?((0,r.uX)(),(0,r.CE)("div",te," ❌ املأ جميع الحقول المطلوبة بشكل صحيح ")):re.selectedItem&&re.isFormValid?((0,r.uX)(),(0,r.CE)("div",ae," ✅ جاهز للنقل - "+(0,s.v_)(re.totalRequestedQuantity)+" وحدة ",1)):(0,r.Q3)("",!0)])])])])):(0,r.Q3)("",!0)}var oe=a(953),se=a(834),le={name:"TransferModal",props:{isOpen:Boolean,item:{type:Object,default:null}},emits:["close","success"],setup(e,{emit:t}){const a=(0,se.Pj)(),o=(0,oe.KR)(!1),s=(0,oe.KR)(""),l=(0,oe.KR)(""),n=(0,oe.KR)(!0),i=(0,oe.KR)({item_id:"",from_warehouse:"",to_warehouse:"",cartons:0,single_bottles:0,notes:""}),d=(0,r.EW)(()=>a.state.warehouses.filter(e=>"primary"===e.type)),u=(0,r.EW)(()=>a.state.inventory||[]),c=(0,r.EW)(()=>u.value.filter(e=>e.remaining_quantity>0)),m=(0,r.EW)(()=>{let e=c.value;if(s.value){const t=s.value.toLowerCase();e=e.filter(e=>(e.name?.toLowerCase().includes(t)||e.code?.toLowerCase().includes(t)||e.color?.toLowerCase().includes(t)||e.supplier?.toLowerCase().includes(t))&&e.remaining_quantity>0)}return l.value&&(e=e.filter(e=>e.warehouse_id===l.value)),e}),v=(0,r.EW)(()=>i.value.item_id?u.value.find(e=>e.id===i.value.item_id):null),p=(0,r.EW)(()=>v.value?d.value.filter(e=>e.id!==v.value.warehouse_id):[]),g=(0,r.EW)(()=>v.value?.per_carton_count||1),b=(0,r.EW)(()=>i.value.cartons*g.value+i.value.single_bottles),k=(0,r.EW)(()=>{if(!v.value)return null;const e=v.value.remaining_quantity;return 0===b.value?{type:"error",text:"❗ حدد كمية"}:b.value>e?{type:"error",text:`❌ ${b.value} > ${e}`}:i.value.cartons>v.value.cartons_count?{type:"error",text:`❌ كراتين: ${i.value.cartons} > ${v.value.cartons_count}`}:i.value.single_bottles>v.value.single_bottles_count?{type:"error",text:`❌ فردي: ${i.value.single_bottles} > ${v.value.single_bottles_count}`}:i.value.to_warehouse?i.value.from_warehouse===i.value.to_warehouse?{type:"error",text:"❌ نفس المخزن"}:{type:"success",text:`✅ ${b.value} / ${e}`}:{type:"error",text:"❗ اختر المخزن"}}),h=(0,r.EW)(()=>v.value&&i.value.to_warehouse&&b.value>0&&"success"===k.value?.type),y=e=>0===e?"text-red-600":e<10?"text-orange-600":"text-green-600",x=e=>{const t=a.state.warehouses.find(t=>t.id===e);return t?t.name_ar:e},f=e=>{const t={"مخزن شارع الشيخ":"الشيخ","مخزن الترعه":"الترعه","مخزن موقف شبين":"شبين","مخزن هايبر التهامي":"التهامي","مخزن المنوفية":"المنوفية","مخزن الزهراء":"الزهراء","مصنع البران":"البران"};return t[e]||(e?e.substring(0,8):"")},w=e=>{i.value.item_id=e.id,i.value.from_warehouse=e.warehouse_id,i.value.cartons=Math.min(1,e.cartons_count),i.value.single_bottles=Math.min(1,e.single_bottles_count),i.value.to_warehouse="",window.innerWidth<640&&(n.value=!0)},L=()=>{if(!v.value)return;i.value.cartons>v.value.cartons_count&&(i.value.cartons=v.value.cartons_count),i.value.single_bottles>v.value.single_bottles_count&&(i.value.single_bottles=v.value.single_bottles_count),i.value.cartons<0&&(i.value.cartons=0),i.value.single_bottles<0&&(i.value.single_bottles=0);const e=i.value.cartons*g.value+i.value.single_bottles;if(e>v.value.remaining_quantity){const e=Math.floor(v.value.remaining_quantity/g.value);if(e<i.value.cartons)i.value.cartons=e,i.value.single_bottles=v.value.remaining_quantity-i.value.cartons*g.value;else{const e=v.value.remaining_quantity-i.value.cartons*g.value;e<i.value.single_bottles&&(i.value.single_bottles=e)}}},_=()=>{t("close"),C()},C=()=>{i.value={item_id:"",from_warehouse:"",to_warehouse:"",cartons:0,single_bottles:0,notes:""},s.value="",l.value="",n.value=window.innerWidth>=640},E=async()=>{if(a.state.user&&v.value&&h.value)if(i.value.from_warehouse!==i.value.to_warehouse){if(b.value<=0)alert("❗ يجب تحديد كمية للنقل");else if(b.value>v.value.remaining_quantity)alert("❌ الكمية المطلوبة تتجاوز الكمية المتاحة");else if(confirm(`هل أنت متأكد من نقل ${b.value} وحدة من "${v.value.name}"؟`)){o.value=!0;try{const e={item_id:i.value.item_id,from_warehouse:i.value.from_warehouse,to_warehouse:i.value.to_warehouse,cartons:i.value.cartons,single_bottles:i.value.single_bottles,notes:i.value.notes,total_quantity:b.value,item_name:v.value.name,item_code:v.value.code,item_color:v.value.color};await a.dispatch("transferItem",e),t("success"),_()}catch(e){console.error("Error transferring item:",e),alert(`❌ خطأ في النقل: ${e.message||"حدث خطأ غير متوقع"}`)}finally{o.value=!1}}}else alert("❌ لا يمكن النقل إلى نفس المخزن")};return"undefined"!==typeof window&&(n.value=window.innerWidth>=640),(0,r.wB)(()=>e.isOpen,t=>{t&&(C(),e.item&&w(e.item))}),(0,r.wB)(()=>i.value.cartons,()=>{L()}),(0,r.wB)(()=>i.value.single_bottles,()=>{L()}),(0,r.wB)(()=>v.value,e=>{e&&L()}),{loading:o,formData:i,searchTerm:s,filterWarehouse:l,isDetailsExpanded:n,primaryWarehouses:d,availableItems:c,filteredItems:m,selectedItem:v,availableDestinationWarehouses:p,totalRequestedQuantity:b,validationMessage:k,isFormValid:h,getQuantityClass:y,getWarehouseName:x,getWarehouseShortName:f,selectItem:w,validateQuantities:L,closeModal:_,handleSubmit:E}}},ne=a(6262);const ie=(0,ne.A)(le,[["render",re],["__scopeId","data-v-e2e72018"]]);var de=ie},6217:function(e,t,a){a.d(t,{A:function(){return ie}});var r=a(641),o=a(33),s=a(3751);const l={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},n={class:"bg-white rounded-2xl shadow-xl w-full max-w-2xl rtl max-h-[90vh] overflow-hidden"},i={class:"sticky top-0 bg-white z-10 px-6 py-4 border-b border-gray-200"},d={class:"flex items-center justify-between"},u={class:"p-6 space-y-6 overflow-y-auto max-h-[calc(90vh-180px)]"},c=["value"],m={class:"grid grid-cols-3 gap-2"},v=["onClick"],p={class:"flex items-center justify-between mb-3"},g={class:"text-xs text-gray-500"},b={class:"relative mb-4"},k={class:"border border-gray-200 rounded-lg overflow-hidden"},h={class:"max-h-60 overflow-y-auto"},y={class:"col-span-5 p-3"},x={class:"font-medium text-sm text-gray-900"},f={class:"text-xs text-gray-500 mt-1"},w={key:0,class:"ml-2"},L={key:1,class:"text-gray-400"},_={class:"col-span-2 p-3 text-center"},C={class:"text-xs font-mono bg-gray-100 text-gray-700 px-2 py-1 rounded"},E={class:"col-span-2 p-3 text-center"},W={class:"col-span-3 p-3 text-center"},M=["onClick"],D={key:0,class:"p-8 text-center"},X={key:0,class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},I={class:"flex items-center justify-between mb-3"},j={class:"grid grid-cols-2 gap-3"},q={class:"text-sm font-medium text-blue-900"},B={class:"text-sm font-medium text-blue-900"},V={class:"text-sm font-medium text-blue-900"},Q={key:1},S={class:"space-y-4"},F={class:"block text-sm font-medium text-gray-700 mb-2"},K={class:"text-xs font-normal text-gray-500"},P={class:"flex items-center space-x-3 space-x-reverse"},U=["disabled"],R=["max"],z=["disabled"],A={class:"flex items-center justify-between mt-2"},H={class:"text-xs text-gray-500"},O={class:"grid grid-cols-3 gap-2"},$=["onClick"],J={key:2,class:"bg-red-50 border border-red-200 rounded-lg p-4"},N={class:"flex items-center"},T={class:"text-sm text-red-600"},G={class:"sticky bottom-0 bg-white border-t border-gray-200 px-6 py-4"},Z={class:"flex space-x-3 space-x-reverse"},Y=["disabled"],ee={key:0,class:"animate-spin h-4 w-4 ml-2 text-white",fill:"none",viewBox:"0 0 24 24"},te={key:1,class:"h-4 w-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function ae(e,t,a,ae,re,oe){return a.isOpen?((0,r.uX)(),(0,r.CE)("div",l,[(0,r.Lk)("div",n,[(0,r.Lk)("div",i,[(0,r.Lk)("div",d,[t[13]||(t[13]=(0,r.Lk)("div",null,[(0,r.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"صرف أصناف للفروع"),(0,r.Lk)("p",{class:"text-sm text-gray-500 mt-1"},"اختر الصنف من القائمة وأدخل كمية الصرف")],-1)),(0,r.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors duration-200"},[...t[12]||(t[12]=[(0,r.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),(0,r.Lk)("div",u,[(0,r.Lk)("div",null,[t[15]||(t[15]=(0,r.Lk)("h4",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},[(0,r.Lk)("span",{class:"h-6 w-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs ml-2"},"1"),(0,r.eW)(" اختر المخزن المصدر ")],-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>ae.form.sourceWarehouse=e),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",onChange:t[2]||(t[2]=(...e)=>ae.onWarehouseChange&&ae.onWarehouseChange(...e))},[t[14]||(t[14]=(0,r.Lk)("option",{value:""},"اختر المخزن المصدر",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ae.warehouses,e=>((0,r.uX)(),(0,r.CE)("option",{key:e.id,value:e.id},(0,o.v_)(e.name_ar),9,c))),128))],544),[[s.u1,ae.form.sourceWarehouse]])]),(0,r.Lk)("div",null,[t[16]||(t[16]=(0,r.Lk)("h4",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},[(0,r.Lk)("span",{class:"h-6 w-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs ml-2"},"2"),(0,r.eW)(" اختر الفرع المستلم ")],-1)),(0,r.Lk)("div",m,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ae.destinations,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.id,onClick:t=>ae.form.destinationBranch=e.id,class:(0,o.C4)(["p-3 border rounded-lg text-sm transition-all duration-200",ae.form.destinationBranch===e.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"])},(0,o.v_)(e.name_ar),11,v))),128))])]),(0,r.Lk)("div",null,[(0,r.Lk)("div",p,[t[17]||(t[17]=(0,r.Lk)("h4",{class:"text-sm font-medium text-gray-700 flex items-center"},[(0,r.Lk)("span",{class:"h-6 w-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs ml-2"},"3"),(0,r.eW)(" اختر الصنف المراد صرفه ")],-1)),(0,r.Lk)("div",g,(0,o.v_)(ae.filteredItems.length)+" صنف متاح ",1)]),(0,r.Lk)("div",b,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>ae.searchTerm=e),type:"text",placeholder:"ابحث عن صنف بالاسم أو الكود...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"},null,512),[[s.Jo,ae.searchTerm]]),t[18]||(t[18]=(0,r.Lk)("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[(0,r.Lk)("svg",{class:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),(0,r.Lk)("div",k,[t[20]||(t[20]=(0,r.Fv)('<div class="grid grid-cols-12 bg-gray-50 text-xs font-medium text-gray-600 border-b border-gray-200" data-v-770c4848><div class="col-span-5 p-3" data-v-770c4848>الصنف</div><div class="col-span-2 p-3 text-center" data-v-770c4848>الكود</div><div class="col-span-2 p-3 text-center" data-v-770c4848>المتاح</div><div class="col-span-3 p-3 text-center" data-v-770c4848>الإجراء</div></div>',1)),(0,r.Lk)("div",h,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ae.filteredItems,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,o.C4)(["grid grid-cols-12 border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150",ae.selectedItem?.id===e.id?"bg-blue-50 border-blue-200":""])},[(0,r.Lk)("div",y,[(0,r.Lk)("div",x,(0,o.v_)(e.الاسم||e.name),1),(0,r.Lk)("div",f,[e.اللون||e.color?((0,r.uX)(),(0,r.CE)("span",w,(0,o.v_)(e.اللون||e.color),1)):(0,r.Q3)("",!0),e.المورد||e.supplier?((0,r.uX)(),(0,r.CE)("span",L,"المورد: "+(0,o.v_)(e.المورد||e.supplier),1)):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",_,[(0,r.Lk)("span",C,(0,o.v_)(e.الكود||e.code),1)]),(0,r.Lk)("div",E,[(0,r.Lk)("span",{class:(0,o.C4)(["text-sm font-medium",ae.getStockClass(e.الكميه_المتبقيه||e.remaining_quantity)])},(0,o.v_)(e.الكميه_المتبقيه||e.remaining_quantity),3)]),(0,r.Lk)("div",W,[(0,r.Lk)("button",{onClick:t=>ae.selectItem(e),class:(0,o.C4)(["px-3 py-1.5 text-xs font-medium rounded-lg transition-colors duration-200",ae.selectedItem?.id===e.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},(0,o.v_)(ae.selectedItem?.id===e.id?"محدد":"اختر"),11,M)])],2))),128)),0===ae.filteredItems.length?((0,r.uX)(),(0,r.CE)("div",D,[...t[19]||(t[19]=[(0,r.Lk)("svg",{class:"mx-auto h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m8-8V4a1 1 0 00-1-1h-2a1 1 0 00-1 1v1M9 7h6"})],-1),(0,r.Lk)("p",{class:"text-sm text-gray-500 mt-2"},"لا توجد أصناف مطابقة للبحث",-1)])])):(0,r.Q3)("",!0)])])]),ae.selectedItem?((0,r.uX)(),(0,r.CE)("div",X,[(0,r.Lk)("div",I,[t[21]||(t[21]=(0,r.Lk)("h5",{class:"text-sm font-medium text-blue-800"},"الصنف المحدد",-1)),(0,r.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>ae.clearSelection&&ae.clearSelection(...e)),class:"text-xs text-blue-600 hover:text-blue-800"}," إلغاء التحديد ")]),(0,r.Lk)("div",j,[(0,r.Lk)("div",null,[t[22]||(t[22]=(0,r.Lk)("div",{class:"text-xs text-blue-600"},"الاسم",-1)),(0,r.Lk)("div",q,(0,o.v_)(ae.selectedItem.الاسم||ae.selectedItem.name),1)]),(0,r.Lk)("div",null,[t[23]||(t[23]=(0,r.Lk)("div",{class:"text-xs text-blue-600"},"الكود",-1)),(0,r.Lk)("div",B,(0,o.v_)(ae.selectedItem.الكود||ae.selectedItem.code),1)]),(0,r.Lk)("div",null,[t[24]||(t[24]=(0,r.Lk)("div",{class:"text-xs text-blue-600"},"المخزن الحالي",-1)),(0,r.Lk)("div",V,(0,o.v_)(ae.getWarehouseName(ae.selectedItem.المخزن_id||ae.selectedItem.warehouse_id)),1)]),(0,r.Lk)("div",null,[t[25]||(t[25]=(0,r.Lk)("div",{class:"text-xs text-blue-600"},"الكمية المتاحة",-1)),(0,r.Lk)("div",{class:(0,o.C4)(["text-sm font-medium",ae.getStockClass(ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity)])},(0,o.v_)(ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity),3)])])])):(0,r.Q3)("",!0),ae.selectedItem?((0,r.uX)(),(0,r.CE)("div",Q,[t[31]||(t[31]=(0,r.Lk)("h4",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},[(0,r.Lk)("span",{class:"h-6 w-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-xs ml-2"},"4"),(0,r.eW)(" أدخل تفاصيل الصرف ")],-1)),(0,r.Lk)("div",S,[(0,r.Lk)("div",null,[(0,r.Lk)("label",F,[t[26]||(t[26]=(0,r.eW)(" الكمية المراد صرفها ",-1)),(0,r.Lk)("span",K," (الحد الأقصى: "+(0,o.v_)(ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity)+") ",1)]),(0,r.Lk)("div",P,[(0,r.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>ae.decreaseQuantity&&ae.decreaseQuantity(...e)),disabled:ae.form.quantity<=1,class:"w-10 h-10 flex items-center justify-center border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[...t[27]||(t[27]=[(0,r.Lk)("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)])],8,U),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>ae.form.quantity=e),type:"number",max:ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity,min:"1",required:"",class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg font-medium"},null,8,R),[[s.Jo,ae.form.quantity,void 0,{number:!0}]]),(0,r.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>ae.increaseQuantity&&ae.increaseQuantity(...e)),disabled:ae.form.quantity>=(ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity),class:"w-10 h-10 flex items-center justify-center border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[...t[28]||(t[28]=[(0,r.Lk)("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,z)]),(0,r.Lk)("div",A,[(0,r.Lk)("span",H," سيتبقى بعد الصرف: "+(0,o.v_)((ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity)-ae.form.quantity),1),(0,r.Lk)("button",{onClick:t[8]||(t[8]=e=>ae.form.quantity=ae.selectedItem.الكميه_المتبقيه||ae.selectedItem.remaining_quantity),class:"text-xs text-blue-600 hover:text-blue-800"}," استخدام الكل ")])]),(0,r.Lk)("div",null,[t[29]||(t[29]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"أولوية الصرف",-1)),(0,r.Lk)("div",O,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ae.priorityOptions,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.value,onClick:t=>ae.form.priority=e.value,class:(0,o.C4)(["p-3 border rounded-lg text-sm transition-all duration-200 flex items-center justify-center space-x-2 space-x-reverse",ae.form.priority===e.value?e.borderClass+" "+e.bgClass+" "+e.textClass:"border-gray-200 hover:border-gray-300 hover:bg-gray-50 text-gray-700"])},[(0,r.Lk)("span",{class:(0,o.C4)(e.iconClass)},(0,o.v_)(e.icon),3),(0,r.Lk)("span",null,(0,o.v_)(e.label),1)],10,$))),128))])]),(0,r.Lk)("div",null,[t[30]||(t[30]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ملاحظات",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>ae.form.notes=e),rows:"2",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"أضف أي ملاحظات حول عملية الصرف..."},null,512),[[s.Jo,ae.form.notes]])])])])):(0,r.Q3)("",!0),ae.error?((0,r.uX)(),(0,r.CE)("div",J,[(0,r.Lk)("div",N,[t[32]||(t[32]=(0,r.Lk)("svg",{class:"h-5 w-5 text-red-400 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),(0,r.Lk)("p",T,(0,o.v_)(ae.error),1)])])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",G,[(0,r.Lk)("div",Z,[(0,r.Lk)("button",{type:"button",onClick:t[10]||(t[10]=t=>e.$emit("close")),class:"flex-1 px-4 py-3 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors duration-200"}," إلغاء "),(0,r.Lk)("button",{type:"submit",onClick:t[11]||(t[11]=(...e)=>ae.handleSubmit&&ae.handleSubmit(...e)),disabled:ae.loading||!ae.selectedItem||!ae.form.destinationBranch||!ae.form.sourceWarehouse||ae.form.quantity>(ae.selectedItem?.الكميه_المتبقيه||ae.selectedItem?.remaining_quantity||0),class:"flex-1 px-4 py-3 text-sm font-medium text-white bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center"},[ae.loading?((0,r.uX)(),(0,r.CE)("svg",ee,[...t[33]||(t[33]=[(0,r.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,r.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,r.uX)(),(0,r.CE)("svg",te,[...t[34]||(t[34]=[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"},null,-1)])])),(0,r.Lk)("span",null,(0,o.v_)(ae.loading?"جاري الصرف...":"تأكيد الصرف"),1)],8,Y)])])])])):(0,r.Q3)("",!0)}var re=a(953),oe=a(834),se={name:"DispatchModal",props:{isOpen:{type:Boolean,default:!1},item:{type:Object,default:null}},emits:["close","success"],setup(e,{emit:t}){const a=(0,oe.Pj)(),o=(0,re.KR)(!1),s=(0,re.KR)(""),l=(0,re.KR)(null),n=(0,re.KR)(""),i=(0,re.Kh)({sourceWarehouse:"",destinationBranch:"",quantity:1,notes:"",priority:"normal"}),d=[{id:"مصنع البران",name_ar:"مصنع البران",icon:"🏭"},{id:"مخزن الزهراء",name_ar:"مخزن الزهراء",icon:"🏪"}],u=[{value:"normal",label:"عادية",icon:"⏱️",bgClass:"bg-blue-50",borderClass:"border-blue-300",textClass:"text-blue-700",iconClass:"text-blue-500"},{value:"high",label:"عالية",icon:"⚠️",bgClass:"bg-orange-50",borderClass:"border-orange-300",textClass:"text-orange-700",iconClass:"text-orange-500"},{value:"urgent",label:"عاجلة",icon:"🚨",bgClass:"bg-red-50",borderClass:"border-red-300",textClass:"text-red-700",iconClass:"text-red-500"}],c=(0,r.EW)(()=>a.state.warehouses||[]),m=(0,r.EW)(()=>a.state.inventory||[]),v=(0,r.EW)(()=>i.sourceWarehouse?m.value.filter(e=>(e.المخزن_id||e.warehouse_id)===i.sourceWarehouse&&(e.الكميه_المتبقيه||e.remaining_quantity)>0):[]),p=(0,r.EW)(()=>{if(!n.value.trim())return v.value;const e=n.value.toLowerCase().trim();return v.value.filter(t=>{const a=(t.الاسم||t.name||"").toLowerCase(),r=(t.الكود||t.code||"").toLowerCase(),o=(t.اللون||t.color||"").toLowerCase(),s=(t.المورد||t.supplier||"").toLowerCase();return a.includes(e)||r.includes(e)||o.includes(e)||s.includes(e)})}),g=e=>{const t=c.value.find(t=>t.id===e);return t?t.name_ar:e},b=e=>0===e?"text-red-600":e<10?"text-yellow-600":"text-green-600",k=()=>{Object.assign(i,{sourceWarehouse:"",destinationBranch:"",quantity:1,notes:"",priority:"normal"}),l.value=null,s.value="",n.value=""},h=e=>{l.value?.id===e.id?l.value=null:(l.value=e,i.quantity=1)},y=()=>{l.value=null},x=()=>{l.value=null,n.value=""},f=()=>{const e=l.value?.الكميه_المتبقيه||l.value?.remaining_quantity||0;i.quantity<e&&i.quantity++},w=()=>{i.quantity>1&&i.quantity--};(0,r.wB)(()=>e.isOpen,t=>{t&&(k(),e.item&&(h(e.item),i.sourceWarehouse=e.item.المخزن_id||e.item.warehouse_id))}),(0,r.wB)(()=>e.item,t=>{t&&e.isOpen&&(h(t),i.sourceWarehouse=t.المخزن_id||t.warehouse_id)}),(0,r.wB)(()=>i.quantity,e=>{if(l.value){const t=l.value.الكميه_المتبقيه||l.value.remaining_quantity||0;e>t?i.quantity=t:e<1&&(i.quantity=1)}});const L=async()=>{if(!i.sourceWarehouse)return void(s.value="يرجى اختيار المخزن المصدر");if(!i.destinationBranch)return void(s.value="يرجى اختيار الفرع المستلم");if(!l.value)return void(s.value="يرجى اختيار صنف للصرف");if(!i.quantity||i.quantity<=0)return void(s.value="يرجى إدخال كمية صحيحة");const e=l.value.الكميه_المتبقيه||l.value.remaining_quantity||0;if(i.quantity>e)s.value=`الكمية المطلوبة (${i.quantity}) تتجاوز الكمية المتاحة (${e})`;else{o.value=!0,s.value="";try{const e={item_id:l.value.id,from_warehouse:i.sourceWarehouse,to_destination:i.destinationBranch,quantity:i.quantity,cartons:0,single_bottles:i.quantity,notes:i.notes,priority:i.priority};console.log("Dispatching item with data:",e);const r=await a.dispatch("dispatchItem",e);if(!r?.success)throw new Error("فشل في عملية الصرف");console.log("Dispatch completed successfully:",r),k(),t("success",r),setTimeout(()=>{t("close")},500)}catch(r){console.error("Error creating dispatch:",r),s.value=r.message||"فشل في عملية الصرف. يرجى المحاولة مرة أخرى."}finally{o.value=!1}}};return{form:i,loading:o,error:s,selectedItem:l,searchTerm:n,warehouses:c,destinations:d,priorityOptions:u,availableItems:v,filteredItems:p,selectItem:h,clearSelection:y,onWarehouseChange:x,increaseQuantity:f,decreaseQuantity:w,getWarehouseName:g,getStockClass:b,handleSubmit:L}}},le=a(6262);const ne=(0,le.A)(se,[["render",ae],["__scopeId","data-v-770c4848"]]);var ie=ne},8038:function(e,t,a){a.d(t,{A:function(){return le}});var r=a(641),o=a(3751),s=a(33);const l={key:0,class:"modal-overlay"},n={class:"modal-content"},i={class:"modal-header"},d={class:"modal-body"},u={class:"form-group"},c={class:"photo-upload-container"},m={class:"photo-preview-wrapper"},v={class:"photo-actions"},p=["disabled"],g={key:0,class:"spinner spinner-xs",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},b={key:1,class:"photo-action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},k={key:0,class:"photo-info"},h={class:"photo-info-text"},y={class:"form-group"},x={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},f={class:"form-group"},w={class:"form-group"},L={class:"form-group"},_=["value"],C={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},E={class:"form-group"},W={class:"form-group"},M={class:"form-group"},D={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 sm:space-x-reverse mb-4"},X={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},I={class:"form-group"},j={class:"form-group"},q={key:1,class:"form-group"},B={class:"form-group"},V={key:2,class:"alert alert-info"},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},S={key:0},F={key:1},K={class:"col-span-full border-t pt-1 font-medium mt-1"},P={key:3,class:"alert alert-warning"},U={class:"mt-2 text-sm"},R={key:0},z={key:4,class:"alert alert-danger"},A={class:"alert-message"},H={key:5,class:"alert alert-success"},O={class:"alert-message"},$={key:6,class:"alert alert-danger"},J={class:"alert-message"},N={class:"modal-footer"},T={class:"flex gap-2"},G=["disabled"],Z={key:0,class:"spinner spinner-sm",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Y={key:1,class:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function ee(e,t,a,ee,te,ae){return a.isOpen?((0,r.uX)(),(0,r.CE)("div",l,[(0,r.Lk)("div",n,[(0,r.Lk)("div",i,[t[23]||(t[23]=(0,r.Lk)("h2",{class:"modal-title"},"إضافة صنف جديد",-1)),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>ee.closeModal&&ee.closeModal(...e)),class:"modal-close-btn"},[...t[22]||(t[22]=[(0,r.Lk)("svg",{class:"modal-close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,r.Lk)("div",d,[(0,r.Lk)("form",{onSubmit:t[21]||(t[21]=(0,o.D$)((...e)=>ee.handleSubmit&&ee.handleSubmit(...e),["prevent"])),class:"space-y-4"},[(0,r.Lk)("div",u,[t[30]||(t[30]=(0,r.Lk)("label",{class:"form-label"}," صورة الصنف ",-1)),(0,r.Lk)("div",c,[(0,r.Lk)("div",m,[ee.previewPhoto?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"photo-preview",style:(0,s.Tr)({backgroundImage:`url(${ee.previewPhoto})`}),onClick:t[1]||(t[1]=(...e)=>ee.openFilePicker&&ee.openFilePicker(...e))},[...t[24]||(t[24]=[(0,r.Lk)("div",{class:"photo-overlay"},[(0,r.Lk)("svg",{class:"photo-edit-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)])],4)):((0,r.uX)(),(0,r.CE)("div",{key:1,class:"photo-placeholder",onClick:t[2]||(t[2]=(...e)=>ee.openFilePicker&&ee.openFilePicker(...e))},[...t[25]||(t[25]=[(0,r.Lk)("svg",{class:"photo-placeholder-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),(0,r.Lk)("span",{class:"photo-placeholder-text"},"انقر لاختيار صورة",-1)])]))]),(0,r.Lk)("div",v,[(0,r.Lk)("input",{type:"file",ref:"fileInput",accept:"image/*",class:"hidden",onChange:t[3]||(t[3]=(...e)=>ee.handleFileUpload&&ee.handleFileUpload(...e))},null,544),(0,r.Lk)("button",{type:"button",onClick:t[4]||(t[4]=(...e)=>ee.openFilePicker&&ee.openFilePicker(...e)),class:"photo-action-btn"},[...t[26]||(t[26]=[(0,r.Lk)("svg",{class:"photo-action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),(0,r.eW)(" اختيار صورة ",-1)])]),(0,r.Lk)("button",{type:"button",onClick:t[5]||(t[5]=(...e)=>ee.handlePasteFromClipboard&&ee.handlePasteFromClipboard(...e)),class:"photo-action-btn",disabled:ee.clipboardLoading},[ee.clipboardLoading?((0,r.uX)(),(0,r.CE)("svg",g,[...t[27]||(t[27]=[(0,r.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,r.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,r.uX)(),(0,r.CE)("svg",b,[...t[28]||(t[28]=[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])),(0,r.eW)(" "+(0,s.v_)(ee.clipboardLoading?"جاري اللصق...":"لصق من الحافظة"),1)],8,p),ee.previewPhoto?((0,r.uX)(),(0,r.CE)("button",{key:0,type:"button",onClick:t[6]||(t[6]=(...e)=>ee.removePhoto&&ee.removePhoto(...e)),class:"photo-action-btn photo-action-btn-danger"},[...t[29]||(t[29]=[(0,r.Lk)("svg",{class:"photo-action-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),(0,r.eW)(" إزالة الصورة ",-1)])])):(0,r.Q3)("",!0)]),ee.selectedFile?((0,r.uX)(),(0,r.CE)("div",k,[(0,r.Lk)("p",h,(0,s.v_)(ee.selectedFile.name)+" ("+(0,s.v_)(ee.formatFileSize(ee.selectedFile.size))+") ",1)])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",y,[t[31]||(t[31]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)(" الاسم "),(0,r.Lk)("span",{class:"required-star"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[7]||(t[7]=e=>ee.formData.name=e),class:"form-input",placeholder:"أدخل اسم الصنف"},null,512),[[o.Jo,ee.formData.name]])]),(0,r.Lk)("div",x,[(0,r.Lk)("div",f,[t[32]||(t[32]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)(" الكود "),(0,r.Lk)("span",{class:"required-star"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[8]||(t[8]=e=>ee.formData.code=e),class:"form-input",placeholder:"كود الصنف"},null,512),[[o.Jo,ee.formData.code]])]),(0,r.Lk)("div",w,[t[33]||(t[33]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)(" اللون "),(0,r.Lk)("span",{class:"required-star"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[9]||(t[9]=e=>ee.formData.color=e),class:"form-input",placeholder:"لون الصنف"},null,512),[[o.Jo,ee.formData.color]])])]),(0,r.Lk)("div",L,[t[35]||(t[35]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)(" المخزن "),(0,r.Lk)("span",{class:"required-star"},"*")],-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>ee.formData.warehouse_id=e),class:"form-select",required:""},[t[34]||(t[34]=(0,r.Lk)("option",{value:""},"اختر المخزن",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ee.accessibleWarehouses,e=>((0,r.uX)(),(0,r.CE)("option",{key:e.id,value:e.id},(0,s.v_)(e.name_ar),9,_))),128))],512),[[o.u1,ee.formData.warehouse_id]])]),(0,r.Lk)("div",C,[(0,r.Lk)("div",E,[t[36]||(t[36]=(0,r.Lk)("label",{class:"form-label"}," المورد ",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>ee.formData.supplier=e),class:"form-input",placeholder:"اسم المورد"},null,512),[[o.Jo,ee.formData.supplier]])]),(0,r.Lk)("div",W,[t[37]||(t[37]=(0,r.Lk)("label",{class:"form-label"}," مكان الصنف ",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>ee.formData.item_location=e),class:"form-input",placeholder:"مكان الصنف داخل المخزن"},null,512),[[o.Jo,ee.formData.item_location]])])]),(0,r.Lk)("div",M,[t[38]||(t[38]=(0,r.Lk)("label",{class:"form-label"}," طريقة الإضافة ",-1)),(0,r.Lk)("div",D,[(0,r.Lk)("button",{type:"button",onClick:t[13]||(t[13]=e=>ee.addMode="cartons"),class:(0,s.C4)(["mode-btn","cartons"===ee.addMode?"mode-btn-active":"mode-btn-inactive"])}," كراتين ",2),(0,r.Lk)("button",{type:"button",onClick:t[14]||(t[14]=e=>ee.addMode="single"),class:(0,s.C4)(["mode-btn","single"===ee.addMode?"mode-btn-active":"mode-btn-inactive"])}," فردي ",2),(0,r.Lk)("button",{type:"button",onClick:t[15]||(t[15]=e=>ee.addMode="both"),class:(0,s.C4)(["mode-btn","both"===ee.addMode?"mode-btn-active":"mode-btn-inactive"])}," الاثنين معاً ",2)])]),"cartons"===ee.addMode||"both"===ee.addMode?((0,r.uX)(),(0,r.CE)("div",X,[(0,r.Lk)("div",I,[t[39]||(t[39]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)(" عدد الكراتين "),(0,r.Lk)("span",{class:"required-star"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"0",required:"","onUpdate:modelValue":t[16]||(t[16]=e=>ee.formData.cartons_count=e),class:"form-input"},null,512),[[o.Jo,ee.formData.cartons_count,void 0,{number:!0}]])]),(0,r.Lk)("div",j,[t[40]||(t[40]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)(" عدد في الكرتونة "),(0,r.Lk)("span",{class:"required-star"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"1",required:"","onUpdate:modelValue":t[17]||(t[17]=e=>ee.formData.per_carton_count=e),class:"form-input"},null,512),[[o.Jo,ee.formData.per_carton_count,void 0,{number:!0}]])])])):(0,r.Q3)("",!0),"single"===ee.addMode||"both"===ee.addMode?((0,r.uX)(),(0,r.CE)("div",q,[t[41]||(t[41]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)(" عدد القزاز الفردي "),(0,r.Lk)("span",{class:"required-star"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"0",required:"","onUpdate:modelValue":t[18]||(t[18]=e=>ee.formData.single_bottles_count=e),class:"form-input"},null,512),[[o.Jo,ee.formData.single_bottles_count,void 0,{number:!0}]])])):(0,r.Q3)("",!0),(0,r.Lk)("div",B,[t[42]||(t[42]=(0,r.Lk)("label",{class:"form-label"}," ملاحظات ",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[19]||(t[19]=e=>ee.formData.notes=e),rows:"2",class:"form-textarea",placeholder:"ملاحظات إضافية (اختياري)"},null,512),[[o.Jo,ee.formData.notes]])]),ee.showSummary?((0,r.uX)(),(0,r.CE)("div",V,[t[43]||(t[43]=(0,r.Lk)("h4",{class:"alert-title"},"ملخص الكمية:",-1)),(0,r.Lk)("div",Q,["cartons"===ee.addMode||"both"===ee.addMode?((0,r.uX)(),(0,r.CE)("div",S," الكراتين: "+(0,s.v_)(ee.formData.cartons_count)+" × "+(0,s.v_)(ee.formData.per_carton_count)+" = "+(0,s.v_)(ee.cartonsTotal),1)):(0,r.Q3)("",!0),"single"===ee.addMode||"both"===ee.addMode?((0,r.uX)(),(0,r.CE)("div",F," الفردي: "+(0,s.v_)(ee.formData.single_bottles_count),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",K," الإجمالي: "+(0,s.v_)(ee.totalQuantity),1)])])):(0,r.Q3)("",!0),ee.existingItem&&!ee.storeOperationError?((0,r.uX)(),(0,r.CE)("div",P,[t[44]||(t[44]=(0,r.Fv)('<div class="flex items-center" data-v-bf359d62><svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20" data-v-bf359d62><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" data-v-bf359d62></path></svg><h4 class="alert-title" data-v-bf359d62>تم العثور على صنف موجود</h4></div><p class="alert-message" data-v-bf359d62> يوجد بالفعل صنف بنفس الاسم واللون والكود في هذا المخزن. سيتم تحديث الكميات بدلاً من إنشاء صنف جديد. </p>',2)),(0,r.Lk)("div",U,[(0,r.Lk)("p",null,"الكمية الحالية: "+(0,s.v_)(ee.existingItem.remaining_quantity),1),(0,r.Lk)("p",null,"الكمية المضافة سابقاً: "+(0,s.v_)(ee.existingItem.total_added),1),ee.existingItem.photo_url?((0,r.uX)(),(0,r.CE)("p",R,"يوجد صورة مرفقة سابقاً")):(0,r.Q3)("",!0)])])):(0,r.Q3)("",!0),ee.storeOperationError?((0,r.uX)(),(0,r.CE)("div",z,[(0,r.Lk)("p",A,(0,s.v_)(ee.storeOperationError),1)])):(0,r.Q3)("",!0),ee.successMessage?((0,r.uX)(),(0,r.CE)("div",H,[(0,r.Lk)("p",O,(0,s.v_)(ee.successMessage),1)])):(0,r.Q3)("",!0),ee.errorMessage?((0,r.uX)(),(0,r.CE)("div",$,[(0,r.Lk)("p",J,(0,s.v_)(ee.errorMessage),1)])):(0,r.Q3)("",!0),(0,r.Lk)("div",N,[(0,r.Lk)("div",T,[(0,r.Lk)("button",{type:"button",onClick:t[20]||(t[20]=(...e)=>ee.closeModal&&ee.closeModal(...e)),class:"btn-secondary"}," إلغاء "),(0,r.Lk)("button",{type:"submit",disabled:ee.loading||ee.storeOperationLoading||!ee.isFormValid||ee.uploadingPhoto,class:"btn-primary"},[ee.loading||ee.storeOperationLoading||ee.uploadingPhoto?((0,r.uX)(),(0,r.CE)("svg",Z,[...t[45]||(t[45]=[(0,r.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,r.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):((0,r.uX)(),(0,r.CE)("svg",Y,[...t[46]||(t[46]=[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"},null,-1)])])),(0,r.eW)(" "+(0,s.v_)(ee.loading||ee.storeOperationLoading||ee.uploadingPhoto?"جاري الحفظ...":ee.existingItem?"تحديث الكميات":"إضافة الصنف"),1)],8,G)])])],32)])])])):(0,r.Q3)("",!0)}var te=a(953),ae=a(834),re={name:"AddItemModal",props:{isOpen:{type:Boolean,required:!0}},emits:["close","success"],setup(e,{emit:t}){const a=(0,ae.Pj)(),o=(0,te.KR)(!1),s=(0,te.KR)(""),l=(0,te.KR)(""),n=(0,te.KR)("both"),i=(0,te.KR)(null),d=(0,te.KR)(!1),u=(0,te.KR)(!1),c=(0,te.KR)(null),m=(0,te.KR)(""),v=(0,te.KR)(null),p=(0,te.KR)({name:"",code:"",color:"",warehouse_id:"",supplier:"",item_location:"",cartons_count:0,per_carton_count:12,single_bottles_count:0,notes:"",photo_url:null}),g=(0,r.EW)(()=>a.getters.accessibleWarehouses),b=(0,r.EW)(()=>a.state.operationLoading),k=(0,r.EW)(()=>a.state.operationError),h=((0,r.EW)(()=>a.state.user),(0,r.EW)(()=>a.state.user?.uid)),y=((0,r.EW)(()=>a.state.userProfile),(0,r.EW)(()=>p.value.cartons_count*p.value.per_carton_count)),x=(0,r.EW)(()=>{const e=y.value,t=p.value.single_bottles_count||0;return e+t}),f=(0,r.EW)(()=>x.value>0),w=(0,r.EW)(()=>!!p.value.name.trim()&&(!!p.value.code.trim()&&(!!p.value.color.trim()&&(!!p.value.warehouse_id&&("cartons"===n.value?p.value.cartons_count>0&&p.value.per_carton_count>0:"single"===n.value?p.value.single_bottles_count>0:"both"===n.value&&x.value>0))))),L=(0,r.EW)(()=>("cartons"===n.value||"both"===n.value)&&p.value.cartons_count>0);(0,r.wB)(()=>e.isOpen,e=>{if(e&&(C(),g.value.length>0)){const e=a.getters.mainWarehouse;p.value.warehouse_id=e?.id||g.value[0].id}}),(0,r.wB)(g,e=>{if(e.length>0&&!p.value.warehouse_id){const t=a.getters.mainWarehouse;p.value.warehouse_id=t?.id||e[0].id}}),(0,r.wB)([()=>p.value.name,()=>p.value.code,()=>p.value.color,()=>p.value.warehouse_id],async([e,t,a,r])=>{e&&t&&a&&r?await j():i.value=null},{immediate:!0});const _=()=>{t("close"),C()},C=()=>{p.value={name:"",code:"",color:"",warehouse_id:g.value.length>0?a.getters.mainWarehouse?.id||g.value[0].id:"",supplier:"",item_location:"",cartons_count:0,per_carton_count:12,single_bottles_count:0,notes:"",photo_url:null},n.value="both",s.value="",l.value="",i.value=null,c.value=null,m.value="",a.dispatch("clearOperationError")},E=e=>{if(0===e)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+a[r]},W=()=>{v.value&&v.value.click()},M=e=>{const t=e.target.files[0];if(!t)return;if(!t.type.startsWith("image/"))return void(s.value="يرجى اختيار ملف صورة فقط");if(t.size>5242880)return void(s.value="حجم الصورة يجب أن يكون أقل من 5MB");c.value=t;const a=new FileReader;a.onload=e=>{m.value=e.target.result},a.readAsDataURL(t),v.value&&(v.value.value="")},D=()=>{c.value=null,m.value="",p.value.photo_url=null},X=async()=>{u.value=!0,s.value="";try{if(!navigator.clipboard||!navigator.clipboard.read)return void(s.value="ميزة لصق الصور من الحافظة غير مدعومة في هذا المتصفح");const e=await navigator.clipboard.read();for(const t of e){const e=t.types.filter(e=>e.startsWith("image/"));if(e.length>0){const a=e[0],r=await t.getType(a),o=new File([r],`pasted-image-${Date.now()}.${a.split("/")[1]}`,{type:a});c.value=o;const s=new FileReader;s.onload=e=>{m.value=e.target.result},s.readAsDataURL(r),l.value="تم لصق الصورة من الحافظة بنجاح";break}}c.value||(s.value="لا توجد صورة في الحافظة")}catch(e){console.error("Error pasting from clipboard:",e),s.value="حدث خطأ أثناء لصق الصورة من الحافظة. تأكد من وجود صورة في الحافظة وأنك قد منحت الإذن للوصول إلى الحافظة."}finally{u.value=!1}},I=async()=>{if(!c.value)return null;d.value=!0;try{return new Promise(e=>{const t=new FileReader;t.onload=t=>{setTimeout(()=>{e(t.target.result)},1e3)},t.readAsDataURL(c.value)})}catch(e){return console.error("Error uploading photo:",e),s.value="حدث خطأ أثناء رفع الصورة",null}finally{d.value=!1}},j=async()=>{if(p.value.name&&p.value.code&&p.value.color&&p.value.warehouse_id)try{const e=await a.dispatch("checkExistingItem",{name:p.value.name.trim(),code:p.value.code.trim(),color:p.value.color.trim(),warehouse_id:p.value.warehouse_id});e&&e.exists&&e.item?(i.value=e.item,e.item.photo_url&&(m.value=e.item.photo_url,p.value.photo_url=e.item.photo_url)):i.value=null}catch(e){console.error("Error checking existing item:",e),i.value=null}else i.value=null},q=()=>{if(s.value="",a.dispatch("clearOperationError"),!p.value.name.trim())return s.value="يرجى إدخال اسم الصنف",!1;if(!p.value.code.trim())return s.value="يرجى إدخال كود الصنف",!1;if(!p.value.color.trim())return s.value="يرجى إدخال لون الصنف",!1;if(!p.value.warehouse_id)return s.value="يرجى اختيار المخزن",!1;if(!h.value)return s.value="يجب تسجيل الدخول أولاً",!1;if(!a.getters.canEdit)return s.value="ليس لديك صلاحية لإضافة أصناف",!1;if("cartons"===n.value){if(!p.value.cartons_count||p.value.cartons_count<=0)return s.value="يرجى إدخال عدد كراتين صحيح",!1;if(!p.value.per_carton_count||p.value.per_carton_count<=0)return s.value="يرجى إدخال عدد صحيح في الكرتونة",!1}else if("single"===n.value){if(!p.value.single_bottles_count||p.value.single_bottles_count<=0)return s.value="يرجى إدخال عدد فردي صحيح",!1}else if("both"===n.value){const e=p.value.cartons_count&&p.value.cartons_count>0&&p.value.per_carton_count&&p.value.per_carton_count>0,t=p.value.single_bottles_count&&p.value.single_bottles_count>0;if(!e&&!t)return s.value="يرجى إدخال كميات صحيحة إما في الكراتين أو الفردي",!1}return!(x.value<=0)||(s.value="يرجى إدخال كمية صحيحة",!1)},B=async()=>{if(q()){o.value=!0,s.value="",l.value="";try{if(c.value&&!m.value.startsWith("data:image/")){const e=await I();e&&(p.value.photo_url=e)}else m.value&&m.value.startsWith("data:image/")&&(p.value.photo_url=m.value);const e=h.value;if(!e)throw new Error("يجب تسجيل الدخول أولاً");const r=L.value,o={name:p.value.name.trim(),code:p.value.code.trim(),color:p.value.color.trim(),warehouse_id:p.value.warehouse_id,cartons_count:p.value.cartons_count||0,per_carton_count:p.value.per_carton_count||(r?12:1),single_bottles_count:p.value.single_bottles_count||0,supplier:p.value.supplier?.trim()||"",item_location:p.value.item_location?.trim()||"",notes:p.value.notes?.trim()||"",photo_url:p.value.photo_url||null};console.log("Submitting item with data:",{itemData:o,userId:e,addingCartons:r,existingItem:i.value});const s=await a.dispatch("addInventoryItemAtomic",{itemData:o,userId:e,isAddingCartons:r});console.log("Item operation completed:",s),l.value="created"===s?.type?"تم إضافة الصنف الجديد بنجاح!":"updated"===s?.type?"تم تحديث الكميات بنجاح!":"تم حفظ التغييرات بنجاح!",setTimeout(()=>{t("success",s||{type:i.value?"updated":"created"}),_()},1500)}catch(e){console.error("Error in handleSubmit:",e),e.message?.includes("يجب تسجيل الدخول")?s.value="يجب تسجيل الدخول أولاً":e.message?.includes("صلاحية")?s.value="ليس لديك صلاحية لإضافة أصناف. يرجى التواصل مع المشرف.":e.message?.includes("مطلوب")||e.message?.includes("الحقل")?s.value=e.message:e.message?.includes("الشبكة")||e.message?.includes("الاتصال")?s.value="خطأ في الاتصال بالشبكة. يرجى التحقق من اتصال الإنترنت والمحاولة مرة أخرى.":k.value?s.value=k.value:s.value=`حدث خطأ أثناء حفظ الصنف: ${e.message||"خطأ غير معروف"}`}finally{o.value=!1}}};return{loading:o,errorMessage:s,successMessage:l,addMode:n,existingItem:i,formData:p,accessibleWarehouses:g,storeOperationLoading:b,storeOperationError:k,cartonsTotal:y,totalQuantity:x,showSummary:f,isFormValid:w,uploadingPhoto:d,clipboardLoading:u,selectedFile:c,previewPhoto:m,fileInput:v,closeModal:_,handleSubmit:B,formatFileSize:E,openFilePicker:W,handleFileUpload:M,handlePasteFromClipboard:X,removePhoto:D}}},oe=a(6262);const se=(0,oe.A)(re,[["render",ee],["__scopeId","data-v-bf359d62"]]);var le=se}}]);